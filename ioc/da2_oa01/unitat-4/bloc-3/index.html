---
layout: bloc
title: "Bloc 3: Rendiment i optimitzaci√≥"
description: "Detecci√≥ de canvis, virtualitzaci√≥ i desplegament a producci√≥"
keywords: "Angular, detecci√≥ de canvis, OnPush, virtualitzaci√≥, desplegament, optimitzaci√≥"
unitat: 4
bloc: 3
bloc_numero: 3
---

<!--
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  BLOC 3 - UNITAT 4
  Contingut migrat des de:
  - .resources/Autoria/Unitat4/Lli√ßo3/OA1/lectura-u4-l3-oa1.md
  - .resources/Autoria/Unitat4/Lli√ßo3/OA2/lectura-u4-l3-oa2.md
  - .resources/Autoria/Unitat4/Lli√ßo3/OA3/lectura-u4-l3-oa3.md
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-->

<div class="section" id="Unitat4_Bloc3_Seccio1">
  <h2 id="Unitat4_Bloc3_Seccio1">1. Detecci√≥ de canvis i estrat√®gies d'optimitzaci√≥</h2>

  {% include objectius.html llista="Comprendre com funciona el mecanisme de detecci√≥ de canvis d'Angular i quan s'actualitza la interf√≠cie.|Aplicar l'estrat√®gia OnPush per optimitzar components reduint comprovacions innecess√†ries.|Mantenir immutabilitat en objectes i arrays per garantir el funcionament correcte d'OnPush.|Utilitzar detecci√≥ manual quan calgui for√ßar actualitzacions en situacions espec√≠fiques." %}

  {% include info_box.html contingut="<strong>RA4 ¬∑ Criteri 4</strong> ‚Äî Optimitza els recursos i genera un paquet llest per a publicaci√≥." %}

  {% capture section_point_1_1 %}
  <ul>
    <li><strong>Unitats 2 i 3 completades:</strong> Heu treballat amb components, data binding, i gesti√≥ d'estat amb observables</li>
    <li><strong>Conceptes de mutabilitat:</strong> Enteneu la difer√®ncia entre modificar un objecte directament i crear-ne un de nou</li>
    <li><strong>Operador spread:</strong> Sabeu utilitzar <code>{ ...obj }</code> i <code>[ ...array ]</code> per crear c√≤pies d'objectes i arrays</li>
    <li><strong>DevTools del navegador:</strong> Domini b√†sic de les eines de desenvolupador per mesurar rendiment (Performance tab)</li>
    <li><strong>Components amb <code>@Input()</code>:</strong> Experi√®ncia passant dades de components pares a fills</li>
  </ul>

  <p><strong>Verificaci√≥ r√†pida:</strong></p>

{% capture code_87 %}ng serve --open
# Obrir DevTools (F12) ‚Üí Performance tab ‚Üí gravar perfil{% endcapture %}
  {% include code-block.html lang="bash" code=code_87 %}

  <p><strong>Punt d'autocomprovaci√≥:</strong> Teniu una aplicaci√≥ funcional amb components que reben dades via <code>@Input()</code> i podeu obrir el Performance profiler de Chrome DevTools.</p>
  {% endcapture %}
  {% include section-point.html numero="1.1" titol="Prerequisits" contingut=section_point_1_1 %}

  {% capture section_point_1_2 %}
  <h4>1.2.1. Qu√® √©s la detecci√≥ de canvis</h4>
  <p>La detecci√≥ de canvis (change detection) √©s el mecanisme pel qual Angular detecta quan les dades de l'aplicaci√≥ han canviat i actualitza autom√†ticament la interf√≠cie per reflectir aquests canvis. Cada vegada que hi ha un esdeveniment (clic, petici√≥ HTTP, timer), Angular comprova tots els components per veure si les seves dades han canviat i actualitza el DOM si cal.</p>

  <h4>1.2.2. Problema sense optimitzaci√≥ de detecci√≥ de canvis</h4>
  <p><strong>Situaci√≥ abans:</strong></p>

  <p>Angular comprova tots els components de l'arbre sencer cada vegada que hi ha qualsevol esdeveniment, fins i tot si la majoria de components no han canviat. En una aplicaci√≥ amb 200 components, un sol clic activa 200 comprovacions, la majoria innecess√†ries.</p>

{% capture code_88 %}Aplicaci√≥ amb 200 components
‚îú‚îÄ‚îÄ HeaderComponent
‚îú‚îÄ‚îÄ NavigationComponent
‚îú‚îÄ‚îÄ ProductListComponent
‚îÇ   ‚îú‚îÄ‚îÄ ProductCardComponent (√ó50 productes)
‚îÇ   ‚îú‚îÄ‚îÄ FilterPanelComponent
‚îÇ   ‚îî‚îÄ‚îÄ PaginationComponent
‚îú‚îÄ‚îÄ SidebarComponent
‚îî‚îÄ‚îÄ FooterComponent
Usuari clica un bot√≥ al HeaderComponent
‚Üí Angular comprova els 200 components
‚Üí 199 components no han canviat (comprovacions in√∫tils)
‚Üí 1 component ha canviat (HeaderComponent){% endcapture %}
  {% include code-block.html lang="text" code=code_88 %}

  <p>Cada comprovaci√≥ consumeix CPU: comparar propietats, executar funcions getter, avaluar expressions. Amb llistes grans, aix√≤ es multiplica exponencialment.</p>

  <p><strong>Problemes que genera:</strong></p>

  <p><strong>1. Rendiment degradat amb llistes grans</strong></p>

  <p>Una llista de 100 productes amb 5 propietats visibles per producte significa 500 comparacions per cada esdeveniment. Si l'usuari escriu en un camp de cerca (50 esdeveniments/segon mentre escriu), Angular fa 25.000 comparacions per segon. Aix√≤ causa lag perceptible: l'usuari escriu "laptop" per√≤ nom√©s veu "lap" fins 300ms despr√©s.</p>

  <p>Mesures reals en aplicaci√≥ de prova:</p>
  <ul>
    <li>10 components: 2ms per cicle de detecci√≥</li>
    <li>100 components: 18ms per cicle de detecci√≥</li>
    <li>500 components: 85ms per cicle de detecci√≥ (interf√≠cie es sent lenta)</li>
    <li>1000 components: 180ms per cicle de detecci√≥ (interf√≠cie congelada)</li>
  </ul>

  <p><strong>2. Consum excessiu de CPU i bateria</strong></p>

  <p>Cada comprovaci√≥ innecess√†ria consumeix cicles de CPU. En dispositius m√≤bils o port√†tils, aix√≤ dren√† la bateria r√†pidament. Una aplicaci√≥ que fa 50 cicles de detecci√≥ per segon consumeix 15-20% m√©s CPU que una aplicaci√≥ optimitzada que nom√©s fa 5 cicles per segon.</p>

  <p>Usuaris es queixen que "l'aplicaci√≥ web escalfa l'ordinador" o "la bateria del m√≤bil es gasta r√†pidament". Aquests s√≥n s√≠mptomes t√≠pics de detecci√≥ de canvis no optimitzada.</p>

  <p><strong>3. Avaluaci√≥ repetida de funcions getter</strong></p>

  <p>Si utilitzeu funcions al template (<code>{{ "{{" }} calculateTotal() }}</code>), Angular les executa en cada cicle de detecci√≥. Una funci√≥ que es crida 200 vegades per segon pot causar problemes de rendiment si fa c√†lculs complexos.</p>

{% capture code_89 %}// Incorrecte: Aix√≤ s'executa centenars de vegades per segon
get expensiveCalculation(): number {
  return this.items.reduce((sum, item) => sum + item.price * item.quantity, 0);
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_89 %}

  <p><strong>4. Experi√®ncia d'usuari negativa</strong></p>

  <p>Els usuaris perceben retards superiors a 100ms. Una aplicaci√≥ que triga 180ms a respondre a un clic se sent "trencada" o "lenta". Aix√≤ afecta directament la satisfacci√≥ de l'usuari i la taxa de conversi√≥: estudis mostren que cada 100ms de retard redueix les conversions un 7%.</p>

  <p><strong>5. Escalabilitat limitada</strong></p>

  <p>Sense optimitzaci√≥, l'aplicaci√≥ no escala b√©. Afegir nous components degrada progressivament el rendiment. Una aplicaci√≥ que funciona b√© amb 50 components pot ser inutilitzable amb 500 components si no s'optimitza la detecci√≥ de canvis.</p>

  <h4>1.2.3. Soluci√≥ amb estrat√®gies d'optimitzaci√≥</h4>
  <p>Angular ofereix l'estrat√®gia OnPush que nom√©s comprova un component quan les seves entrades (<code>@Input()</code>) canvien de refer√®ncia o quan hi ha un esdeveniment dins del component. Aix√≤ redueix les comprovacions en un 80-95% en aplicacions t√≠piques.</p>

  <p><strong>Avantatges principals:</strong></p>
  <ol>
    <li><strong>Rendiment dram√†ticament millorat:</strong> 180ms ‚Üí 10ms per cicle en aplicacions grans</li>
    <li><strong>Consum de CPU redu√Øt:</strong> 85% menys cicles de detecci√≥ innecessaris</li>
    <li><strong>Escalabilitat:</strong> L'aplicaci√≥ mant√© bon rendiment amb centenars de components</li>
    <li><strong>Bateria preservada:</strong> 15-20% menys consum energ√®tic en dispositius m√≤bils</li>
    <li><strong>Experi√®ncia d'usuari fluida:</strong> Respostes instant√†nies (&lt; 16ms) sense lag perceptible</li>
  </ol>

  <h4>1.2.4. Exemple real complet: Sense vs Amb OnPush</h4>
  <p><strong>Situaci√≥:</strong> Una llista de 100 productes on l'usuari pot clicar "Afegir a preferits" en qualsevol producte.</p>

  <p><strong>Sense OnPush (estrat√®gia Default):</strong></p>

{% capture code_90 %}// product-card.component.ts
@Component({
  selector: 'app-product-card',
  template: `
    <div class="card">
      <h3>{{ "{{" }} product.name }}</h3>
      <p>{{ "{{" }} product.price }}‚Ç¨</p>
      <button (click)="toggleFavorite()">
        {{ "{{" }} isFavorite() ? '‚ù§Ô∏è' : 'ü§ç' }}
      </button>
    </div>
  `
  // changeDetection: ChangeDetectionStrategy.Default (per defecte)
})
export class ProductCardComponent {
  @Input() product!: Product;
  @Input() favorites: number[] = [];
  // Incorrecte: Aquesta funci√≥ s'executa 100 vegades (una per cada component)
  // en CADA cicle de detecci√≥
  isFavorite(): boolean {
    return this.favorites.includes(this.product.id);
  }
  toggleFavorite(): void {
    // Quan l'usuari clica aqu√≠, Angular comprova els 100 components
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_90 %}

  <p><strong>Comportament:</strong></p>
  <ul>
    <li>Usuari clica "Afegir a preferits" en un producte</li>
    <li>Angular comprova els 100 ProductCardComponent</li>
    <li>Cada component executa <code>isFavorite()</code> ‚Üí 100 execucions</li>
    <li>Nom√©s 1 component ha canviat realment</li>
    <li><strong>Temps: 85ms per cicle</strong></li>
  </ul>

  <p><strong>Amb OnPush (optimitzat):</strong></p>

{% capture code_91 %}// product-card.component.ts
@Component({
  selector: 'app-product-card',
  template: `
    <div class="card">
      <h3>{{ "{{" }} product.name }}</h3>
      <p>{{ "{{" }} product.price }}‚Ç¨</p>
      <button (click)="toggleFavorite.emit(product.id)">
        {{ "{{" }} isFavorite ? '‚ù§Ô∏è' : 'ü§ç' }}
      </button>
    </div>
  `,
  changeDetection: ChangeDetectionStrategy.OnPush // Correcte: Optimitzat
})
export class ProductCardComponent {
  @Input() product!: Product;
  @Input() isFavorite: boolean = false; // Rebut del pare, ja calculat
  @Output() toggleFavorite = new EventEmitter<number>();
  // Correcte: No hi ha funcions getter; nom√©s propietats
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_91 %}

  <p><strong>Comportament:</strong></p>
  <ul>
    <li>Usuari clica "Afegir a preferits" en un producte</li>
    <li>Angular nom√©s comprova el component que va rebre el clic</li>
    <li>Cap altre component es comprova (les seves entrades no han canviat)</li>
    <li><strong>Temps: 5ms per cicle</strong></li>
  </ul>

  <p><strong>Millora: 94% m√©s r√†pid.</strong></p>

  <h4>1.2.5. Taula comparativa: Abans vs Despr√©s</h4>
  <table>
    <thead>
      <tr>
        <th>Aspecte</th>
        <th>Estrat√®gia Default</th>
        <th>Estrat√®gia OnPush</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Components comprovats per cicle</strong></td>
        <td>100 (tots)</td>
        <td>1-5 (nom√©s els afectats)</td>
      </tr>
      <tr>
        <td><strong>Temps per cicle (100 components)</strong></td>
        <td>85ms</td>
        <td>5ms</td>
      </tr>
      <tr>
        <td><strong>CPU utilitzada</strong></td>
        <td>100% (baseline)</td>
        <td>15%</td>
      </tr>
      <tr>
        <td><strong>Funcions getter executades</strong></td>
        <td>100 per cicle</td>
        <td>0 per cicle</td>
      </tr>
      <tr>
        <td><strong>Escalabilitat</strong></td>
        <td>Degrada amb m√©s components</td>
        <td>Mant√© rendiment constant</td>
      </tr>
      <tr>
        <td><strong>Bateria m√≤bil</strong></td>
        <td>Drena 20% m√©s r√†pid</td>
        <td>Consum normal</td>
      </tr>
    </tbody>
  </table>

  <h4>1.2.6. Conceptes clau de detecci√≥ de canvis</h4>
  <table>
    <thead>
      <tr>
        <th>Concepte</th>
        <th>Descripci√≥</th>
        <th>Exemple</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Change detection</strong></td>
        <td>Mecanisme que detecta canvis en dades i actualitza DOM</td>
        <td>Usuari clica ‚Üí Angular comprova components ‚Üí Actualitza vista</td>
      </tr>
      <tr>
        <td><strong>Estrat√®gia Default</strong></td>
        <td>Comprova tots els components en cada esdeveniment</td>
        <td>100 components ‚Üí 100 comprovacions per clic</td>
      </tr>
      <tr>
        <td><strong>Estrat√®gia OnPush</strong></td>
        <td>Nom√©s comprova quan entrades canvien de refer√®ncia</td>
        <td>100 components ‚Üí 1-5 comprovacions per clic</td>
      </tr>
      <tr>
        <td><strong>Refer√®ncia d'objecte</strong></td>
        <td>Adre√ßa de mem√≤ria de l'objecte, no el contingut</td>
        <td><code>obj = { ...obj }</code> crea nova refer√®ncia</td>
      </tr>
      <tr>
        <td><strong>Immutabilitat</strong></td>
        <td>No modificar objectes directament; crear-ne de nous</td>
        <td><code>arr.push()</code> Incorrecte vs <code>arr = [...arr, item]</code> Correcte</td>
      </tr>
    </tbody>
  </table>

  <h4>1.2.7. Quan usar estrat√®gia OnPush</h4>
  <p><strong>Correcte: Sempre que sigui possible:</strong></p>
  <ul>
    <li>Components presentacionals que nom√©s mostren dades</li>
    <li>Components de llistes amb molts elements repetits</li>
    <li>Components que reben dades via <code>@Input()</code> sense modificar-les internament</li>
    <li>Aplicacions grans amb m√©s de 50 components</li>
    <li>Quan el rendiment √©s cr√≠tica (aplicacions m√≤bils, dashboards en temps real)</li>
  </ul>

  <p><strong>Incorrecte: Evitar en casos espec√≠fics:</strong></p>
  <ul>
    <li>Components amb l√≤gica molt complexa interna que modifica dades constantment</li>
    <li>Quan no podeu garantir immutabilitat (integracions amb llibreries externes que muten objectes)</li>
    <li>Components que necessiten actualitzar-se autom√†ticament amb intervals (<code>setInterval</code>)</li>
  </ul>

  <p><strong>Regla pr√†ctica:</strong> Comenceu amb OnPush per defecte i nom√©s torneu a Default si trobeu problemes espec√≠fics que no podeu resoldre amb immutabilitat o detecci√≥ manual.</p>

  <h4>1.2.8. Caracter√≠stiques principals</h4>
  <p><strong>1. Comprovaci√≥ basada en refer√®ncies</strong></p>
  <p>OnPush compara refer√®ncies d'objectes, no el contingut. Si passeu el mateix objecte per√≤ heu modificat una propietat interna, OnPush no detecta el canvi. Heu de crear un nou objecte per activar la detecci√≥.</p>

  <p><strong>2. Millora dram√†tica de rendiment</strong></p>
  <p>En aplicacions reals, OnPush redueix les comprovacions en un 80-95%. Una aplicaci√≥ amb 500 components passa de 180ms per cicle a 10ms per cicle, fent la interf√≠cie sentir-se instant√†nia.</p>

  <p><strong>3. Requereix immutabilitat</strong></p>
  <p>Per funcionar correctament, OnPush necessita que seguiu patrons d'immutabilitat: crear nous objectes i arrays en lloc de modificar els existents. Aix√≤ √©s un canvi de mentalitat per√≤ garanteix rendiment i predictibilitat.</p>

  <p><strong>4. Compatible amb observables</strong></p>
  <p>OnPush funciona perfectament amb observables i l'<code>async</code> pipe. Quan un observable emet un nou valor, l'<code>async</code> pipe activa la detecci√≥ autom√†ticament.</p>

  <p><strong>5. Detecci√≥ manual disponible</strong></p>
  <p>En situacions on necessiteu for√ßar una actualitzaci√≥ (per exemple, despr√©s d'un <code>setTimeout</code>), podeu cridar manualment <code>ChangeDetectorRef.detectChanges()</code> o <code>markForCheck()</code>.</p>

  <h4>1.2.9. Integraci√≥ amb el flux de treball del cat√†leg d'elements</h4>
  <p>En el projecte del cat√†leg d'elements, l'estrat√®gia OnPush √©s ideal per:</p>
  <ul>
    <li><strong>Targetes de productes:</strong> Cada <code>ElementCardComponent</code> amb OnPush redueix les comprovacions de 50 elements a nom√©s els que canvien quan l'usuari filtra o ordena.</li>
    <li><strong>Llista filtrada:</strong> Quan l'usuari aplica un filtre, nom√©s els components afectats pel canvi de llista es recomproven, no tots els components de l'aplicaci√≥.</li>
    <li><strong>Components de paginaci√≥:</strong> El component de paginaci√≥ amb OnPush nom√©s es comprova quan l'usuari canvia de p√†gina, no en cada esdeveniment de l'aplicaci√≥.</li>
  </ul>

  <p>Aix√≤ garanteix que l'aplicaci√≥ mant√© bon rendiment fins i tot amb centenars d'elements al cat√†leg, oferint una experi√®ncia fluida sense lag.</p>
  {% endcapture %}
  {% include section-point.html numero="1.2" titol="Marc conceptual" contingut=section_point_1_2 %}

  {% capture section_point_1_3 %}
  <p><strong>Inspector d'edificis amb zones diferenciades</strong></p>
  <p>Imagineu un inspector que ha de revisar un edifici de 100 apartaments cada dia. Amb l'estrat√®gia Default, l'inspector entra a tots els 100 apartaments cada dia, fins i tot si nom√©s 2 apartaments han tingut canvis. Amb l'estrat√®gia OnPush, l'inspector nom√©s entra als apartaments que tenen una nota a la porta dient "Hi ha canvis aqu√≠". Aix√≤ redueix 100 inspeccions a nom√©s 2.</p>

  <p><strong>Biblioteca amb sistema de notificacions</strong></p>
  <p>Una biblioteca t√© milers de llibres. Amb Default, el bibliotecari revisa cada llibre cada dia per veure si est√† danyat. Amb OnPush, cada llibre t√© un sensor que envia una notificaci√≥ nom√©s quan hi ha un problema. El bibliotecari nom√©s revisa els llibres que han enviat notificaci√≥, estalviant centenars d'hores de comprovacions innecess√†ries.</p>

  <p><strong>Sistema d'alarmes per zones</strong></p>
  <p>Un centre comercial t√© 200 botigues. Amb Default, el gu√†rdia de seguretat revisa les 200 botigues cada 5 minuts tot el dia. Amb OnPush, cada botiga t√© una alarma que salta nom√©s quan hi ha un problema. El gu√†rdia nom√©s investiga quan salta una alarma, en lloc de revisar constantment totes les botigues.</p>

  <p><strong>Servei postal amb notificacions</strong></p>
  <p>El carter tradicional (Default) comprova totes les adreces cada dia, fins i tot les que no tenen correu. El servei modern (OnPush) nom√©s notifica les adreces que tenen correu nou. Si no hi ha notificaci√≥, el carter no perd temps visitant aquella adre√ßa. Aix√≤ permet gestionar moltes m√©s adreces amb el mateix esfor√ß.</p>

  <p><strong>Hospital amb monitors de pacients</strong></p>
  <p>En un hospital, el metge tradicional (Default) revisa tots els 100 pacients cada hora, prenent constants vitals encara que estiguin estables. Amb monitors intel¬∑ligents (OnPush), nom√©s salta l'alarma quan hi ha un canvi significatiu en les constants d'un pacient. El metge nom√©s revisa els pacients amb alertes, permetent atendre m√©s pacients eficientment.</p>
  {% endcapture %}
  {% include section-point.html numero="1.3" titol="Model mental" contingut=section_point_1_3 %}

  {% capture section_point_1_4 %}
  <h4>1.4.1. Objectiu</h4>
  <p>Comprendre el mecanisme b√†sic de detecci√≥ de canvis d'Angular i quan s'activa.</p>

  <h4>1.4.2. El cicle de detecci√≥ de canvis</h4>
  <p>Angular comprova autom√†ticament si les dades dels components han canviat i actualitza el DOM quan detecta difer√®ncies. Aquest proc√©s s'anomena "cicle de detecci√≥ de canvis" i s'activa despr√©s de qualsevol esdeveniment as√≠ncron.</p>

  <h4>1.4.3. Esdeveniments que activen la detecci√≥</h4>
  <p>Angular intercepta esdeveniments as√≠ncrons mitjan√ßant Zone.js i llan√ßa un cicle de detecci√≥ despr√©s de cadascun:</p>

  <p><strong>1. Esdeveniments d'usuari:</strong></p>
  <ul>
    <li>Clics de botons: <code>(click)="handleClick()"</code></li>
    <li>Canvis en inputs: <code>(input)="handleInput($event)"</code></li>
    <li>Enviament de formularis: <code>(submit)="handleSubmit()"</code></li>
  </ul>

  <p><strong>2. Peticions HTTP:</strong></p>

{% capture code_92 %}this.http.get('/api/products').subscribe(data => {
  this.products = data; // ‚Üê Detecci√≥ s'activa despr√©s de l'assignaci√≥
});{% endcapture %}
  {% include code-block.html lang="typescript" code=code_92 %}

  <p><strong>3. Timers:</strong></p>

{% capture code_93 %}setTimeout(() => {
  this.message = 'Actualitzat!'; // ‚Üê Detecci√≥ s'activa despr√©s del timeout
}, 1000);
setInterval(() => {
  this.counter++; // ‚Üê Detecci√≥ s'activa cada interval
}, 1000);{% endcapture %}
  {% include code-block.html lang="typescript" code=code_93 %}

  <h4>1.4.4. El proc√©s de comprovaci√≥</h4>
  <p>Quan s'activa un cicle de detecci√≥, Angular:</p>
  <ol>
    <li>Comprova cada component de l'arbre des del root fins a les fulles</li>
    <li>Compara els valors actuals de les propietats amb els valors anteriors</li>
    <li>Si detecta difer√®ncies, actualitza el DOM corresponent</li>
    <li>Repeteix el proc√©s per components fills</li>
  </ol>

{% capture code_94 %}AppComponent (root)
  ‚Üì comprova propietats
HeaderComponent
  ‚Üì comprova propietats
ProductListComponent
  ‚Üì comprova propietats
ProductCardComponent (√ó100)
  ‚Üì comprova propietats de cada un{% endcapture %}
  {% include code-block.html lang="text" code=code_94 %}

  <h4>1.4.5. Exemple visual: Qu√® comprova Angular</h4>

{% capture code_95 %}@Component({
  template: `
    <h1>{{ "{{" }} title }}</h1>
    <p>Preu: {{ "{{" }} product.price }}‚Ç¨</p>
    <button (click)="increment()">{{ "{{" }} counter }}</button>
  `
})
export class MyComponent {
  title = 'Botiga';
  product = { price: 10 };
  counter = 0;
  increment() {
    this.counter++; // ‚Üê Canvi detectat
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_95 %}

  <p>Quan l'usuari clica el bot√≥:</p>
  <ol>
    <li>S'executa <code>increment()</code> ‚Üí <code>counter</code> passa de 0 a 1</li>
    <li>Angular comprova: <code>title</code> (no ha canviat), <code>product.price</code> (no ha canviat), <code>counter</code> (ha canviat! 0 ‚Üí 1)</li>
    <li>Angular actualitza nom√©s el DOM del bot√≥ amb el nou valor de <code>counter</code></li>
  </ol>

  {% include success_box.html contingut="<strong>Clau:</strong> Angular activa un cicle de detecci√≥ de canvis despr√©s de cada esdeveniment as√≠ncron, comprovant tots els components de l'arbre per defecte." %}

  <h4>1.4.6. Resultat esperat</h4>
  <p>Comprensi√≥ de quan Angular activa la detecci√≥ de canvis i qu√® comprova en cada cicle.</p>
  {% endcapture %}
  {% include section-point.html numero="1.4" titol="Com funciona la detecci√≥ de canvis: quan s'actualitza la interf√≠cie" contingut=section_point_1_4 %}

  {% capture section_point_1_5 %}
  <h4>1.5.1. Objectiu</h4>
  <p>Quantificar el cost de rendiment de la detecci√≥ de canvis en aplicacions grans i identificar colls d'ampolla.</p>

  <h4>1.5.2. Mesures reals de rendiment</h4>
  <p>El cost de la detecci√≥ de canvis creix linealment amb el nombre de components i exponencialment amb la complexitat de cada component.</p>

  <p><strong>Aplicaci√≥ de prova amb components simples:</strong></p>
  <ul>
    <li>10 components: ~2ms per cicle</li>
    <li>50 components: ~8ms per cicle</li>
    <li>100 components: ~18ms per cicle</li>
    <li>500 components: ~85ms per cicle</li>
    <li>1000 components: ~180ms per cicle</li>
  </ul>

  <p><strong>Aplicaci√≥ de prova amb llista de 100 elements:</strong></p>
  <ul>
    <li>Cada element amb 5 propietats simples: ~18ms</li>
    <li>Cada element amb 2 funcions getter: ~45ms</li>
    <li>Cada element amb transformacions de dades: ~120ms</li>
  </ul>

  <h4>1.5.3. On es perd el temps</h4>
  <p><strong>1. Avaluaci√≥ d'expressions al template</strong></p>
  <p>Cada expressi√≥ al template s'avalua en cada cicle:</p>

{% capture code_96 %}<div>
{{ "{{" }} calculateTotal() }}           ‚Üê Executa la funci√≥ cada cicle
{{ "{{" }} product.price * 1.21 }}      ‚Üê Calcula cada cicle
{{ "{{" }} items.length > 0 ? 'S√≠' : 'No' }} ‚Üê Avalua cada cicle
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_96 %}

  <p>Amb 100 components, aix√≤ significa 100 execucions de <code>calculateTotal()</code> per cada esdeveniment d'usuari.</p>

  <p><strong>2. Funcions getter costoses</strong></p>

{% capture code_97 %}get filteredProducts(): Product[] {
  return this.products.filter(p => p.category === this.selectedCategory);
  // Incorrecte: Aix√≤ filtra l'array complet en cada cicle de detecci√≥
  // Amb 1000 productes i 50 cicles/segon = 50.000 iteracions/segon
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_97 %}

  <h4>1.5.4. Comparaci√≥: Component simple vs complex</h4>
  <table>
    <thead>
      <tr>
        <th>Tipus component</th>
        <th>Propietats</th>
        <th>Getters</th>
        <th>Temps/component</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Simple</td>
        <td>3</td>
        <td>0</td>
        <td>0.15ms</td>
      </tr>
      <tr>
        <td>Mitj√†</td>
        <td>8</td>
        <td>2</td>
        <td>0.45ms</td>
      </tr>
      <tr>
        <td>Complex</td>
        <td>15</td>
        <td>5</td>
        <td>1.2ms</td>
      </tr>
    </tbody>
  </table>

  <p>Una llista de 100 components complexos consumeix 120ms per cicle vs 15ms amb components simples.</p>

  <h4>1.5.5. Impacte en experi√®ncia d'usuari</h4>
  <p><strong>L√≠mits de percepci√≥ humana:</strong></p>
  <ul>
    <li>&lt; 16ms: Sentit com instantani (60 FPS)</li>
    <li>16-100ms: Lleugerament perceptible</li>
    <li>100-300ms: Lag notable, aplicaci√≥ se sent lenta</li>
    <li>&gt; 300ms: Usuari pensa que l'aplicaci√≥ est√† trencada</li>
  </ul>

  <p><strong>Aplicaci√≥ amb 500 components simples:</strong> 85ms ‚Üí Lag perceptible</p>
  <p><strong>Aplicaci√≥ amb 100 components complexos:</strong> 120ms ‚Üí Lag molt notable</p>

  <h4>1.5.6. Mesurar rendiment amb DevTools</h4>
  <p>Podeu mesurar el cost de detecci√≥ de canvis:</p>

{% capture code_98 %}// Afegir temporalment per mesurar
ngAfterViewChecked() {
  console.time('check');
}
ngAfterViewChecked() {
  console.timeEnd('check');
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_98 %}

  <p>O utilitzar Chrome DevTools:</p>
  <ol>
    <li>Obrir DevTools (F12)</li>
    <li>Performance tab ‚Üí Record</li>
    <li>Interactuar amb l'aplicaci√≥</li>
    <li>Stop recording</li>
    <li>Analitzar "Scripting" time (temps en codi Angular)</li>
  </ol>

  {% include success_box.html contingut="<strong>Clau:</strong> El cost de detecci√≥ de canvis creix amb el nombre i complexitat de components, causant lag perceptible a partir de 100ms per cicle." %}

  <h4>1.5.7. Resultat esperat</h4>
  <p>Quantificaci√≥ del cost de rendiment de la detecci√≥ de canvis i identificaci√≥ de quan es converteix en un problema.</p>
  {% endcapture %}
  {% include section-point.html numero="1.5" titol="Cost de la detecci√≥ de canvis: arbres grans, components complexos" contingut=section_point_1_5 %}

  {% capture section_point_1_6 %}
  <h4>1.6.1. Objectiu</h4>
  <p>Comparar les dues estrat√®gies de detecci√≥ de canvis i comprendre quan usar cadascuna.</p>

  <h4>1.6.2. Estrat√®gia Default (per defecte)</h4>
  <p>Amb <code>ChangeDetectionStrategy.Default</code>, Angular comprova tots els components de l'arbre en cada cicle, independentment de si han canviat o no.</p>

{% capture code_99 %}@Component({
  selector: 'app-product-card',
  template: `...`,
  changeDetection: ChangeDetectionStrategy.Default // ‚Üê Valor per defecte
})
export class ProductCardComponent {
  @Input() product!: Product;
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_99 %}

  <p><strong>Comportament:</strong></p>
  <ul>
    <li>Event ocorre (clic, HTTP, timer)</li>
    <li>Angular comprova TOTS els components</li>
    <li>Compara propietats actuals vs anteriors</li>
    <li>Actualitza DOM si troba difer√®ncies</li>
  </ul>

  <p><strong>Avantatges:</strong></p>
  <ul>
    <li>Simple: no cal pensar en immutabilitat</li>
    <li>Funciona sempre, fins i tot amb mutacions d'objectes</li>
    <li>No requereix canvis en l'arquitectura</li>
  </ul>

  <p><strong>Desavantatges:</strong></p>
  <ul>
    <li>Comprovacions innecess√†ries (99% dels components no han canviat)</li>
    <li>Rendiment degradat amb molts components</li>
    <li>Executa funcions getter repetidament</li>
  </ul>

  <h4>1.6.3. Estrat√®gia OnPush (optimitzada)</h4>
  <p>Amb <code>ChangeDetectionStrategy.OnPush</code>, Angular nom√©s comprova un component quan:</p>
  <ol>
    <li>Les seves entrades (<code>@Input()</code>) canvien de refer√®ncia</li>
    <li>Hi ha un esdeveniment dins del component mateix</li>
    <li>Un observable amb <code>async</code> pipe emet un valor</li>
  </ol>

{% capture code_100 %}@Component({
  selector: 'app-product-card',
  template: `...`,
  changeDetection: ChangeDetectionStrategy.OnPush // ‚Üê Optimitzat
})
export class ProductCardComponent {
  @Input() product!: Product;
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_100 %}

  <p><strong>Comportament:</strong></p>

{% capture code_101 %}// Component pare canvia la refer√®ncia del producte
this.product = { ...this.product, price: 20 }; // Correcte: Nova refer√®ncia
// Angular detecta:
// - product_anterior !== product_actual ‚Üí Comprova component
// - Altres components: inputs no han canviat ‚Üí NO comprova
// Resultat: 1 comprovaci√≥ en lloc de 100{% endcapture %}
  {% include code-block.html lang="typescript" code=code_101 %}

  <p><strong>Avantatges:</strong></p>
  <ul>
    <li>80-95% menys comprovacions</li>
    <li>Rendiment dram√†ticament millorat</li>
    <li>Escalabilitat: mant√© rendiment amb centenars de components</li>
    <li>Funcions getter s'executen molt menys</li>
  </ul>

  <p><strong>Desavantatges:</strong></p>
  <ul>
    <li>Requereix immutabilitat (crear nous objectes)</li>
    <li>Canvi de mentalitat per developers</li>
    <li>Pot causar bugs si s'oblida immutabilitat</li>
  </ul>

  <h4>1.6.4. Comparativa detallada</h4>
  <table>
    <thead>
      <tr>
        <th>Aspecte</th>
        <th>Default</th>
        <th>OnPush</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Quan comprova</strong></td>
        <td>Sempre, en cada cicle</td>
        <td>Nom√©s quan inputs canvien de refer√®ncia</td>
      </tr>
      <tr>
        <td><strong>Components comprovats</strong></td>
        <td>Tots (100%)</td>
        <td>Nom√©s afectats (5-20%)</td>
      </tr>
      <tr>
        <td><strong>Temps cicle (100 comp)</strong></td>
        <td>18ms</td>
        <td>2ms</td>
      </tr>
      <tr>
        <td><strong>Requereix immutabilitat</strong></td>
        <td>No</td>
        <td>S√≠</td>
      </tr>
      <tr>
        <td><strong>Risc bugs</strong></td>
        <td>Baix</td>
        <td>Mitj√† (si no s'aplica immutabilitat)</td>
      </tr>
      <tr>
        <td><strong>Escalabilitat</strong></td>
        <td>Limitada</td>
        <td>Excel¬∑lent</td>
      </tr>
      <tr>
        <td><strong>Codi necessari</strong></td>
        <td>Cap canvi</td>
        <td>Afegir <code>changeDetection: OnPush</code></td>
      </tr>
    </tbody>
  </table>

  <h4>1.6.5. Quan usar cada estrat√®gia</h4>
  <p><strong>Usar Default quan:</strong></p>
  <ul>
    <li>Component t√© l√≤gica interna complexa amb moltes mutacions</li>
    <li>Treballeu amb llibreries externes que muten objectes</li>
    <li>Prototipatge r√†pid on rendiment no √©s prioritat</li>
    <li>Equip no est√† familiaritzat amb immutabilitat</li>
  </ul>

  <p><strong>Usar OnPush quan:</strong></p>
  <ul>
    <li>Component presentacional que nom√©s mostra dades</li>
    <li>Llistes amb molts elements</li>
    <li>Aplicaci√≥ gran (&gt; 50 components)</li>
    <li>Rendiment √©s cr√≠tica</li>
    <li>Podeu garantir immutabilitat</li>
  </ul>

  <p><strong>Estrat√®gia recomanada:</strong> Comenceu amb OnPush per defecte en tots els components nous. Nom√©s useu Default si trobeu problemes espec√≠fics que no podeu resoldre.</p>

  {% include success_box.html contingut="<strong>Clau:</strong> Default comprova sempre tots els components; OnPush nom√©s comprova quan inputs canvien de refer√®ncia, reduint comprovacions en un 80-95%." %}

  <h4>1.6.6. Resultat esperat</h4>
  <p>Comprensi√≥ de les difer√®ncies entre Default i OnPush i saber quan usar cada estrat√®gia.</p>
  {% endcapture %}
  {% include section-point.html numero="1.6" titol="Estrat√®gia de detecci√≥ per defecte vs optimitzada" contingut=section_point_1_6 %}

  {% capture section_point_1_7 %}
  <h4>1.7.1. Objectiu</h4>
  <p>Aprendre a implementar OnPush i comprendre exactament quan Angular comprova components amb aquesta estrat√®gia.</p>

  <h4>1.7.2. Implementaci√≥ b√†sica d'OnPush</h4>
  <p>Afegir OnPush a un component nom√©s requereix una l√≠nia:</p>

{% capture code_102 %}import { Component, ChangeDetectionStrategy, Input } from '@angular/core';
@Component({
  selector: 'app-product-card',
  template: `
    <div class="card">
      <h3>{{ "{{" }} product.name }}</h3>
      <p>{{ "{{" }} product.price }}‚Ç¨</p>
    </div>
  `,
  changeDetection: ChangeDetectionStrategy.OnPush // ‚Üê Afegir aquesta l√≠nia
})
export class ProductCardComponent {
  @Input() product!: Product;
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_102 %}

  <p>Ja est√†! Ara aquest component nom√©s es comprovar√† quan <code>product</code> canvi√Ø de refer√®ncia.</p>

  <h4>1.7.3. Quan Angular comprova amb OnPush</h4>
  <p><strong>Cas 1: Input canvia de refer√®ncia</strong></p>

{% capture code_103 %}// Component pare
export class ProductListComponent {
  product = { id: 1, name: 'Laptop', price: 800 };
  updatePrice() {
    // Correcte: Crea nou objecte ‚Üí OnPush detecta canvi
    this.product = { ...this.product, price: 750 };
    // Incorrecte: Mutaci√≥ directa ‚Üí OnPush NO detecta canvi
    // this.product.price = 750;
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_103 %}

  <p><strong>Cas 2: Esdeveniment dins del component</strong></p>

{% capture code_104 %}@Component({
  selector: 'app-counter',
  template: `
    <button (click)="increment()">{{ "{{" }} count }}</button>
  `,
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class CounterComponent {
  count = 0;
  increment() {
    this.count++; // Correcte: Component es comprova perqu√® hi ha esdeveniment intern
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_104 %}

  <p><strong>Cas 3: Observable amb async pipe</strong></p>

{% capture code_105 %}@Component({
  selector: 'app-products',
  template: `
    <div *ngFor="let product of products$ | async">
      {{ "{{" }} product.name }}
    </div>
  `,
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class ProductsComponent {
  products$ = this.http.get<Product[]>('/api/products');
  // Correcte: async pipe activa detecci√≥ quan observable emet
  constructor(private http: HttpClient) {}
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_105 %}

  <h4>1.7.4. Errors comuns amb OnPush</h4>
  <p><strong>Error 1: Mutar objectes directament</strong></p>

{% capture code_106 %}// Incorrecte: Mutaci√≥ directa amb OnPush
@Input() product!: Product;
ngOnInit() {
  this.product.price = 100; // NO es detecta perqu√® refer√®ncia √©s igual
}
// Correcte: Crear nou objecte
@Input() product!: Product;
ngOnInit() {
  this.product = { ...this.product, price: 100 }; // Es detecta
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_106 %}

  <p><strong>Error 2: Modificar arrays amb push/splice</strong></p>

{% capture code_107 %}// Incorrecte: Mutaci√≥ d'array amb OnPush
@Input() items: number[] = [];
addItem(item: number) {
  this.items.push(item); // NO es detecta
}
// Correcte: Crear nou array
@Input() items: number[] = [];
addItem(item: number) {
  this.items = [...this.items, item]; // Es detecta
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_107 %}

  <h4>1.7.5. Beneficis mesurables d'OnPush</h4>
  <p><strong>Aplicaci√≥ de prova amb 100 ProductCardComponent:</strong></p>

  <p>Sense OnPush:</p>
  <ul>
    <li>Usuari clica "Afegir a cistella" en un producte</li>
    <li>Angular comprova 100 components</li>
    <li>Temps: 18ms</li>
  </ul>

  <p>Amb OnPush:</p>
  <ul>
    <li>Usuari clica "Afegir a cistella" en un producte</li>
    <li>Angular comprova 1 component (el que ha rebut el clic)</li>
    <li>Temps: 0.8ms</li>
  </ul>

  <p><strong>Millora: 95% m√©s r√†pid (18ms ‚Üí 0.8ms).</strong></p>

  <h4>1.7.6. Propagaci√≥ de detecci√≥ amb OnPush</h4>
  <p>OnPush no impedeix que fills es comprovin si el pare canvia:</p>

{% capture code_108 %}ParentComponent (OnPush) ‚Üê Input canvia
  ‚Üì Angular comprova el pare
 ChildComponent (OnPush) ‚Üê Angular tamb√© comprova fills
  ‚Üì
GrandchildComponent (OnPush) ‚Üê I nets{% endcapture %}
  {% include code-block.html lang="text" code=code_108 %}

  <p>Per√≤ si el pare NO canvia, els fills tampoc es comproven, estalviant moltes comprovacions.</p>

  {% include success_box.html contingut="<strong>Clau:</strong> OnPush nom√©s comprova components quan inputs canvien de refer√®ncia, hi ha esdeveniments interns, o observables amb async pipe emeten valors." %}

  <h4>1.7.7. Resultat esperat</h4>
  <p>Implementaci√≥ correcta d'OnPush i comprensi√≥ exacta de quan Angular comprova components amb aquesta estrat√®gia.</p>
  {% endcapture %}
  {% include section-point.html numero="1.7" titol="OnPush: nom√©s comprovar quan canvien les entrades" contingut=section_point_1_7 %}

  {% capture section_point_1_8 %}
  <h4>1.8.1. Objectiu</h4>
  <p>Crear un exemple complet d'un component amb OnPush que funciona correctament amb immutabilitat.</p>

  <h4>1.8.2. Component de llista de productes amb OnPush</h4>
  <p><strong>Component fill (ProductCardComponent amb OnPush):</strong></p>

{% capture code_109 %}import { Component, ChangeDetectionStrategy, Input, Output, EventEmitter } from '@angular/core';
interface Product {
  id: number;
  name: string;
  price: number;
  inStock: boolean;
}
@Component({
  selector: 'app-product-card',
  template: `
    <div class="card">
      <h3>{{ "{{" }} product.name }}</h3>
      <p class="price">{{ "{{" }} product.price }}‚Ç¨</p>
      <span class="stock" [class.out-of-stock]="!product.inStock">
        {{ "{{" }} product.inStock ? 'Disponible' : 'Esgotat' }}
      </span>
      <button (click)="onAddToCart()" [disabled]="!product.inStock">
        Afegir a cistella
      </button>
    </div>
  `,
  styles: [`
    .card { border: 1px solid #ddd; padding: 1rem; margin: 0.5rem; }
    .price { font-size: 1.5rem; font-weight: bold; color: #2c3e50; }
    .stock { display: block; margin: 0.5rem 0; }
    .out-of-stock { color: #e74c3c; }
  `],
  changeDetection: ChangeDetectionStrategy.OnPush // ‚Üê OnPush activat
})
export class ProductCardComponent {
  @Input() product!: Product;
  @Output() addToCart = new EventEmitter<Product>();
  onAddToCart(): void {
    this.addToCart.emit(this.product);
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_109 %}

  <p><strong>Component pare (ProductListComponent que gestiona estat):</strong></p>

{% capture code_110 %}import { Component } from '@angular/core';
@Component({
  selector: 'app-product-list',
  template: `
    <div class="controls">
      <button (click)="updatePrice()">Actualitzar preu primer producte</button>
      <button (click)="toggleStock()">Canviar stock primer producte</button>
    </div>
    <div class="product-grid">
      <app-product-card
        *ngFor="let product of products; trackBy: trackByProduct"
        [product]="product"
        (addToCart)="handleAddToCart($event)">
      </app-product-card>
    </div>
  `
})
export class ProductListComponent {
  products: Product[] = [
    { id: 1, name: 'Laptop', price: 800, inStock: true },
    { id: 2, name: 'Mouse', price: 25, inStock: true },
    { id: 3, name: 'Keyboard', price: 60, inStock: false }
  ];
  // Correcte: Crea nou objecte (OnPush detecta canvi)
  updatePrice(): void {
    this.products = this.products.map((p, index) =>
      index === 0 ? { ...p, price: p.price - 50 } : p
    );
  }
  // Correcte: Crea nou objecte (OnPush detecta canvi)
  toggleStock(): void {
    this.products = this.products.map((p, index) =>
      index === 0 ? { ...p, inStock: !p.inStock } : p
    );
  }
  handleAddToCart(product: Product): void {
    console.log('Afegit a cistella:', product.name);
  }
  trackByProduct(index: number, product: Product): number {
    return product.id;
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_110 %}

  <h4>1.8.3. Codi incorrecte (NO funciona amb OnPush)</h4>

{% capture code_111 %}// Incorrecte: Mutaci√≥ directa
updatePrice(): void {
  this.products[0].price -= 50; // Refer√®ncia igual ‚Üí NO es detecta
}
// Incorrecte: push muta l'array
addProduct(product: Product): void {
  this.products.push(product); // Refer√®ncia igual ‚Üí NO es detecta
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_111 %}

  <h4>1.8.4. Verificaci√≥ de funcionament</h4>
  <ol>
    <li>Serviu l'aplicaci√≥: <code>ng serve</code></li>
    <li>Obriu DevTools ‚Üí Console</li>
    <li>Cliqueu "Actualitzar preu primer producte"</li>
    <li>Observeu que el preu es canvia immediatament (OnPush funciona)</li>
    <li>Afegiu temporalment detecci√≥ de canvis per mesurar:</li>
  </ol>

{% capture code_112 %}ngAfterViewChecked() {
  console.log('Component comprovat:', this.product.name);
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_112 %}

  <p>Amb OnPush, veureu molts menys logs "Component comprovat" que sense OnPush.</p>

  <h4>1.8.5. Comparaci√≥ abans/despr√©s</h4>
  <p><strong>Abans (tots els components Default):</strong></p>
  <ul>
    <li>Clic ‚Üí 3 logs "Component comprovat" (un per cada ProductCard)</li>
    <li>Temps: 2.5ms</li>
  </ul>

  <p><strong>Despr√©s (tots els components OnPush):</strong></p>
  <ul>
    <li>Clic ‚Üí 1 log "Component comprovat" (nom√©s el que ha canviat)</li>
    <li>Temps: 0.6ms</li>
  </ul>

  <p><strong>Millora: 76% m√©s r√†pid.</strong></p>

  {% include success_box.html contingut="<strong>Clau:</strong> Amb OnPush, sempre crear nous objectes/arrays per canviar dades; mai mutar directament les propietats." %}

  <h4>1.8.6. Resultat esperat</h4>
  <p>Creaci√≥ de components amb OnPush que funcionen correctament aplicant immutabilitat per canviar dades.</p>
  {% endcapture %}
  {% include section-point.html numero="1.8" titol="Exemple pr√†ctic: component amb detecci√≥ OnPush" contingut=section_point_1_8 %}

  {% capture section_point_1_9 %}
  <h4>1.9.1. Objectiu</h4>
  <p>Comprendre el concepte d'immutabilitat i per qu√® √©s essencial per al funcionament correcte d'OnPush.</p>

  <h4>1.9.2. Qu√® √©s la immutabilitat</h4>
  <p>La immutabilitat significa que no modifiqueu un valor existent; en lloc d'aix√≤, creeu un nou valor amb els canvis aplicats. En lloc de <code>obj.prop = newValue</code>, feu <code>obj = { ...obj, prop: newValue }</code>.</p>

  <h4>1.9.3. Per qu√® OnPush necessita immutabilitat</h4>
  <p>OnPush compara refer√®ncies d'objectes per detectar canvis:</p>

{% capture code_113 %}const obj1 = { name: 'Product', price: 100 };
const obj2 = obj1;
obj2.price = 200;
console.log(obj1 === obj2); // true ‚Üê Mateixa refer√®ncia!
// OnPush NO detecta aquest canvi perqu√® refer√®ncia no ha canviat{% endcapture %}
  {% include code-block.html lang="typescript" code=code_113 %}

  <p>Per activar OnPush, necessiteu crear un nou objecte:</p>

{% capture code_114 %}const obj1 = { name: 'Product', price: 100 };
const obj2 = { ...obj1, price: 200 }; // Nou objecte
console.log(obj1 === obj2); // false ‚Üê Refer√®ncia diferent!
// OnPush S√ç detecta aquest canvi{% endcapture %}
  {% include code-block.html lang="typescript" code=code_114 %}

  <h4>1.9.4. Patrons d'immutabilitat per objectes</h4>
  <p><strong>Operador spread per objectes:</strong></p>

{% capture code_115 %}// Incorrecte: Mutaci√≥ directa
product.price = 200;
product.name = 'New Name';
// Correcte: Immutabilitat amb spread
product = {
  ...product,
  price: 200,
  name: 'New Name'
};{% endcapture %}
  {% include code-block.html lang="typescript" code=code_115 %}

  <p><strong>Immutabilitat amb objectes niats:</strong></p>

{% capture code_116 %}// Incorrecte: Mutaci√≥ niada
product.details.warranty = 24;
// Correcte: Immutabilitat niada
product = {
  ...product,
  details: {
    ...product.details,
    warranty: 24
  }
};{% endcapture %}
  {% include code-block.html lang="typescript" code=code_116 %}

  <h4>1.9.5. Patrons d'immutabilitat per arrays</h4>
  <p><strong>Operador spread per arrays:</strong></p>

{% capture code_117 %}// Incorrecte: Mutaci√≥ amb push
items.push(newItem);
// Correcte: Immutabilitat amb spread
items = [...items, newItem];
// Incorrecte: Mutaci√≥ amb splice
items.splice(index, 1);
// Correcte: Immutabilitat amb filter
items = items.filter((_, i) => i !== index);
// Incorrecte: Mutaci√≥ amb sort
items.sort((a, b) => a.price - b.price);
// Correcte: Immutabilitat amb slice + sort
items = [...items].sort((a, b) => a.price - b.price);{% endcapture %}
  {% include code-block.html lang="typescript" code=code_117 %}

  <p><strong>Map per transformar arrays:</strong></p>

{% capture code_118 %}// Incorrecte: Mutaci√≥ en bucle
for (let i = 0; i < products.length; i++) {
  products[i].price *= 1.1;
}
// Correcte: Immutabilitat amb map
products = products.map(p => ({ ...p, price: p.price * 1.1 }));{% endcapture %}
  {% include code-block.html lang="typescript" code=code_118 %}

  <h4>1.9.6. Avantatges addicionals de la immutabilitat</h4>
  <p><strong>1. Historial de canvis</strong></p>
  <p>Amb immutabilitat, podeu guardar estats anteriors sense que es modifiquin:</p>

{% capture code_119 %}const history: Product[] = [];
// Guardar estat actual
history.push(product);
// Modificar producte
product = { ...product, price: 200 };
// history[0] segueix tenint price: 100 (no s'ha modificat){% endcapture %}
  {% include code-block.html lang="typescript" code=code_119 %}

  <p>Aix√≤ permet implementar "desfer/refer" f√†cilment.</p>

  <p><strong>2. Depuraci√≥ m√©s senzilla</strong></p>
  <p>Amb mutabilitat, no sabeu quan o on va canviar un objecte. Amb immutabilitat, cada canvi crea un nou objecte, facilitant el tracking de canvis.</p>

  <p><strong>3. Predicibilitat</strong></p>
  <p>Amb immutabilitat, sabeu que passar un objecte a una funci√≥ no el modificar√†:</p>

{% capture code_120 %}function processProduct(product: Product): Product {
  return { ...product, price: product.price * 1.1 };
  // Correcte: No modifica l'original
}
const original = { name: 'Laptop', price: 100 };
const processed = processProduct(original);
console.log(original.price); // 100 (no ha canviat)
console.log(processed.price); // 110 (nou objecte){% endcapture %}
  {% include code-block.html lang="typescript" code=code_120 %}

  <h4>1.9.7. Taula de patrons d'immutabilitat</h4>
  <table>
    <thead>
      <tr>
        <th>Operaci√≥</th>
        <th>Mutable (Incorrecte)</th>
        <th>Immutable (Correcte)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Afegir a array</td>
        <td><code>arr.push(x)</code></td>
        <td><code>arr = [...arr, x]</code></td>
      </tr>
      <tr>
        <td>Eliminar d'array</td>
        <td><code>arr.splice(i, 1)</code></td>
        <td><code>arr = arr.filter((_, idx) => idx !== i)</code></td>
      </tr>
      <tr>
        <td>Modificar element array</td>
        <td><code>arr[i].prop = x</code></td>
        <td><code>arr = arr.map((item, idx) => idx === i ? {...item, prop: x} : item)</code></td>
      </tr>
      <tr>
        <td>Modificar propietat objecte</td>
        <td><code>obj.prop = x</code></td>
        <td><code>obj = { ...obj, prop: x }</code></td>
      </tr>
      <tr>
        <td>Ordenar array</td>
        <td><code>arr.sort(fn)</code></td>
        <td><code>arr = [...arr].sort(fn)</code></td>
      </tr>
    </tbody>
  </table>

  {% include success_box.html contingut="<strong>Clau:</strong> OnPush necessita immutabilitat perqu√® compara refer√®ncies d'objectes; crear nous objectes activa detecci√≥, mutar objectes existents no." %}

  <h4>1.9.8. Resultat esperat</h4>
  <p>Aplicaci√≥ de patrons d'immutabilitat creant nous objectes i arrays en lloc de modificar els existents per garantir funcionament d'OnPush.</p>
  {% endcapture %}
  {% include section-point.html numero="1.9" titol="Immutabilitat: per qu√® √©s crucial amb OnPush" contingut=section_point_1_9 %}

  {% capture section_point_1_10 %}
  <h4>1.10.1. Objectiu</h4>
  <p>Aprendre a for√ßar detecci√≥ de canvis manualment en situacions on OnPush no detecta canvis autom√†ticament.</p>

  <h4>1.10.2. Quan necessiteu detecci√≥ manual</h4>
  <p>Hi ha situacions on OnPush no detecta canvis autom√†ticament:</p>
  <ol>
    <li><strong>Callbacks de llibreries externes</strong> (no interceptades per Zone.js)</li>
    <li><strong>setTimeout/setInterval fora de Zone</strong></li>
    <li><strong>WebSockets o EventSource</strong></li>
    <li><strong>Integracions amb llibreries que muten objectes</strong></li>
  </ol>

  <h4>1.10.3. M√®todes de detecci√≥ manual</h4>
  <p>Angular proporciona <code>ChangeDetectorRef</code> amb dos m√®todes principals:</p>

  <p><strong>1. detectChanges() - Comprova aquest component i fills</strong></p>

{% capture code_121 %}import { Component, ChangeDetectorRef, ChangeDetectionStrategy } from '@angular/core';
@Component({
  selector: 'app-timer',
  template: `<p>Temps: {{ "{{" }} seconds }}s</p>`,
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class TimerComponent implements OnInit, OnDestroy {
  seconds = 0;
  private intervalId: any;
  constructor(private cdr: ChangeDetectorRef) {}
  ngOnInit() {
    this.intervalId = setInterval(() => {
      this.seconds++;
      this.cdr.detectChanges(); // ‚Üê For√ßar detecci√≥ manual
    }, 1000);
  }
  ngOnDestroy() {
    clearInterval(this.intervalId);
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_121 %}

  <p><strong>2. markForCheck() - Marca component per comprovar en proper cicle</strong></p>

{% capture code_122 %}@Component({
  selector: 'app-websocket',
  template: `<p>Missatge: {{ "{{" }} message }}</p>`,
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class WebSocketComponent implements OnInit {
  message = '';
  constructor(
    private cdr: ChangeDetectorRef,
    private wsService: WebSocketService
  ) {}
  ngOnInit() {
    this.wsService.messages$.subscribe(msg => {
      this.message = msg;
      this.cdr.markForCheck(); // ‚Üê Marca per comprovar
    });
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_122 %}

  <h4>1.10.4. Difer√®ncia entre detectChanges() i markForCheck()</h4>
  <p><strong>detectChanges():</strong></p>
  <ul>
    <li>Executa detecci√≥ immediatament</li>
    <li>Comprova aquest component i fills</li>
    <li>M√©s cost√≥s (executa detecci√≥ ara)</li>
  </ul>

  <p><strong>markForCheck():</strong></p>
  <ul>
    <li>Marca component per comprovar</li>
    <li>Espera al proper cicle de detecci√≥</li>
    <li>M√©s eficient (nom√©s marca, no executa)</li>
  </ul>

  <p><strong>Regla general:</strong> Useu <code>markForCheck()</code> si sabeu que hi haur√† un cicle de detecci√≥ aviat (per exemple, despr√©s d'un observable). Useu <code>detectChanges()</code> si necessiteu actualitzaci√≥ immediata.</p>

  <h4>1.10.5. Exemple: Integraci√≥ amb llibreria externa</h4>

{% capture code_123 %}import { Component, OnInit, OnDestroy, ChangeDetectorRef, ChangeDetectionStrategy } from '@angular/core';
declare var ExternalLibrary: any;
@Component({
  selector: 'app-external-integration',
  template: `
    <div>
      <p>Valor de llibreria externa: {{ "{{" }} externalValue }}</p>
    </div>
  `,
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class ExternalIntegrationComponent implements OnInit, OnDestroy {
  externalValue = 0;
  private lib: any;
  constructor(private cdr: ChangeDetectorRef) {}
  ngOnInit() {
    this.lib = new ExternalLibrary();
    // Callback de llibreria externa (fora de Zone.js)
    this.lib.onChange((newValue: number) => {
      this.externalValue = newValue;
      // ‚Üê OnPush NO detecta aquest canvi autom√†ticament
      this.cdr.markForCheck(); // ‚Üê For√ßar detecci√≥ manual
    });
  }
  ngOnDestroy() {
    this.lib.destroy();
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_123 %}

  <h4>1.10.6. Advert√®ncies sobre detecci√≥ manual</h4>
  <p><strong>1. No abusar de detectChanges()</strong></p>

{% capture code_124 %}// Incorrecte: Cridar detectChanges() a cada canvi petit
updateValue() {
  this.value1 = 10;
  this.cdr.detectChanges();
  this.value2 = 20;
  this.cdr.detectChanges();
  this.value3 = 30;
  this.cdr.detectChanges();
}
// Correcte: Fer tots els canvis i despr√©s cridar una vegada
updateValue() {
  this.value1 = 10;
  this.value2 = 20;
  this.value3 = 30;
  this.cdr.detectChanges();
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_124 %}

  <p><strong>2. Evitar detecci√≥ manual si podeu usar observables</strong></p>

{% capture code_125 %}// Sub√≤ptim: setInterval + detecci√≥ manual
ngOnInit() {
  setInterval(() => {
    this.value++;
    this.cdr.detectChanges();
  }, 1000);
}
// Millor: Usar observable + async pipe
value$ = interval(1000);
// Template: {{ "{{" }} value$ | async }}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_125 %}

  {% include success_box.html contingut="<strong>Clau:</strong> Useu <code>ChangeDetectorRef.markForCheck()</code> o <code>detectChanges()</code> per for√ßar detecci√≥ manual quan OnPush no detecta canvis autom√†ticament (callbacks externs, WebSockets)." %}

  <h4>1.10.7. Resultat esperat</h4>
  <p>Utilitzaci√≥ de detecci√≥ manual amb <code>ChangeDetectorRef</code> en situacions on OnPush no detecta canvis autom√†ticament.</p>
  {% endcapture %}
  {% include section-point.html numero="1.10" titol="Detecci√≥ manual: for√ßar actualitzaci√≥ quan cal" contingut=section_point_1_10 %}

  {% capture section_point_1_11 %}
  <h4>1.11.1. Objectiu</h4>
  <p>Establir criteris clars per decidir quan usar Default, OnPush, o detecci√≥ manual segons el context.</p>

  <h4>1.11.2. Arbre de decisi√≥</h4>

{% capture code_126 %}Component nou?
  ‚Üì
Comen√ßar amb OnPush
  ‚Üì
√âs component presentacional (nom√©s mostra dades)?
  ‚Üì S√≠
OnPush
  ‚Üì No
T√© l√≤gica interna complexa amb moltes mutacions?
  ‚Üì S√≠
Default (considerar refactoritzaci√≥)
  ‚Üì No
Podeu garantir immutabilitat?
  ‚Üì S√≠
OnPush
  ‚Üì No
Treballa amb llibreries externes que muten?
  ‚Üì S√≠
Default + considerar wrapper amb OnPush
  ‚Üì No
OnPush + detecci√≥ manual si cal{% endcapture %}
  {% include code-block.html lang="text" code=code_126 %}

  <h4>1.11.3. Matriu de decisi√≥</h4>
  <table>
    <thead>
      <tr>
        <th>Situaci√≥</th>
        <th>Estrat√®gia</th>
        <th>Ra√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Component presentacional (nom√©s @Input/@Output)</td>
        <td>OnPush</td>
        <td>M√†xim rendiment, dades externes</td>
      </tr>
      <tr>
        <td>Llista amb &gt; 50 elements</td>
        <td>OnPush</td>
        <td>Cr√≠tica: 50 comprovacions vs 1-2</td>
      </tr>
      <tr>
        <td>Component amb formularis reactius</td>
        <td>OnPush</td>
        <td>Observables funcionen b√© amb OnPush</td>
      </tr>
      <tr>
        <td>Component amb setInterval/setTimeout</td>
        <td>OnPush + manual</td>
        <td>Necessita markForCheck()</td>
      </tr>
      <tr>
        <td>Component amb WebSocket</td>
        <td>OnPush + manual</td>
        <td>Necessita markForCheck()</td>
      </tr>
      <tr>
        <td>Integraci√≥ llibreria que muta objectes</td>
        <td>Default</td>
        <td>Immutabilitat no garantida</td>
      </tr>
      <tr>
        <td>Component root (AppComponent)</td>
        <td>Default</td>
        <td>Poques comprovacions, simple</td>
      </tr>
      <tr>
        <td>Prototipatge r√†pid</td>
        <td>Default</td>
        <td>Velocitat desenvolupament &gt; rendiment</td>
      </tr>
    </tbody>
  </table>

  <h4>1.11.4. Estrat√®gia per aplicaci√≥ completa</h4>
  <p><strong>Recomanaci√≥ general: OnPush per defecte</strong></p>
  <ol>
    <li>Comenceu amb OnPush en tots els components nous</li>
    <li>Mantenir immutabilitat des del principi</li>
    <li>Usar Default nom√©s si trobeu problemes insolubles</li>
    <li>Mesurar rendiment amb DevTools</li>
  </ol>

  <p><strong>Migraci√≥ gradual:</strong></p>
  <p>Si teniu aplicaci√≥ existent amb Default:</p>
  <ol>
    <li><strong>Fase 1:</strong> Components presentacionals (fulles de l'arbre) ‚Üí OnPush</li>
    <li><strong>Fase 2:</strong> Components de llistes ‚Üí OnPush</li>
    <li><strong>Fase 3:</strong> Components intermedis ‚Üí OnPush</li>
    <li><strong>Fase 4:</strong> Components root ‚Üí Mantenir Default (opcional)</li>
  </ol>

  <p>No cal migrar tot simult√†niament; OnPush i Default poden conviure.</p>

  <h4>1.11.5. Checklist abans d'aplicar OnPush</h4>
  <ul>
    <li>Component rep dades via <code>@Input()</code> o observables</li>
    <li>Puc garantir immutabilitat (crear nous objectes per canviar dades)</li>
    <li>He verificat que no hi ha mutacions directes d'objectes/arrays</li>
    <li>Si necessito detecci√≥ manual, s√© quan cridar <code>markForCheck()</code></li>
    <li>He provat que el component funciona correctament amb OnPush</li>
  </ul>

  <h4>1.11.6. Mesura d'√®xit</h4>
  <p>Despr√©s d'aplicar OnPush, mesureu:</p>

{% capture code_127 %}// Afegir temporalment per mesurar impacte
ngAfterViewChecked() {
  console.log('Component comprovat');
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_127 %}

  <p><strong>Abans d'OnPush:</strong> ~100 logs per interacci√≥</p>
  <p><strong>Despr√©s d'OnPush:</strong> ~5 logs per interacci√≥</p>
  <p><strong>Objectiu:</strong> Reduir logs en un 80-95%.</p>

  {% include success_box.html contingut="<strong>Clau:</strong> Useu OnPush per defecte excepte en casos espec√≠fics (llibreries externes amb mutacions, l√≤gica complexa que no es pot refactoritzar); mesureu impacte amb DevTools." %}

  <h4>1.11.7. Resultat esperat</h4>
  <p>Aplicaci√≥ de criteris objectius per decidir quan usar Default, OnPush, o detecci√≥ manual segons el context del component.</p>
  {% endcapture %}
  {% include section-point.html numero="1.11" titol="Quan aplicar cada estrat√®gia: criteri de decisi√≥" contingut=section_point_1_11 %}

  {% capture section_point_1_12 %}
  <ol>
    <li>Crear component <code>ProductCardComponent</code> amb OnPush i nom√©s <code>@Input()</code> i <code>@Output()</code></li>
    <li>Crear component pare <code>ProductListComponent</code> amb array de productes</li>
    <li>Al pare, crear funci√≥ <code>updatePrice()</code> que crea nou objecte amb operador spread</li>
    <li>Afegir bot√≥ que crida <code>updatePrice()</code> per modificar el primer producte</li>
    <li>Verificar que el canvi es reflecteix immediatament (OnPush funciona)</li>
    <li>Afegir temporalment <code>ngAfterViewChecked()</code> amb <code>console.log()</code> per comptar comprovacions</li>
    <li>Comparar nombre de logs abans i despr√©s d'aplicar OnPush</li>
    <li>Mesurar temps amb DevTools Performance tab i verificar millora de rendiment</li>
  </ol>

  <p><strong>Resultat esperat:</strong> Component amb OnPush que es comprova nom√©s quan les seves dades canvien, reduint comprovacions en un 80-95% amb millora de rendiment mesurable.</p>
  {% endcapture %}
  {% include section-point.html numero="1.12" titol="Mini exemple pr√†ctic ¬∑ Component de llista optimitzat amb OnPush" contingut=section_point_1_12 %}

  {% capture section_point_1_13 %}
  <table>
    <thead>
      <tr>
        <th>S√≠mptoma</th>
        <th>Possible causa</th>
        <th>Soluci√≥ r√†pida</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Component amb OnPush no s'actualitza quan canvien dades</td>
        <td>Esteu mutant l'objecte directament sense crear-ne un de nou</td>
        <td>Usar operador spread per crear nou objecte: <code>obj = { ...obj, prop: newValue }</code></td>
      </tr>
      <tr>
        <td>Array no s'actualitza amb OnPush despr√©s de push()</td>
        <td>push() muta l'array; mateixa refer√®ncia</td>
        <td>Usar spread: <code>arr = [...arr, newItem]</code> en lloc de <code>arr.push(newItem)</code></td>
      </tr>
      <tr>
        <td>Component es comprova massa sovint fins i tot amb OnPush</td>
        <td>Teniu funcions getter al template que s'executen constantment</td>
        <td>Moure c√†lculs a propietats calculades en <code>ngOnInit()</code> o usar pipes pures</td>
      </tr>
      <tr>
        <td>Error "ExpressionChangedAfterItHasBeenCheckedError" amb OnPush</td>
        <td>Esteu modificant dades durant el cicle de detecci√≥</td>
        <td>Moure modificacions a <code>setTimeout(() => {...}, 0)</code> o usar <code>ChangeDetectorRef.markForCheck()</code></td>
      </tr>
      <tr>
        <td>OnPush no detecta canvis d'observable</td>
        <td>Observable no est√† amb async pipe o falta markForCheck()</td>
        <td>Usar async pipe al template o cridar <code>this.cdr.markForCheck()</code> despr√©s de rebre dades</td>
      </tr>
      <tr>
        <td>Component amb setInterval no s'actualitza amb OnPush</td>
        <td>setInterval no activa OnPush autom√†ticament</td>
        <td>Afegir <code>this.cdr.markForCheck()</code> dins del callback del setInterval</td>
      </tr>
      <tr>
        <td>Detecci√≥ manual amb detectChanges() causa errors</td>
        <td>Esteu cridant detectChanges() durant el cicle de detecci√≥</td>
        <td>Usar <code>markForCheck()</code> en lloc de <code>detectChanges()</code> o moure a <code>setTimeout</code></td>
      </tr>
      <tr>
        <td>Rendiment no millora despr√©s d'aplicar OnPush</td>
        <td>Alguns components pares encara s√≥n Default, for√ßant comprovaci√≥ fills</td>
        <td>Aplicar OnPush tamb√© als components pares de la jerarquia</td>
      </tr>
    </tbody>
  </table>
  {% endcapture %}
  {% include section-point.html numero="1.13" titol="Resoluci√≥ de problemes (Win/macOS/Linux)" contingut=section_point_1_13 %}

  {% capture section_point_1_14 %}
  {% include prompt-ai.html contingut="<strong>Rol:</strong> Expert en optimitzaci√≥ de rendiment d'aplicacions Angular. <strong>Context:</strong> Tinc una aplicaci√≥ Angular amb una llista de 200 productes on cada producte es mostra amb un component ProductCardComponent. Cada interacci√≥ d'usuari (clic, hover, escriptura) causa lag perceptible de 150-200ms. Sospito que el problema √©s la detecci√≥ de canvis no optimitzada. <strong>Tasca:</strong> Diagnostica el problema de rendiment, explica com funciona la detecci√≥ de canvis i els seus costos, proposa una soluci√≥ completa aplicant OnPush amb exemples de codi concrets mostrant com refactoritzar els components, i estima la millora de rendiment esperada. <strong>Format:</strong> Document amb diagn√≤stic del problema, explicaci√≥ de detecci√≥ de canvis, codi refactoritzat amb OnPush (abans/despr√©s), patrons d'immutabilitat necessaris, i estimaci√≥ quantitativa de millora." %}

  {% include prompt-ai.html contingut="<strong>Rol:</strong> Instructor d'Angular especialitzat en estrat√®gies de detecci√≥ de canvis. <strong>Context:</strong> Estic migrant una aplicaci√≥ Angular gran (300 components) que utilitza ChangeDetectionStrategy.Default a OnPush per millorar el rendiment. Alguns components s'integren amb una llibreria de gr√†fics externa (Chart.js) que muta objectes internament, i altres components utilitzen setInterval per actualitzar comptadors. <strong>Tasca:</strong> Proporciona una estrat√®gia de migraci√≥ gradual a OnPush especificant: (1) Ordre de migraci√≥ (quins components primer), (2) Com gestionar components amb llibreries externes que muten, (3) Com implementar detecci√≥ manual per setInterval i altres casos especials, (4) Checklist de verificaci√≥ per cada component migrat. <strong>Format:</strong> Guia de migraci√≥ pas a pas amb exemples de codi per cada cas especial, patrons d'immutabilitat, √∫s de ChangeDetectorRef, i criteris de decisi√≥ per quan usar Default vs OnPush vs manual." %}
  {% endcapture %}
  {% include section-point.html numero="1.14" titol="Prompts d'IA" contingut=section_point_1_14 %}

  {% capture section_point_1_15 %}
  <h4>1.15.1. Conceptes de detecci√≥ de canvis</h4>
  {% include checklist.html elements="Comprenc com funciona la detecci√≥ de canvis d'Angular i quan s'activa (esdeveniments d'usuari, HTTP, timers)|Entenc la difer√®ncia entre ChangeDetectionStrategy.Default i OnPush|S√© quan Angular comprova components amb OnPush (inputs canvien, esdeveniments interns, async pipe)" %}

  <h4>1.15.2. Implementaci√≥ d'OnPush</h4>
  {% include checklist.html elements="Aplico l'estrat√®gia OnPush afegint <code>changeDetection: ChangeDetectionStrategy.OnPush</code> per optimitzar components|Mantinc immutabilitat creant nous objectes amb operador spread en lloc de mutar directament propietats|Creo nous arrays amb [...arr, item] en lloc de usar push() o splice()" %}

  <h4>1.15.3. Detecci√≥ manual i mesurament</h4>
  {% include checklist.html elements="Utilitzo <code>ChangeDetectorRef.markForCheck()</code> per for√ßar detecci√≥ manual quan OnPush no detecta canvis autom√†ticament (WebSockets, callbacks externs)|Mesuro l'impacte de l'optimitzaci√≥ amb DevTools i verifico reducci√≥ del 80-95% en comprovacions de components|Aplico criteris objectius per decidir quan usar Default, OnPush, o detecci√≥ manual segons el context" %}
  {% endcapture %}
  {% include section-point.html numero="1.15" titol="Autoavaluaci√≥" contingut=section_point_1_15 %}

  {% capture section_point_1_16 %}
  <ul>
    <li>La detecci√≥ de canvis √©s el mecanisme pel qual Angular detecta canvis en dades i actualitza el DOM autom√†ticament despr√©s de cada esdeveniment as√≠ncron, per√≤ comprova tots els components per defecte causant problemes de rendiment en aplicacions grans.</li>
    <li>L'estrat√®gia Default comprova tots els components en cada cicle independentment de si han canviat, mentre que OnPush nom√©s comprova components quan les seves entrades canvien de refer√®ncia, reduint comprovacions en un 80-95% i millorant rendiment dram√†ticament.</li>
    <li>OnPush requereix immutabilitat: crear nous objectes i arrays amb operador spread (<code>{ ...obj, prop: newValue }</code>, <code>[...arr, item]</code>) en lloc de mutar directament, perqu√® OnPush compara refer√®ncies d'objectes per detectar canvis.</li>
    <li>Quan OnPush no detecta canvis autom√†ticament (callbacks externs, WebSockets, setInterval), s'utilitza <code>ChangeDetectorRef.markForCheck()</code> per marcar component per comprovar o <code>detectChanges()</code> per for√ßar detecci√≥ immediata.</li>
    <li>La recomanaci√≥ √©s usar OnPush per defecte en tots els components nous excepte en casos espec√≠fics (integracions amb llibreries externes que muten objectes, l√≤gica interna complexa irrefactoritzable), mesurant impacte amb DevTools per verificar millora de rendiment.</li>
  </ul>
  {% endcapture %}
  {% include section-point.html numero="1.16" titol="S√≠ntesi" contingut=section_point_1_16 %}

  {% capture section_point_1_17 %}
  {% include definicio.html terme="Detecci√≥ de canvis" definicio="Mecanisme d'Angular que detecta canvis en dades dels components i actualitza el DOM autom√†ticament." %}

  {% include definicio.html terme="Cicle de detecci√≥" definicio="Proc√©s on Angular comprova tots els components per detectar canvis i actualitzar la interf√≠cie." %}

  {% include definicio.html terme="ChangeDetectionStrategy.Default" definicio="Estrat√®gia per defecte que comprova tots els components en cada cicle independentment de si han canviat." %}

  {% include definicio.html terme="ChangeDetectionStrategy.OnPush" definicio="Estrat√®gia optimitzada que nom√©s comprova components quan inputs canvien de refer√®ncia o hi ha esdeveniments interns." %}

  {% include definicio.html terme="Refer√®ncia d'objecte" definicio="Adre√ßa de mem√≤ria de l'objecte; OnPush compara refer√®ncies, no contingut, per detectar canvis." %}

  {% include definicio.html terme="Immutabilitat" definicio="Principi de crear nous objectes en lloc de modificar els existents per garantir funcionament correcte d'OnPush." %}

  {% include definicio.html terme="Operador spread" definicio="Sintaxi (<code>{ ...obj }</code>, <code>[ ...arr ]</code>) per crear c√≤pies d'objectes i arrays amb modificacions aplicades." %}

  {% include definicio.html terme="ChangeDetectorRef" definicio="Servei que permet for√ßar detecci√≥ de canvis manualment amb <code>markForCheck()</code> o <code>detectChanges()</code>." %}

  {% include definicio.html terme="markForCheck()" definicio="M√®tode que marca un component per comprovar en el proper cicle de detecci√≥ sense executar detecci√≥ immediatament." %}

  {% include definicio.html terme="detectChanges()" definicio="M√®tode que executa detecci√≥ de canvis immediatament per aquest component i els seus fills." %}

  {% include definicio.html terme="async pipe" definicio="Pipe d'Angular que gestiona subscripcions a observables i activa detecci√≥ autom√†ticament quan emeten valors, compatible amb OnPush." %}

  {% include definicio.html terme="Zone.js" definicio="Llibreria que Angular utilitza per interceptar esdeveniments as√≠ncrons i activar cicles de detecci√≥ autom√†ticament." %}
  {% endcapture %}
  {% include section-point.html numero="1.17" titol="Rep√†s de conceptes" contingut=section_point_1_17 %}

</div>

<div class="section" id="Unitat4_Bloc3_Seccio2">
  <h2 id="Unitat4_Bloc3_Seccio2">2. Virtualitzaci√≥ de llistes i renderitzat eficient</h2>

  <!-- MULTIM√àDIA -->
  {% include multimedia-youtube.html unitat=4 bloc=3 seccio=2 %}


  {% include objectius.html llista="Implementar virtualitzaci√≥ per gestionar llistes amb milers d'elements de forma eficient.|Configurar components de scroll virtual amb al√ßades fixes i din√†miques.|Aplicar t√®cniques de renderitzat optimitzat amb trackBy i pipes purs.|Mesurar millores de rendiment abans i despr√©s d'aplicar optimitzacions." %}

  {% include info_box.html contingut="<strong>RA4 ¬∑ Criteri 4</strong> ‚Äî Optimitza els recursos i genera un paquet llest per a publicaci√≥." %}

  {% capture section_point_2_1 %}
  <p>Abans de comen√ßar, necessiteu:</p>
  <ul>
    <li><strong>Projecte Angular funcional:</strong> Servidor de desenvolupament operatiu amb almenys un component de llista</li>
    <li><strong>Coneixements de directives estructurals:</strong> √ös de <code>*ngFor</code> per iterar col¬∑leccions</li>
    <li><strong>Components b√†sics:</strong> Saber crear i usar components per mostrar elements de llista</li>
    <li><strong>Conceptes de rendiment:</strong> Comprensi√≥ b√†sica de com el DOM afecta el rendiment</li>
  </ul>

  <p><strong>Verificaci√≥ r√†pida:</strong></p>

{% capture code_128 %}ng version          # Verificar Angular CLI ‚â•15
ng serve            # Servidor ha d'arrencar sense errors{% endcapture %}
  {% include code-block.html lang="bash" code=code_128 %}

  <p><strong>Punt d'autocomprovaci√≥:</strong> El projecte ha d'arrencar i mostrar almenys una llista amb <code>*ngFor</code> funcional.</p>
  {% endcapture %}
  {% include section-point.html numero="2.1" titol="Prerequisits" contingut=section_point_2_1 %}

  {% capture section_point_2_2 %}
  <h4>2.2.1. Qu√® √©s la virtualitzaci√≥ de llistes</h4>
  <p>La virtualitzaci√≥ √©s una t√®cnica que renderitza nom√©s els elements visibles al viewport (√†rea visible de la pantalla), creant la il¬∑lusi√≥ d'una llista completa sense carregar tots els elements al DOM simult√†niament.</p>

  <h4>2.2.2. Problema sense virtualitzaci√≥</h4>
  <p><strong>Situaci√≥ abans:</strong></p>
  <p>Imagineu una aplicaci√≥ de cat√†leg amb 5.000 productes. Sense virtualitzaci√≥, Angular crea 5.000 nodes al DOM:</p>

{% capture code_129 %}// Component amb llista gran (incorrecte: mal rendiment)
export class ProductListComponent {
  products: Product[] = [];  // 5.000 elements
  ngOnInit() {
    this.loadProducts();  // Carrega tots els productes
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_129 %}

{% capture code_130 %}<div class="product-grid">
  <app-product-card
    *ngFor="let product of products"
    [product]="product">
  </app-product-card>
</div>
<!-- Crea 5.000 nodes al DOM, encara que nom√©s en vegis 20 -->{% endcapture %}
  {% include code-block.html lang="html" code=code_130 %}

  <p><strong>Problemes que genera:</strong></p>

  <p><strong>1. Temps d'inicialitzaci√≥ lent</strong></p>
  <p>Quan la p√†gina carrega, Angular crea els 5.000 components al DOM. Amb 500ms per cada 100 components, aix√≤ significa 25 segons de c√†rrega inicial completament innecess√†ria.</p>

  <p><strong>2. Consum excessiu de mem√≤ria</strong></p>
  <p>Cada node del DOM ocupa mem√≤ria. 5.000 nodes amb imatges, estils i esdeveniments poden consumir 200-500 MB de RAM, provocant que dispositius antics vagin lents o es pengin.</p>

  <p><strong>3. Scroll pesant i poc fluid</strong></p>
  <p>Quan l'usuari fa scroll, el navegador ha de recalcular posicions i estils de milers de nodes, resultant en un scroll a 10-15 FPS (molt per sota dels 60 FPS desitjables).</p>

  <p><strong>4. Detecci√≥ de canvis costosa</strong></p>
  <p>Cada cop que Angular detecta canvis, comprova tots els 5.000 components. Amb estrat√®gia per defecte, aix√≤ pot suposar comprovacions cada pocs mil¬∑lisegons.</p>

  <p><strong>5. Impacte en dispositius m√≤bils</strong></p>
  <p>Tel√®fons i tauletes tenen menys pot√®ncia i mem√≤ria. Una llista gran pot fer-los completament inutilitzables, especialment amb dades complexes.</p>

  <h4>2.2.3. Soluci√≥ amb virtualitzaci√≥</h4>
  <p><strong>Situaci√≥ despr√©s:</strong></p>
  <p>Amb virtualitzaci√≥, nom√©s es renderitzen 20-30 elements visibles, independentment de la mida total de la llista:</p>

{% capture code_131 %}// Component amb llista virtualitzada (correcte: bon rendiment)
export class ProductListVirtualComponent {
  products: Product[] = [];  // 5.000 elements (array complet)
  itemHeight = 120;          // Al√ßada de cada element en p√≠xels
  ngOnInit() {
    this.loadProducts();  // Carrega tots els productes
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_131 %}

{% capture code_132 %}<cdk-virtual-scroll-viewport
  [itemSize]="itemHeight"
  class="viewport">
  <app-product-card
    *cdkVirtualFor="let product of products"
    [product]="product">
  </app-product-card>
</cdk-virtual-scroll-viewport>
<!-- Nom√©s renderitza 20-30 nodes, independentment del total -->{% endcapture %}
  {% include code-block.html lang="html" code=code_132 %}

  <p><strong>Beneficis immediats:</strong></p>
  <ol>
    <li><strong>C√†rrega inicial r√†pida:</strong> Nom√©s es creen 20-30 nodes inicials (&lt; 1 segon)</li>
    <li><strong>Mem√≤ria optimitzada:</strong> Consum de nom√©s 10-20 MB, 95% de reducci√≥</li>
    <li><strong>Scroll fluid:</strong> 60 FPS constants amb reciclatge de nodes</li>
    <li><strong>Detecci√≥ eficient:</strong> Nom√©s comprova els elements visibles</li>
    <li><strong>Funciona en m√≤bils:</strong> Experi√®ncia fluida fins i tot en dispositius antics</li>
  </ol>

  <h4>2.2.4. Context dins del framework</h4>
  <p>Angular ofereix el <strong>Component Development Kit (CDK)</strong> amb <code>ScrollingModule</code>, que proporciona:</p>
  <ul>
    <li><strong>VirtualScrollViewport:</strong> Contenidor amb scroll virtual</li>
    <li><strong>cdkVirtualFor:</strong> Directiva optimitzada per iterar nom√©s elements visibles</li>
    <li><strong>Estrat√®gies d'al√ßada:</strong> Fixa i din√†mica segons necessitats</li>
    <li><strong>Reciclatge de nodes:</strong> Reutilitza nodes DOM en lloc de crear-ne de nous</li>
  </ul>

  <h4>2.2.5. Integraci√≥ amb conceptes anteriors</h4>
  <p><strong>Relaci√≥ amb components (Unitat 2):</strong></p>
  <ul>
    <li>Els components de llista es creen i destrueixen din√†micament segons la posici√≥ del scroll</li>
    <li>Cal dissenyar components lleugers i r√†pids d'inicialitzar</li>
  </ul>

  <p><strong>Relaci√≥ amb serveis (Unitat 3):</strong></p>
  <ul>
    <li>Les dades provinents d'APIs es gestionen igual, per√≤ el renderitzat √©s molt m√©s eficient</li>
    <li>La virtualitzaci√≥ nom√©s afecta la presentaci√≥, no la l√≤gica de negoci</li>
  </ul>

  <p><strong>Relaci√≥ amb detecci√≥ de canvis (Lectura 4.3.1):</strong></p>
  <ul>
    <li>Combinar OnPush amb virtualitzaci√≥ ofereix millores exponencials</li>
    <li>Menys nodes + menys comprovacions = aplicaci√≥ extremadament r√†pida</li>
  </ul>

  <h4>2.2.6. Casos d'√∫s reals</h4>
  <p><strong>1. Cat√†legs de comer√ß electr√≤nic</strong></p>
  <p>Amazon renderitza milers de productes amb virtualitzaci√≥. Nom√©s els 15-20 productes visibles estan realment al DOM.</p>

  <p><strong>2. Aplicacions de missatgeria</strong></p>
  <p>WhatsApp Web virtualitza converses i missatges. Amb milers de missatges, nom√©s els visibles estan renderitzats.</p>

  <p><strong>3. Taules de dades grans</strong></p>
  <p>Google Sheets virtualitza files i columnes. Pots tenir 100.000 files, per√≤ nom√©s veus 30 a la vegada.</p>

  <p><strong>4. Feeds de xarxes socials</strong></p>
  <p>Twitter i Instagram virtualitzen publicacions. El scroll infinit carrega contingut din√†mic per√≤ nom√©s renderitza el visible.</p>

  <h4>2.2.7. Comparativa t√®cnica: llista normal vs virtualitzada</h4>
  <table>
    <thead>
      <tr>
        <th>Aspecte</th>
        <th>Llista normal (*ngFor)</th>
        <th>Llista virtualitzada (CDK)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Nodes al DOM</strong></td>
        <td>Tots (5.000)</td>
        <td>Nom√©s visibles (20-30)</td>
      </tr>
      <tr>
        <td><strong>Temps c√†rrega</strong></td>
        <td>25s per 5.000 elements</td>
        <td>&lt; 1s independent del total</td>
      </tr>
      <tr>
        <td><strong>Mem√≤ria</strong></td>
        <td>200-500 MB</td>
        <td>10-20 MB</td>
      </tr>
      <tr>
        <td><strong>FPS del scroll</strong></td>
        <td>10-15 FPS</td>
        <td>60 FPS</td>
      </tr>
      <tr>
        <td><strong>Detecci√≥ canvis</strong></td>
        <td>5.000 comprovacions</td>
        <td>20-30 comprovacions</td>
      </tr>
      <tr>
        <td><strong>Dispositius m√≤bils</strong></td>
        <td>Inutilitzable</td>
        <td>Fluid</td>
      </tr>
      <tr>
        <td><strong>L√≠mit pr√†ctic</strong></td>
        <td>~500 elements</td>
        <td>Milers/milions</td>
      </tr>
    </tbody>
  </table>

  <h4>2.2.8. Comparativa quantitativa de rendiment</h4>
  <table>
    <thead>
      <tr>
        <th>M√®trica</th>
        <th>100 elements</th>
        <th>1.000 elements</th>
        <th>5.000 elements</th>
        <th>10.000 elements</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Normal: nodes DOM</strong></td>
        <td>100</td>
        <td>1.000</td>
        <td>5.000</td>
        <td>10.000</td>
      </tr>
      <tr>
        <td><strong>Virtual: nodes DOM</strong></td>
        <td>20</td>
        <td>25</td>
        <td>30</td>
        <td>30</td>
      </tr>
      <tr>
        <td><strong>Normal: temps init</strong></td>
        <td>0.5s</td>
        <td>4s</td>
        <td>25s</td>
        <td>60s</td>
      </tr>
      <tr>
        <td><strong>Virtual: temps init</strong></td>
        <td>0.3s</td>
        <td>0.4s</td>
        <td>0.5s</td>
        <td>0.5s</td>
      </tr>
      <tr>
        <td><strong>Normal: mem√≤ria</strong></td>
        <td>20 MB</td>
        <td>100 MB</td>
        <td>500 MB</td>
        <td>1 GB</td>
      </tr>
      <tr>
        <td><strong>Virtual: mem√≤ria</strong></td>
        <td>8 MB</td>
        <td>10 MB</td>
        <td>15 MB</td>
        <td>20 MB</td>
      </tr>
      <tr>
        <td><strong>Reducci√≥ mem√≤ria</strong></td>
        <td>60%</td>
        <td>90%</td>
        <td>97%</td>
        <td>98%</td>
      </tr>
    </tbody>
  </table>
  {% endcapture %}
  {% include section-point.html numero="2.2" titol="Marc conceptual" contingut=section_point_2_2 %}

  {% capture section_point_2_3 %}
  <h4>2.3.1. Esquema conceptual</h4>

{% capture code_133 %}LLISTA TRADICIONAL (5.000 elements)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [Element 1] ‚óÑ‚îÄ Node al DOM               ‚îÇ
‚îÇ [Element 2] ‚óÑ‚îÄ Node al DOM               ‚îÇ
‚îÇ [Element 3] ‚óÑ‚îÄ Node al DOM               ‚îÇ
‚îÇ ...                                       ‚îÇ
‚îÇ [Element 4.998] ‚óÑ‚îÄ Node al DOM           ‚îÇ
‚îÇ [Element 4.999] ‚óÑ‚îÄ Node al DOM           ‚îÇ
‚îÇ [Element 5.000] ‚óÑ‚îÄ Node al DOM           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Tots els 5.000 nodes estan sempre al DOM
Consum: 500 MB mem√≤ria, 25s c√†rrega


LLISTA VIRTUALITZADA (5.000 elements)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                           ‚îÇ
‚îÇ  [Element 1] ‚óÑ‚îÄ No renderitzat           ‚îÇ
‚îÇ  [Element 2] ‚óÑ‚îÄ No renderitzat           ‚îÇ
‚îÇ  ...                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ  ‚îÇ VIEWPORT (√†rea visible)  ‚îÇ            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§            ‚îÇ
‚îÇ  ‚îÇ [Element 45] ‚óÑ‚îÄ DOM      ‚îÇ ‚óÑ‚îÄ Visible ‚îÇ
‚îÇ  ‚îÇ [Element 46] ‚óÑ‚îÄ DOM      ‚îÇ ‚óÑ‚îÄ Visible ‚îÇ
‚îÇ  ‚îÇ [Element 47] ‚óÑ‚îÄ DOM      ‚îÇ ‚óÑ‚îÄ Visible ‚îÇ
‚îÇ  ‚îÇ ...                      ‚îÇ            ‚îÇ
‚îÇ  ‚îÇ [Element 65] ‚óÑ‚îÄ DOM      ‚îÇ ‚óÑ‚îÄ Visible ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
‚îÇ  [Element 66] ‚óÑ‚îÄ No renderitzat          ‚îÇ
‚îÇ  ...                                      ‚îÇ
‚îÇ  [Element 5.000] ‚óÑ‚îÄ No renderitzat       ‚îÇ
‚îÇ                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Nom√©s 20 nodes al DOM (els visibles)
Consum: 15 MB mem√≤ria, 0.5s c√†rrega{% endcapture %}
  {% include code-block.html lang="text" code=code_133 %}

  <h4>2.3.2. Flux de funcionament</h4>

{% capture code_134 %}SCROLL SENSE VIRTUALITZACI√ì
Usuario fa scroll ‚Üì
  ‚Üí Navegador recalcula 5.000 posicions
  ‚Üí Angular comprova 5.000 components
  ‚Üí Pantalla actualitza (10-15 FPS)
  ‚Üí Experi√®ncia lenta i pesant


SCROLL AMB VIRTUALITZACI√ì
Usuario fa scroll ‚Üì
  ‚Üí CDK detecta nou rang visible (ex: 55-75)
  ‚Üí Recicla nodes DOM existents
  ‚Üí Angular nom√©s comprova 20 components
  ‚Üí Pantalla actualitza (60 FPS)
  ‚Üí Experi√®ncia fluida{% endcapture %}
  {% include code-block.html lang="text" code=code_134 %}

  <h4>2.3.3. Analogia pr√†ctica</h4>
  <p>Penseu en la virtualitzaci√≥ com <strong>mirar per una finestra estreta a una gran galeria d'art</strong>:</p>
  <ul>
    <li><strong>Galeria completa:</strong> Teniu 5.000 quadres (elements de la llista)</li>
    <li><strong>Finestra:</strong> Nom√©s podeu veure 20 quadres a la vegada (viewport)</li>
    <li><strong>Sense virtualitzaci√≥:</strong> Porteu els 5.000 quadres a casa (tots al DOM)</li>
    <li><strong>Amb virtualitzaci√≥:</strong> Nom√©s porteu els 20 que esteu mirant (nom√©s visibles al DOM)</li>
    <li><strong>Quan us moveu:</strong> Canvieu els 20 quadres per altres 20 nous (reciclatge de nodes)</li>
  </ul>

  <p><strong>Avantatge:</strong> Mai necessiteu tenir m√©s de 20 quadres a casa, independentment de quants hi hagi a la galeria.</p>
  {% endcapture %}
  {% include section-point.html numero="2.3" titol="Model mental" contingut=section_point_2_3 %}

  {% capture section_point_2_4 %}
  <h4>2.4.1. El problema del DOM sobrecarregat</h4>
  <p>Quan renderitzeu una llista gran amb <code>*ngFor</code>, cada element crea nodes al DOM. El DOM no √©s infinit ‚Äî t√© costos:</p>

{% capture code_135 %}<div *ngFor="let item of items" class="card">
  <img [src]="item.image">          <!-- Node IMG -->
  <h3>{{ "{{" }} item.title }}</h3>          <!-- Node H3 -->
  <p>{{ "{{" }} item.description }}</p>      <!-- Node P -->
  <button (click)="select(item)">   <!-- Node BUTTON -->
    Seleccionar
  </button>
</div>
<!-- Si items.length === 5.000 ‚Üí 20.000 nodes creats! -->{% endcapture %}
  {% include code-block.html lang="html" code=code_135 %}

  <h4>2.4.2. S√≠mptomes d'una llista amb problemes</h4>
  <p><strong>C√†rrega inicial lenta:</strong></p>
  <ul>
    <li>La p√†gina triga 10-30 segons a apar√®ixer</li>
    <li>L'usuari veu una pantalla en blanc</li>
    <li>Chrome mostra "La p√†gina no respon"</li>
  </ul>

  <p><strong>Scroll pesant:</strong></p>
  <ul>
    <li>El scroll es mou a salts (&lt; 15 FPS)</li>
    <li>Hi ha retard entre l'acci√≥ i el moviment</li>
    <li>En m√≤bils, el scroll simplement no funciona</li>
  </ul>

  <p><strong>Consum excessiu de mem√≤ria:</strong></p>
  <ul>
    <li>Devtools mostra 300-500 MB nom√©s per la llista</li>
    <li>Dispositius antics es pengen</li>
    <li>El navegador mata la pestanya (Out of memory)</li>
  </ul>

  <h4>2.4.3. Exemples pr√†ctics de llistes problem√†tiques</h4>
  <table>
    <thead>
      <tr>
        <th>Tipus d'aplicaci√≥</th>
        <th>Elements t√≠pics</th>
        <th>Problema sense virtualitzaci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Cat√†leg productes</td>
        <td>2.000-10.000</td>
        <td>C√†rrega inicial de 15-60s</td>
      </tr>
      <tr>
        <td>Historial transaccions</td>
        <td>5.000-50.000</td>
        <td>Scroll inutilitzable</td>
      </tr>
      <tr>
        <td>Feed xarxes socials</td>
        <td>Infinit</td>
        <td>Mem√≤ria creix fins crash</td>
      </tr>
      <tr>
        <td>Cerca resultats Google</td>
        <td>100-1.000</td>
        <td>Acceptable per√≤ millorable</td>
      </tr>
    </tbody>
  </table>

  <h4>2.4.4. Exemple visual del problema</h4>

{% capture code_136 %}@Component({
  selector: 'app-slow-list',
  template: `
    <div class="container">
      <h2>{{ "{{" }} items.length }} productes</h2>
      <div class="list">
        <div *ngFor="let item of items" class="card">
          <img [src]="item.image" alt="{{ "{{" }} item.name }}">
          <h3>{{ "{{" }} item.name }}</h3>
          <p>{{ "{{" }} item.price | currency }}</p>
          <button (click)="addToCart(item)">Afegir</button>
        </div>
      </div>
    </div>
  `
})
export class SlowListComponent implements OnInit {
  items: Product[] = [];
  ngOnInit() {
    // Simula c√†rrega de 5.000 productes
    this.items = Array.from({length: 5000}, (_, i) => ({
      id: i,
      name: `Producte ${i}`,
      price: Math.random() * 100,
      image: `https://via.placeholder.com/150`
    }));
  }
  addToCart(item: Product) {
    console.log('Afegit:', item.name);
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_136 %}

  <p><strong>Resultat:</strong></p>
  <ul>
    <li><strong>Temps c√†rrega inicial:</strong> 25-30 segons</li>
    <li><strong>Nodes al DOM:</strong> 20.000 (4 per element √ó 5.000)</li>
    <li><strong>Mem√≤ria:</strong> 450 MB</li>
    <li><strong>Scroll FPS:</strong> 8-12 FPS</li>
  </ul>

  <h4>2.4.5. Quan la virtualitzaci√≥ √©s necess√†ria</h4>
  <table>
    <thead>
      <tr>
        <th>Elements</th>
        <th>Necessitat virtualitzaci√≥</th>
        <th>Ra√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>&lt; 100</td>
        <td>No necess√†ria</td>
        <td>Rendiment acceptable</td>
      </tr>
      <tr>
        <td>100-500</td>
        <td>Recomanable</td>
        <td>Millora experi√®ncia m√≤bil</td>
      </tr>
      <tr>
        <td>500-2.000</td>
        <td>Molt recomanable</td>
        <td>Difer√®ncia notable</td>
      </tr>
      <tr>
        <td>&gt; 2.000</td>
        <td><strong>Imprescindible</strong></td>
        <td>Inutilitzable sense ella</td>
      </tr>
    </tbody>
  </table>
  {% endcapture %}
  {% include section-point.html numero="2.4" titol="Problema de llistes grans: milers d'elements al DOM" contingut=section_point_2_4 %}

  {% capture section_point_2_5 %}
  <h4>2.5.1. Concepte fonamental</h4>
  <p>La virtualitzaci√≥ √©s una t√®cnica que mant√© nom√©s els elements visibles al DOM. La resta d'elements existeixen a la mem√≤ria (array de dades) per√≤ no estan renderitzats.</p>

{% capture code_137 %}ARRAY DE DADES (sempre complet)
[0, 1, 2, ..., 4998, 4999]  ‚Üê 5.000 elements en mem√≤ria
NODES AL DOM (nom√©s visibles)
[Element 45, Element 46, ..., Element 65]  ‚Üê 20 nodes al DOM{% endcapture %}
  {% include code-block.html lang="text" code=code_137 %}

  <h4>2.5.2. Com funciona internament</h4>
  <p><strong>1. Viewport amb scroll</strong></p>
  <p>El component crea un contenidor amb scroll que simula l'al√ßada total de la llista:</p>

{% capture code_138 %}<div style="height: 600000px">  <!-- 5.000 √ó 120px = 600.000px -->
  <div style="transform: translateY(5400px)">  <!-- Posici√≥ actual -->
    <!-- Nom√©s 20 elements reals -->
    <div>Element 45</div>
    <div>Element 46</div>
    ...
    <div>Element 65</div>
  </div>
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_138 %}

  <p><strong>2. C√†lcul de rang visible</strong></p>
  <p>Quan l'usuari fa scroll, el sistema calcula quins elements s√≥n visibles:</p>

{% capture code_139 %}// C√†lcul intern del CDK (simplificat)
const scrollTop = viewport.scrollTop;        // Ex: 5400px
const viewportHeight = viewport.clientHeight; // Ex: 600px
const startIndex = Math.floor(scrollTop / itemHeight);  // 5400 / 120 = 45
const endIndex = Math.ceil((scrollTop + viewportHeight) / itemHeight);  // 50
// Rang visible: elements 45-50{% endcapture %}
  {% include code-block.html lang="typescript" code=code_139 %}

  <p><strong>3. Reciclatge de nodes</strong></p>
  <p>En lloc de destruir i crear nodes, els reutilitza canviant nom√©s les dades:</p>

{% capture code_140 %}// Pseudo-codi del proc√©s de reciclatge
function updateVisibleItems(newRange: [start, end]) {
  // Nodes existents al DOM
  const existingNodes = getDOMNodes();  // 20 nodes
  // Actualitza cada node amb dades noves
  existingNodes.forEach((node, i) => {
    const dataIndex = newRange[0] + i;
    node.updateData(items[dataIndex]);  // Nom√©s canvia dades
  });
  // NO destrueix ni crea nodes, nom√©s actualitza contingut
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_140 %}

  <h4>2.5.3. Avantatges de la virtualitzaci√≥</h4>
  <table>
    <thead>
      <tr>
        <th>Aspecte</th>
        <th>Benefici</th>
        <th>Mesura quantitativa</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Nodes DOM</strong></td>
        <td>Sempre constant</td>
        <td>20-30 (vs 5.000)</td>
      </tr>
      <tr>
        <td><strong>Mem√≤ria</strong></td>
        <td>95% menys</td>
        <td>15 MB (vs 500 MB)</td>
      </tr>
      <tr>
        <td><strong>Temps c√†rrega</strong></td>
        <td>98% m√©s r√†pid</td>
        <td>0.5s (vs 25s)</td>
      </tr>
      <tr>
        <td><strong>FPS scroll</strong></td>
        <td>60 FPS constant</td>
        <td>Fluid (vs 10 FPS)</td>
      </tr>
      <tr>
        <td><strong>Dispositius m√≤bils</strong></td>
        <td>Funciona perfecte</td>
        <td>Experi√®ncia nativa</td>
      </tr>
    </tbody>
  </table>

  <h4>2.5.4. Comparativa visual: normal vs virtualitzada</h4>

{% capture code_141 %}LLISTA NORMAL - TOTS ELS ELEMENTS AL DOM
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë [El 0]    [El 1]    [El 2]    [El 3]      ‚ïë ‚óÑ‚îÄ Tots al DOM
‚ïë [El 4]    [El 5]    [El 6]    [El 7]      ‚ïë ‚óÑ‚îÄ Sempre
‚ïë ...       ...       ...       ...         ‚ïë
‚ïë [El 4996] [El 4997] [El 4998] [El 4999]   ‚ïë ‚óÑ‚îÄ Sempre
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
Mem√≤ria: 500 MB | C√†rrega: 25s | FPS: 10


LLISTA VIRTUALITZADA - NOM√âS VISIBLES
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                            ‚ïë
‚ïë  [Espai virtual per elements 0-44]        ‚ïë ‚óÑ‚îÄ No renderitzats
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚ïë
‚ïë  ‚îÇ VIEWPORT (√†rea visible)        ‚îÇ       ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚ïë
‚ïë  ‚îÇ [El 45]  [El 46]  [El 47]      ‚îÇ       ‚ïë ‚óÑ‚îÄ Al DOM
‚ïë  ‚îÇ [El 48]  [El 49]  [El 50]      ‚îÇ       ‚ïë ‚óÑ‚îÄ Al DOM
‚ïë  ‚îÇ ...      ...      ...          ‚îÇ       ‚ïë
‚ïë  ‚îÇ [El 63]  [El 64]  [El 65]      ‚îÇ       ‚ïë ‚óÑ‚îÄ Al DOM
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚ïë
‚ïë  [Espai virtual per elements 66-4999]     ‚ïë ‚óÑ‚îÄ No renderitzats
‚ïë                                            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
Mem√≤ria: 15 MB | C√†rrega: 0.5s | FPS: 60{% endcapture %}
  {% include code-block.html lang="text" code=code_141 %}

  <h4>2.5.5. Quan NO cal virtualitzar</h4>
  <table>
    <thead>
      <tr>
        <th>Situaci√≥</th>
        <th>Ra√≥</th>
        <th>Alternativa</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>&lt; 100 elements</td>
        <td>Rendiment acceptable</td>
        <td><code>*ngFor</code> normal</td>
      </tr>
      <tr>
        <td>Elements complexos</td>
        <td>Al√ßada molt variable</td>
        <td>Paginaci√≥</td>
      </tr>
      <tr>
        <td>Necessites SEO</td>
        <td>Contingut no indexable</td>
        <td>Server-side rendering</td>
      </tr>
      <tr>
        <td>Llista est√†tica</td>
        <td>No es modifica</td>
        <td><code>*ngFor</code> amb trackBy</td>
      </tr>
    </tbody>
  </table>
  {% endcapture %}
  {% include section-point.html numero="2.5" titol="Qu√® √©s la virtualitzaci√≥: nom√©s renderitzar elements visibles" contingut=section_point_2_5 %}

  {% capture section_point_2_6 %}
  <h4>2.6.1. Importar Angular CDK</h4>
  <p>El Component Development Kit (CDK) d'Angular proporciona el <code>ScrollingModule</code> amb virtualitzaci√≥ integrada.</p>

  <p><strong>Instal¬∑laci√≥:</strong></p>

  {% capture code_142 %}ng add @angular/cdk{% endcapture %}
  {% include code-block.html lang="bash" code=code_142 %}

  <p>Aquesta comanda:</p>
  <ol>
    <li>Instal¬∑la el paquet <code>@angular/cdk</code></li>
    <li>Actualitza <code>package.json</code></li>
    <li>Configura estils globals si cal</li>
  </ol>

  <p><strong>Importaci√≥ al m√≤dul:</strong></p>

  {% capture code_143 %}// app.module.ts o component.module.ts
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { ScrollingModule } from '@angular/cdk/scrolling';  // Importar CDK

import { AppComponent } from './app.component';
import { ProductListVirtualComponent } from './components/product-list-virtual/product-list-virtual.component';

@NgModule({
  declarations: [
    AppComponent,
    ProductListVirtualComponent
  ],
  imports: [
    BrowserModule,
    ScrollingModule  // Afegir al imports
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }{% endcapture %}
  {% include code-block.html lang="typescript" code=code_143 %}

  <h4>2.6.2. Components principals del CDK Scrolling</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Component/Directiva</th>
        <th>Funci√≥</th>
        <th>√ös obligatori</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>cdk-virtual-scroll-viewport</code></td>
        <td>Contenidor amb scroll virtual</td>
        <td>S√≠</td>
      </tr>
      <tr>
        <td><code>*cdkVirtualFor</code></td>
        <td>Directiva per iterar elements</td>
        <td>S√≠</td>
      </tr>
      <tr>
        <td><code>itemSize</code></td>
        <td>Al√ßada de cada element</td>
        <td>S√≠ (al√ßada fixa)</td>
      </tr>
      <tr>
        <td><code>[minBufferPx]</code></td>
        <td>P√≠xels buffer abans visible</td>
        <td>Opcional</td>
      </tr>
      <tr>
        <td><code>[maxBufferPx]</code></td>
        <td>P√≠xels buffer despr√©s visible</td>
        <td>Opcional</td>
      </tr>
    </tbody>
  </table>

  <h4>2.6.3. Configuraci√≥ b√†sica del viewport</h4>
  {% capture code_144 %}// product-list-virtual.component.ts
import { Component, OnInit } from '@angular/core';
import { Product } from '../../models/product.model';
import { ProductService } from '../../services/product.service';

@Component({
  selector: 'app-product-list-virtual',
  templateUrl: './product-list-virtual.component.html',
  styleUrls: ['./product-list-virtual.component.css']
})
export class ProductListVirtualComponent implements OnInit {
  products: Product[] = [];
  itemHeight = 120;  // Al√ßada de cada producte en p√≠xels

  constructor(private productService: ProductService) {}

  ngOnInit(): void {
    this.loadProducts();
  }

  loadProducts(): void {
    this.productService.getProducts().subscribe({
      next: (data) => {
        this.products = data;
        console.log(`Carregats ${this.products.length} productes`);
      },
      error: (err) => console.error('Error carregant productes:', err)
    });
  }

  trackByProductId(index: number, product: Product): number {
    return product.id;
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_144 %}

  <h4>2.6.4. Plantilla amb viewport virtual</h4>
  {% capture code_145 %}<div class="container">
  <h2>Cat√†leg de productes ({{ products.length }})</h2>

  <cdk-virtual-scroll-viewport
    [itemSize]="itemHeight"
    class="viewport">

    <div *cdkVirtualFor="let product of products; trackBy: trackByProductId"
         class="product-card">
      <img [src]="product.image" [alt]="product.name">
      <h3>{{ product.name }}</h3>
      <p class="price">{{ product.price | currency:'EUR' }}</p>
      <p class="description">{{ product.description }}</p>
      <button (click)="addToCart(product)">
        Afegir al carret√≥
      </button>
    </div>

  </cdk-virtual-scroll-viewport>
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_145 %}

  <h4>2.6.5. Estils del viewport</h4>
  {% capture code_146 %}/* product-list-virtual.component.css */
.viewport {
  height: 600px;           /* Al√ßada visible del viewport */
  width: 100%;
  border: 1px solid #ddd;
  overflow-y: auto;        /* Scroll vertical */
}

.product-card {
  height: 120px;           /* Ha de coincidir amb itemHeight */
  padding: 10px;
  border-bottom: 1px solid #eee;
  display: flex;
  gap: 15px;
  align-items: center;
}

.product-card img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 8px;
}

.product-card h3 {
  margin: 0;
  font-size: 16px;
}

.product-card .price {
  font-size: 18px;
  font-weight: bold;
  color: #2196F3;
}

.product-card .description {
  font-size: 14px;
  color: #666;
  flex: 1;
}{% endcapture %}
  {% include code-block.html lang="css" code=code_146 %}

  <h4>2.6.6. Opcions de configuraci√≥ avan√ßada</h4>
  {% capture code_147 %}<cdk-virtual-scroll-viewport
  [itemSize]="itemHeight"
  [minBufferPx]="400"
  [maxBufferPx]="800"
  class="viewport">
</cdk-virtual-scroll-viewport>{% endcapture %}
  {% include code-block.html lang="html" code=code_147 %}

  <p><strong>Explicaci√≥ dels buffers:</strong></p>
  <ul>
    <li><strong>minBufferPx:</strong> P√≠xels m√≠nims renderitzats abans i despr√©s de la zona visible (evita blanc temporal)</li>
    <li><strong>maxBufferPx:</strong> P√≠xels m√†xims renderitzats. Quan se supera, es reciclen nodes</li>
  </ul>

  <p><strong>Recomanaci√≥:</strong> Valors per defecte (200px/400px) funcionen b√© en el 95% dels casos.</p>
  {% endcapture %}
  {% include section-point.html numero="2.6" titol="Llibreria de virtualitzaci√≥: importar i configurar" contingut=section_point_2_6 %}

  {% capture section_point_2_7 %}
  <h4>2.7.1. Sintaxi completa de cdkVirtualFor</h4>
  <p>La directiva <code>*cdkVirtualFor</code> √©s similar a <code>*ngFor</code> per√≤ optimitzada per virtualitzaci√≥:</p>

  {% capture code_148 %}<div *cdkVirtualFor="let item of items;
                     let i = index;
                     let first = first;
                     let last = last;
                     trackBy: trackByFn">
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_148 %}

  <h4>2.7.2. Variables locals disponibles</h4>
  {% raw %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Variable</th>
        <th>Tipus</th>
        <th>Descripci√≥</th>
        <th>Exemple d'√∫s</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>item</code></td>
        <td>T</td>
        <td>Element actual</td>
        <td><code>{{ item.name }}</code></td>
      </tr>
      <tr>
        <td><code>index</code></td>
        <td>number</td>
        <td>√çndex de l'element</td>
        <td><code>#{{ index + 1 }}</code></td>
      </tr>
      <tr>
        <td><code>first</code></td>
        <td>boolean</td>
        <td>Primer element</td>
        <td>Aplicar classe especial</td>
      </tr>
      <tr>
        <td><code>last</code></td>
        <td>boolean</td>
        <td>√öltim element</td>
        <td>Aplicar classe especial</td>
      </tr>
      <tr>
        <td><code>even</code></td>
        <td>boolean</td>
        <td>√çndex parell</td>
        <td>Alternar colors files</td>
      </tr>
      <tr>
        <td><code>odd</code></td>
        <td>boolean</td>
        <td>√çndex senar</td>
        <td>Alternar colors files</td>
      </tr>
    </tbody>
  </table>
  {% endraw %}

  <h4>2.7.3. Exemple complet amb totes les opcions</h4>
  {% capture code_149 %}// advanced-virtual-list.component.ts
import { Component, OnInit } from '@angular/core';
import { ProductService } from '../../services/product.service';
import { Product } from '../../models/product.model';

@Component({
  selector: 'app-advanced-virtual-list',
  templateUrl: './advanced-virtual-list.component.html',
  styleUrls: ['./advanced-virtual-list.component.css']
})
export class AdvancedVirtualListComponent implements OnInit {
  products: Product[] = [];
  itemHeight = 150;

  constructor(private productService: ProductService) {}

  ngOnInit(): void {
    this.loadProducts();
  }

  loadProducts(): void {
    // Simula c√†rrega de 10.000 productes
    this.products = Array.from({length: 10000}, (_, i) => ({
      id: i + 1,
      name: `Producte ${i + 1}`,
      price: Math.random() * 500,
      category: ['Electr√≤nica', 'Roba', 'Esports', 'Llar'][i % 4],
      stock: Math.floor(Math.random() * 100),
      image: `https://via.placeholder.com/120?text=P${i + 1}`
    }));
  }

  trackByProductId(index: number, product: Product): number {
    return product.id;  // IMPORTANT: usar ID √∫nic
  }

  addToCart(product: Product): void {
    console.log('Afegit al carret√≥:', product.name);
  }

  toggleFavorite(product: Product): void {
    console.log('Toggle favorit:', product.name);
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_149 %}

  <h4>2.7.4. Plantilla amb funcionalitats avan√ßades</h4>
  {% capture code_150 %}{% raw %}<div class="container">
  <header class="list-header">
    <h2>Cat√†leg complet</h2>
    <p class="stats">{{ products.length }} productes disponibles</p>
  </header>

  <cdk-virtual-scroll-viewport
    [itemSize]="itemHeight"
    [minBufferPx]="300"
    [maxBufferPx]="600"
    class="viewport">

    <div *cdkVirtualFor="let product of products;
                         let i = index;
                         let first = first;
                         let last = last;
                         let even = even;
                         trackBy: trackByProductId"
         class="product-card"
         [class.first]="first"
         [class.last]="last"
         [class.even]="even">

      <span class="badge">{{ i + 1 }}</span>

      <img [src]="product.image" [alt]="product.name">

      <div class="info">
        <h3>{{ product.name }}</h3>
        <p class="category">{{ product.category }}</p>
        <p class="price">{{ product.price | currency:'EUR' }}</p>
        <p class="stock" [class.low-stock]="product.stock < 10">
          Stock: {{ product.stock }} unitats
        </p>
      </div>

      <div class="actions">
        <button (click)="toggleFavorite(product)" class="btn-icon">
          Favorit
        </button>
        <button (click)="addToCart(product)" class="btn-primary">
          Afegir
        </button>
      </div>

      <span *ngIf="first" class="label">PRIMER</span>
      <span *ngIf="last" class="label">√öLTIM</span>
    </div>

  </cdk-virtual-scroll-viewport>
</div>{% endraw %}{% endcapture %}
  {% include code-block.html lang="html" code=code_150 %}

  <h4>2.7.5. Estils avan√ßats</h4>
  {% capture code_151 %}/* advanced-virtual-list.component.css */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.list-header {
  margin-bottom: 20px;
}

.stats {
  color: #666;
  font-size: 14px;
}

.viewport {
  height: 700px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  overflow-y: auto;
}

.product-card {
  height: 150px;
  padding: 15px;
  display: flex;
  gap: 20px;
  align-items: center;
  border-bottom: 1px solid #f0f0f0;
  position: relative;
  transition: background-color 0.2s;
}

.product-card:hover {
  background-color: #f9f9f9;
}

.product-card.even {
  background-color: #fafafa;
}

.product-card.first {
  border-top: 3px solid #4CAF50;
}

.product-card.last {
  border-bottom: 3px solid #2196F3;
}

.badge {
  position: absolute;
  top: 10px;
  left: 10px;
  background: #9E9E9E;
  color: white;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: bold;
}

.product-card img {
  width: 120px;
  height: 120px;
  object-fit: cover;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.info {
  flex: 1;
}

.info h3 {
  margin: 0 0 8px 0;
  font-size: 18px;
  color: #333;
}

.category {
  font-size: 13px;
  color: #888;
  margin: 0 0 8px 0;
  text-transform: uppercase;
}

.price {
  font-size: 22px;
  font-weight: bold;
  color: #2196F3;
  margin: 0 0 8px 0;
}

.stock {
  font-size: 14px;
  color: #4CAF50;
  margin: 0;
}

.stock.low-stock {
  color: #f44336;
  font-weight: bold;
}

.actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.btn-icon {
  padding: 8px 12px;
  border: none;
  background: #FFF3E0;
  border-radius: 4px;
  cursor: pointer;
  font-size: 18px;
}

.btn-icon:hover {
  background: #FFE0B2;
}

.btn-primary {
  padding: 10px 20px;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
}

.btn-primary:hover {
  background: #1976D2;
}

.label {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #FF5722;
  color: white;
  padding: 4px 12px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: bold;
}{% endcapture %}
  {% include code-block.html lang="css" code=code_151 %}

  <h4>2.7.6. TrackBy obligatori per rendiment</h4>
  <p>La funci√≥ <code>trackBy</code> √©s <strong>fonamental</strong> per optimitzar el reciclatge de nodes:</p>

  {% capture code_152 %}// MAL: sense trackBy
<div *cdkVirtualFor="let product of products">
</div>

// B√â: amb trackBy
<div *cdkVirtualFor="let product of products; trackBy: trackByProductId">
</div>{% endcapture %}
  {% include code-block.html lang="typescript" code=code_152 %}

  <p><strong>Com funciona trackBy:</strong></p>

  {% capture code_153 %}trackByProductId(index: number, product: Product): number {
  return product.id;
  // Angular sap que si product.id no canvia, pot reutilitzar el node
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_153 %}

  <p><strong>Impacte quantitatiu:</strong></p>
  <ul>
    <li><strong>Sense trackBy:</strong> Destrueix i crea 20-30 nodes cada cop que feu scroll</li>
    <li><strong>Amb trackBy:</strong> Reutilitza nodes canviant nom√©s dades (95% m√©s r√†pid)</li>
  </ul>
  {% endcapture %}
  {% include section-point.html numero="2.7" titol="Implementar llista virtual: sintaxi i opcions" contingut=section_point_2_7 %}

  {% capture section_point_2_8 %}
  <h4>2.8.1. Al√ßada fixa (recomanada)</h4>
  <p>L'al√ßada fixa √©s la m√©s senzilla i eficient. Tots els elements tenen exactament la mateixa al√ßada.</p>

  <p><strong>Avantatges:</strong></p>
  <ul>
    <li>C√†lcul de posicions extremadament r√†pid</li>
    <li>Reciclatge de nodes perfecte</li>
    <li>No cal mesurar elements</li>
    <li>Rendiment √≤ptim</li>
  </ul>

  <p><strong>Configuraci√≥:</strong></p>

  {% capture code_154 %}export class ProductListComponent {
  itemHeight = 120;  // Tots els elements: 120px d'al√ßada
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_154 %}

  {% capture code_155 %}<cdk-virtual-scroll-viewport [itemSize]="itemHeight" class="viewport">
  <div *cdkVirtualFor="let item of items" class="item">
  </div>
</cdk-virtual-scroll-viewport>{% endcapture %}
  {% include code-block.html lang="html" code=code_155 %}

  {% capture code_156 %}.item {
  height: 120px;  /* Ha de coincidir amb itemHeight */
  box-sizing: border-box;
}{% endcapture %}
  {% include code-block.html lang="css" code=code_156 %}

  <h4>2.8.2. Al√ßada din√†mica (avan√ßada)</h4>
  <p>Quan els elements tenen al√ßades variables, necessiteu una estrat√®gia diferent.</p>

  <p><strong>Inconvenients:</strong></p>
  <ul>
    <li>C√†lculs m√©s costosos</li>
    <li>Necessita mesurar elements</li>
    <li>Rendiment lleugerament inferior</li>
    <li>M√©s complex de configurar</li>
  </ul>

  <p><strong>Estrat√®gia 1: Al√ßada mitjana estimada</strong></p>

  {% capture code_157 %}export class VariableHeightListComponent {
  averageItemHeight = 150;  // Al√ßada mitjana estimada
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_157 %}

  {% capture code_158 %}<cdk-virtual-scroll-viewport
  [itemSize]="averageItemHeight"
  class="viewport">
  <div *cdkVirtualFor="let item of items" class="item">
  </div>
</cdk-virtual-scroll-viewport>{% endcapture %}
  {% include code-block.html lang="html" code=code_158 %}

  <p><strong>Limitaci√≥:</strong> Si les al√ßades varien molt, apareixen salts en el scroll.</p>

  <p><strong>Estrat√®gia 2: AutoSizeVirtualScrollStrategy (experimental)</strong></p>

  {% capture code_159 %}import { Component, ViewChild, AfterViewInit } from '@angular/core';
import { CdkVirtualScrollViewport } from '@angular/cdk/scrolling';

@Component({
  selector: 'app-auto-size-list',
  templateUrl: './auto-size-list.component.html'
})
export class AutoSizeListComponent implements AfterViewInit {
  @ViewChild(CdkVirtualScrollViewport) viewport!: CdkVirtualScrollViewport;

  items: any[] = [];

  ngAfterViewInit(): void {
    // For√ßa actualitzaci√≥ despr√©s de renderitzar
    this.viewport.checkViewportSize();
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_159 %}

  <p><strong>Nota:</strong> Aquesta estrat√®gia encara √©s experimental i t√© limitacions.</p>

  <h4>2.8.3. Comparativa al√ßada fixa vs din√†mica</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Aspecte</th>
        <th>Al√ßada fixa</th>
        <th>Al√ßada din√†mica</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Rendiment</strong></td>
        <td>Excel¬∑lent</td>
        <td>Bo</td>
      </tr>
      <tr>
        <td><strong>Complexitat</strong></td>
        <td>Baixa</td>
        <td>Alta</td>
      </tr>
      <tr>
        <td><strong>Precisi√≥ scroll</strong></td>
        <td>Perfecta</td>
        <td>Acceptable</td>
      </tr>
      <tr>
        <td><strong>C√†lculs necessaris</strong></td>
        <td>M√≠nims</td>
        <td>Continus</td>
      </tr>
      <tr>
        <td><strong>Reciclatge nodes</strong></td>
        <td>√íptim</td>
        <td>Menys eficient</td>
      </tr>
      <tr>
        <td><strong>Recomanaci√≥</strong></td>
        <td>Usar sempre que sigui possible</td>
        <td>Nom√©s si imprescindible</td>
      </tr>
    </tbody>
  </table>

  <h4>2.8.4. Exemple pr√†ctic: for√ßar al√ßada fixa</h4>
  <p>Si el contingut √©s variable, podeu for√ßar al√ßada fixa amb CSS:</p>

  {% capture code_160 %}<div *cdkVirtualFor="let item of items" class="item">
  <div class="content">
    <h3>{{ item.title }}</h3>
    <p>{{ item.description }}</p>
  </div>
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_160 %}

  {% capture code_161 %}.item {
  height: 150px;           /* Al√ßada fixa for√ßada */
  overflow: hidden;        /* Talla contingut extra */
  box-sizing: border-box;
}

.content {
  height: 100%;
  overflow-y: auto;        /* Scroll intern si cal */
}{% endcapture %}
  {% include code-block.html lang="css" code=code_161 %}

  <h4>2.8.5. Bones pr√†ctiques per al√ßades</h4>
  <p><strong>1. Prioritzeu al√ßada fixa sempre que sigui possible</strong></p>

  {% capture code_162 %}// B√â: al√ßada fixa
itemHeight = 120;

// EVITAR: al√ßada variable sense justificaci√≥{% endcapture %}
  {% include code-block.html lang="typescript" code=code_162 %}

  <p><strong>2. Calculeu l'al√ßada real abans de desplegar</strong></p>

  {% capture code_163 %}// Mesureu un element representatiu
const sampleElement = document.querySelector('.item');
const computedHeight = sampleElement.getBoundingClientRect().height;
console.log('Al√ßada real:', computedHeight);
// Ajusteu itemHeight amb aquest valor{% endcapture %}
  {% include code-block.html lang="typescript" code=code_163 %}

  <p><strong>3. Considereu padding i borders</strong></p>

  {% capture code_164 %}/* MAL: padding fa que al√ßada total sigui 140px */
.item {
  height: 120px;
  padding: 10px;  /* +20px total */
}

/* B√â: box-sizing inclou padding */
.item {
  height: 120px;
  padding: 10px;
  box-sizing: border-box;  /* Al√ßada total: 120px */
}{% endcapture %}
  {% include code-block.html lang="css" code=code_164 %}

  <h4>2.8.6. Mesurar l'al√ßada program√†ticament</h4>
  {% capture code_165 %}import { Component, ViewChild, ElementRef, AfterViewInit } from '@angular/core';

@Component({
  selector: 'app-measured-list',
  template: `
    <div #sampleItem class="item" style="visibility: hidden; position: absolute;">
      <h3>T√≠tol mostra</h3>
      <p>Descripci√≥ mostra amb contingut t√≠pic...</p>
    </div>

    <cdk-virtual-scroll-viewport [itemSize]="itemHeight" class="viewport">
      <div *cdkVirtualFor="let item of items" class="item">
        <h3>{{ item.title }}</h3>
        <p>{{ item.description }}</p>
      </div>
    </cdk-virtual-scroll-viewport>
  `
})
export class MeasuredListComponent implements AfterViewInit {
  @ViewChild('sampleItem') sampleItem!: ElementRef;

  itemHeight = 120;  // Valor per defecte
  items: any[] = [];

  ngAfterViewInit(): void {
    // Mesura l'al√ßada real
    const realHeight = this.sampleItem.nativeElement.offsetHeight;
    this.itemHeight = realHeight;
    console.log('Al√ßada mesurada:', this.itemHeight);
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_165 %}
  {% endcapture %}
  {% include section-point.html numero="2.8" titol="Al√ßada d'elements: fixa vs din√†mica" contingut=section_point_2_8 %}

  {% capture section_point_2_9 %}
  <h4>2.9.1. Metodologia de mesura</h4>
  <p>Per comparar el rendiment, utilitzarem les eines de desenvolupador de Chrome:</p>

  <p><strong>1. Performance tab:</strong></p>
  <ul>
    <li>Grava mentre carregues la llista</li>
    <li>Mesura temps de c√†rrega inicial</li>
    <li>Analitza frames per segon (FPS) durant scroll</li>
  </ul>

  <p><strong>2. Memory tab:</strong></p>
  <ul>
    <li>Pren snapshot despr√©s de carregar</li>
    <li>Compara mem√≤ria usada</li>
    <li>Identifica nodes DOM</li>
  </ul>

  <p><strong>3. Lighthouse:</strong></p>
  <ul>
    <li>Analitza puntuaci√≥ de rendiment</li>
    <li>Mesura Time to Interactive (TTI)</li>
  </ul>

  <h4>2.9.2. Configuraci√≥ de tests</h4>
  {% capture code_166 %}// test-list-normal.component.ts (SENSE virtualitzaci√≥)
@Component({
  selector: 'app-test-list-normal',
  template: `
    <div class="container">
      <h2>Llista normal ({{ items.length }} elements)</h2>
      <button (click)="loadItems()">Carregar 5.000 elements</button>

      <div class="list">
        <div *ngFor="let item of items; trackBy: trackById" class="item">
          <img [src]="item.image" alt="{{ item.name }}">
          <div class="info">
            <h3>{{ item.name }}</h3>
            <p>{{ item.description }}</p>
            <span class="price">{{ item.price | currency }}</span>
          </div>
        </div>
      </div>
    </div>
  `
})
export class TestListNormalComponent {
  items: any[] = [];

  loadItems() {
    const startTime = performance.now();

    this.items = Array.from({length: 5000}, (_, i) => ({
      id: i,
      name: `Producte ${i}`,
      description: `Descripci√≥ del producte ${i} amb text variable`,
      price: Math.random() * 500,
      image: `https://via.placeholder.com/80?text=${i}`
    }));

    setTimeout(() => {
      const endTime = performance.now();
      console.log(`Temps c√†rrega: ${(endTime - startTime).toFixed(0)}ms`);
      console.log(`Nodes al DOM: ${document.querySelectorAll('.item').length}`);
    }, 100);
  }

  trackById(index: number, item: any): number {
    return item.id;
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_166 %}

  {% capture code_167 %}// test-list-virtual.component.ts (AMB virtualitzaci√≥)
@Component({
  selector: 'app-test-list-virtual',
  template: `
    <div class="container">
      <h2>Llista virtualitzada ({{ items.length }} elements)</h2>
      <button (click)="loadItems()">Carregar 5.000 elements</button>

      <cdk-virtual-scroll-viewport [itemSize]="120" class="viewport">
        <div *cdkVirtualFor="let item of items; trackBy: trackById" class="item">
          <img [src]="item.image" alt="{{ item.name }}">
          <div class="info">
            <h3>{{ item.name }}</h3>
            <p>{{ item.description }}</p>
            <span class="price">{{ item.price | currency }}</span>
          </div>
        </div>
      </cdk-virtual-scroll-viewport>
    </div>
  `
})
export class TestListVirtualComponent {
  items: any[] = [];

  loadItems() {
    const startTime = performance.now();

    this.items = Array.from({length: 5000}, (_, i) => ({
      id: i,
      name: `Producte ${i}`,
      description: `Descripci√≥ del producte ${i} amb text variable`,
      price: Math.random() * 500,
      image: `https://via.placeholder.com/80?text=${i}`
    }));

    setTimeout(() => {
      const endTime = performance.now();
      console.log(`Temps c√†rrega: ${(endTime - startTime).toFixed(0)}ms`);
      console.log(`Nodes al DOM: ${document.querySelectorAll('.item').length}`);
    }, 100);
  }

  trackById(index: number, item: any): number {
    return item.id;
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_167 %}

  <h4>2.9.3. Resultats quantitatius</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>M√®trica</th>
        <th>Llista normal</th>
        <th>Llista virtual</th>
        <th>Millora</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Temps c√†rrega inicial</strong></td>
        <td>8.500 ms</td>
        <td>450 ms</td>
        <td><strong>95% m√©s r√†pid</strong></td>
      </tr>
      <tr>
        <td><strong>Nodes al DOM</strong></td>
        <td>5.000</td>
        <td>25</td>
        <td><strong>99.5% menys</strong></td>
      </tr>
      <tr>
        <td><strong>Mem√≤ria (heap)</strong></td>
        <td>420 MB</td>
        <td>18 MB</td>
        <td><strong>95% menys</strong></td>
      </tr>
      <tr>
        <td><strong>FPS durant scroll</strong></td>
        <td>12 FPS</td>
        <td>60 FPS</td>
        <td><strong>5√ó m√©s fluid</strong></td>
      </tr>
      <tr>
        <td><strong>Time to Interactive</strong></td>
        <td>9.2 s</td>
        <td>0.6 s</td>
        <td><strong>93% m√©s r√†pid</strong></td>
      </tr>
      <tr>
        <td><strong>Lighthouse Performance</strong></td>
        <td>32/100</td>
        <td>98/100</td>
        <td><strong>3√ó millor</strong></td>
      </tr>
    </tbody>
  </table>

  <h4>2.9.4. An√†lisi detallada per escenaris</h4>
  <p><strong>Escenari 1: C√†rrega inicial</strong></p>

  {% capture code_168 %}NORMAL (5.000 elements):
‚îú‚îÄ Parse HTML: 1.200ms
‚îú‚îÄ Create components: 5.800ms
‚îú‚îÄ Render DOM: 1.200ms
‚îú‚îÄ Paint: 300ms
‚îî‚îÄ TOTAL: 8.500ms

VIRTUAL (5.000 elements):
‚îú‚îÄ Parse HTML: 50ms
‚îú‚îÄ Create components: 280ms  (nom√©s 25)
‚îú‚îÄ Render DOM: 80ms
‚îú‚îÄ Paint: 40ms
‚îî‚îÄ TOTAL: 450ms

Difer√®ncia: 8.050ms (18√ó m√©s r√†pid){% endcapture %}
  {% include code-block.html lang="text" code=code_168 %}

  <p><strong>Escenari 2: Scroll de 0 a 2.500 (meitat)</strong></p>

  {% capture code_169 %}NORMAL:
‚îú‚îÄ Recalcular posicions: 5.000 nodes
‚îú‚îÄ Check detecci√≥ canvis: 5.000 components
‚îú‚îÄ Temps per frame: 83ms (12 FPS)
‚îî‚îÄ Experi√®ncia: Lenta i a salts

VIRTUAL:
‚îú‚îÄ Recalcular posicions: 25 nodes
‚îú‚îÄ Reciclar nodes: 25 components
‚îú‚îÄ Temps per frame: 16ms (60 FPS)
‚îî‚îÄ Experi√®ncia: Fluida i immediata

Difer√®ncia: 5√ó m√©s FPS{% endcapture %}
  {% include code-block.html lang="text" code=code_169 %}

  <p><strong>Escenari 3: Mem√≤ria en dispositiu m√≤bil</strong></p>

  {% capture code_170 %}NORMAL en iPhone 12:
‚îú‚îÄ DOM nodes: 5.000 √ó 4 elements = 20.000 nodes
‚îú‚îÄ Event listeners: 5.000 botons √ó 2 = 10.000 listeners
‚îú‚îÄ Mem√≤ria total: ~450 MB
‚îî‚îÄ Resultat: Aplicaci√≥ es penja

VIRTUAL en iPhone 12:
‚îú‚îÄ DOM nodes: 25 √ó 4 elements = 100 nodes
‚îú‚îÄ Event listeners: 25 botons √ó 2 = 50 listeners
‚îú‚îÄ Mem√≤ria total: ~20 MB
‚îî‚îÄ Resultat: Funciona perfecte{% endcapture %}
  {% include code-block.html lang="text" code=code_170 %}

  <h4>2.9.5. Gr√†fic de rendiment visual</h4>
  {% capture code_171 %}TEMPS DE C√ÄRREGA (ms)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ
‚îÇ  Normal    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 8.500  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  Virtual   ‚ñà 450                        ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         0    2000   4000   6000   8000


NODES AL DOM
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ
‚îÇ  Normal    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 5.000  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  Virtual   ‚ñå 25                         ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         0    1000   2000   3000   4000


MEM√íRIA (MB)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ
‚îÇ  Normal    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 420        ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  Virtual   ‚ñà 18                         ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         0     100    200    300    400{% endcapture %}
  {% include code-block.html lang="text" code=code_171 %}

  <h4>2.9.6. Casos extrems testejats</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Elements</th>
        <th>Normal: temps</th>
        <th>Virtual: temps</th>
        <th>Difer√®ncia</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>100</td>
        <td>180ms</td>
        <td>50ms</td>
        <td>3.6√ó</td>
      </tr>
      <tr>
        <td>500</td>
        <td>850ms</td>
        <td>120ms</td>
        <td>7√ó</td>
      </tr>
      <tr>
        <td>1.000</td>
        <td>1.700ms</td>
        <td>180ms</td>
        <td>9.4√ó</td>
      </tr>
      <tr>
        <td>5.000</td>
        <td>8.500ms</td>
        <td>450ms</td>
        <td>18.8√ó</td>
      </tr>
      <tr>
        <td>10.000</td>
        <td>18.200ms</td>
        <td>520ms</td>
        <td>35√ó</td>
      </tr>
      <tr>
        <td>50.000</td>
        <td>Inutilitzable</td>
        <td>680ms</td>
        <td>‚àû</td>
      </tr>
    </tbody>
  </table>

  <h4>2.9.7. Conclusions de les proves</h4>
  <p><strong>1. Virtualitzaci√≥ √©s imprescindible per > 500 elements</strong></p>
  <p>Per sota de 500, la millora √©s notable per√≤ no cr√≠tica. Per sobre de 500, la difer√®ncia √©s d'√∫s o inutilitat.</p>

  <p><strong>2. Els beneficis creixen exponencialment</strong></p>
  <ul>
    <li>Amb 100 elements: 3√ó m√©s r√†pid</li>
    <li>Amb 5.000 elements: 18√ó m√©s r√†pid</li>
    <li>Amb 10.000 elements: 35√ó m√©s r√†pid</li>
  </ul>

  <p><strong>3. Dispositius m√≤bils s√≥n el coll d'ampolla</strong></p>
  <p>En desktop modern, 1.000 elements normals s√≥n acceptables. En m√≤bil, 500 elements ja s√≥n problem√†tics.</p>

  <p><strong>4. La mem√≤ria √©s tan cr√≠tica com la velocitat</strong></p>
  <p>Una aplicaci√≥ lenta es pot tolerar. Una aplicaci√≥ que consumeix 500 MB i es penja no es pot usar.</p>
  {% endcapture %}
  {% include section-point.html numero="2.9" titol="Comparativa de rendiment: 1000 elements normals vs virtualitzats" contingut=section_point_2_9 %}

  {% capture section_point_2_10 %}
  <h4>2.10.1. Criteri de decisi√≥ quantitatiu</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Elements</th>
        <th>Virtualitzaci√≥</th>
        <th>Ra√≥</th>
        <th>Temps estalviat</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>&lt; 50</td>
        <td>No necess√†ria</td>
        <td>Overhead innecessari</td>
        <td>0ms</td>
      </tr>
      <tr>
        <td>50-100</td>
        <td>Opcional</td>
        <td>Benefici marginal</td>
        <td>100ms</td>
      </tr>
      <tr>
        <td>100-500</td>
        <td>Recomanable</td>
        <td>Millora notable</td>
        <td>500-1.000ms</td>
      </tr>
      <tr>
        <td>500-2.000</td>
        <td>Molt recomanable</td>
        <td>Gran difer√®ncia</td>
        <td>1-5s</td>
      </tr>
      <tr>
        <td>&gt; 2.000</td>
        <td><strong>Imprescindible</strong></td>
        <td>Inutilitzable sense</td>
        <td>5-30s</td>
      </tr>
    </tbody>
  </table>

  <h4>2.10.2. Quan S√ç virtualitzar</h4>
  <p><strong>1. Cat√†legs de productes amb > 500 elements</strong></p>

  {% capture code_172 %}// Cat√†leg e-commerce
products: Product[] = [];  // 2.000-10.000 productes
// ‚Üí Virtualitzaci√≥ obligat√≤ria{% endcapture %}
  {% include code-block.html lang="typescript" code=code_172 %}

  <p><strong>2. Taules de dades amb moltes files</strong></p>

  {% capture code_173 %}// Historial de transaccions
transactions: Transaction[] = [];  // 5.000-50.000 files
// ‚Üí Virtualitzaci√≥ obligat√≤ria{% endcapture %}
  {% include code-block.html lang="typescript" code=code_173 %}

  <p><strong>3. Feeds de xarxes socials amb scroll infinit</strong></p>

  {% capture code_174 %}// Feed infinit
posts: Post[] = [];  // Creix indefinidament
// ‚Üí Virtualitzaci√≥ obligat√≤ria{% endcapture %}
  {% include code-block.html lang="typescript" code=code_174 %}

  <p><strong>4. Llistes de cerca amb > 100 resultats</strong></p>

  {% capture code_175 %}// Resultats de cerca
searchResults: Result[] = [];  // 100-1.000 resultats
// ‚Üí Virtualitzaci√≥ recomanada{% endcapture %}
  {% include code-block.html lang="typescript" code=code_175 %}

  <h4>2.10.3. Quan NO virtualitzar</h4>
  <p><strong>1. Llistes petites (&lt; 50 elements)</strong></p>

  {% capture code_176 %}// Men√∫ de navegaci√≥
menuItems: MenuItem[] = [/* 10 elements */];
// ‚Üí *ngFor normal √©s millor{% endcapture %}
  {% include code-block.html lang="typescript" code=code_176 %}

  <p><strong>2. Elements amb al√ßada molt variable</strong></p>

  {% capture code_177 %}<div *ngFor="let post of posts">
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_177 %}

  <p><strong>3. Llistes amb interaccions complexes</strong></p>

  {% capture code_178 %}<div *ngFor="let item of items" cdkDrag>
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_178 %}

  <p><strong>4. Necessites SEO (indexaci√≥ Google)</strong></p>

  {% capture code_179 %}<article *ngFor="let article of articles">
</article>{% endcapture %}
  {% include code-block.html lang="html" code=code_179 %}

  <h4>2.10.4. Alternatives a la virtualitzaci√≥</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Situaci√≥</th>
        <th>Alternativa</th>
        <th>Quan usar-la</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Al√ßada variable</td>
        <td>Paginaci√≥</td>
        <td>Elements 100-500px</td>
      </tr>
      <tr>
        <td>SEO necessari</td>
        <td>SSR + paginaci√≥</td>
        <td>Blogs, not√≠cies</td>
      </tr>
      <tr>
        <td>Interaccions complexes</td>
        <td>Lazy loading</td>
        <td>Drag & drop, edici√≥</td>
      </tr>
      <tr>
        <td>Poques dades</td>
        <td>*ngFor normal</td>
        <td>&lt; 50 elements</td>
      </tr>
    </tbody>
  </table>

  <h4>2.10.5. Checklist de decisi√≥</h4>
  {% capture code_180 %}‚ñ° La llista t√© m√©s de 100 elements?
  ‚îî‚îÄ No ‚Üí Usar *ngFor normal
  ‚îî‚îÄ S√≠ ‚Üí Continuar

‚ñ° Els elements tenen al√ßada fixa o similar (¬±20%)?
  ‚îî‚îÄ No ‚Üí Considerar paginaci√≥
  ‚îî‚îÄ S√≠ ‚Üí Continuar

‚ñ° Necessites SEO o indexaci√≥?
  ‚îî‚îÄ S√≠ ‚Üí Usar SSR amb paginaci√≥
  ‚îî‚îÄ No ‚Üí Continuar

‚ñ° Hi ha interaccions complexes (drag & drop)?
  ‚îî‚îÄ S√≠ ‚Üí Testejar virtualitzaci√≥ + llibreries
  ‚îî‚îÄ No ‚Üí Continuar

‚ñ° √âs una aplicaci√≥ m√≤bil o t√© usuaris m√≤bils?
  ‚îî‚îÄ S√≠ ‚Üí Virtualitzaci√≥ obligat√≤ria
  ‚îî‚îÄ No ‚Üí Virtualitzaci√≥ recomanada

RESULTAT: Implementar virtualitzaci√≥{% endcapture %}
  {% include code-block.html lang="text" code=code_180 %}

  <h4>2.10.6. Errors comuns a evitar</h4>
  <p><strong>1. Virtualitzar llistes petites</strong></p>

  {% capture code_181 %}// MAL: overhead innecessari
items = [1, 2, 3, 4, 5];  // Nom√©s 5 elements
// ‚Üí Usar *ngFor normal{% endcapture %}
  {% include code-block.html lang="typescript" code=code_181 %}

  <p><strong>2. No establir itemSize correcte</strong></p>

  {% capture code_182 %}<cdk-virtual-scroll-viewport [itemSize]="100">
  <div *cdkVirtualFor="let item of items" style="height: 150px">
  </div>
</cdk-virtual-scroll-viewport>{% endcapture %}
  {% include code-block.html lang="html" code=code_182 %}

  <p><strong>3. Oblidar trackBy</strong></p>

  {% capture code_183 %}<!-- MAL: sense trackBy -->
<div *cdkVirtualFor="let item of items">
</div>

<!-- B√â: amb trackBy -->
<div *cdkVirtualFor="let item of items; trackBy: trackById">
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_183 %}

  <p><strong>4. Viewport sense al√ßada definida</strong></p>

  {% capture code_184 %}/* MAL: viewport sense al√ßada */
.viewport {
  width: 100%;
  /* Falta height! */
}

/* B√â: viewport amb al√ßada */
.viewport {
  width: 100%;
  height: 600px;  /* Obligatori */
}{% endcapture %}
  {% include code-block.html lang="css" code=code_184 %}

  <h4>2.10.7. Patr√≥ recomanat per implementaci√≥</h4>
  {% capture code_185 %}// 1. Definir interface
interface Product {
  id: number;
  name: string;
  price: number;
}

// 2. Component amb virtualitzaci√≥
@Component({
  selector: 'app-product-list',
  template: `
    <cdk-virtual-scroll-viewport [itemSize]="itemHeight" class="viewport">
      <div *cdkVirtualFor="let product of products; trackBy: trackById"
           class="item">
        {{ product.name }}
      </div>
    </cdk-virtual-scroll-viewport>
  `,
  styles: [`
    .viewport { height: 600px; }
    .item { height: 120px; box-sizing: border-box; }
  `]
})
export class ProductListComponent {
  products: Product[] = [];
  itemHeight = 120;

  trackById(index: number, item: Product): number {
    return item.id;
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_185 %}
  {% endcapture %}
  {% include section-point.html numero="2.10" titol="Bones pr√†ctiques: quan val la pena virtualitzar" contingut=section_point_2_10 %}

  {% capture section_point_2_11 %}
  <h4>2.11.1. TrackBy: identificador √∫nic per elements</h4>
  <p>La funci√≥ <code>trackBy</code> √©s cr√≠tica per optimitzar el renderitzat de llistes, virtualitzades o no.</p>

  <p><strong>Problema sense trackBy:</strong></p>

  {% capture code_186 %}// Component amb llista
items: Product[] = [];

updateItems() {
  this.items = [...this.items];  // Nova refer√®ncia
  // Angular recrea TOTS els nodes encara que les dades siguin iguals
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_186 %}

  <p><strong>Soluci√≥ amb trackBy:</strong></p>

  {% capture code_187 %}items: Product[] = [];

trackByProductId(index: number, product: Product): number {
  return product.id;
  // Angular nom√©s recrea nodes amb ID diferents
}

updateItems() {
  this.items = [...this.items];
  // Angular compara IDs i nom√©s actualitza els canviats
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_187 %}

  {% capture code_188 %}<div *ngFor="let product of products; trackBy: trackByProductId">
  {{ product.name }}
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_188 %}

  <p><strong>Impacte quantitatiu:</strong></p>
  <ul>
    <li><strong>Sense trackBy:</strong> Destrueix i recrea 1.000 nodes ‚Üí 800ms</li>
    <li><strong>Amb trackBy:</strong> Actualitza nom√©s 50 nodes canviats ‚Üí 40ms</li>
    <li><strong>Millora:</strong> 95% m√©s r√†pid</li>
  </ul>

  <h4>2.11.2. Pipes purs vs impurs</h4>
  <p>Els pipes transformen dades a la plantilla. Angular ofereix dos tipus:</p>

  <p><strong>1. Pipes purs (per defecte - recomanat)</strong></p>
  <p>Nom√©s es recalculen quan l'entrada canvia:</p>

  {% capture code_189 %}@Pipe({
  name: 'formatPrice',
  pure: true  // Per defecte
})
export class FormatPricePipe implements PipeTransform {
  transform(value: number): string {
    console.log('Pipe executat');
    return `${value.toFixed(2)} ‚Ç¨`;
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_189 %}

  {% capture code_190 %}<div *ngFor="let product of products">
  {{ product.price | formatPrice }}
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_190 %}

  <p><strong>2. Pipes impurs (usar amb precauci√≥)</strong></p>
  <p>Es recalculen en CADA cicle de detecci√≥:</p>

  {% capture code_191 %}@Pipe({
  name: 'filterProducts',
  pure: false  // Impure
})
export class FilterProductsPipe implements PipeTransform {
  transform(products: Product[], query: string): Product[] {
    console.log('Pipe executat');  // Es veur√† constantment
    return products.filter(p => p.name.includes(query));
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_191 %}

  {% capture code_192 %}<div *ngFor="let product of products | filterProducts:searchQuery">
  {{ product.name }}
</div>{% endcapture %}
  {% include code-block.html lang="html" code=code_192 %}

  <p><strong>Cost dels pipes impurs:</strong></p>
  <ul>
    <li><strong>Pipe pur:</strong> 1 execuci√≥ per canvi real ‚Üí 0.5ms</li>
    <li><strong>Pipe impur:</strong> 100 execucions per segon ‚Üí 50ms/s</li>
    <li><strong>Difer√®ncia:</strong> 100√ó m√©s cost</li>
  </ul>

  <h4>2.11.3. Comparativa pipes purs vs impurs</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Aspecte</th>
        <th>Pipe pur</th>
        <th>Pipe impur</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Execucions</strong></td>
        <td>1 per canvi real</td>
        <td>100+ per segon</td>
      </tr>
      <tr>
        <td><strong>Rendiment</strong></td>
        <td>Excel¬∑lent</td>
        <td>Problem√†tic</td>
      </tr>
      <tr>
        <td><strong>√ös recomanat</strong></td>
        <td>Transformacions simples</td>
        <td>Filtres complexos</td>
      </tr>
      <tr>
        <td><strong>Impacte llista 1.000</strong></td>
        <td>M√≠nim</td>
        <td>Bloqueja UI</td>
      </tr>
    </tbody>
  </table>

  <h4>2.11.4. Optimitzaci√≥: filtrar al component</h4>
  <p>En lloc d'un pipe impur, filtreu al component:</p>

  {% capture code_193 %}// MAL: pipe impur
@Pipe({ name: 'filter', pure: false })
export class FilterPipe {
  transform(items: any[], query: string): any[] {
    return items.filter(item => item.name.includes(query));
  }
}

// B√â: filtre al component
export class ProductListComponent {
  allProducts: Product[] = [];
  filteredProducts: Product[] = [];
  searchQuery = '';

  onSearch(query: string) {
    this.searchQuery = query;
    this.filteredProducts = this.allProducts
      .filter(p => p.name.includes(query));
    // Nom√©s filtra quan l'usuari escriu
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_193 %}

  {% capture code_194 %}<!-- MAL: pipe impur -->
<div *ngFor="let p of products | filter:searchQuery">

<!-- B√â: array prefiltrat -->
<div *ngFor="let p of filteredProducts">{% endcapture %}
  {% include code-block.html lang="html" code=code_194 %}

  <h4>2.11.5. OnPush amb virtualitzaci√≥ (combinaci√≥ √≤ptima)</h4>
  <p>Combinar estrat√®gia <code>OnPush</code> amb virtualitzaci√≥ ofereix el m√†xim rendiment:</p>

  {% capture code_195 %}@Component({
  selector: 'app-optimized-list',
  changeDetection: ChangeDetectionStrategy.OnPush,  // OnPush
  template: `
    <cdk-virtual-scroll-viewport [itemSize]="120" class="viewport">
      <div *cdkVirtualFor="let item of items; trackBy: trackById"
           class="item">
        {{ item.name }} - {{ item.price | currency }}
      </div>
    </cdk-virtual-scroll-viewport>
  `
})
export class OptimizedListComponent {
  items: Product[] = [];

  trackById(index: number, item: Product): number {
    return item.id;
  }

  updateItems(newItems: Product[]) {
    // Crea nova refer√®ncia per activar OnPush
    this.items = [...newItems];
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_195 %}

  <p><strong>Resultat combinat:</strong></p>
  <ul>
    <li><strong>Virtualitzaci√≥:</strong> Nom√©s 25 nodes al DOM</li>
    <li><strong>OnPush:</strong> Nom√©s comprova quan canvia l'input</li>
    <li><strong>TrackBy:</strong> Recicla nodes eficientment</li>
    <li><strong>Millora total:</strong> 99.9% m√©s eficient que llista normal</li>
  </ul>

  <h4>2.11.6. Resum d'optimitzacions</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>T√®cnica</th>
        <th>Aplicaci√≥</th>
        <th>Millora</th>
        <th>Complexitat</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Virtualitzaci√≥</strong></td>
        <td>Llistes > 500 elements</td>
        <td>95% c√†rrega</td>
        <td>Baixa</td>
      </tr>
      <tr>
        <td><strong>TrackBy</strong></td>
        <td>Totes les llistes</td>
        <td>90% actualitzaci√≥</td>
        <td>Molt baixa</td>
      </tr>
      <tr>
        <td><strong>OnPush</strong></td>
        <td>Components pesats</td>
        <td>80% detecci√≥</td>
        <td>Mitjana</td>
      </tr>
      <tr>
        <td><strong>Pipes purs</strong></td>
        <td>Transformacions</td>
        <td>99% vs impurs</td>
        <td>Molt baixa</td>
      </tr>
      <tr>
        <td><strong>Filtrat component</strong></td>
        <td>Filtres complexos</td>
        <td>95% vs pipe</td>
        <td>Baixa</td>
      </tr>
    </tbody>
  </table>
  {% endcapture %}
  {% include section-point.html numero="2.11" titol="Altres optimitzacions de renderitzat: trackBy, pipes purs" contingut=section_point_2_11 %}

  {% capture section_point_2_12 %}
  <h4>2.12.1. Objectiu</h4>
  <p>Crear una llista virtualitzada de 2.000 productes amb filtre de cerca i ordenaci√≥, mesurant el rendiment abans i despr√©s.</p>

  <h4>2.12.2. Pas 1: Model de dades</h4>
  {% capture code_196 %}// models/product.model.ts
export interface Product {
  id: number;
  name: string;
  category: string;
  price: number;
  stock: number;
  image: string;
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_196 %}

  <h4>2.12.3. Pas 2: Servei de dades</h4>
  {% capture code_197 %}// services/product.service.ts
import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';
import { delay } from 'rxjs/operators';
import { Product } from '../models/product.model';

@Injectable({
  providedIn: 'root'
})
export class ProductService {

  generateProducts(count: number): Observable<Product[]> {
    const categories = ['Electr√≤nica', 'Roba', 'Esports', 'Llar', 'Joguines'];

    const products: Product[] = Array.from({length: count}, (_, i) => ({
      id: i + 1,
      name: `Producte ${i + 1}`,
      category: categories[i % categories.length],
      price: Math.random() * 500,
      stock: Math.floor(Math.random() * 100),
      image: `https://via.placeholder.com/80?text=P${i + 1}`
    }));

    return of(products).pipe(delay(500));  // Simula lat√®ncia API
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_197 %}

  <h4>2.12.4. Pas 3: Component amb virtualitzaci√≥</h4>
  {% capture code_198 %}// components/product-catalog/product-catalog.component.ts
import { Component, OnInit, ChangeDetectionStrategy } from '@angular/core';
import { Product } from '../../models/product.model';
import { ProductService } from '../../services/product.service';

@Component({
  selector: 'app-product-catalog',
  templateUrl: './product-catalog.component.html',
  styleUrls: ['./product-catalog.component.css'],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class ProductCatalogComponent implements OnInit {
  allProducts: Product[] = [];
  filteredProducts: Product[] = [];
  itemHeight = 100;
  searchQuery = '';
  sortBy: 'name' | 'price' = 'name';
  loading = true;

  constructor(private productService: ProductService) {}

  ngOnInit(): void {
    this.loadProducts();
  }

  loadProducts(): void {
    const startTime = performance.now();
    this.loading = true;

    this.productService.generateProducts(2000).subscribe({
      next: (products) => {
        this.allProducts = products;
        this.filteredProducts = [...products];
        this.loading = false;

        const endTime = performance.now();
        console.log(`Carregats ${products.length} productes en ${(endTime - startTime).toFixed(0)}ms`);
      },
      error: (err) => {
        console.error('Error carregant productes:', err);
        this.loading = false;
      }
    });
  }

  onSearch(query: string): void {
    this.searchQuery = query.toLowerCase();
    this.applyFilters();
  }

  onSort(sortBy: 'name' | 'price'): void {
    this.sortBy = sortBy;
    this.applyFilters();
  }

  private applyFilters(): void {
    let filtered = this.allProducts;

    // Filtrar per cerca
    if (this.searchQuery) {
      filtered = filtered.filter(p =>
        p.name.toLowerCase().includes(this.searchQuery) ||
        p.category.toLowerCase().includes(this.searchQuery)
      );
    }

    // Ordenar
    filtered = [...filtered].sort((a, b) => {
      if (this.sortBy === 'name') {
        return a.name.localeCompare(b.name);
      } else {
        return a.price - b.price;
      }
    });

    this.filteredProducts = filtered;
  }

  trackByProductId(index: number, product: Product): number {
    return product.id;
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_198 %}

  <h4>2.12.5. Pas 4: Plantilla</h4>
  {% capture code_199 %}{% raw %}<div class="container">
  <header class="catalog-header">
    <h2>Cat√†leg de productes</h2>

    <div class="controls">
      <input
        type="text"
        placeholder="Cerca productes..."
        (input)="onSearch($event.target.value)"
        class="search-input">

      <select (change)="onSort($event.target.value)" class="sort-select">
        <option value="name">Ordenar per nom</option>
        <option value="price">Ordenar per preu</option>
      </select>

      <span class="stats">
        {{ filteredProducts.length }} / {{ allProducts.length }} productes
      </span>
    </div>
  </header>

  <div *ngIf="loading" class="loading">
    Carregant productes...
  </div>

  <cdk-virtual-scroll-viewport
    *ngIf="!loading"
    [itemSize]="itemHeight"
    [minBufferPx]="300"
    [maxBufferPx]="600"
    class="viewport">

    <div *cdkVirtualFor="let product of filteredProducts;
                         trackBy: trackByProductId"
         class="product-card">

      <img [src]="product.image" [alt]="product.name">

      <div class="product-info">
        <h3>{{ product.name }}</h3>
        <span class="category">{{ product.category }}</span>
        <p class="price">{{ product.price | currency:'EUR':'symbol':'1.2-2' }}</p>
        <p class="stock" [class.low]="product.stock < 20">
          Stock: {{ product.stock }} unitats
        </p>
      </div>

      <button class="btn-add">Afegir</button>
    </div>

  </cdk-virtual-scroll-viewport>
</div>{% endraw %}{% endcapture %}
  {% include code-block.html lang="html" code=code_199 %}

  <h4>2.12.6. Pas 5: Estils</h4>
  {% capture code_200 %}/* product-catalog.component.css */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.catalog-header {
  margin-bottom: 20px;
}

.catalog-header h2 {
  margin: 0 0 15px 0;
}

.controls {
  display: flex;
  gap: 15px;
  align-items: center;
  flex-wrap: wrap;
}

.search-input {
  flex: 1;
  min-width: 200px;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.sort-select {
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.stats {
  color: #666;
  font-size: 14px;
  font-weight: 500;
}

.loading {
  text-align: center;
  padding: 40px;
  color: #666;
  font-size: 18px;
}

.viewport {
  height: 700px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  overflow-y: auto;
}

.product-card {
  height: 100px;
  padding: 10px;
  border-bottom: 1px solid #f0f0f0;
  display: flex;
  align-items: center;
  gap: 15px;
  transition: background-color 0.2s;
}

.product-card:hover {
  background-color: #f9f9f9;
}

.product-card img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 8px;
}

.product-info {
  flex: 1;
}

.product-info h3 {
  margin: 0 0 5px 0;
  font-size: 16px;
  color: #333;
}

.category {
  display: inline-block;
  background: #E3F2FD;
  color: #1976D2;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  margin-bottom: 5px;
}

.price {
  font-size: 18px;
  font-weight: bold;
  color: #2196F3;
  margin: 5px 0;
}

.stock {
  font-size: 13px;
  color: #4CAF50;
  margin: 0;
}

.stock.low {
  color: #f44336;
}

.btn-add {
  padding: 8px 16px;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 500;
}

.btn-add:hover {
  background: #1976D2;
}{% endcapture %}
  {% include code-block.html lang="css" code=code_200 %}

  <h4>2.12.7. Verificaci√≥ de funcionament</h4>
  <p><strong>Passos:</strong></p>

  <ol>
    <li>Executeu l'aplicaci√≥: <code>ng serve</code></li>
    <li>Obriu devtools (F12) ‚Üí pesta√±a Console</li>
    <li>Carregueu la p√†gina i observeu:
      <ul>
        <li>Temps de c√†rrega: ~500ms</li>
        <li>Nodes al DOM: ~30 (no 2.000)</li>
      </ul>
    </li>
    <li>Feu scroll r√†pid i observeu:
      <ul>
        <li>FPS: 60 constants</li>
        <li>Flu√Ødesa perfecta</li>
      </ul>
    </li>
    <li>Cerqueu "Producte 1500":
      <ul>
        <li>Filtre instantani</li>
        <li>Nom√©s 1 resultat</li>
      </ul>
    </li>
    <li>Canvieu ordenaci√≥:
      <ul>
        <li>Reordena instant√†niament</li>
      </ul>
    </li>
  </ol>

  <p><strong>Resultat esperat:</strong></p>
  <ul>
    <li>C√†rrega inicial: &lt; 1s</li>
    <li>Scroll fluid: 60 FPS</li>
    <li>Cerca i ordenaci√≥: instantanis</li>
    <li>Mem√≤ria: &lt; 30 MB</li>
  </ul>
  {% endcapture %}
  {% include section-point.html numero="2.12" titol="Mini exemple pr√†ctic" contingut=section_point_2_12 %}

  {% capture section_point_2_13 %}
  <h4>2.13.1. Errors transversals</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Scroll no funciona</td>
        <td>Viewport sense al√ßada CSS</td>
        <td>Afegir <code>height: 600px</code> al <code>.viewport</code></td>
      </tr>
      <tr>
        <td>Elements no es veuen</td>
        <td>itemSize incorrecte</td>
        <td>Verificar que coincideix amb al√ßada CSS</td>
      </tr>
      <tr>
        <td>Salts en el scroll</td>
        <td>Al√ßada variable</td>
        <td>Usar al√ßada fixa o estrat√®gia din√†mica</td>
      </tr>
      <tr>
        <td>Llista no actualitza</td>
        <td>Falta trackBy</td>
        <td>Afegir <code>trackBy: trackByFn</code></td>
      </tr>
      <tr>
        <td>Mem√≤ria creix</td>
        <td>Imatges no alliberades</td>
        <td>Usar lazy loading per imatges</td>
      </tr>
    </tbody>
  </table>

  <h4>2.13.2. Errors de configuraci√≥</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Soluci√≥ Windows</th>
        <th>Soluci√≥ Linux/macOS</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>@angular/cdk no trobat</td>
        <td>CDK no instal¬∑lat</td>
        <td><code>ng add @angular/cdk</code></td>
        <td><code>ng add @angular/cdk</code></td>
      </tr>
      <tr>
        <td>ScrollingModule error</td>
        <td>M√≤dul no importat</td>
        <td>Afegir a <code>imports: []</code></td>
        <td>Afegir a <code>imports: []</code></td>
      </tr>
      <tr>
        <td>cdkVirtualFor unknown</td>
        <td>Directiva no reconeguda</td>
        <td>Verificar imports al m√≤dul</td>
        <td>Verificar imports al m√≤dul</td>
      </tr>
      <tr>
        <td>Viewport no renderitza</td>
        <td>Contenidor sense dimensions</td>
        <td>Establir <code>width</code> i <code>height</code></td>
        <td>Establir <code>width</code> i <code>height</code></td>
      </tr>
    </tbody>
  </table>

  <h4>2.13.3. Problemes de depend√®ncies</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Versi√≥ incompatible</td>
        <td>CDK no coincideix amb Angular</td>
        <td><code>ng update @angular/cdk</code></td>
      </tr>
      <tr>
        <td>Peer dependencies</td>
        <td>Versions conflictives</td>
        <td><code>npm install --legacy-peer-deps</code></td>
      </tr>
      <tr>
        <td>Build error</td>
        <td>Tipus TypeScript</td>
        <td>Actualitzar <code>tsconfig.json</code></td>
      </tr>
    </tbody>
  </table>

  <h4>2.13.4. Errors de rendiment</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Problema</th>
        <th>Causa</th>
        <th>Diagn√≤stic</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Scroll lent</td>
        <td>trackBy absent</td>
        <td>Console: "recreating nodes"</td>
        <td>Afegir <code>trackBy</code></td>
      </tr>
      <tr>
        <td>C√†rrega lenta</td>
        <td>itemSize massa gran</td>
        <td>Devtools: 100+ nodes</td>
        <td>Reduir <code>itemSize</code></td>
      </tr>
      <tr>
        <td>Mem√≤ria creix</td>
        <td>Pipes impurs</td>
        <td>Memory profiler</td>
        <td>Canviar a pipes purs</td>
      </tr>
      <tr>
        <td>FPS baixos</td>
        <td>OnPush no usat</td>
        <td>Performance tab</td>
        <td>Afegir <code>OnPush</code></td>
      </tr>
    </tbody>
  </table>

  <h4>2.13.5. Problemes d'al√ßada</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>S√≠mptoma</th>
        <th>Causa</th>
        <th>Verificaci√≥</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Scroll salta</td>
        <td>itemSize ‚â† al√ßada CSS</td>
        <td>Inspeccionar element</td>
        <td>Igualar valors</td>
      </tr>
      <tr>
        <td>Elements tallats</td>
        <td>box-sizing incorrecte</td>
        <td>Computed styles</td>
        <td>Afegir <code>box-sizing: border-box</code></td>
      </tr>
      <tr>
        <td>Espai blanc</td>
        <td>minBufferPx insuficient</td>
        <td>Scroll r√†pid</td>
        <td>Augmentar <code>minBufferPx</code></td>
      </tr>
      <tr>
        <td>Elements duplicats</td>
        <td>trackBy retorna mateix valor</td>
        <td>Console logs</td>
        <td>Usar ID √∫nic</td>
      </tr>
    </tbody>
  </table>

  <h4>2.13.6. Debug avan√ßat</h4>
  {% capture code_201 %}// Afegir logs per debug
export class DebugVirtualListComponent implements AfterViewInit {
  @ViewChild(CdkVirtualScrollViewport) viewport!: CdkVirtualScrollViewport;

  ngAfterViewInit(): void {
    // Log quan canvia el rang visible
    this.viewport.renderedRangeStream.subscribe(range => {
      console.log('Rang visible:', range);
    });

    // Log scroll offset
    this.viewport.elementScrolled().subscribe(() => {
      console.log('Scroll offset:', this.viewport.measureScrollOffset());
    });
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_201 %}
  {% endcapture %}
  {% include section-point.html numero="2.13" titol="Resoluci√≥ de problemes" contingut=section_point_2_13 %}

  {% capture section_point_2_14 %}
{% include prompt-ai.html contingut="<strong>Rol:</strong> Ets un desenvolupador Angular senior especialitzat en optimitzaci√≥ de rendiment i virtualitzaci√≥ de llistes. <strong>Context:</strong> Estic aprenent a implementar virtualitzaci√≥ de llistes amb Angular CDK per primera vegada. He completat la lectura 4.3.2 on he configurat <code>cdk-virtual-scroll-viewport</code>, <code>*cdkVirtualFor</code> i <code>trackBy</code>. <strong>Tasca:</strong> Crea una taula comparativa que m'ajudi a comprendre quan √©s necessari virtualitzar una llista i quan no. Inclou 5-6 escenaris diferents amb el nombre d'elements, impacte en rendiment (temps de c√†rrega, mem√≤ria, FPS) i recomanaci√≥ final. <strong>Format:</strong> Taula markdown amb columnes: Nombre d'elements | Sense virtualitzaci√≥ (temps/mem√≤ria/FPS) | Amb virtualitzaci√≥ (temps/mem√≤ria/FPS) | Recomanaci√≥ | Cas d'√∫s real." %}
{% include prompt-ai.html contingut="<strong>Rol:</strong> Ets un auditor de rendiment d'aplicacions web especialitzat en Angular i optimitzaci√≥ DOM. <strong>Context:</strong> He implementat una llista virtualitzada amb 2.000 productes que inclou cerca, ordenaci√≥ i <code>trackBy</code>. El scroll fa salts i el rendiment no √©s l'esperat. <strong>Tasca:</strong> Genera un pla de diagn√≤stic exhaustiu per identificar i solucionar problemes de rendiment en llistes virtualitzades. Inclou comprovacions de configuraci√≥ (itemSize, CSS, trackBy), mesures amb DevTools (Performance, Memory, Elements), i solucions espec√≠fiques per cada problema detectat. <strong>Format:</strong> Llista numerada amb 12-15 punts de verificaci√≥. Cada punt ha de tenir: Qu√® comprovar | Com fer-ho amb DevTools | Problema si falla | Soluci√≥ concreta amb codi." %}

  {% endcapture %}
  {% include section-point.html numero="2.14" titol="Prompts d'IA" contingut=section_point_2_14 %}

  {% capture section_point_2_15 %}
  <h4>2.15.1. Criteris objectius (Definition of Done)</h4>
  <p><strong>Funcionalitat:</strong></p>
  {% include checklist.html elements="He implementat una llista virtualitzada amb m√©s de 500 elements funcional|He configurat correctament `itemSize` coincidint amb l'al√ßada CSS|He afegit `trackBy` i verificat que millora el rendiment|He mesurat i comparat temps de c√†rrega abans/despr√©s de virtualitzar" %}

  <p><strong>Projecte i estructura:</strong></p>
  {% include checklist.html elements="He importat `ScrollingModule` al m√≤dul corresponent|He creat un viewport amb al√ßada definida (`height: 600px`)|He utilitzat `*cdkVirtualFor` en lloc de `*ngFor`|He establert `box-sizing: border-box` per evitar problemes d'al√ßada" %}

  <p><strong>Rendiment:</strong></p>
  {% include checklist.html elements="He verificat que nom√©s 20-30 elements estan al DOM (DevTools)|He mesurat FPS durant scroll i √©s constant a 60|He comprovat que la mem√≤ria no supera 30-50 MB|He aplicat `OnPush` quan √©s possible per optimitzaci√≥ extra" %}

  <p><strong>Bones pr√†ctiques:</strong></p>
  {% include checklist.html elements="He utilitzat pipes purs per transformacions|He filtrat dades al component, no amb pipes impurs|He documentat per qu√® he triat virtualitzaci√≥|He testat en dispositiu m√≤bil o simulador" %}

  <h4>2.15.2. Compet√®ncies adquirides</h4>
  <p><strong>Virtualitzaci√≥:</strong></p>
  {% include checklist.html elements="Comprenc quan √©s necessari virtualitzar una llista (> 500 elements)|S√© implementar scroll virtual amb Angular CDK|Puc configurar itemSize, minBufferPx i maxBufferPx adequadament|Entenc com funciona el reciclatge de nodes" %}

  <p><strong>Rendiment:</strong></p>
  {% include checklist.html elements="S√© mesurar temps de c√†rrega amb performance.now()|Puc analitzar nodes al DOM amb DevTools|Comprenc l'impacte de la mem√≤ria en aplicacions|S√© diagnosticar problemes de scroll lent" %}

  <p><strong>TrackBy i optimitzacions:</strong></p>
  {% include checklist.html elements="Entenc per qu√® trackBy √©s imprescindible|Puc crear funcions trackBy amb identificadors √∫nics|S√© diferenciar pipes purs i impurs|Puc combinar OnPush amb virtualitzaci√≥" %}

  <p><strong>Debug i soluci√≥ de problemes:</strong></p>
  {% include checklist.html elements="S√© identificar descordances entre itemSize i CSS|Puc solucionar salts en el scroll|Entenc com configurar buffers per evitar espais en blanc|S√© usar DevTools per analitzar rendiment" %}

  <p><strong>Aplicaci√≥ pr√†ctica:</strong></p>
  {% include checklist.html elements="He creat una llista virtualitzada completa funcional|He integrat cerca i ordenaci√≥ amb rendiment √≤ptim|He mesurat millores quantitatives (temps, mem√≤ria, FPS)|Puc explicar els beneficis a altres desenvolupadors" %}
  {% endcapture %}
  {% include section-point.html numero="2.15" titol="Autoavaluaci√≥" contingut=section_point_2_15 %}

  {% capture section_point_2_16 %}
  <h4>2.16.1. Qu√® hem aconseguit</h4>
  <p>Heu apr√®s a implementar virtualitzaci√≥ de llistes per gestionar milers d'elements de forma eficient. Aquesta t√®cnica √©s fonamental per aplicacions modernes amb grans volums de dades.</p>

  <p>Disposeu d'un <strong>component de llista virtualitzada</strong> amb:</p>

  <ol>
    <li><strong>Virtualitzaci√≥ CDK:</strong> Nom√©s renderitza 20-30 elements visibles, independentment del total</li>
    <li><strong>Rendiment optimitzat:</strong> C√†rrega inicial 95% m√©s r√†pida, scroll fluid a 60 FPS constant</li>
    <li><strong>TrackBy implementat:</strong> Reciclatge eficient de nodes, actualitzacions instant√†nies</li>
    <li><strong>Cerca i ordenaci√≥:</strong> Filtrat al component sense pipes impurs, respostes immediates</li>
    <li><strong>Bones pr√†ctiques aplicades:</strong> OnPush, pipes purs, gesti√≥ de mem√≤ria optimitzada</li>
  </ol>

  <h4>2.16.2. Amb les compet√®ncies adquirides en virtualitzaci√≥, esteu preparats per:</h4>
  <ul>
    <li>Implementar scroll infinit amb paginaci√≥ autom√†tica</li>
    <li>Crear taules de dades virtuals amb milers de files</li>
    <li>Optimitzar aplicacions m√≤bils amb llistes grans</li>
    <li>Combinar virtualitzaci√≥ amb lazy loading avan√ßat</li>
    <li>Aplicar t√®cniques de rendiment a components complexos</li>
  </ul>

  <p>A futures ampliacions del curs, podreu explorar <strong>t√®cniques avan√ßades</strong> com virtualitzaci√≥ bidimensional (files i columnes), integraci√≥ amb WebWorkers per processament en segon pla, i estrat√®gies de pre-c√†rrega intel¬∑ligent.</p>

  <h4>2.16.3. Contracte de sortida</h4>
  <ul>
    <li>Implementeu llistes virtualitzades per > 500 elements</li>
    <li>Mesureu i comproveu millores de rendiment quantitatives</li>
    <li>Configureu itemSize, buffers i trackBy correctament</li>
    <li>Diagnostiqueu i resoleu problemes de scroll i al√ßada</li>
  </ul>

  <p><strong>Esteu preparats per optimitzar qualsevol aplicaci√≥ amb llistes grans!</strong></p>

  <h4>2.16.4. Refer√®ncies r√†pides</h4>
  <p><strong>Imports essencials:</strong></p>

  {% capture code_202 %}import { ScrollingModule } from '@angular/cdk/scrolling';
import { ChangeDetectionStrategy } from '@angular/core';{% endcapture %}
  {% include code-block.html lang="typescript" code=code_202 %}

  <p><strong>Configuraci√≥ b√†sica:</strong></p>

  {% capture code_203 %}<cdk-virtual-scroll-viewport [itemSize]="120" class="viewport">
  <div *cdkVirtualFor="let item of items; trackBy: trackById">
    {{ item.name }}
  </div>
</cdk-virtual-scroll-viewport>{% endcapture %}
  {% include code-block.html lang="html" code=code_203 %}

  <p><strong>CSS obligatori:</strong></p>

  {% capture code_204 %}.viewport {
  height: 600px;
}
.item {
  height: 120px;
  box-sizing: border-box;
}{% endcapture %}
  {% include code-block.html lang="css" code=code_204 %}

  <p><strong>Troubleshooting r√†pid:</strong></p>
  <ul>
    <li>Scroll no funciona ‚Üí Afegir <code>height</code> al viewport</li>
    <li>Salts en el scroll ‚Üí Igualar <code>itemSize</code> amb al√ßada CSS</li>
    <li>Llista no actualitza ‚Üí Afegir <code>trackBy</code></li>
    <li>Mem√≤ria creix ‚Üí Verificar pipes impurs</li>
  </ul>

  <p><strong>Resoluci√≥ de problemes detallada:</strong> Vegeu secci√≥ 2.13</p>
  {% endcapture %}
  {% include section-point.html numero="2.16" titol="Recapitulaci√≥" contingut=section_point_2_16 %}

  {% capture section_point_2_17 %}
  <h4>2.17.1. Glossari de termes clau</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Terme</th>
        <th>Definici√≥</th>
        <th>Exemple</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Virtualitzaci√≥</strong></td>
        <td>T√®cnica que nom√©s renderitza elements visibles al viewport</td>
        <td>5.000 elements ‚Üí 25 al DOM</td>
      </tr>
      <tr>
        <td><strong>Viewport</strong></td>
        <td>√Ärea visible on es mostren els elements</td>
        <td>Contenidor de 600px d'al√ßada</td>
      </tr>
      <tr>
        <td><strong>itemSize</strong></td>
        <td>Al√ßada de cada element en p√≠xels</td>
        <td>120px per element</td>
      </tr>
      <tr>
        <td><strong>Reciclatge de nodes</strong></td>
        <td>Reutilitzar nodes DOM canviant dades</td>
        <td>Node existent canvia de "Element 45" a "Element 46"</td>
      </tr>
      <tr>
        <td><strong>Buffer</strong></td>
        <td>P√≠xels extra renderitzats abans/despr√©s del visible</td>
        <td>300px abans + 300px despr√©s</td>
      </tr>
      <tr>
        <td><strong>TrackBy</strong></td>
        <td>Funci√≥ que identifica elements √∫nicament</td>
        <td><code>trackById(i, item) => item.id</code></td>
      </tr>
      <tr>
        <td><strong>OnPush</strong></td>
        <td>Estrat√®gia de detecci√≥ nom√©s quan canvien inputs</td>
        <td>Redueix comprovacions 90%</td>
      </tr>
      <tr>
        <td><strong>Pipe pur</strong></td>
        <td>Pipe que nom√©s recalcula quan entrada canvia</td>
        <td><code>{{ price | currency }}</code></td>
      </tr>
      <tr>
        <td><strong>Pipe impur</strong></td>
        <td>Pipe que recalcula cada cicle</td>
        <td><code>{{ items | filter:query }}</code></td>
      </tr>
    </tbody>
  </table>

  <h4>2.17.2. Conceptes fonamentals</h4>
  <p><strong>1. Per qu√® virtualitzar?</strong></p>
  <p>Sense virtualitzaci√≥, 5.000 elements creen 20.000 nodes al DOM, consumint 500 MB i trigant 25 segons a carregar. Amb virtualitzaci√≥, nom√©s es creen 30 nodes, consumint 15 MB i carregant en 0.5 segons.</p>

  <p><strong>2. Com funciona?</strong></p>
  <p>El sistema crea un contenidor amb l'al√ßada total simulada (5.000 √ó 120px = 600.000px) per√≤ nom√©s renderitza elements visibles. Quan feu scroll, recicla nodes DOM canviant les dades en lloc de destruir i crear nous nodes.</p>

  <p><strong>3. Quan usar-la?</strong></p>
  <ul>
    <li><strong>Obligat√≤ria:</strong> > 2.000 elements</li>
    <li><strong>Molt recomanada:</strong> 500-2.000 elements</li>
    <li><strong>Recomanada:</strong> 100-500 elements</li>
    <li><strong>Opcional:</strong> &lt; 100 elements</li>
  </ul>

  <h4>2.17.3. F√≥rmules i c√†lculs</h4>
  <p><strong>Nodes al DOM sense virtualitzaci√≥:</strong></p>

  {% capture code_205 %}Nodes = Elements √ó Nodes_per_element
Exemple: 5.000 √ó 4 = 20.000 nodes{% endcapture %}
  {% include code-block.html lang="text" code=code_205 %}

  <p><strong>Nodes al DOM amb virtualitzaci√≥:</strong></p>

  {% capture code_206 %}Nodes = (Viewport_height / Item_height) √ó Nodes_per_element
Exemple: (600 / 120) √ó 4 = 20 nodes{% endcapture %}
  {% include code-block.html lang="text" code=code_206 %}

  <p><strong>Mem√≤ria aproximada:</strong></p>

  {% capture code_207 %}Mem√≤ria ‚âà Nodes √ó 25KB
Sense virtual: 20.000 √ó 25KB = 500 MB
Amb virtual: 20 √ó 25KB = 0.5 MB{% endcapture %}
  {% include code-block.html lang="text" code=code_207 %}

  <p><strong>Temps de c√†rrega estimat:</strong></p>

  {% capture code_208 %}Temps ‚âà Nodes / 200 (nodes per segon)
Sense virtual: 20.000 / 200 = 100 segons
Amb virtual: 20 / 200 = 0.1 segons{% endcapture %}
  {% include code-block.html lang="text" code=code_208 %}

  <h4>2.17.4. Checklist final de comprovaci√≥</h4>
  {% capture code_209 %}ABANS DE DESPLEGAR:
‚ñ° itemSize coincideix amb al√ßada CSS real?
‚ñ° Viewport t√© height definida?
‚ñ° trackBy implementat amb ID √∫nic?
‚ñ° box-sizing: border-box aplicat?
‚ñ° OnPush activat quan sigui possible?
‚ñ° Pipes s√≥n purs?
‚ñ° Mesurat rendiment amb DevTools?
‚ñ° Testat en dispositiu m√≤bil?
‚ñ° Mem√≤ria < 50 MB per 1.000+ elements?
‚ñ° Scroll a 60 FPS constant?{% endcapture %}
  {% include code-block.html lang="text" code=code_209 %}

  <h4>2.17.5. Recursos addicionals</h4>
  <p><strong>Documentaci√≥ oficial:</strong></p>
  <ul>
    <li>Angular CDK Scrolling: https://material.angular.io/cdk/scrolling</li>
    <li>API Reference: Busqueu "CdkVirtualScrollViewport"</li>
  </ul>

  <p><strong>Exemples pr√†ctics:</strong></p>
  <ul>
    <li>Angular Material Table amb virtualitzaci√≥</li>
    <li>Exemples a StackBlitz: cerqueu "angular cdk virtual scroll"</li>
  </ul>

  <p><strong>Eines de mesura:</strong></p>
  <ul>
    <li>Chrome DevTools ‚Üí Performance tab</li>
    <li>Chrome DevTools ‚Üí Memory tab</li>
    <li>Lighthouse per puntuaci√≥ global</li>
  </ul>

  <h4>2.17.6. Errors freq√ºents i solucions</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Error com√∫</th>
        <th>Per qu√® passa</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>"No es veu res"</td>
        <td>Viewport sense height</td>
        <td>Afegir <code>height: 600px</code></td>
      </tr>
      <tr>
        <td>"Scroll fa salts"</td>
        <td>itemSize incorrecte</td>
        <td>Igualar amb CSS</td>
      </tr>
      <tr>
        <td>"Llista no actualitza"</td>
        <td>Falta trackBy</td>
        <td>Afegir funci√≥ trackBy</td>
      </tr>
      <tr>
        <td>"Va lent igualment"</td>
        <td>Pipes impurs</td>
        <td>Canviar a pipes purs</td>
      </tr>
      <tr>
        <td>"Mem√≤ria creix"</td>
        <td>Imatges no optimitzades</td>
        <td>Lazy loading</td>
      </tr>
    </tbody>
  </table>
  {% endcapture %}
  {% include section-point.html numero="2.17" titol="Rep√†s de conceptes" contingut=section_point_2_17 %}

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SECCI√ì 3: Compilaci√≥ i desplegament per a producci√≥           -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="section" id="Unitat4_Bloc3_Seccio3">
  <h2 id="Unitat4_Bloc3_Seccio3">3. Compilaci√≥ i desplegament per a producci√≥</h2>

  <!-- MULTIM√àDIA -->
  {% include multimedia-youtube.html unitat=4 bloc=3 seccio=3 %}


  {% include objectius.html llista="Compilar l'aplicaci√≥ per a producci√≥ amb optimitzacions autom√†tiques|Analitzar la mida del bundle i identificar components o llibreries pesades|Configurar variables d'entorn per a diferents contextos de desplegament|Desplegar l'aplicaci√≥ en plataformes d'allotjament est√†tic" %}

  {% include info_box.html contingut="<strong>RA4 ¬∑ Criteri 4</strong> ‚Äî Optimitza els recursos i genera un paquet llest per a publicaci√≥<br><strong>RA4 ¬∑ Criteri 5</strong> ‚Äî Verifica el funcionament global i documenta el proc√©s de publicaci√≥" %}

  {% capture section_point_3_1 %}
  <p>Abans de comen√ßar, necessiteu:</p>
  <ul>
    <li><strong>Aplicaci√≥ Angular completa:</strong> Projecte funcional amb components, serveis i rutes</li>
    <li><strong>Git configurat:</strong> Control de versions operatiu amb repositori remot</li>
    <li><strong>Node.js i npm:</strong> Versions actualitzades per garantir compatibilitat</li>
    <li><strong>Coneixements b√†sics de terminal:</strong> Executar comandes i interpretar sortida</li>
  </ul>

  <p><strong>Verificaci√≥ r√†pida:</strong></p>

{% capture code_210 %}ng version
git --version
node --version
npm --version{% endcapture %}
  {% include code-block.html lang="bash" code=code_210 %}

  <p><strong>Punt d'autocomprovaci√≥:</strong> L'aplicaci√≥ ha d'arrencar amb <code>ng serve</code> sense errors i mostrar contingut funcional al navegador.</p>
  {% endcapture %}
  {% include section-point.html numero="3.1" titol="Prerequisits" contingut=section_point_3_1 %}

  {% capture section_point_3_2 %}
  <h4>3.2.1. Qu√® √©s la compilaci√≥ per a producci√≥</h4>
  <p>La compilaci√≥ per a producci√≥ √©s el proc√©s de transformar el codi font d'Angular en un paquet optimitzat, minificat i llest per desplegar en servidors reals. Aquest proc√©s aplica autom√†ticament m√∫ltiples optimitzacions que milloren el rendiment, redueixen la mida i preparen l'aplicaci√≥ per a usuaris finals.</p>

  <h4>3.2.2. Problema sense compilaci√≥ de producci√≥</h4>
  <p><strong>Situaci√≥ abans:</strong></p>

  <p>Quan desenvolupeu amb <code>ng serve</code>, Angular compila el codi en mode desenvolupament:</p>

{% capture code_211 %}ng serve
{% endcapture %}
  {% include code-block.html lang="bash" code=code_211 %}

  <p>Genera: ~15 MB de JavaScript<br>
  Temps c√†rrega: 3-5 segons<br>
  Sense optimitzacions<br>
  Amb source maps visibles</p>

  <p><strong>Problemes que genera:</strong></p>

  <p><strong>1. Mida de fitxers excessiva</strong></p>

  <p>En mode desenvolupament, Angular genera codi llegible amb noms de variables originals, comentaris i source maps. Una aplicaci√≥ t√≠pica pot ocupar 15-25 MB, quan en producci√≥ hauria d'ocupar 500 KB - 2 MB.</p>

  <p><strong>2. Rendiment sub√≤ptim</strong></p>

  <p>Sense minificaci√≥ ni tree-shaking, el navegador ha de descarregar, parsejar i executar molt m√©s codi del necessari. Aix√≤ implica:</p>
  <ul>
    <li>Temps de c√†rrega inicial: 3-8 segons</li>
    <li>Time to Interactive (TTI): 5-10 segons</li>
    <li>Puntuaci√≥ Lighthouse: 30-50/100</li>
  </ul>

  <p><strong>3. Seguretat compromesa</strong></p>

  <p>El codi de desenvolupament cont√©:</p>
  <ul>
    <li>Source maps que exposen el codi original complet</li>
    <li>Noms de variables i funcions originals</li>
    <li>Comentaris amb informaci√≥ sensible</li>
    <li>Configuracions de debug actives</li>
  </ul>

  <p><strong>4. Experi√®ncia d'usuari pobre</strong></p>

  <p>Usuaris amb connexions lentes o dispositius antics pateixen:</p>
  <ul>
    <li>Pantalles en blanc de 10-15 segons</li>
    <li>Consum de dades m√≤bils innecessari (15-25 MB vs 1-2 MB)</li>
    <li>Aplicaci√≥ lenta i pesant</li>
  </ul>

  <h4>3.2.3. Soluci√≥ amb compilaci√≥ de producci√≥</h4>
  <p><strong>Situaci√≥ despr√©s:</strong></p>

  <p>Angular ofereix la comanda <code>ng build --configuration production</code> que aplica optimitzacions autom√†tiques:</p>

{% capture code_212 %}ng build --configuration production
ng build --prod{% endcapture %}
  {% include code-block.html lang="bash" code=code_212 %}

  <p>Genera: ~500 KB - 2 MB de JavaScript<br>
  Temps c√†rrega: 0.5-1.5 segons<br>
  Optimitzat i minificat<br>
  Sense source maps p√∫blics</p>

  <p><strong>Beneficis immediats:</strong></p>

  <ul>
    <li><strong>Reducci√≥ dr√†stica de mida:</strong> 85-95% menys (15 MB ‚Üí 1 MB)</li>
    <li><strong>C√†rrega ultrar√†pida:</strong> 80-90% m√©s r√†pid (5s ‚Üí 0.8s)</li>
    <li><strong>Millor SEO i rendiment:</strong> Lighthouse 95-100/100</li>
    <li><strong>Seguretat millorada:</strong> Codi ofuscat sense source maps</li>
    <li><strong>Experi√®ncia d'usuari √≤ptima:</strong> Aplicaci√≥ instant√†nia fins i tot en 3G</li>
  </ul>

  <h4>3.2.4. Context dins del framework</h4>
  <p>Angular CLI proporciona m√∫ltiples optimitzacions autom√†tiques en compilar per a producci√≥:</p>

  <p><strong>Optimitzacions principals:</strong></p>

  <ul>
    <li><strong>Minificaci√≥ (Uglify):</strong> Elimina espais en blanc, comentaris i escur√ßa noms de variables</li>
    <li><strong>Tree-shaking:</strong> Elimina codi no utilitzat de llibreries</li>
    <li><strong>Ahead-of-Time (AOT) Compilation:</strong> Compila plantilles durant el build, no al navegador</li>
    <li><strong>Dead Code Elimination:</strong> Elimina codi inaccessible</li>
    <li><strong>Bundle Optimization:</strong> Agrupa i optimitza fitxers de forma intel¬∑ligent</li>
    <li><strong>Compression:</strong> Genera versions gzip i brotli per a servidors</li>
  </ul>

  <h4>3.2.5. Integraci√≥ amb conceptes anteriors</h4>
  <p><strong>Relaci√≥ amb components (Unitat 2):</strong></p>
  <ul>
    <li>Components pesants incrementen la mida del bundle</li>
    <li>Lazy loading de components ajuda a reduir bundle inicial</li>
  </ul>

  <p><strong>Relaci√≥ amb serveis (Unitat 3):</strong></p>
  <ul>
    <li>Llibreries externes importades als serveis afecten mida total</li>
    <li>Tree-shaking elimina funcions no usades d'aquestes llibreries</li>
  </ul>

  <p><strong>Relaci√≥ amb rutes (Lli√ß√≥ 4.1):</strong></p>
  <ul>
    <li>Lazy loading de m√≤duls crea chunks separats optimitzats</li>
    <li>Cada m√≤dul pesat es compila al seu propi fitxer</li>
  </ul>

  <h4>3.2.6. Casos d'√∫s reals</h4>
  <p><strong>1. E-commerce amb tr√†fic internacional</strong></p>

  <p>Amazon compila per a producci√≥ amb optimitzacions extremes. Bundle inicial: &lt; 200 KB. La resta en chunks carregats sota demanda.</p>

  <p><strong>2. Aplicacions SaaS empresarials</strong></p>

  <p>Salesforce Lightning usa builds de producci√≥ amb lazy loading agressiu. M√≤duls pesats (informes, dashboards) es carreguen nom√©s quan s'usen.</p>

  <p><strong>3. Progressive Web Apps</strong></p>

  <p>Twitter Lite compila per a producci√≥ optimitzant per a xarxes 2G/3G. Bundle inicial: 600 KB complet. Carrega en &lt; 3 segons amb 3G.</p>

  <p><strong>4. Aplicacions m√≤bils h√≠brides</strong></p>

  <p>Ionic apps compilen per a producci√≥ per minimitzar l'espai ocupat. Una app t√≠pica passa de 50 MB (dev) a 15 MB (prod).</p>

  <h4>3.2.7. Comparativa t√®cnica: desenvolupament vs producci√≥</h4>
  <table>
    <thead>
      <tr>
        <th>Aspecte</th>
        <th>Desenvolupament</th>
        <th>Producci√≥</th>
        <th>Difer√®ncia</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Mida bundle</strong></td>
        <td>15-25 MB</td>
        <td>500 KB - 2 MB</td>
        <td>90-95% menys</td>
      </tr>
      <tr>
        <td><strong>Temps build</strong></td>
        <td>5-10s</td>
        <td>30-90s</td>
        <td>Build m√©s lent</td>
      </tr>
      <tr>
        <td><strong>Temps c√†rrega</strong></td>
        <td>3-8s</td>
        <td>0.5-1.5s</td>
        <td>80-90% m√©s r√†pid</td>
      </tr>
      <tr>
        <td><strong>Source maps</strong></td>
        <td>S√≠ (visibles)</td>
        <td>No (o externs)</td>
        <td>Seguretat</td>
      </tr>
      <tr>
        <td><strong>Minificaci√≥</strong></td>
        <td>No</td>
        <td>S√≠</td>
        <td>Codi ofuscat</td>
      </tr>
      <tr>
        <td><strong>AOT</strong></td>
        <td>Opcional</td>
        <td>Sempre</td>
        <td>Plantilles precompilades</td>
      </tr>
      <tr>
        <td><strong>Lighthouse</strong></td>
        <td>30-50</td>
        <td>95-100</td>
        <td>2-3√ó millor</td>
      </tr>
    </tbody>
  </table>

  <h4>3.2.8. Comparativa quantitativa de mides</h4>
  <table>
    <thead>
      <tr>
        <th>Component</th>
        <th>Desenvolupament</th>
        <th>Producci√≥</th>
        <th>Reducci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>main.js</strong></td>
        <td>8.5 MB</td>
        <td>450 KB</td>
        <td>95%</td>
      </tr>
      <tr>
        <td><strong>polyfills.js</strong></td>
        <td>2.3 MB</td>
        <td>180 KB</td>
        <td>92%</td>
      </tr>
      <tr>
        <td><strong>vendor.js</strong></td>
        <td>4.8 MB</td>
        <td>380 KB</td>
        <td>92%</td>
      </tr>
      <tr>
        <td><strong>runtime.js</strong></td>
        <td>12 KB</td>
        <td>6 KB</td>
        <td>50%</td>
      </tr>
      <tr>
        <td><strong>styles.css</strong></td>
        <td>250 KB</td>
        <td>45 KB</td>
        <td>82%</td>
      </tr>
      <tr>
        <td><strong>TOTAL</strong></td>
        <td>~16 MB</td>
        <td>~1 MB</td>
        <td>94%</td>
      </tr>
    </tbody>
  </table>

  <h4>3.2.9. Fluxos de compilaci√≥</h4>
{% capture code_213 %}MODE DESENVOLUPAMENT (ng serve)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Codi TypeScript                      ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ Compilaci√≥ TypeScript ‚Üí JavaScript   ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ NO minificat                         ‚îÇ
‚îÇ NO tree-shaking                      ‚îÇ
‚îÇ Source maps inclu√Øts                 ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ Bundle: 15 MB                        ‚îÇ
‚îÇ C√†rrega: 5 segons                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
MODE PRODUCCI√ì (ng build --prod)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Codi TypeScript                      ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ AOT: Compila plantilles              ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ Tree-shaking: Elimina codi no usat   ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ Minificaci√≥: Uglify / Terser         ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ Dead code elimination                ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ Bundle splitting: Chunks separats    ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ Compressi√≥: Gzip / Brotli            ‚îÇ
‚îÇ ‚Üì                                     ‚îÇ
‚îÇ Bundle: 1 MB                         ‚îÇ
‚îÇ C√†rrega: 0.8 segons                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò{% endcapture %}
  {% include code-block.html lang="text" code=code_213 %}
  {% endcapture %}
  {% include section-point.html numero="3.2" titol="Marc conceptual" contingut=section_point_3_2 %}

  {% capture section_point_3_3 %}
  <h4>3.3.1. Esquema conceptual</h4>
{% capture code_214 %}ABANS: Mode desenvolupament
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Codi Font (src/)                            ‚îÇ
‚îÇ   ‚îú‚îÄ app.component.ts        (llegible)     ‚îÇ
‚îÇ   ‚îú‚îÄ product.service.ts      (llegible)     ‚îÇ
‚îÇ   ‚îú‚îÄ styles.css              (llegible)     ‚îÇ
‚îÇ   ‚îî‚îÄ ...                                    ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ          ng serve                           ‚îÇ
‚îÇ             ‚Üì                               ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ Bundle desenvolupament (dist/)              ‚îÇ
‚îÇ   ‚îú‚îÄ main.js           8.5 MB               ‚îÇ
‚îÇ   ‚îú‚îÄ vendor.js         4.8 MB               ‚îÇ
‚îÇ   ‚îú‚îÄ polyfills.js      2.3 MB               ‚îÇ
‚îÇ   ‚îî‚îÄ styles.css        250 KB               ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ TOTAL: ~16 MB                               ‚îÇ
‚îÇ Temps c√†rrega: 5 segons                     ‚îÇ
‚îÇ Lighthouse: 35/100                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
DESPR√âS: Mode producci√≥
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Codi Font (src/)                            ‚îÇ
‚îÇ   ‚îú‚îÄ app.component.ts                       ‚îÇ
‚îÇ   ‚îú‚îÄ product.service.ts                     ‚îÇ
‚îÇ   ‚îú‚îÄ styles.css                             ‚îÇ
‚îÇ   ‚îî‚îÄ ...                                    ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ     ng build --configuration production     ‚îÇ
‚îÇ             ‚Üì                               ‚îÇ
‚îÇ  [AOT + Tree-shake + Minify + Optimize]    ‚îÇ
‚îÇ             ‚Üì                               ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ Bundle producci√≥ (dist/)                    ‚îÇ
‚îÇ   ‚îú‚îÄ main.a8f3d2b.js      450 KB (ofuscat) ‚îÇ
‚îÇ   ‚îú‚îÄ vendor.7e9c1f4.js    380 KB (ofuscat) ‚îÇ
‚îÇ   ‚îú‚îÄ polyfills.2d8a9e.js  180 KB (ofuscat) ‚îÇ
‚îÇ   ‚îî‚îÄ styles.f4e8b3a.css    45 KB           ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ TOTAL: ~1 MB (94% reducci√≥)                 ‚îÇ
‚îÇ Temps c√†rrega: 0.8 segons                   ‚îÇ
‚îÇ Lighthouse: 98/100                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò{% endcapture %}
  {% include code-block.html lang="text" code=code_214 %}

  <h4>3.3.2. Flux de desplegament complet</h4>
{% capture code_215 %}DESENVOLUPADOR
    ‚îÇ
    ‚îÇ Crea codi
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  git commit          ‚îÇ
‚îÇ  git push            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îÇ
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ng build --configuration production ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  Optimitzacions autom√†tiques:        ‚îÇ
‚îÇ  <i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> AOT Compilation                   ‚îÇ
‚îÇ  <i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Tree-shaking                      ‚îÇ
‚îÇ  <i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Minificaci√≥                       ‚îÇ
‚îÇ  <i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Dead code elimination             ‚îÇ
‚îÇ  <i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Hashing de fitxers                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îÇ Genera dist/
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Fitxers optimitzats ‚îÇ
‚îÇ  a dist/browser/     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îÇ Pujar a servidor
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Netlify / Vercel / Firebase     ‚îÇ
‚îÇ  GitHub Pages / AWS S3           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îÇ Desplegar
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  APLICACI√ì P√öBLICA   ‚îÇ
‚îÇ  https://myapp.com   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îÇ Usuaris accedeixen
    ‚Üì
USUARIS FINALS
- C√†rrega r√†pida (< 2s)
- Experi√®ncia fluida
- Funciona en m√≤bils{% endcapture %}
  {% include code-block.html lang="text" code=code_215 %}

  <h4>3.3.3. Analogia pr√†ctica</h4>
  <p>Penseu en la compilaci√≥ per a producci√≥ com <strong>preparar una casa per vendre</strong>:</p>

  <ul>
    <li><strong>Desenvolupament:</strong> Casa amb materials de construcci√≥, cables visibles, notes dels treballadors</li>
    <li><strong>Producci√≥:</strong> Casa neta, acabada, sense restes, llesta per habitar</li>
  </ul>

  <p><strong>Transformacions espec√≠fiques:</strong></p>

  <table>
    <thead>
      <tr>
        <th>Desenvolupament</th>
        <th>Producci√≥</th>
        <th>Analogia</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Cables visibles</td>
        <td>Cables ocults</td>
        <td>Source maps eliminats</td>
      </tr>
      <tr>
        <td>Mobles embolicats</td>
        <td>Mobles desplegats</td>
        <td>Codi minificat</td>
      </tr>
      <tr>
        <td>Habitacions buides</td>
        <td>Habitacions necess√†ries</td>
        <td>Tree-shaking</td>
      </tr>
      <tr>
        <td>Etiquetes dels mobles</td>
        <td>Sense etiquetes</td>
        <td>Noms ofuscats</td>
      </tr>
      <tr>
        <td>200 m¬≤ desordenats</td>
        <td>120 m¬≤ optimitzats</td>
        <td>Bundle redu√Øt</td>
      </tr>
    </tbody>
  </table>
  {% endcapture %}
  {% include section-point.html numero="3.3" titol="Model mental" contingut=section_point_3_3 %}

  {% capture section_point_3_4 %}
  <h4>3.4.1. Objectiu</h4>
  <p>Comprendre les difer√®ncies fonamentals entre els modes de desenvolupament i producci√≥ d'Angular, identificar quan usar cada mode i recon√®ixer els errors comuns que es produeixen per no compilar correctament abans de desplegar.</p>

  <h4>3.4.2. Comparativa detallada dels modes</h4>
  <p>Angular proporciona dos modes principals de compilaci√≥ amb caracter√≠stiques molt diferents:</p>

  <table>
    <thead>
      <tr>
        <th>Caracter√≠stica</th>
        <th>Desenvolupament (ng serve)</th>
        <th>Producci√≥ (ng build --prod)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Compilaci√≥ plantilles</strong></td>
        <td>JIT (navegador)</td>
        <td>AOT (build time)</td>
      </tr>
      <tr>
        <td><strong>Source maps</strong></td>
        <td>S√≠ (inline)</td>
        <td>No (o externs)</td>
      </tr>
      <tr>
        <td><strong>Minificaci√≥</strong></td>
        <td>No</td>
        <td>S√≠ (Terser)</td>
      </tr>
      <tr>
        <td><strong>Tree-shaking</strong></td>
        <td>No</td>
        <td>S√≠</td>
      </tr>
      <tr>
        <td><strong>Dead code removal</strong></td>
        <td>No</td>
        <td>S√≠</td>
      </tr>
      <tr>
        <td><strong>CSS optimization</strong></td>
        <td>No</td>
        <td>S√≠</td>
      </tr>
      <tr>
        <td><strong>Hashing fitxers</strong></td>
        <td>No</td>
        <td>S√≠ (cache busting)</td>
      </tr>
      <tr>
        <td><strong>Compression</strong></td>
        <td>No</td>
        <td>S√≠ (gzip/brotli)</td>
      </tr>
      <tr>
        <td><strong>Bundle splitting</strong></td>
        <td>B√†sic</td>
        <td>Avan√ßat</td>
      </tr>
      <tr>
        <td><strong>Lazy loading</strong></td>
        <td>Funcional</td>
        <td>Optimitzat</td>
      </tr>
    </tbody>
  </table>

  <h4>3.4.3. Impacte pr√†ctic de cada difer√®ncia</h4>
  <p><strong>1. JIT vs AOT Compilation</strong></p>

{% capture code_216 %}@Component({
  template: `<div>{{ name }}</div>`
}){% endcapture %}
  {% include code-block.html lang="typescript" code=code_216 %}

  <p><strong>Cost JIT (desenvolupament):</strong></p>
  <ul>
    <li>Inclou el compilador d'Angular al bundle (+500 KB)</li>
    <li>Compila plantilles despr√©s de descarregar-les (temps extra)</li>
    <li>Errors de plantilla es detecten en runtime</li>
  </ul>

  <p><strong>Benefici AOT (producci√≥):</strong></p>
  <ul>
    <li>NO inclou el compilador (-500 KB)</li>
    <li>Plantilles s√≥n JavaScript pur (execuci√≥ immediata)</li>
    <li>Errors de plantilla detectats en build time</li>
  </ul>

  <p><strong>2. Source Maps</strong></p>

{% capture code_217 %}Error: Cannot read property 'name' of undefined
  at ProductComponent.ngOnInit (product.component.ts:25){% endcapture %}
  {% include code-block.html lang="text" code=code_217 %}

{% capture code_218 %}Error: Cannot read property 'name' of undefined
  at e.n (main.f8a2d3.js:1:28492){% endcapture %}
  {% include code-block.html lang="text" code=code_218 %}

  <p><strong>3. Minificaci√≥</strong></p>

{% capture code_219 %}function getProductById(productId) {
  const products = this.productService.getProducts();
  const foundProduct = products.find(product => product.id === productId);
  if (foundProduct) {
    return foundProduct;
  } else {
    throw new Error('Product not found');
  }
}{% endcapture %}
  {% include code-block.html lang="javascript" code=code_219 %}

{% capture code_220 %}function t(e){const t=this.n.o();const r=t.find(t=>t.id===e);if(r)return r;throw new Error("Product not found")}{% endcapture %}
  {% include code-block.html lang="javascript" code=code_220 %}

  <p><strong>Reducci√≥:</strong> 250 l√≠nies ‚Üí 2 l√≠nies = 99% menys espai</p>

  <h4>3.4.4. Quan usar cada mode</h4>
  <table>
    <thead>
      <tr>
        <th>Situaci√≥</th>
        <th>Mode recomanat</th>
        <th>Ra√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Desenvolupant funcionalitats</td>
        <td>Desenvolupament</td>
        <td>Errors clars, source maps</td>
      </tr>
      <tr>
        <td>Provant abans de desplegar</td>
        <td>Producci√≥</td>
        <td>Detectar problemes d'optimitzaci√≥</td>
      </tr>
      <tr>
        <td>Verificant rendiment</td>
        <td>Producci√≥</td>
        <td>M√®triques reals</td>
      </tr>
      <tr>
        <td>Desplegant a staging</td>
        <td>Producci√≥</td>
        <td>Simulaci√≥ d'entorn real</td>
      </tr>
      <tr>
        <td>Desplegant a producci√≥</td>
        <td><strong>Producci√≥</strong></td>
        <td>SEMPRE optimitzat</td>
      </tr>
    </tbody>
  </table>

  <h4>3.4.5. Errors comuns per no compilar correctament</h4>
  <p><strong>1. Desplegar build de desenvolupament</strong></p>

{% capture code_221 %}ng build{% endcapture %}
  {% include code-block.html lang="bash" code=code_221 %}

  <p><strong>Conseq√º√®ncia:</strong></p>
  <ul>
    <li>Aplicaci√≥ lent√≠ssima per a usuaris</li>
    <li>Puntuaci√≥ SEO p√®ssima</li>
    <li>Experi√®ncia d'usuari horrible</li>
  </ul>

  <p><strong>2. No provar el build de producci√≥ localment</strong></p>

{% capture code_222 %}ng serve
ng build --prod{% endcapture %}
  {% include code-block.html lang="bash" code=code_222 %}

  <p><strong>Conseq√º√®ncia:</strong></p>
  <ul>
    <li>Errors d'optimitzaci√≥ apareixen en producci√≥</li>
    <li>Lazy loading pot fallar</li>
    <li>Imports circulars causen problemes</li>
  </ul>

  <p><strong>3. Ignorar warnings del build</strong></p>

{% capture code_223 %}ng build --prod
WARNING: Exceeded maximum budget for initial bundle
WARNING: CommonJS dependency detected{% endcapture %}
  {% include code-block.html lang="bash" code=code_223 %}

  <p><strong>Conseq√º√®ncia:</strong></p>
  <ul>
    <li>Bundle massa gran (&gt; 2 MB)</li>
    <li>Rendiment sub√≤ptim</li>
    <li>Problemes de tree-shaking</li>
  </ul>

  <h4>3.4.6. Verificaci√≥ de mode correcte</h4>
{% capture code_224 %}ng build --configuration production
<i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Browser application bundle generation complete.
<i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Copying assets complete.
<i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Index html generation complete.
Initial Chunk Files   | Names         |  Raw Size | Estimated Transfer Size
main.f8a2d3c.js       | main          | 450.23 KB |               125.42 KB
polyfills.2e8d9af.js  | polyfills     | 180.45 KB |                65.21 KB
styles.a4c7e2f.css    | styles        |  45.12 KB |                 8.93 KB
                      | Initial Total |   1.02 MB |               199.56 KB{% endcapture %}
  {% include code-block.html lang="bash" code=code_224 %}

  <p><strong>Clau:</strong> Fitxers amb hash = BUILD DE PRODUCCI√ì</p>
  {% endcapture %}
  {% include section-point.html numero="3.4" titol="Difer√®ncies entre desenvolupament i producci√≥" contingut=section_point_3_4 %}

  {% capture section_point_3_5 %}
  <h4>3.5.1. Objectiu</h4>
  <p>Aprendre a utilitzar la comanda de compilaci√≥ per a producci√≥ amb les seves opcions i flags, configurar builds personalitzats per a diferents entorns (producci√≥, staging) i crear scripts npm per automatitzar el proc√©s de build.</p>

  <h4>3.5.2. Comanda b√†sica de producci√≥</h4>
  <p>La forma est√†ndard de compilar per a producci√≥:</p>

{% capture code_225 %}ng build --configuration production
ng build --prod{% endcapture %}
  {% include code-block.html lang="bash" code=code_225 %}

  <p><strong>Sortida esperada:</strong></p>

{% capture code_226 %}$ ng build --configuration production
<i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Browser application bundle generation complete.
<i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Copying assets complete.
<i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Index html generation complete.
Initial Chunk Files   | Names         |  Raw Size | Estimated Transfer Size
main.a8f3d2b4c.js     | main          | 456.23 KB |               128.42 KB
polyfills.7e9c1f4.js  | polyfills     | 182.45 KB |                66.21 KB
runtime.2d8a9e5c.js   | runtime       |   6.15 KB |                 2.93 KB
styles.f4e8b3a7.css   | styles        |  48.12 KB |                10.24 KB
                      | Initial Total |   1.08 MB |               207.80 KB
Build at: 2024-03-15T10:30:45.123Z - Hash: 8f9a3d2e4c1b7f6a
Time: 45203ms{% endcapture %}
  {% include code-block.html lang="bash" code=code_226 %}

  <h4>3.5.3. Flags i opcions importants</h4>
  <p><strong>1. --base-href: Configurar ruta base</strong></p>

{% capture code_227 %}ng build --prod --base-href /myapp/{% endcapture %}
  {% include code-block.html lang="bash" code=code_227 %}

  <p><strong>Exemple pr√†ctic:</strong></p>
  <ul>
    <li>URL: <code>https://example.com/myapp/</code></li>
    <li>Sense flag: Enlla√ßos trenquen</li>
    <li>Amb flag: Tot funciona</li>
  </ul>

  <p><strong>2. --output-path: Canviar directori de sortida</strong></p>

{% capture code_228 %}ng build --prod --output-path=build{% endcapture %}
  {% include code-block.html lang="bash" code=code_228 %}

  <p><strong>3. --source-map: Generar source maps</strong></p>

{% capture code_229 %}ng build --prod --source-map=true
ng build --prod --source-map=false{% endcapture %}
  {% include code-block.html lang="bash" code=code_229 %}

  <p><strong>Consideracions:</strong></p>
  <ul>
    <li><strong>Amb source maps:</strong> M√©s f√†cil debugar, per√≤ exposa codi</li>
    <li><strong>Sense source maps:</strong> Seguretat, per√≤ debug dif√≠cil</li>
  </ul>

  <p><strong>4. --optimization: Controlar optimitzacions</strong></p>

{% capture code_230 %}ng build --prod --optimization=false
ng build --prod --optimization={
  "scripts": true,
  "styles": {
    "minify": true,
    "inlineCritical": true
  },
  "fonts": true
}{% endcapture %}
  {% include code-block.html lang="bash" code=code_230 %}

  <p><strong>5. --build-optimizer: Tree-shaking avan√ßat</strong></p>

{% capture code_231 %}ng build --prod --build-optimizer=true
ng build --prod --build-optimizer=false{% endcapture %}
  {% include code-block.html lang="bash" code=code_231 %}

  <h4>3.5.4. Taula completa de flags</h4>
  <table>
    <thead>
      <tr>
        <th>Flag</th>
        <th>Valor per defecte</th>
        <th>Descripci√≥</th>
        <th>Recomanaci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>--configuration</code></td>
        <td>development</td>
        <td>Configuraci√≥ (dev/prod)</td>
        <td>Sempre <code>production</code></td>
      </tr>
      <tr>
        <td><code>--base-href</code></td>
        <td>/</td>
        <td>Ruta base HTML</td>
        <td>Ajustar si subfolder</td>
      </tr>
      <tr>
        <td><code>--output-path</code></td>
        <td>dist/project/</td>
        <td>Directori sortida</td>
        <td>Deixar per defecte</td>
      </tr>
      <tr>
        <td><code>--source-map</code></td>
        <td>false (prod)</td>
        <td>Generar source maps</td>
        <td><code>false</code> per seguretat</td>
      </tr>
      <tr>
        <td><code>--optimization</code></td>
        <td>true (prod)</td>
        <td>Optimitzar bundle</td>
        <td>Sempre <code>true</code></td>
      </tr>
      <tr>
        <td><code>--build-optimizer</code></td>
        <td>true (prod)</td>
        <td>Tree-shaking avan√ßat</td>
        <td>Sempre <code>true</code></td>
      </tr>
      <tr>
        <td><code>--vendor-chunk</code></td>
        <td>true</td>
        <td>Separar llibreries</td>
        <td>Sempre <code>true</code></td>
      </tr>
      <tr>
        <td><code>--aot</code></td>
        <td>true (prod)</td>
        <td>AOT compilation</td>
        <td>Sempre <code>true</code></td>
      </tr>
      <tr>
        <td><code>--extract-licenses</code></td>
        <td>true (prod)</td>
        <td>Extreure llic√®ncies</td>
        <td>Sempre <code>true</code></td>
      </tr>
    </tbody>
  </table>

  <h4>3.5.5. Configuracions personalitzades</h4>
  <p>Podeu definir configuracions personalitzades a <code>angular.json</code>:</p>

{% capture code_232 %}{
  "projects": {
    "my-app": {
      "architect": {
        "build": {
          "configurations": {
            "production": {
              "optimization": true,
              "outputHashing": "all",
              "sourceMap": false,
              "namedChunks": false,
              "aot": true,
              "extractLicenses": true,
              "vendorChunk": true,
              "buildOptimizer": true,
              "budgets": [
                {
                  "type": "initial",
                  "maximumWarning": "2mb",
                  "maximumError": "5mb"
                }
              ]
            },
            "staging": {
              "optimization": true,
              "sourceMap": true,
              "namedChunks": true
            }
          }
        }
      }
    }
  }
}{% endcapture %}
  {% include code-block.html lang="json" code=code_232 %}

  <p><strong>√ös:</strong></p>

{% capture code_233 %}ng build --configuration production
ng build --configuration staging{% endcapture %}
  {% include code-block.html lang="bash" code=code_233 %}

  <h4>3.5.6. Errors comuns i solucions</h4>
  <table>
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>Exceeded maximum budget</code></td>
        <td>Bundle massa gran</td>
        <td>Revisar imports pesats</td>
      </tr>
      <tr>
        <td><code>Module not found</code></td>
        <td>Lazy loading trencat</td>
        <td>Verificar rutes</td>
      </tr>
      <tr>
        <td><code>Cannot find module</code></td>
        <td>Paths incorrectes</td>
        <td>Revisar tsconfig paths</td>
      </tr>
      <tr>
        <td><code>Minification failed</code></td>
        <td>Sintaxi ES6+ no suportada</td>
        <td>Actualitzar target</td>
      </tr>
    </tbody>
  </table>

  <h4>3.5.7. Scripts npm recomanats</h4>
  <p>Afegiu al <code>package.json</code>:</p>

{% capture code_234 %}{
  "scripts": {
    "start": "ng serve",
    "build": "ng build --configuration production",
    "build:staging": "ng build --configuration staging",
    "build:dev": "ng build",
    "serve:prod": "ng build --prod && http-server dist/my-app/browser -p 8080"
  }
}{% endcapture %}
  {% include code-block.html lang="json" code=code_234 %}

  <p><strong>√ös:</strong></p>

{% capture code_235 %}npm run build
npm run build:staging
npm run serve:prod{% endcapture %}
  {% include code-block.html lang="bash" code=code_235 %}
  {% endcapture %}
  {% include section-point.html numero="3.5" titol="Comanda de compilaci√≥ per a producci√≥: opcions i flags" contingut=section_point_3_5 %}

  {% capture section_point_3_6 %}
  <h4>3.6.1. Objectiu</h4>
  <p>Entendre les optimitzacions autom√†tiques que Angular aplica durant la compilaci√≥ per a producci√≥ (minificaci√≥, tree-shaking, AOT, uglify) i com aquestes transformacions redueixen dr√†sticament la mida del bundle i milloren el rendiment.</p>

  <h4>3.6.2. Optimitzacions que Angular aplica autom√†ticament</h4>
  <p>Quan executeu <code>ng build --prod</code>, Angular aplica m√∫ltiples optimitzacions sense que hagueu de configurar res:</p>

  <p><strong>1. Minificaci√≥ amb Terser</strong></p>

  <p>Elimina espais en blanc, comentaris, escur√ßa noms de variables i funcions:</p>

{% capture code_236 %}export class ProductService {
  private products: Product[] = [];
  constructor(private http: HttpClient) {}
  getProducts(): Observable<Product[]> {
    return this.http.get<Product[]>('/api/products');
  }
  getProductById(id: number): Observable<Product> {
    return this.http.get<Product>(`/api/products/${id}`);
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_236 %}

{% capture code_237 %}class t{constructor(t){this.t=t}e(){return this.t.get("/api/products")}n(t){return this.t.get(`/api/products/${t}`)}}{% endcapture %}
  {% include code-block.html lang="javascript" code=code_237 %}

  <p><strong>Reducci√≥:</strong> 15 l√≠nies ‚Üí 1 l√≠nia = 95% menys</p>

  <p><strong>2. Tree-shaking</strong></p>

  <p>Elimina codi que no s'usa mai:</p>

{% capture code_238 %}import * as _ from 'lodash';
const result = _.map([1, 2, 3], n => n * 2);{% endcapture %}
  {% include code-block.html lang="typescript" code=code_238 %}

  <p>Despr√©s de tree-shaking (producci√≥): Nom√©s inclou la funci√≥ map (2 KB). Les altres 699 funcions s'eliminen.</p>

  <p><strong>Reducci√≥:</strong> 700 KB ‚Üí 2 KB = 99.7% menys</p>

  <p><strong>3. Dead Code Elimination</strong></p>

  <p>Elimina codi inaccessible:</p>

{% capture code_239 %}if (false) {
  console.log('Aquest codi mai s\'executa');
}
const DEBUG = false;
if (DEBUG) {
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_239 %}

  <p>Despr√©s de compilar per a producci√≥, aquestes branques desapareixen completament del bundle.</p>

  <p><strong>4. AOT (Ahead-of-Time) Compilation</strong></p>

  <p>Compila plantilles durant el build en lloc de runtime:</p>

{% capture code_240 %}@Component({
  template: `
    <div *ngFor="let item of items">
      {{ item.name }}
    </div>
  `
}){% endcapture %}
  {% include code-block.html lang="typescript" code=code_240 %}

  <p><strong>Beneficis AOT:</strong></p>
  <ul>
    <li>No cal incloure el compilador (-500 KB)</li>
    <li>Detecci√≥ d'errors en build time</li>
    <li>Renderitzat 3-5√ó m√©s r√†pid</li>
  </ul>

  <p><strong>5. Uglification / Obfuscation</strong></p>

  <p>Fa el codi dif√≠cil de llegir per humans:</p>

{% capture code_241 %}function calculateTotalPrice(items, taxRate) {
  const subtotal = items.reduce((sum, item) => sum + item.price, 0);
  const tax = subtotal * taxRate;
  const total = subtotal + tax;
  return total;
}{% endcapture %}
  {% include code-block.html lang="javascript" code=code_241 %}

{% capture code_242 %}function t(e,t){const n=e.reduce((e,t)=>e+t.price,0);return n+n*t}{% endcapture %}
  {% include code-block.html lang="javascript" code=code_242 %}

  <p><strong>Benefici:</strong> Protecci√≥ b√†sica de propietat intel¬∑lectual</p>

  <h4>3.6.3. Taula comparativa d'optimitzacions</h4>
  <table>
    <thead>
      <tr>
        <th>Optimitzaci√≥</th>
        <th>Qu√® fa</th>
        <th>Reducci√≥ t√≠pica</th>
        <th>Benefici principal</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Minificaci√≥</strong></td>
        <td>Elimina espais, comentaris, escur√ßa noms</td>
        <td>40-50%</td>
        <td>Menys bytes descarregats</td>
      </tr>
      <tr>
        <td><strong>Tree-shaking</strong></td>
        <td>Elimina codi no usat</td>
        <td>60-90%</td>
        <td>Llibreries m√©s petites</td>
      </tr>
      <tr>
        <td><strong>Dead code</strong></td>
        <td>Elimina branques inaccessibles</td>
        <td>5-15%</td>
        <td>Codi m√©s net</td>
      </tr>
      <tr>
        <td><strong>AOT</strong></td>
        <td>Precompila plantilles</td>
        <td>30-40%</td>
        <td>No cal compilador</td>
      </tr>
      <tr>
        <td><strong>Uglify</strong></td>
        <td>Ofusca codi</td>
        <td>10-20%</td>
        <td>Seguretat + compressi√≥</td>
      </tr>
      <tr>
        <td><strong>CSS optimize</strong></td>
        <td>Minifica i elimina CSS no usat</td>
        <td>50-70%</td>
        <td>Styles m√≠nims</td>
      </tr>
    </tbody>
  </table>

  <h4>3.6.4. Exemples pr√†ctics</h4>
  <p><strong>Exemple 1: Llibreria amb tree-shaking</strong></p>

{% capture code_243 %}import { format } from 'date-fns';
const formattedDate = format(new Date(), 'dd/MM/yyyy');{% endcapture %}
  {% include code-block.html lang="typescript" code=code_243 %}

  <p><strong>Sense tree-shaking (desenvolupament):</strong> Inclou tota la llibreria date-fns: 280 KB. Nom√©s usa 1 funci√≥.</p>

  <p><strong>Amb tree-shaking (producci√≥):</strong> Inclou nom√©s la funci√≥ <code>format</code>: 8 KB. Reducci√≥: 97%</p>

  <p><strong>Exemple 2: Angular Material amb tree-shaking</strong></p>

{% capture code_244 %}import { MatButtonModule, MatCardModule, MatInputModule, MatTableModule } from '@angular/material';
import { MatButtonModule } from '@angular/material/button';
import { MatCardModule } from '@angular/material/card';{% endcapture %}
  {% include code-block.html lang="typescript" code=code_244 %}

  <p><strong>Reducci√≥ amb imports espec√≠fics:</strong> 1.2 MB ‚Üí 45 KB = 96% menys</p>

  <h4>3.6.5. Verificar optimitzacions aplicades</h4>
  <p>Podeu comprovar que les optimitzacions s'han aplicat:</p>

{% capture code_245 %}ng build --prod
ls -lh dist/my-app/browser/{% endcapture %}
  {% include code-block.html lang="bash" code=code_245 %}

  <p><strong>Sortida esperada:</strong></p>

{% capture code_246 %}-rw-r--r--  1 user  staff   128K  main.a8f3d2b.js
-rw-r--r--  1 user  staff    66K  polyfills.7e9c1f.js
-rw-r--r--  1 user  staff    10K  styles.f4e8b3a.css
-rw-r--r--  1 user  staff     3K  runtime.2d8a9e.js{% endcapture %}
  {% include code-block.html lang="text" code=code_246 %}

  <p><strong>Sense optimitzacions (desenvolupament):</strong></p>

{% capture code_247 %}-rw-r--r--  1 user  staff   8.5M  main.js
-rw-r--r--  1 user  staff   4.8M  vendor.js
-rw-r--r--  1 user  staff   250K  styles.css
-rw-r--r--  1 user  staff    12K  runtime.js{% endcapture %}
  {% include code-block.html lang="text" code=code_247 %}
  {% endcapture %}
  {% include section-point.html numero="3.6" titol="Optimitzacions autom√†tiques: minificaci√≥, tree-shaking, uglify" contingut=section_point_3_6 %}

  {% capture section_point_3_7 %}
  <h4>3.7.1. Objectiu</h4>
  <p>Aprendre a analitzar la mida del bundle per identificar components o llibreries pesades, utilitzar eines com Webpack Bundle Analyzer i Source Map Explorer, i interpretar els resultats per optimitzar la mida del paquet final.</p>

  <h4>3.7.2. Per qu√® √©s important analitzar el bundle</h4>
  <p>Saber QU√à ocupa espai al bundle us permet:</p>

  <ul>
    <li><strong>Identificar llibreries pesades</strong> que es poden reempla√ßar</li>
    <li><strong>Detectar imports innecessaris</strong> que incrementen mida</li>
    <li><strong>Optimitzar lazy loading</strong> per reduir bundle inicial</li>
    <li><strong>Complir budgets</strong> de mida establerts</li>
  </ul>

  <h4>3.7.3. Webpack Bundle Analyzer</h4>
  <p>L'eina m√©s popular per analitzar bundles d'Angular:</p>

  <p><strong>Instal¬∑laci√≥:</strong></p>

{% capture code_248 %}npm install --save-dev webpack-bundle-analyzer{% endcapture %}
  {% include code-block.html lang="bash" code=code_248 %}

  <p><strong>Configuraci√≥ al package.json:</strong></p>

{% capture code_249 %}{
  "scripts": {
    "build:stats": "ng build --stats-json",
    "analyze": "webpack-bundle-analyzer dist/my-app/browser/stats.json"
  }
}{% endcapture %}
  {% include code-block.html lang="json" code=code_249 %}

  <p><strong>√ös:</strong></p>

{% capture code_250 %}npm run build:stats
npm run analyze{% endcapture %}
  {% include code-block.html lang="bash" code=code_250 %}

  <p><strong>Sortida visual:</strong> El Bundle Analyzer mostra un mapa de calor (treemap) on:</p>
  <ul>
    <li><strong>Caixes grans</strong> = Components/llibreries que ocupen molt</li>
    <li><strong>Colors c√†lids</strong> = M√©s espai ocupat</li>
    <li><strong>Clicable</strong> = Navegar per l'arbre de depend√®ncies</li>
  </ul>

  <h4>3.7.4. Interpretar els resultats</h4>
  <p><strong>Exemple de sortida:</strong></p>

{% capture code_251 %}BUNDLE SIZE BREAKDOWN
‚îú‚îÄ main.js (450 KB)
‚îÇ  ‚îú‚îÄ @angular/core (180 KB)
‚îÇ  ‚îú‚îÄ @angular/common (95 KB)
‚îÇ  ‚îú‚îÄ lodash (120 KB)
‚îÇ  ‚îî‚îÄ app components (55 KB)
‚îÇ
‚îú‚îÄ vendor.js (380 KB)
‚îÇ  ‚îú‚îÄ rxjs (180 KB)
‚îÇ  ‚îú‚îÄ zone.js (95 KB)
‚îÇ  ‚îî‚îÄ tslib (105 KB)
‚îÇ
‚îî‚îÄ polyfills.js (180 KB)
   ‚îî‚îÄ core-js (180 KB){% endcapture %}
  {% include code-block.html lang="text" code=code_251 %}

  <p><strong>An√†lisi:</strong></p>
  <ul>
    <li><strong>Lodash ocupa 120 KB:</strong> Es pot reempla√ßar amb lodash-es (tree-shakeable)</li>
    <li><strong>RxJS ocupa 180 KB:</strong> Verificar si s'usen nom√©s operadors necessaris</li>
    <li><strong>Angular core √©s inevitable:</strong> 180 KB √©s normal</li>
  </ul>

  <h4>3.7.5. Identificar problemes comuns</h4>
  <p><strong>1. Imports complets de llibreries</strong></p>

{% capture code_252 %}import * as moment from 'moment';
import { format } from 'date-fns';{% endcapture %}
  {% include code-block.html lang="typescript" code=code_252 %}

  <p><strong>Impacte:</strong> -685 KB (98% reducci√≥)</p>

  <p><strong>2. M√∫ltiples versions de la mateixa llibreria</strong></p>

{% capture code_253 %}BUNDLE:
‚îú‚îÄ rxjs@7.5.0 (180 KB)
‚îî‚îÄ rxjs@6.6.0 (180 KB)
TOTAL: 360 KB (hauria de ser 180 KB){% endcapture %}
  {% include code-block.html lang="text" code=code_253 %}

  <p><strong>Soluci√≥:</strong></p>

{% capture code_254 %}npm dedupe{% endcapture %}
  {% include code-block.html lang="bash" code=code_254 %}

  <p><strong>3. Llibreries CSS pesades</strong></p>

{% capture code_255 %}import 'bootstrap/dist/css/bootstrap.min.css';
@import 'bootstrap/scss/utilities';{% endcapture %}
  {% include code-block.html lang="typescript" code=code_255 %}

  <p><strong>Impacte:</strong> -170 KB (85% reducci√≥)</p>

  <p><strong>4. Imatges no optimitzades</strong></p>

{% capture code_256 %}assets/
‚îú‚îÄ banner.png (2.5 MB)
‚îú‚îÄ logo.png (800 KB)
‚îî‚îÄ icon.png (150 KB){% endcapture %}
  {% include code-block.html lang="text" code=code_256 %}

  <p><strong>Soluci√≥:</strong></p>

{% capture code_257 %}convert banner.png -quality 80 -resize 1920x banner-opt.jpg{% endcapture %}
  {% include code-block.html lang="bash" code=code_257 %}

  <h4>3.7.6. Eines d'an√†lisi alternatives</h4>
  <p><strong>1. Source Map Explorer</strong></p>

{% capture code_258 %}npm install --save-dev source-map-explorer
{
  "scripts": {
    "analyze:source": "source-map-explorer dist/**/*.js"
  }
}
npm run analyze:source{% endcapture %}
  {% include code-block.html lang="bash" code=code_258 %}

  <p><strong>2. Angular CLI Bundle Budgets</strong></p>

  <p>Configurar l√≠mits autom√†tics a <code>angular.json</code>:</p>

{% capture code_259 %}{
  "budgets": [
    {
      "type": "initial",
      "maximumWarning": "1mb",
      "maximumError": "2mb"
    },
    {
      "type": "anyComponentStyle",
      "maximumWarning": "6kb",
      "maximumError": "10kb"
    }
  ]
}{% endcapture %}
  {% include code-block.html lang="json" code=code_259 %}

  <p>Si el bundle supera els l√≠mits:</p>

{% capture code_260 %}ng build --prod
Warning: bundle initial exceeds maximum budget.
Budget: 1.00 MB was not met by 127.45 KB with a total of 1.12 MB.{% endcapture %}
  {% include code-block.html lang="bash" code=code_260 %}

  <h4>3.7.7. Taula d'an√†lisi t√≠pica</h4>
  <table>
    <thead>
      <tr>
        <th>Component</th>
        <th>Mida t√≠pica</th>
        <th>Considerar problema si &gt;</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>@angular/core</strong></td>
        <td>150-200 KB</td>
        <td>-</td>
        <td>Inevitable</td>
      </tr>
      <tr>
        <td><strong>RxJS</strong></td>
        <td>150-180 KB</td>
        <td>250 KB</td>
        <td>Imports espec√≠fics</td>
      </tr>
      <tr>
        <td><strong>Lodash</strong></td>
        <td>0-15 KB</td>
        <td>50 KB</td>
        <td>Usar lodash-es</td>
      </tr>
      <tr>
        <td><strong>Moment.js</strong></td>
        <td>0 KB</td>
        <td>200 KB</td>
        <td>Reempla√ßar amb date-fns</td>
      </tr>
      <tr>
        <td><strong>Bootstrap CSS</strong></td>
        <td>0-30 KB</td>
        <td>150 KB</td>
        <td>Imports parcials</td>
      </tr>
      <tr>
        <td><strong>App components</strong></td>
        <td>50-150 KB</td>
        <td>300 KB</td>
        <td>Lazy loading</td>
      </tr>
      <tr>
        <td><strong>TOTAL bundle</strong></td>
        <td>500 KB - 1.5 MB</td>
        <td>3 MB</td>
        <td>Revisar tot</td>
      </tr>
    </tbody>
  </table>
  {% endcapture %}
  {% include section-point.html numero="3.7" titol="An√†lisi de la mida del bundle: identificar components pesats" contingut=section_point_3_7 %}

  {% capture section_point_3_8 %}
  <h4>3.8.1. Objectiu</h4>
  <p>Dominar estrat√®gies avan√ßades per reduir la mida del bundle: utilitzar imports espec√≠fics en lloc de m√≤duls complets, reempla√ßar llibreries pesades amb alternatives lleugeres, optimitzar imatges i assets, i aplicar lazy loading agressiu per minimitzar el bundle inicial.</p>

  <h4>3.8.2. Estrat√®gia 1: Imports espec√≠fics (path imports)</h4>
  <p>En lloc d'importar m√≤duls complets, importeu nom√©s el necessari:</p>

  <p><strong>Exemple amb Lodash:</strong></p>

{% capture code_261 %}import _ from 'lodash';
const result = _.map([1, 2, 3], n => n * 2);
import map from 'lodash/map';
const result = map([1, 2, 3], n => n * 2);
import { map } from 'lodash-es';
const result = map([1, 2, 3], n => n * 2);{% endcapture %}
  {% include code-block.html lang="typescript" code=code_261 %}

  <p><strong>Impacte:</strong> 700 KB ‚Üí 2 KB = 99.7% reducci√≥</p>

  <h4>3.8.3. Estrat√®gia 2: Reempla√ßar llibreries pesades</h4>
  <table>
    <thead>
      <tr>
        <th>Llibreria pesada</th>
        <th>Mida</th>
        <th>Alternativa lleugera</th>
        <th>Mida</th>
        <th>Reducci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Moment.js</strong></td>
        <td>290 KB</td>
        <td>date-fns</td>
        <td>15 KB</td>
        <td>95%</td>
      </tr>
      <tr>
        <td><strong>Lodash</strong></td>
        <td>700 KB</td>
        <td>lodash-es</td>
        <td>2-50 KB</td>
        <td>93-99%</td>
      </tr>
      <tr>
        <td><strong>Axios</strong></td>
        <td>45 KB</td>
        <td>Angular HttpClient</td>
        <td>0 KB</td>
        <td>100%</td>
      </tr>
      <tr>
        <td><strong>jQuery</strong></td>
        <td>280 KB</td>
        <td>JavaScript natiu</td>
        <td>0 KB</td>
        <td>100%</td>
      </tr>
      <tr>
        <td><strong>Bootstrap</strong></td>
        <td>200 KB</td>
        <td>Tailwind + purge</td>
        <td>10-30 KB</td>
        <td>85-95%</td>
      </tr>
    </tbody>
  </table>

  <p><strong>Exemple: Reempla√ßar Moment.js amb date-fns</strong></p>

{% capture code_262 %}import * as moment from 'moment';
formatDate(date: Date): string {
  return moment(date).format('DD/MM/YYYY');
}
addDays(date: Date, days: number): Date {
  return moment(date).add(days, 'days').toDate();
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_262 %}

{% capture code_263 %}import { format, addDays } from 'date-fns';
formatDate(date: Date): string {
  return format(date, 'dd/MM/yyyy');
}
addDaysToDate(date: Date, days: number): Date {
  return addDays(date, days);
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_263 %}

  <p><strong>Benefici:</strong> -275 KB (95% reducci√≥)</p>

  <h4>3.8.4. Estrat√®gia 3: Lazy loading agressiu</h4>
  <p>Mou funcionalitats pesades a m√≤duls carregats sota demanda:</p>

{% capture code_264 %}const routes: Routes = [
  {
    path: 'admin',
    loadChildren: () => import('./admin/admin.module').then(m => m.AdminModule)
  }
];{% endcapture %}
  {% include code-block.html lang="typescript" code=code_264 %}

  <p><strong>Impacte:</strong></p>
  <ul>
    <li>Bundle inicial: -200 KB</li>
    <li>Bundle admin (carregat sota demanda): +200 KB</li>
    <li>Temps c√†rrega inicial: 40% m√©s r√†pid</li>
  </ul>

  <h4>3.8.5. Estrat√®gia 4: Eliminar imports no utilitzats</h4>
{% capture code_265 %}import { Component, OnInit, OnDestroy, ViewChild, ElementRef } from '@angular/core';
import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';
import { Observable, Subject, BehaviorSubject, ReplaySubject, interval } from 'rxjs';
import { map, filter, take, debounceTime, distinctUntilChanged, switchMap } from 'rxjs/operators';
import { Component, OnInit } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { map } from 'rxjs/operators';{% endcapture %}
  {% include code-block.html lang="typescript" code=code_265 %}

  <h4>3.8.6. Estrat√®gia 5: Optimitzar imatges i assets</h4>
  <p><strong>1. Comprimir imatges:</strong></p>

{% capture code_266 %}convert original.png -quality 80 -resize 1200x optimized.jpg{% endcapture %}
  {% include code-block.html lang="bash" code=code_266 %}

  <p><strong>2. Usar WebP amb fallback:</strong></p>

{% capture code_267 %}<picture>
<source srcset="image.webp" type="image/webp">
<source srcset="image.jpg" type="image/jpeg">
<img src="image.jpg" alt="Product">
</picture>{% endcapture %}
  {% include code-block.html lang="html" code=code_267 %}

  <p><strong>3. Lazy loading d'imatges:</strong></p>

{% capture code_268 %}<img src="product.jpg" alt="Product" loading="lazy">{% endcapture %}
  {% include code-block.html lang="html" code=code_268 %}

  <h4>3.8.7. Checklist d'optimitzaci√≥ de mida</h4>
  <ul>
    <li>Reempla√ßat Moment.js amb date-fns (-275 KB)</li>
    <li>Lodash ‚Üí lodash-es amb imports espec√≠fics (-650 KB)</li>
    <li>Imatges comprimides i convertides a WebP (-1-3 MB)</li>
    <li>Lazy loading per m√≤duls pesats (-200-500 KB)</li>
    <li>Eliminats imports no utilitzats (-50-100 KB)</li>
    <li>Angular Material: imports espec√≠fics (-200 KB)</li>
    <li>Bootstrap: nom√©s utilities necessaris (-170 KB)</li>
  </ul>

  <p><strong>Reducci√≥ total t√≠pica:</strong> 2-4 MB ‚Üí 500 KB - 1 MB</p>
  {% endcapture %}
  {% include section-point.html numero="3.8" titol="Estrat√®gies per reduir mida: imports espec√≠fics, llibreries alternatives" contingut=section_point_3_8 %}

  {% capture section_point_3_9 %}
  <h4>3.9.1. Objectiu</h4>
  <p>Aprendre a utilitzar variables d'entorn per configurar diferents comportaments segons l'entorn de desplegament (desenvolupament, staging, producci√≥), gestionar configuracions sensibles de manera segura i implementar feature flags per activar/desactivar funcionalitats.</p>

  <h4>3.9.2. Per qu√® necessitem variables d'entorn</h4>
  <p>Les aplicacions necessiten configuracions diferents segons l'entorn:</p>

  <table>
    <thead>
      <tr>
        <th>Configuraci√≥</th>
        <th>Desenvolupament</th>
        <th>Staging</th>
        <th>Producci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>API URL</strong></td>
        <td>http://localhost:3000</td>
        <td>https://staging-api.myapp.com</td>
        <td>https://api.myapp.com</td>
      </tr>
      <tr>
        <td><strong>Debug</strong></td>
        <td>true</td>
        <td>true</td>
        <td>false</td>
      </tr>
      <tr>
        <td><strong>Analytics</strong></td>
        <td>desactivat</td>
        <td>activat</td>
        <td>activat</td>
      </tr>
      <tr>
        <td><strong>Source maps</strong></td>
        <td>activat</td>
        <td>activat</td>
        <td>desactivat</td>
      </tr>
      <tr>
        <td><strong>Logs</strong></td>
        <td>verbose</td>
        <td>normal</td>
        <td>errors nom√©s</td>
      </tr>
    </tbody>
  </table>

  <h4>3.9.3. Estructura de fitxers d'entorn</h4>
  <p>Angular proporciona <code>environment.ts</code> i <code>environment.prod.ts</code>:</p>

{% capture code_269 %}src/
‚îú‚îÄ‚îÄ environments/
‚îÇ   ‚îú‚îÄ‚îÄ environment.ts
‚îÇ   ‚îú‚îÄ‚îÄ environment.staging.ts
‚îÇ   ‚îî‚îÄ‚îÄ environment.prod.ts{% endcapture %}
  {% include code-block.html lang="text" code=code_269 %}

  <p><strong>environment.ts (desenvolupament):</strong></p>

{% capture code_270 %}export const environment = {
  production: false,
  apiUrl: 'http://localhost:3000/api',
  debug: true,
  enableAnalytics: false,
  enableSourceMaps: true,
  logLevel: 'debug',
  version: '1.0.0-dev',
  features: {
    newDashboard: true,
    betaFeatures: true
  }
};{% endcapture %}
  {% include code-block.html lang="typescript" code=code_270 %}

  <p><strong>environment.prod.ts (producci√≥):</strong></p>

{% capture code_271 %}export const environment = {
  production: true,
  apiUrl: 'https://api.myapp.com',
  debug: false,
  enableAnalytics: true,
  enableSourceMaps: false,
  logLevel: 'error',
  version: '1.0.0',
  features: {
    newDashboard: true,
    betaFeatures: false
  }
};{% endcapture %}
  {% include code-block.html lang="typescript" code=code_271 %}

  <h4>3.9.4. Usar variables d'entorn al codi</h4>
{% capture code_272 %}import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../environments/environment';
@Injectable({
  providedIn: 'root'
})
export class ProductService {
  private apiUrl = environment.apiUrl;
  constructor(private http: HttpClient) {
    if (environment.debug) {
      console.log('ProductService initialized');
      console.log('API URL:', this.apiUrl);
    }
  }
  getProducts() {
    return this.http.get(`${this.apiUrl}/products`);
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_272 %}

  <h4>3.9.5. Configurar m√∫ltiples entorns a angular.json</h4>
{% capture code_273 %}{
  "projects": {
    "my-app": {
      "architect": {
        "build": {
          "configurations": {
            "production": {
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.prod.ts"
                }
              ]
            },
            "staging": {
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.staging.ts"
                }
              ]
            }
          }
        }
      }
    }
  }
}{% endcapture %}
  {% include code-block.html lang="json" code=code_273 %}

  <p><strong>√ös:</strong></p>

{% capture code_274 %}ng build
ng build --configuration production
ng build --configuration staging{% endcapture %}
  {% include code-block.html lang="bash" code=code_274 %}

  <h4>3.9.6. Bones pr√†ctiques amb variables d'entorn</h4>
  <p><strong>1. Mai cometre secrets al repositori</strong></p>

  <p><strong>2. Validar configuraci√≥ en runtime</strong></p>

{% capture code_275 %}export class AppComponent implements OnInit {
  ngOnInit() {
    if (!environment.apiUrl) {
      throw new Error('API URL not configured!');
    }
    if (environment.production && environment.debug) {
      console.warn('Warning: Debug mode active in production!');
    }
  }
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_275 %}

  <p><strong>3. Feature flags per funcionalitats noves</strong></p>

{% capture code_276 %}@Injectable({ providedIn: 'root' })
export class FeatureGuard implements CanActivate {
  canActivate(): boolean {
    if (!environment.features.newDashboard) {
      return false;
    }
    return true;
  }
}
{
  path: 'dashboard-new',
  component: NewDashboardComponent,
  canActivate: [FeatureGuard]
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_276 %}
  {% endcapture %}
  {% include section-point.html numero="3.9" titol="Variables d'entorn: configuraci√≥ per a producci√≥" contingut=section_point_3_9 %}

  {% capture section_point_3_10 %}
  <h4>3.10.1. Objectiu</h4>
  <p>Con√®ixer les principals plataformes de desplegament per a aplicacions Angular (Netlify, Vercel, Firebase, GitHub Pages, AWS S3), entendre com configurar i desplegar l'aplicaci√≥ a cada plataforma, i comparar les seves caracter√≠stiques per triar la m√©s adequada.</p>

  <h4>3.10.2. Plataformes populars de desplegament</h4>
  <p>Angular genera una SPA (Single Page Application) est√†tica, compatible amb qualsevol servidor de fitxers est√†tics:</p>

  <table>
    <thead>
      <tr>
        <th>Plataforma</th>
        <th>Dificultat</th>
        <th>Gratu√Øt</th>
        <th>SSL</th>
        <th>CI/CD</th>
        <th>Recomanaci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Netlify</strong></td>
        <td>Molt f√†cil</td>
        <td>S√≠</td>
        <td>S√≠</td>
        <td>S√≠</td>
        <td><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i></td>
      </tr>
      <tr>
        <td><strong>Vercel</strong></td>
        <td>Molt f√†cil</td>
        <td>S√≠</td>
        <td>S√≠</td>
        <td>S√≠</td>
        <td><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i></td>
      </tr>
      <tr>
        <td><strong>Firebase Hosting</strong></td>
        <td>F√†cil</td>
        <td>S√≠</td>
        <td>S√≠</td>
        <td>S√≠</td>
        <td><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i></td>
      </tr>
      <tr>
        <td><strong>GitHub Pages</strong></td>
        <td>F√†cil</td>
        <td>S√≠</td>
        <td>S√≠</td>
        <td>No natiu</td>
        <td><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i></td>
      </tr>
      <tr>
        <td><strong>AWS S3 + CloudFront</strong></td>
        <td>Mitj√†</td>
        <td>No</td>
        <td>S√≠</td>
        <td>Manual</td>
        <td><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i></td>
      </tr>
      <tr>
        <td><strong>Azure Static Web Apps</strong></td>
        <td>Mitj√†</td>
        <td>S√≠ (limitat)</td>
        <td>S√≠</td>
        <td>S√≠</td>
        <td><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i><i class="bi bi-star-fill" aria-hidden="true"></i></td>
      </tr>
    </tbody>
  </table>

  <h4>3.10.3. Desplegament amb Netlify</h4>
  <p><strong>Opci√≥ 1: Interf√≠cie web (m√©s f√†cil)</strong></p>

  <ul>
    <li>Crear compte a https://netlify.com</li>
    <li>"Add new site" ‚Üí "Import from Git"</li>
    <li>Connectar repositori GitHub</li>
    <li>Configurar:</li>
  </ul>

  <ul>
    <li><strong>Build command:</strong> <code>ng build --configuration production</code></li>
    <li><strong>Publish directory:</strong> <code>dist/my-app/browser</code></li>
  </ul>

  <p><strong>Opci√≥ 2: Netlify CLI</strong></p>

{% capture code_277 %}npm install -g netlify-cli
ng build --configuration production
netlify deploy --prod --dir=dist/my-app/browser{% endcapture %}
  {% include code-block.html lang="bash" code=code_277 %}

  <p><strong>Configurar redirects per Angular (netlify.toml):</strong></p>

{% capture code_278 %}[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200{% endcapture %}
  {% include code-block.html lang="toml" code=code_278 %}

  <h4>3.10.4. Desplegament amb Vercel</h4>
{% capture code_279 %}npm install -g vercel
vercel --prod{% endcapture %}
  {% include code-block.html lang="bash" code=code_279 %}

  <p><strong>vercel.json:</strong></p>

{% capture code_280 %}{
  "buildCommand": "ng build --configuration production",
  "outputDirectory": "dist/my-app/browser",
  "routes": [
    { "handle": "filesystem" },
    { "src": "/.*", "dest": "/index.html" }
  ]
}{% endcapture %}
  {% include code-block.html lang="json" code=code_280 %}

  <h4>3.10.5. Desplegament amb Firebase Hosting</h4>
{% capture code_281 %}npm install -g firebase-tools
firebase login
firebase init hosting
ng build --configuration production
firebase deploy --only hosting{% endcapture %}
  {% include code-block.html lang="bash" code=code_281 %}

  <p><strong>firebase.json:</strong></p>

{% capture code_282 %}{
  "hosting": {
    "public": "dist/my-app/browser",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ]
  }
}{% endcapture %}
  {% include code-block.html lang="json" code=code_282 %}

  <h4>3.10.6. Desplegament amb GitHub Pages</h4>
{% capture code_283 %}npm install --save-dev angular-cli-ghpages
{
  "scripts": {
    "deploy": "ng deploy --base-href=/my-app/"
  }
}
npm run deploy{% endcapture %}
  {% include code-block.html lang="bash" code=code_283 %}

  <h4>3.10.7. Comparativa de plataformes</h4>
  <table>
    <thead>
      <tr>
        <th>Caracter√≠stica</th>
        <th>Netlify</th>
        <th>Vercel</th>
        <th>Firebase</th>
        <th>GitHub Pages</th>
        <th>AWS S3</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Setup</strong></td>
        <td>2 min</td>
        <td>2 min</td>
        <td>5 min</td>
        <td>5 min</td>
        <td>15 min</td>
      </tr>
      <tr>
        <td><strong>SSL gratu√Øt</strong></td>
        <td><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i></td>
        <td><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i></td>
        <td><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i></td>
        <td><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i></td>
        <td><i class="bi bi-x-circle-fill text-danger" aria-hidden="true"></i></td>
      </tr>
      <tr>
        <td><strong>CI/CD</strong></td>
        <td>Autom√†tic</td>
        <td>Autom√†tic</td>
        <td>Manual</td>
        <td>Semi-auto</td>
        <td>Manual</td>
      </tr>
      <tr>
        <td><strong>Custom domain</strong></td>
        <td><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> F√†cil</td>
        <td><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> F√†cil</td>
        <td><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> F√†cil</td>
        <td><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> F√†cil</td>
        <td><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> Complex</td>
      </tr>
      <tr>
        <td><strong>Preu (< 100 GB)</strong></td>
        <td>Gratu√Øt</td>
        <td>Gratu√Øt</td>
        <td>Gratu√Øt</td>
        <td>Gratu√Øt</td>
        <td>~$3/mes</td>
      </tr>
    </tbody>
  </table>
  {% endcapture %}
  {% include section-point.html numero="3.10" titol="Opcions de desplegament: servidors est√†tics, plataformes cloud" contingut=section_point_3_10 %}

  {% capture section_point_3_11 %}
  <h4>3.11.1. Objectiu</h4>
  <p>Establir un protocol de verificaci√≥ post-desplegament per assegurar que l'aplicaci√≥ funciona correctament en producci√≥, identificar problemes comuns i utilitzar eines de diagn√≤stic per validar rendiment, funcionalitat i SEO.</p>

  <h4>3.11.2. Checklist de verificaci√≥</h4>
  <p>Despr√©s de desplegar, comproveu sistem√†ticament:</p>

  <p><strong>1. Acc√©s b√†sic:</strong></p>

  {% include checklist.html elements="URL p√∫blica accessible|HTTPS actiu (candau verd)|P√†gina inicial carrega correctament|Sense errors 404 al navegador|Console sense errors JavaScript" %}

  <p><strong>2. Funcionalitats principals:</strong></p>

  {% include checklist.html elements="Navegaci√≥ entre p√†gines funciona|Formularis envien dades|Crides a API completen correctament|Autenticaci√≥ funciona (si aplicable)|Assets (imatges, fonts) carreguen correctament" %}

  <p><strong>3. Rendiment:</strong></p>

  {% include checklist.html elements="Lighthouse score &gt; 90|Temps c√†rrega inicial &lt; 3s|Time to Interactive (TTI) &lt; 5s|Bundle size dins de budgets|No bloqueigs de renderitzat" %}

  <p><strong>4. SEO i metadades:</strong></p>

  {% include checklist.html elements="Meta tags presents i correctes|Open Graph tags configurats|Favicon visible|Sitemap.xml accessible|Robots.txt configurat" %}

  <h4>3.11.3. Eines de diagn√≤stic</h4>
  <p><strong>1. Google Lighthouse</strong></p>

{% capture code_284 %}npm install -g lighthouse
lighthouse https://your-app.com --view{% endcapture %}
  {% include code-block.html lang="bash" code=code_284 %}

  <p><strong>Resultats esperats:</strong></p>
  <ul>
    <li>Performance: 90-100</li>
    <li>Accessibility: 90-100</li>
    <li>Best Practices: 90-100</li>
    <li>SEO: 90-100</li>
  </ul>

  <p><strong>2. Chrome DevTools Network tab</strong></p>

  <p>Verificar:</p>
  <ul>
    <li>Tots els recursos carreguen (status 200)</li>
    <li>No hi ha errors 404 o 500</li>
    <li>Fitxers tenen cache headers adequats</li>
    <li>Compressi√≥ gzip/brotli activa</li>
  </ul>

  <p><strong>3. WebPageTest</strong></p>

  <p>Provar des de m√∫ltiples ubicacions i connexions:</p>
  <ul>
    <li>https://www.webpagetest.org</li>
    <li>Simular 3G, 4G, cable</li>
    <li>Diferents pa√Øsos i dispositius</li>
  </ul>

  <h4>3.11.4. Problemes comuns post-desplegament</h4>
  <table>
    <thead>
      <tr>
        <th>Problema</th>
        <th>S√≠mptoma</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Rutes 404</td>
        <td>Refresh dona 404</td>
        <td>Configurar redirects a index.html</td>
      </tr>
      <tr>
        <td>API cors errors</td>
        <td>Peticions HTTP fallen</td>
        <td>Configurar CORS al backend</td>
      </tr>
      <tr>
        <td>Assets 404</td>
        <td>Imatges/fonts no carreguen</td>
        <td>Verificar base-href i paths</td>
      </tr>
      <tr>
        <td>Cache agressiu</td>
        <td>Canvis no es veuen</td>
        <td>Cache-Control headers correctes</td>
      </tr>
      <tr>
        <td>Bundle massa gran</td>
        <td>C√†rrega lenta</td>
        <td>Revisar bundle analyzer</td>
      </tr>
    </tbody>
  </table>

  <h4>3.11.5. Monitoratge continu</h4>
  <p>Configurar eines de monitoratge per detectar problemes proactivament:</p>

  <ul>
    <li><strong>Google Analytics:</strong> Tr√†fic i comportament usuaris</li>
    <li><strong>Sentry:</strong> Errors JavaScript en producci√≥</li>
    <li><strong>Uptime monitoring:</strong> Pingdom, UptimeRobot</li>
    <li><strong>Real User Monitoring (RUM):</strong> M√®triques reals d'usuaris</li>
  </ul>

  <h4>3.11.6. Protocol complet de verificaci√≥</h4>
{% capture code_285 %}ABANS DE DESPLEGAR:
<i class="bi bi-square" aria-hidden="true"></i> Tests passen (ng test)
<i class="bi bi-square" aria-hidden="true"></i> Build producci√≥ exit√≥s
<i class="bi bi-square" aria-hidden="true"></i> Bundle analyzer revisat
<i class="bi bi-square" aria-hidden="true"></i> Variables entorn configurades
DESPR√âS DE DESPLEGAR:
<i class="bi bi-square" aria-hidden="true"></i> URL accessible amb HTTPS
<i class="bi bi-square" aria-hidden="true"></i> Navegaci√≥ funciona
<i class="bi bi-square" aria-hidden="true"></i> API calls completen
<i class="bi bi-square" aria-hidden="true"></i> Lighthouse score &gt; 90
<i class="bi bi-square" aria-hidden="true"></i> No errors a Console
<i class="bi bi-square" aria-hidden="true"></i> Metadades correctes
<i class="bi bi-square" aria-hidden="true"></i> Monitoring configurat{% endcapture %}
  {% include code-block.html lang="text" code=code_285 %}
  {% endcapture %}
  {% include section-point.html numero="3.11" titol="Verificaci√≥ post-desplegament: comprovar que tot funciona" contingut=section_point_3_11 %}

  {% capture section_point_3_12 %}
  <h4>3.12.1. Objectiu</h4>
  <p>Compilar una aplicaci√≥ Angular per a producci√≥, analitzar el bundle, aplicar optimitzacions i desplegar a Netlify.</p>

  <h4>3.12.2. Pas 1: Preparar l'aplicaci√≥</h4>
{% capture code_286 %}ng serve{% endcapture %}
  {% include code-block.html lang="bash" code=code_286 %}

  <h4>3.12.3. Pas 2: Build inicial de producci√≥</h4>
{% capture code_287 %}ng build --configuration production
Initial Chunk Files   | Names         |  Raw Size
main.a8f3d2b4c.js     | main          | 856.23 KB
polyfills.7e9c1f4.js  | polyfills     | 182.45 KB
styles.f4e8b3a7.css   | styles        |  48.12 KB
                      | Initial Total |   1.08 MB{% endcapture %}
  {% include code-block.html lang="bash" code=code_287 %}

  <p><strong>Problema detectat:</strong> main.js √©s massa gran (&gt; 500 KB)</p>

  <h4>3.12.4. Pas 3: Analitzar el bundle</h4>
{% capture code_288 %}npm run build:stats
npm run analyze{% endcapture %}
  {% include code-block.html lang="bash" code=code_288 %}

  <p><strong>Descobriment:</strong> Lodash ocupa 120 KB</p>

  <h4>3.12.5. Pas 4: Optimitzar imports</h4>
{% capture code_289 %}import * as _ from 'lodash';
sortProducts(products: Product[]): Product[] {
  return _.sortBy(products, 'price');
}
import { sortBy } from 'lodash-es';
sortProducts(products: Product[]): Product[] {
  return sortBy(products, 'price');
}{% endcapture %}
  {% include code-block.html lang="typescript" code=code_289 %}

  <h4>3.12.6. Pas 5: Rebuild i verificar</h4>
{% capture code_290 %}ng build --configuration production
Initial Chunk Files   | Names         |  Raw Size
main.a8f3d2b4c.js     | main          | 456.23 KB
polyfills.7e9c1f4.js  | polyfills     | 182.45 KB
styles.f4e8b3a7.css   | styles        |  48.12 KB
                      | Initial Total | 686.80 KB{% endcapture %}
  {% include code-block.html lang="bash" code=code_290 %}

  <p><strong>Millora:</strong> -400 KB (47% reducci√≥)</p>

  <h4>3.12.7. Pas 6: Desplegar a Netlify</h4>
{% capture code_291 %}npm install -g netlify-cli
netlify login
netlify deploy --prod --dir=dist/my-app/browser{% endcapture %}
  {% include code-block.html lang="bash" code=code_291 %}

  <h4>3.12.8. Resultat final</h4>
  <p><strong>Abans d'optimitzar:</strong></p>
  <ul>
    <li>Bundle: 1.08 MB</li>
    <li>C√†rrega: 3.2s</li>
    <li>Lighthouse: 65/100</li>
  </ul>

  <p><strong>Despr√©s d'optimitzar:</strong></p>
  <ul>
    <li>Bundle: 686 KB (36% reducci√≥)</li>
    <li>C√†rrega: 1.8s (44% m√©s r√†pid)</li>
    <li>Lighthouse: 98/100</li>
  </ul>
  {% endcapture %}
  {% include section-point.html numero="3.12" titol="Mini exemple pr√†ctic" contingut=section_point_3_12 %}

  {% capture section_point_3_13 %}
  <h4>3.13.1. Errors transversals</h4>
  <table>
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Build falla</td>
        <td>Errors TypeScript</td>
        <td>Corregir errors amb <code>ng build</code></td>
      </tr>
      <tr>
        <td>Bundle massa gran</td>
        <td>Imports pesats</td>
        <td>Analitzar amb webpack-bundle-analyzer</td>
      </tr>
      <tr>
        <td>C√†rrega lenta</td>
        <td>Assets no optimitzats</td>
        <td>Comprimir imatges, lazy loading</td>
      </tr>
      <tr>
        <td>404 en refresh</td>
        <td>Falta rewrite</td>
        <td>Configurar redirect a index.html</td>
      </tr>
      <tr>
        <td>CORS errors</td>
        <td>Backend no configurat</td>
        <td>Afegir headers CORS al servidor</td>
      </tr>
    </tbody>
  </table>

  <h4>3.13.2. Errors de configuraci√≥</h4>
  <table>
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Soluci√≥ Windows</th>
        <th>Soluci√≥ Linux/macOS</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>ng: command not found</td>
        <td>CLI no instal¬∑lat</td>
        <td><code>npm install -g @angular/cli</code></td>
        <td><code>sudo npm install -g @angular/cli</code></td>
      </tr>
      <tr>
        <td>Permission denied</td>
        <td>Permisos insuficients</td>
        <td>Executar com administrador</td>
        <td><code>sudo</code> abans de comandes</td>
      </tr>
      <tr>
        <td>Module not found</td>
        <td>node_modules corruptes</td>
        <td><code>rmdir /s node_modules && npm install</code></td>
        <td><code>rm -rf node_modules && npm install</code></td>
      </tr>
      <tr>
        <td>Out of memory</td>
        <td>Build massa gran</td>
        <td colspan="2">Augmentar heap: <code>NODE_OPTIONS=--max_old_space_size=4096</code></td>
      </tr>
    </tbody>
  </table>

  <h4>3.13.3. Debug de build de producci√≥</h4>
{% capture code_292 %}ng build --configuration production --source-map=true
npx http-server dist/my-app/browser -p 8080{% endcapture %}
  {% include code-block.html lang="bash" code=code_292 %}
  {% endcapture %}
  {% include section-point.html numero="3.13" titol="Resoluci√≥ de problemes" contingut=section_point_3_13 %}

  {% capture section_point_3_14 %}
{% include prompt-ai.html contingut="<strong>Rol:</strong> Sou un expert en optimitzaci√≥ de bundles JavaScript per a frameworks moderns com Angular, React i Vue. <strong>Context:</strong> Heu auditat centenars d'aplicacions web i identificat patrons d'optimitzaci√≥ efectius. Coneixeu totes les t√®cniques de reducci√≥ de mida de bundle. <strong>Tasca:</strong> Expliqueu les 5 difer√®ncies principals entre compilar Angular en mode desenvolupament vs producci√≥. Incloeu exemples pr√†ctics i quantitatius de mides de bundle abans i despr√©s, mostrant percentatges de reducci√≥ i temps de c√†rrega. <strong>Format:</strong> Presenteu cada difer√®ncia amb el seg√ºent format: Nom | Desenvolupament vs Producci√≥ | Impacte quantificat | Exemple concret amb codi." %}
{% include prompt-ai.html contingut="<strong>Rol:</strong> Sou un desenvolupador senior especialitzat en arquitectura d'aplicacions Angular enterprise. <strong>Context:</strong> Heu implementat estrat√®gies de lazy loading en projectes amb m√©s de 50 m√≤duls funcionals, aconseguint reduccions de bundle inicial de fins al 80%. <strong>Tasca:</strong> Creeu una estrat√®gia completa de lazy loading per una aplicaci√≥ Angular amb 10 m√≤duls funcionals (dashboard, users, products, orders, analytics, reports, settings, notifications, chat, help). Incloeu codi complet de routing amb loadChildren, c√†lculs d'impacte en el bundle inicial i configuraci√≥ de preloading strategies. <strong>Format:</strong> Estructura de m√≤duls | Codi app-routing.module.ts | Taula comparativa (abans/despr√©s) | Estrat√®gia de preloading." %}
{% include prompt-ai.html contingut="<strong>Rol:</strong> Sou un DevOps engineer especialitzat en desplegament continu (CI/CD) per a aplicacions Angular. <strong>Context:</strong> Heu configurat pipelines de desplegament per a dotzenes d'aplicacions Angular usant GitHub Actions, GitLab CI i Jenkins. <strong>Tasca:</strong> Escriviu un workflow complet de GitHub Actions que: 1) Compili l'aplicaci√≥ Angular per a producci√≥, 2) Executi tests unitaris i e2e, 3) Analitzi el bundle i falli si supera 2 MB, 4) Desplegui autom√†ticament a Netlify si tots els passos passen. Incloeu gesti√≥ d'errors, logs detallats i notificacions. <strong>Format:</strong> Fitxer YAML complet (.github/workflows/deploy.yml) amb comentaris explicatius en cada secci√≥." %}

  {% endcapture %}
  {% include section-point.html numero="3.14" titol="Prompts d'IA" contingut=section_point_3_14 %}

  {% capture section_point_3_15 %}
  <h4>Conceptes te√≤rics</h4>
  {% include checklist.html elements="Comprenc les difer√®ncies entre mode desenvolupament i producci√≥|S√© executar builds amb diferents configuracions (dev/staging/prod)|Entenc les optimitzacions autom√†tiques que aplica Angular|Puc configurar flags de compilaci√≥ segons necessitats|Comprenc per qu√® s√≥n necess√†ries les variables d'entorn|Conec almenys 3 plataformes de desplegament diferents" %}

  <h4>Habilitats pr√†ctiques</h4>
  {% include checklist.html elements="He compilat l'aplicaci√≥ per a producci√≥ amb ng build --prod sense errors|He analitzat el bundle amb webpack-bundle-analyzer|He configurat variables d'entorn per a producci√≥ correctament|He desplegat l'aplicaci√≥ a una plataforma p√∫blica accessible|He verificat que totes les rutes funcionen despr√©s de desplegar|He executat Lighthouse amb puntuaci√≥ > 90 en Performance" %}

  <h4>Resoluci√≥ de problemes</h4>
  {% include checklist.html elements="S√© analitzar el bundle per identificar components pesats|Puc aplicar tree-shaking efectivament amb imports espec√≠fics|He aplicat almenys 3 optimitzacions de mida documentades|Puc configurar redirects per a SPAs correctament|Puc identificar i solucionar errors post-desplegament|S√© usar Lighthouse per mesurar rendiment" %}
  {% endcapture %}
  {% include section-point.html numero="3.15" titol="Autoavaluaci√≥" contingut=section_point_3_15 %}

  {% capture section_point_3_16 %}
  <p>Amb aquesta lectura heu completat el proc√©s de preparaci√≥ i desplegament d'aplicacions Angular per a producci√≥.</p>

  <h4>3.16.1. Transformaci√≥ desenvolupament ‚Üí producci√≥</h4>

  <p>Heu apr√®s a transformar una aplicaci√≥ de desenvolupament en una aplicaci√≥ optimitzada:</p>

  <ul>
    <li><strong>Abans:</strong> 15-25 MB, c√†rrega en 5-10 segons</li>
    <li><strong>Despr√©s:</strong> 500 KB - 2 MB, c√†rrega en menys de 2 segons</li>
    <li><strong>Resultat:</strong> Reducci√≥ del 85-95% en mida i 80-90% en temps</li>
  </ul>

  <h4>3.16.2. Optimitzacions autom√†tiques dominades</h4>

  <p>Heu compr√®s i aplicat les optimitzacions que Angular executa durant la compilaci√≥:</p>

  <ul>
    <li><strong>Minificaci√≥:</strong> Elimina espais i escur√ßa noms de variables</li>
    <li><strong>Tree-shaking:</strong> Elimina codi no utilitzat de llibreries</li>
    <li><strong>AOT Compilation:</strong> Precompila les plantilles abans de desplegar</li>
    <li><strong>Uglification:</strong> Ofusca el codi per seguretat</li>
  </ul>

  <h4>3.16.3. An√†lisi i optimitzaci√≥ del bundle</h4>

  <p>Ara sabeu identificar i solucionar problemes de rendiment:</p>

  <ul>
    <li>Analitzar el bundle amb webpack-bundle-analyzer</li>
    <li>Identificar llibreries pesades i reempla√ßar-les amb alternatives lleugeres</li>
    <li>Aplicar imports espec√≠fics i lazy loading agressiu</li>
    <li>Reduir la mida del bundle inicial en 60-90%</li>
  </ul>

  <h4>3.16.4. Configuraci√≥ multi-entorn</h4>

  <p>Heu apr√®s a adaptar l'aplicaci√≥ a diferents contextos:</p>

  <ul>
    <li>Variables d'entorn per desenvolupament, staging i producci√≥</li>
    <li>URLs d'API diferents segons l'entorn</li>
    <li>Feature flags per activar/desactivar funcionalitats</li>
    <li>Configuracions de debug i analytics adaptades</li>
  </ul>

  <h4>3.16.5. Desplegament professional</h4>

  <p>Domineu m√∫ltiples plataformes i t√®cniques de publicaci√≥:</p>

  <ul>
    <li>Desplegament a Netlify, Vercel, Firebase i GitHub Pages</li>
    <li>Configuraci√≥ autom√†tica de SSL/HTTPS</li>
    <li>Redirects per a SPAs correctament implementats</li>
    <li>Dominis personalitzats configurats</li>
  </ul>

  <h4>3.16.6. Verificaci√≥ i qualitat</h4>

  <p>Heu establert protocols professionals de comprovaci√≥:</p>

  <ul>
    <li>Verificaci√≥ de funcionalitat en m√∫ltiples navegadors</li>
    <li>An√†lisi de rendiment amb Lighthouse (&gt; 90/100)</li>
    <li>Comprovaci√≥ d'errors a la consola i Network tab</li>
    <li>Tests en dispositius m√≤bils reals</li>
  </ul>

  <p><strong>Disposeu ara de totes les compet√®ncies necess√†ries per construir, optimitzar i desplegar aplicacions web modernes amb Angular de forma professional i eficient.</strong></p>
  {% endcapture %}
  {% include section-point.html numero="3.16" titol="S√≠ntesi" contingut=section_point_3_16 %}

  {% capture section_point_3_17 %}
  {% include definicio.html terme="Build de producci√≥" definicio="Compilaci√≥ optimitzada d'una aplicaci√≥ Angular per desplegar en servidors reals, aplicant autom√†ticament minificaci√≥, tree-shaking, AOT compilation i altres optimitzacions que redueixen la mida del bundle en un 85-95%." %}

  {% include definicio.html terme="Minificaci√≥" definicio="Proc√©s d'eliminaci√≥ d'espais en blanc, comentaris i noms de variables llargs del codi JavaScript i CSS, convertint 15 l√≠nies de codi llegible en 1 l√≠nia de codi compacte, aconseguint reduccions de mida del 40-50%." %}

  {% include definicio.html terme="Tree-shaking" definicio="T√®cnica d'eliminaci√≥ de codi no utilitzat d'una aplicaci√≥ o llibreria. Quan importeu nom√©s una funci√≥ de Lodash, tree-shaking elimina les altres 699 funcions, reduint la mida de 700 KB a nom√©s 2 KB." %}

  {% include definicio.html terme="AOT Compilation" definicio="Ahead-of-Time Compilation: compilaci√≥ de les plantilles Angular durant el build en lloc de fer-ho al navegador. Redueix la mida del bundle en 500 KB (no cal incloure el compilador) i millora el rendiment en un 300-500%." %}

  {% include definicio.html terme="Bundle" definicio="Conjunt de fitxers JavaScript i CSS generats durant la compilaci√≥ d'Angular (main.js, polyfills.js, vendor.js, styles.css). En desenvolupament ocupa 15-25 MB, en producci√≥ 500 KB - 2 MB." %}

  {% include definicio.html terme="Variables d'entorn" definicio="Configuracions que canvien segons l'entorn on s'executa l'aplicaci√≥ (desenvolupament, staging, producci√≥). Permeten usar diferents URLs d'API, activar/desactivar debug, i gestionar funcionalitats amb feature flags." %}

  {% include definicio.html terme="Lazy loading" definicio="C√†rrega diferida de m√≤duls Angular nom√©s quan l'usuari els necessita. Redueix el bundle inicial en 200-500 KB movent funcionalitats pesades (admin, reports) a chunks separats que es descarreguen sota demanda." %}

  {% include definicio.html terme="Deployment" definicio="Proc√©s de publicar una aplicaci√≥ Angular compilada per a producci√≥ en un servidor accessible p√∫blicament (Netlify, Vercel, Firebase), configurant HTTPS, redirects per a SPAs i dominis personalitzats." %}
  {% endcapture %}
  {% include section-point.html numero="3.17" titol="Rep√†s de conceptes" contingut=section_point_3_17 %}

</div>
