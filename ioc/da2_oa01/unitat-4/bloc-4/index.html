---
layout: bloc
title: "Cas d'√∫s: Aplicaci√≥ completa amb navegaci√≥ i optimitzaci√≥"
unitat: 4
bloc: 4
bloc_numero: 4
---

<!-- SECCI√ì 0: Introducci√≥ -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio0">
  <h2 id="Unitat4_Bloc4_Seccio0">Introducci√≥</h2>

  <!-- MULTIM√àDIA -->
  {% include multimedia-youtube.html unitat=4 bloc=4 seccio=0 %}

  <div class="info_box">
    <p>En aquest cas d'√∫s pr√†ctic, integrareu tots els conceptes treballats al llarg del m√≤dul per construir una aplicaci√≥ completa de cat√†leg d'elements amb Angular. Desenvolupareu "Cat√†leg Universal", una SPA amb navegaci√≥ multi-p√†gina, arquitectura organitzada, optimitzacions de rendiment aplicades i desplegament a producci√≥.</p>

    <p>Aquest cas d'√∫s representa el projecte final integrador que us permetr√† aplicar els coneixements adquirits sobre entorn de desenvolupament, components, serveis, rutes, arquitectura modular i optimitzaci√≥ en un context professional complet.</p>
  </div>

  <h3>Objectius</h3>

  <p>En finalitzar aquest cas d'√∫s, haur√≠eu de ser capa√ßos de:</p>

  <ul>
    <li>Configurar un sistema de rutes complet amb m√∫ltiples vistes i navegaci√≥ entre elles</li>
    <li>Capturar i gestionar par√†metres de ruta per vistes de detall</li>
    <li>Implementar autenticaci√≥ simulada amb gesti√≥ d'estat d'usuari</li>
    <li>Crear gu√†rdies de ruta per protegir seccions privades de l'aplicaci√≥</li>
    <li>Modularitzar l'aplicaci√≥ amb lazy loading per optimitzar la c√†rrega</li>
    <li>Aplicar estrat√®gies de detecci√≥ de canvis (OnPush) per millorar el rendiment</li>
    <li>Implementar virtualitzaci√≥ per llistes grans amb Angular CDK</li>
    <li>Compilar l'aplicaci√≥ per a producci√≥ i analitzar el bundle generat</li>
  </ul>

  <h3>Criteris d'avaluaci√≥ (RA4)</h3>

  <p>Aquest cas d'√∫s cobreix els seg√ºents criteris del <strong>Resultat d'Aprenentatge 4</strong>:</p>

  <ul>
    <li><strong>RA4.1:</strong> S'ha configurat la navegaci√≥ entre pantalles i la gesti√≥ de par√†metres de ruta</li>
    <li><strong>RA4.2:</strong> S'ha implementat un flux d'inici de sessi√≥ i control d'acc√©s b√†sic basat en serveis</li>
    <li><strong>RA4.3:</strong> S'han aplicat mecanismes per preservar l'estat d'usuari i protegir seccions privades</li>
    <li><strong>RA4.4:</strong> S'han optimitzat els recursos i generat un paquet llest per a publicaci√≥</li>
    <li><strong>RA4.5:</strong> S'ha verificat el funcionament global i documentat el proc√©s adequadament</li>
  </ul>

  <h3>Lectures integrades</h3>

  <p>Aquest cas d'√∫s integra els continguts de totes les unitats del m√≤dul:</p>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Unitat</th>
        <th>Tema</th>
        <th>Aplicaci√≥ en el cas d'√∫s</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Unitat 1</strong></td>
        <td>Entorn de desenvolupament</td>
        <td>Creaci√≥ de projecte, estructura de carpetes, Git i control de versions</td>
      </tr>
      <tr>
        <td><strong>Unitat 2</strong></td>
        <td>Components i interf√≠cie</td>
        <td>Components reutilitzables, directives, vinculaci√≥ de dades, formularis b√†sics</td>
      </tr>
      <tr>
        <td><strong>Unitat 3</strong></td>
        <td>Serveis i integraci√≥</td>
        <td>HttpClient, comunicaci√≥ amb APIs, gesti√≥ d'errors, models i estat reactiu</td>
      </tr>
      <tr>
        <td><strong>Unitat 4</strong></td>
        <td>Navegaci√≥ i optimitzaci√≥</td>
        <td>Routing, par√†metres, gu√†rdies, lazy loading, OnPush, virtualitzaci√≥, build</td>
      </tr>
    </tbody>
  </table>

  <h3>Descripci√≥ de l'aplicaci√≥</h3>

  <p>Creareu <strong>"Cat√†leg Universal"</strong>, una aplicaci√≥ SPA amb les seg√ºents caracter√≠stiques:</p>

  <h4>Funcionalitats principals</h4>

  <ul>
    <li>Llistat de 100 elements amb cerca i ordenaci√≥</li>
    <li>Vista de detall per a cada element amb par√†metres de ruta</li>
    <li>Secci√≥ de preferits protegida amb autenticaci√≥ simulada</li>
    <li>Navegaci√≥ fluida entre totes les vistes</li>
    <li>Rendiment optimitzat amb virtualitzaci√≥ i OnPush</li>
    <li>Build de producci√≥ analitzat i preparat per desplegament</li>
  </ul>

  <h4>Arquitectura t√®cnica</h4>

  <ul>
    <li>Rutes principals: Home, Cerca, Detall, Preferits, Login</li>
    <li>M√≤dul de preferits amb lazy loading</li>
    <li>Gu√†rdies de ruta per protecci√≥ d'acc√©s</li>
    <li>Servei centralitzat d'estat d'usuari</li>
    <li>Components presentacionals i contenidors</li>
  </ul>

  <h4>Tecnologies utilitzades</h4>

  <ul>
    <li>Angular (versi√≥ actual del curs)</li>
    <li>Angular Router per navegaci√≥</li>
    <li>Angular CDK per virtualitzaci√≥</li>
    <li>JSONPlaceholder com API simulada</li>
    <li>Possibilitat de desplegament a Netlify o Vercel</li>
  </ul>

</div>

<!-- SECCI√ì 1: Prerequisits -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio1">
  <h2 id="Unitat4_Bloc4_Seccio1">1. Prerequisits</h2>

  <p>Abans de comen√ßar aquest cas d'√∫s, assegureu-vos que teniu:</p>

  <h3>1.1. Entorn preparat</h3>

  {% include checklist.html elements="Angular CLI instal¬∑lat i funcional|Node.js i npm operatius|VS Code amb extensions d'Angular|Git configurat amb repositori remot" %}

  <h3>1.2. Coneixements previs</h3>

  {% include checklist.html elements="Unitat 1: Entorn de desenvolupament preparat|Unitat 2: Components, directives i formularis|Unitat 3: Serveis, HTTP i integraci√≥ amb APIs|Lectures 4.1, 4.2 i 4.3: Rutes, arquitectura i optimitzaci√≥" %}

  <h3>1.3. Verificaci√≥ inicial</h3>

  <p>Executeu les seg√ºents comandes per assegurar-vos que el vostre entorn est√† llest:</p>

{% capture code_001 %}ng version
git --version
node --version
npm --version{% endcapture %}
{% include code-block.html lang="bash" code=code_001 %}

  <p><strong>Punt d'autocomprovaci√≥:</strong> Tots els comandaments han de retornar versions sense errors.</p>

</div>

<!-- SECCI√ì 2: Visi√≥ general de l'aplicaci√≥ -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio2">
  <h2 id="Unitat4_Bloc4_Seccio2">2. Visi√≥ general de l'aplicaci√≥</h2>

  <h3>2.1. Estructura de rutes</h3>

{% capture code_002 %}/                       ‚Üí HomeComponent (llistat complet)
/search                 ‚Üí SearchComponent (cerca avan√ßada)
/item/:id               ‚Üí DetailComponent (detall amb ID)
/favorites              ‚Üí FavoritesModule (lazy loaded, protegit)
  /favorites/list       ‚Üí FavoritesListComponent
  /favorites/settings   ‚Üí FavoritesSettingsComponent
/login                  ‚Üí LoginComponent (autenticaci√≥ simulada)
/404                    ‚Üí NotFoundComponent{% endcapture %}
{% include code-block.html lang="plaintext" code=code_002 %}

  <h3>2.2. Arquitectura de components</h3>

{% capture code_003 %}AppComponent (contenidor principal)
‚îú‚îÄ‚îÄ HeaderComponent (navegaci√≥)
‚îú‚îÄ‚îÄ router-outlet (contingut din√†mic)
‚îÇ   ‚îú‚îÄ‚îÄ HomeComponent
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ItemCardComponent (presentacional)
‚îÇ   ‚îú‚îÄ‚îÄ SearchComponent
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SearchFormComponent
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ItemCardComponent
‚îÇ   ‚îú‚îÄ‚îÄ DetailComponent
‚îÇ   ‚îú‚îÄ‚îÄ FavoritesModule (lazy)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FavoritesListComponent
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FavoritesSettingsComponent
‚îÇ   ‚îî‚îÄ‚îÄ LoginComponent
‚îî‚îÄ‚îÄ FooterComponent{% endcapture %}
{% include code-block.html lang="plaintext" code=code_003 %}

  <h3>2.3. Serveis</h3>

{% capture code_004 %}CoreModule
‚îú‚îÄ‚îÄ ItemService (gesti√≥ d'elements)
‚îú‚îÄ‚îÄ AuthService (autenticaci√≥ simulada)
‚îú‚îÄ‚îÄ StateService (estat global)
‚îî‚îÄ‚îÄ FavoriteService (gesti√≥ de preferits)

SharedModule
‚îú‚îÄ‚îÄ LoaderComponent
‚îú‚îÄ‚îÄ ErrorComponent
‚îî‚îÄ‚îÄ ItemCardComponent{% endcapture %}
{% include code-block.html lang="plaintext" code=code_004 %}

</div>

<!-- SECCI√ì 3: Sistema de rutes complet -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio3">
  <h2 id="Unitat4_Bloc4_Seccio3">3. Sistema de rutes complet</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Configurar el sistema de rutes principal amb totes les vistes, crear components b√†sics per a cada ruta i implementar navegaci√≥ funcional amb men√∫ actiu.</p>
  </div>

  <h3>3.1. Crear projecte i estructura base</h3>

  <p>Creeu un nou projecte Angular amb routing habilitat i organitzeu l'estructura de carpetes:</p>

{% capture code_005 %}# Crear nou projecte Angular amb routing
ng new cataleg-universal --routing --style=css --skip-git
cd cataleg-universal

# Crear estructura de carpetes
mkdir -p src/app/core/services
mkdir -p src/app/core/guards
mkdir -p src/app/core/models
mkdir -p src/app/shared/components
mkdir -p src/app/features/home
mkdir -p src/app/features/search
mkdir -p src/app/features/detail
mkdir -p src/app/features/login

# Verificar que ng serve arrenca
ng serve{% endcapture %}
{% include code-block.html lang="bash" code=code_005 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="Projecte creat sense errors|Estructura de carpetes organitzada|Servidor arrenca a http://localhost:4200" %}

  <h3>3.2. Crear components per a cada ruta</h3>

  <p>Genereu els components necessaris per a les diferents vistes de l'aplicaci√≥:</p>

{% capture code_006 %}# Components principals
ng generate component features/home --skip-tests
ng generate component features/search --skip-tests
ng generate component features/detail --skip-tests
ng generate component features/login --skip-tests
ng generate component shared/components/header --skip-tests
ng generate component shared/components/footer --skip-tests
ng generate component shared/components/item-card --skip-tests
ng generate component shared/components/not-found --skip-tests{% endcapture %}
{% include code-block.html lang="bash" code=code_006 %}

  <p>Verifiqueu que els components s'han creat correctament:</p>

{% capture code_007 %}# Llistar components creats
ls -la src/app/features/
ls -la src/app/shared/components/{% endcapture %}
{% include code-block.html lang="bash" code=code_007 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="8 components creats correctament|Fitxers .ts, .html, .css generats per cada component|No hi ha errors de compilaci√≥" %}

  <h3>3.3. Configurar rutes principals</h3>

  <p>Configureu el sistema de rutes a l'arxiu de routing principal:</p>

  <p><strong>Fitxer:</strong> <code>src/app/app-routing.module.ts</code></p>

{% capture code_008 %}import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { HomeComponent } from './features/home/home.component';
import { SearchComponent } from './features/search/search.component';
import { DetailComponent } from './features/detail/detail.component';
import { LoginComponent } from './features/login/login.component';
import { NotFoundComponent } from './shared/components/not-found/not-found.component';

const routes: Routes = [
  { path: '', redirectTo: '/home', pathMatch: 'full' },
  { path: 'home', component: HomeComponent },
  { path: 'search', component: SearchComponent },
  { path: 'item/:id', component: DetailComponent },
  { path: 'login', component: LoginComponent },
  {
    path: 'favorites',
    loadChildren: () => import('./features/favorites/favorites.module').then(m => m.FavoritesModule)
    // Nota: crearem aquest m√≤dul m√©s endavant
  },
  { path: '404', component: NotFoundComponent },
  { path: '**', redirectTo: '/404' }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }{% endcapture %}
{% include code-block.html lang="typescript" code=code_008 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="Rutes definides correctament|Redirect a /home funciona|Ruta 404 configurada per paths no existents" %}

  <h3>3.4. Implementar navegaci√≥ al header</h3>

  <p>Creeu un component de cap√ßalera amb navegaci√≥ funcional i enlla√ßos actius:</p>

  <p><strong>Fitxer:</strong> <code>src/app/shared/components/header/header.component.html</code></p>

{% capture code_009 %}<header class="header">
  <div class="container">
    <h1 class="logo">
      <a routerLink="/home">Cat√†leg Universal</a>
    </h1>

    <nav class="nav">
      <a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-link">Inici</a>
      <a routerLink="/search" routerLinkActive="active" class="nav-link">Cerca</a>
      <a routerLink="/favorites" routerLinkActive="active" class="nav-link">Preferits</a>
      <a routerLink="/login" routerLinkActive="active" class="nav-link">Login</a>
    </nav>
  </div>
</header>{% endcapture %}
{% include code-block.html lang="html" code=code_009 %}

  <p><strong>Fitxer:</strong> <code>src/app/shared/components/header/header.component.css</code></p>

{% capture code_010 %}.header {
  background: #2196F3;
  color: white;
  padding: 1rem 0;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo a {
  color: white;
  text-decoration: none;
  font-size: 1.5rem;
  font-weight: bold;
}

.nav {
  display: flex;
  gap: 2rem;
}

.nav-link {
  color: white;
  text-decoration: none;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  transition: background-color 0.2s;
}

.nav-link:hover {
  background-color: rgba(255,255,255,0.1);
}

.nav-link.active {
  background-color: rgba(255,255,255,0.2);
  font-weight: bold;
}{% endcapture %}
{% include code-block.html lang="css" code=code_010 %}

  <p>Actualitzeu el component arrel per incloure la navegaci√≥:</p>

  <p><strong>Fitxer:</strong> <code>src/app/app.component.html</code></p>

{% capture code_011 %}<app-header></app-header>

<main class="main-content">
  <router-outlet></router-outlet>
</main>

<app-footer></app-footer>{% endcapture %}
{% include code-block.html lang="html" code=code_011 %}

  <p>Verifiqueu la navegaci√≥:</p>

{% capture code_012 %}# Arrencar aplicaci√≥
ng serve

# Provar al navegador:
# - Clicar cada enlla√ß del men√∫
# - Verificar que la ruta activa es destaca
# - Provar URL directa: http://localhost:4200/search
# - Verificar que 404 funciona: http://localhost:4200/invalid{% endcapture %}
{% include code-block.html lang="bash" code=code_012 %}

  <h3>Checkpoint</h3>

  {% include checklist.html elements="Navegaci√≥ funciona entre totes les rutes|Enlla√ß actiu es destaca visualment|Ruta 404 captura paths no existents|No hi ha errors a la consola" %}

  <h3>Resoluci√≥ de problemes</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Problema</th>
        <th>Causa probable</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Rutes no funcionen</td>
        <td>RouterModule no importat</td>
        <td>Verificar imports a app.module.ts</td>
      </tr>
      <tr>
        <td>404 no apareix</td>
        <td>Comod√≠ mal configurat</td>
        <td>Verificar que <code>**</code> est√† al final</td>
      </tr>
      <tr>
        <td>Active class no funciona</td>
        <td>routerLinkActive mal escrit</td>
        <td>Verificar sintaxi exacta</td>
      </tr>
      <tr>
        <td>Components no es veuen</td>
        <td>router-outlet absent</td>
        <td>Afegir a app.component.html</td>
      </tr>
    </tbody>
  </table>

</div>

<!-- SECCI√ì 4: Vista de detall amb par√†metres -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio4">
  <h2 id="Unitat4_Bloc4_Seccio4">4. Vista de detall amb par√†metres</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Crear vista de detall que captura ID de la URL, consulta API per obtenir dades de l'element i mostra informaci√≥ completa. Implementar navegaci√≥ des del llistat al detall passant par√†metres.</p>
  </div>

  <h3>4.1. Crear model i servei d'elements</h3>

  <p>Definiu el model de dades i creeu el servei que consultar√† l'API:</p>

  <p><strong>Fitxer:</strong> <code>src/app/core/models/item.model.ts</code></p>

{% capture code_013 %}export interface Item {
  id: number;
  title: string;
  body: string;
  userId: number;
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_013 %}

  <p><strong>Fitxer:</strong> <code>src/app/core/services/item.service.ts</code></p>

{% capture code_014 %}import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { Item } from '../models/item.model';

@Injectable({
  providedIn: 'root'
})
export class ItemService {
  private apiUrl = 'https://jsonplaceholder.typicode.com/posts';

  constructor(private http: HttpClient) {}

  getAllItems(): Observable<Item[]> {
    return this.http.get<Item[]>(this.apiUrl);
  }

  getItemById(id: number): Observable<Item> {
    return this.http.get<Item>(`${this.apiUrl}/${id}`);
  }

  searchItems(query: string, items: Item[]): Item[] {
    const lowerQuery = query.toLowerCase();
    return items.filter(item =>
      item.title.toLowerCase().includes(lowerQuery) ||
      item.body.toLowerCase().includes(lowerQuery)
    );
  }
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_014 %}

  <p>Importeu HttpClientModule al m√≤dul principal:</p>

  <p><strong>Fitxer:</strong> <code>src/app/app.module.ts</code></p>

{% capture code_015 %}import { HttpClientModule } from '@angular/common/http';

@NgModule({
  imports: [
    BrowserModule,
    AppRoutingModule,
    HttpClientModule  // ‚Üê Afegir
  ],
  // ...
})
export class AppModule { }{% endcapture %}
{% include code-block.html lang="typescript" code=code_015 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="Model Item definit amb interf√≠cie|ItemService creat amb m√®todes HTTP|HttpClientModule importat correctament" %}

  <h3>4.2. Implementar component de llistat</h3>

  <p>Desenvolupeu el component Home que mostra el llistat d'elements i permet navegar al detall:</p>

  <p><strong>Fitxer:</strong> <code>src/app/features/home/home.component.ts</code></p>

{% capture code_016 %}import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { ItemService } from '../../core/services/item.service';
import { Item } from '../../core/models/item.model';

@Component({
  selector: 'app-home',
  templateUrl: './home.component.html',
  styleUrls: ['./home.component.css']
})
export class HomeComponent implements OnInit {
  items: Item[] = [];
  loading = true;
  error = '';

  constructor(
    private itemService: ItemService,
    private router: Router
  ) {}

  ngOnInit(): void {
    this.loadItems();
  }

  loadItems(): void {
    this.loading = true;
    this.itemService.getAllItems().subscribe({
      next: (data) => {
        this.items = data;
        this.loading = false;
      },
      error: (err) => {
        this.error = 'Error carregant elements';
        this.loading = false;
        console.error(err);
      }
    });
  }

  viewDetail(id: number): void {
    this.router.navigate(['/item', id]);
  }

  trackByItemId(index: number, item: Item): number {
    return item.id;
  }
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_016 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/home/home.component.html</code></p>

{% capture code_017 %}{% raw %}<div class="container">
  <h2>Cat√†leg complet ({{ items.length }} elements)</h2>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">Carregant elements...</div>

  <!-- Error -->
  <div *ngIf="error" class="error">{{ error }}</div>

  <!-- Llistat -->
  <div *ngIf="!loading && !error" class="items-grid">
    <div *ngFor="let item of items; trackBy: trackByItemId" class="item-card" (click)="viewDetail(item.id)">
      <h3>{{ item.title }}</h3>
      <p>{{ item.body | slice:0:100 }}...</p>
      <span class="item-id">ID: {{ item.id }}</span>
    </div>
  </div>
</div>{% endraw %}{% endcapture %}
{% include code-block.html lang="html" code=code_017 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/home/home.component.css</code></p>

{% capture code_018 %}.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.loading, .error {
  text-align: center;
  padding: 3rem;
  font-size: 1.2rem;
}

.error {
  color: #f44336;
}

.items-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 2rem;
}

.item-card {
  background: white;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 1.5rem;
  cursor: pointer;
  transition: all 0.2s;
}

.item-card:hover {
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  transform: translateY(-2px);
}

.item-card h3 {
  margin: 0 0 1rem 0;
  color: #2196F3;
}

.item-card p {
  color: #666;
  line-height: 1.5;
}

.item-id {
  display: inline-block;
  background: #E3F2FD;
  color: #1976D2;
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  font-size: 0.875rem;
  margin-top: 1rem;
}{% endcapture %}
{% include code-block.html lang="css" code=code_018 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="Llistat mostra 100 elements de JSONPlaceholder|Clicar una targeta navega a /item/:id|Loading apareix mentre carrega|trackBy implementat per rendiment" %}

  <h3>4.3. Implementar component de detall</h3>

  <p>Creeu el component de detall que captura l'ID de la ruta i mostra la informaci√≥ completa:</p>

  <p><strong>Fitxer:</strong> <code>src/app/features/detail/detail.component.ts</code></p>

{% capture code_019 %}import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { ItemService } from '../../core/services/item.service';
import { Item } from '../../core/models/item.model';

@Component({
  selector: 'app-detail',
  templateUrl: './detail.component.html',
  styleUrls: ['./detail.component.css']
})
export class DetailComponent implements OnInit {
  item: Item | null = null;
  loading = true;
  error = '';
  itemId: number = 0;

  constructor(
    private route: ActivatedRoute,
    private router: Router,
    private itemService: ItemService
  ) {}

  ngOnInit(): void {
    // Capturar par√†metre ID de la ruta
    this.route.params.subscribe(params => {
      this.itemId = +params['id'];  // Convertir a number
      this.loadItem(this.itemId);
    });
  }

  loadItem(id: number): void {
    this.loading = true;
    this.itemService.getItemById(id).subscribe({
      next: (data) => {
        this.item = data;
        this.loading = false;
      },
      error: (err) => {
        this.error = 'Element no trobat';
        this.loading = false;
        console.error(err);
      }
    });
  }

  goBack(): void {
    this.router.navigate(['/home']);
  }

  goToNext(): void {
    const nextId = this.itemId + 1;
    this.router.navigate(['/item', nextId]);
  }

  goToPrevious(): void {
    if (this.itemId > 1) {
      const prevId = this.itemId - 1;
      this.router.navigate(['/item', prevId]);
    }
  }
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_019 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/detail/detail.component.html</code></p>

{% capture code_020 %}{% raw %}<div class="container">
  <!-- Loading -->
  <div *ngIf="loading" class="loading">Carregant detall...</div>

  <!-- Error -->
  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button (click)="goBack()" class="btn-primary">Tornar al llistat</button>
  </div>

  <!-- Detall -->
  <div *ngIf="item && !loading" class="detail">
    <div class="detail-header">
      <button (click)="goBack()" class="btn-back">‚Üê Tornar</button>
      <span class="item-badge">ID: {{ item.id }}</span>
    </div>

    <h1>{{ item.title }}</h1>

    <div class="detail-meta">
      <span>Usuari ID: {{ item.userId }}</span>
      <span>Element: {{ item.id }} / 100</span>
    </div>

    <div class="detail-content">
      <h3>Descripci√≥ completa</h3>
      <p>{{ item.body }}</p>
    </div>

    <div class="detail-actions">
      <button (click)="goToPrevious()" [disabled]="itemId <= 1" class="btn-secondary">‚Üê Anterior</button>
      <button (click)="goToNext()" [disabled]="itemId >= 100" class="btn-secondary">Seg√ºent ‚Üí</button>
    </div>
  </div>
</div>{% endraw %}{% endcapture %}
{% include code-block.html lang="html" code=code_020 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/detail/detail.component.css</code></p>

{% capture code_021 %}.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.loading, .error {
  text-align: center;
  padding: 3rem;
}

.detail {
  background: white;
  border-radius: 8px;
  padding: 2rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.detail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.btn-back {
  padding: 0.5rem 1rem;
  background: #e0e0e0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
}

.btn-back:hover {
  background: #d0d0d0;
}

.item-badge {
  background: #E3F2FD;
  color: #1976D2;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-weight: bold;
}

.detail h1 {
  color: #2196F3;
  margin: 0 0 1rem 0;
}

.detail-meta {
  display: flex;
  gap: 2rem;
  color: #666;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #e0e0e0;
}

.detail-content {
  margin: 2rem 0;
}

.detail-content h3 {
  color: #333;
  margin-bottom: 1rem;
}

.detail-content p {
  line-height: 1.8;
  color: #555;
}

.detail-actions {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin-top: 3rem;
}

.btn-secondary {
  padding: 0.75rem 2rem;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
}

.btn-secondary:hover:not(:disabled) {
  background: #1976D2;
}

.btn-secondary:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.btn-primary {
  padding: 0.75rem 2rem;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
}

.btn-primary:hover {
  background: #45a049;
}{% endcapture %}
{% include code-block.html lang="css" code=code_021 %}

  <p>Verifiqueu la funcionalitat completa:</p>

{% capture code_022 %}# 1. Navegar a Home
http://localhost:4200/home

# 2. Clicar qualsevol element
# Hauria de navegar a /item/:id

# 3. Verificar que mostra detall correcte
# 4. Provar botons Anterior/Seg√ºent
# 5. Provar bot√≥ Tornar
# 6. Provar URL directa: http://localhost:4200/item/25{% endcapture %}
{% include code-block.html lang="bash" code=code_022 %}

  <h3>Checkpoint</h3>

  {% include checklist.html elements="Llistat mostra tots els elements de l'API|Clicar element navega a detall amb ID correcte|Component de detall captura par√†metre de ruta|Detall mostra informaci√≥ completa de l'element|Navegaci√≥ Anterior/Seg√ºent funciona|Bot√≥ Tornar retorna al llistat" %}

  <h3>Resoluci√≥ de problemes</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Problema</th>
        <th>Causa probable</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>ID no es captura</td>
        <td>ActivatedRoute no usat</td>
        <td>Importar i injectar ActivatedRoute</td>
      </tr>
      <tr>
        <td>API no respon</td>
        <td>HttpClientModule no importat</td>
        <td>Afegir a app.module.ts</td>
      </tr>
      <tr>
        <td>Navegaci√≥ no funciona</td>
        <td>Router no injectat</td>
        <td>Injectar Router al constructor</td>
      </tr>
      <tr>
        <td>+params['id'] √©s NaN</td>
        <td>Par√†metre mal capturat</td>
        <td>Verificar sintaxi route.params</td>
      </tr>
    </tbody>
  </table>

</div>

<!-- SECCI√ì 5: Gu√†rdies i gesti√≥ d'estat -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio5">
  <h2 id="Unitat4_Bloc4_Seccio5">5. Gu√†rdies i gesti√≥ d'estat</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Crear servei d'autenticaci√≥ simulada amb estat global, implementar gu√†rdia de ruta per protegir seccions privades, i configurar redireccions quan l'acc√©s √©s denegat.</p>
  </div>

  <h3>5.1. Crear servei d'autenticaci√≥</h3>

  <p>Definiu el model d'usuari i creeu el servei que gestionar√† l'estat d'autenticaci√≥:</p>

  <p><strong>Fitxer:</strong> <code>src/app/core/models/user.model.ts</code></p>

{% capture code_023 %}export interface User {
  id: number;
  username: string;
  email: string;
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_023 %}

  <p><strong>Fitxer:</strong> <code>src/app/core/services/auth.service.ts</code></p>

{% capture code_024 %}import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';
import { User } from '../models/user.model';

@Injectable({
  providedIn: 'root'
})
export class AuthService {
  private currentUserSubject: BehaviorSubject<User | null>;
  public currentUser: Observable<User | null>;

  constructor() {
    // Recuperar usuari de localStorage si existeix
    const storedUser = localStorage.getItem('currentUser');
    this.currentUserSubject = new BehaviorSubject<User | null>(
      storedUser ? JSON.parse(storedUser) : null
    );
    this.currentUser = this.currentUserSubject.asObservable();
  }

  public get currentUserValue(): User | null {
    return this.currentUserSubject.value;
  }

  login(username: string, password: string): Observable<boolean> {
    return new Observable(observer => {
      // Simulaci√≥ d'autenticaci√≥
      setTimeout(() => {
        if (username && password.length >= 4) {
          const user: User = {
            id: 1,
            username: username,
            email: `${username}@example.com`
          };

          localStorage.setItem('currentUser', JSON.stringify(user));
          this.currentUserSubject.next(user);
          observer.next(true);
          observer.complete();
        } else {
          observer.next(false);
          observer.complete();
        }
      }, 1000);  // Simula lat√®ncia de xarxa
    });
  }

  logout(): void {
    localStorage.removeItem('currentUser');
    this.currentUserSubject.next(null);
  }

  isAuthenticated(): boolean {
    return this.currentUserValue !== null;
  }
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_024 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="AuthService creat amb estat reactiu|Login simulat amb validaci√≥ b√†sica|Logout neteja estat correctament|isAuthenticated retorna estat correcte" %}

  <h3>5.2. Implementar component de login</h3>

  <p>Creeu el component que permetr√† als usuaris autenticar-se:</p>

  <p><strong>Fitxer:</strong> <code>src/app/features/login/login.component.ts</code></p>

{% capture code_025 %}import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { AuthService } from '../../core/services/auth.service';

@Component({
  selector: 'app-login',
  templateUrl: './login.component.html',
  styleUrls: ['./login.component.css']
})
export class LoginComponent {
  username = '';
  password = '';
  loading = false;
  error = '';

  constructor(
    private authService: AuthService,
    private router: Router
  ) {
    // Si ja est√† autenticat, redirigir a home
    if (this.authService.isAuthenticated()) {
      this.router.navigate(['/home']);
    }
  }

  onSubmit(): void {
    this.error = '';

    if (!this.username || !this.password) {
      this.error = 'Usuari i contrasenya s√≥n obligatoris';
      return;
    }

    if (this.password.length < 4) {
      this.error = 'La contrasenya ha de tenir almenys 4 car√†cters';
      return;
    }

    this.loading = true;

    this.authService.login(this.username, this.password).subscribe({
      next: (success) => {
        this.loading = false;
        if (success) {
          this.router.navigate(['/favorites']);
        } else {
          this.error = 'Credencials incorrectes';
        }
      },
      error: (err) => {
        this.loading = false;
        this.error = 'Error durant el login';
        console.error(err);
      }
    });
  }
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_025 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/login/login.component.html</code></p>

{% capture code_026 %}{% raw %}<div class="container">
  <div class="login-box">
    <h2>Iniciar sessi√≥</h2>
    <p class="subtitle">Accedeix a la teva zona de preferits</p>

    <form (ngSubmit)="onSubmit()" class="login-form">
      <!-- Usuari -->
      <div class="form-group">
        <label for="username">Usuari:</label>
        <input type="text" id="username" [(ngModel)]="username" name="username" placeholder="Introdueix el teu usuari" [disabled]="loading" class="form-input">
      </div>

      <!-- Contrasenya -->
      <div class="form-group">
        <label for="password">Contrasenya:</label>
        <input type="password" id="password" [(ngModel)]="password" name="password" placeholder="M√≠nim 4 car√†cters" [disabled]="loading" class="form-input">
      </div>

      <!-- Error -->
      <div *ngIf="error" class="error-message">{{ error }}</div>

      <!-- Submit -->
      <button type="submit" [disabled]="loading" class="btn-login">
        <span *ngIf="!loading">Entrar</span>
        <span *ngIf="loading">Autenticant...</span>
      </button>
    </form>

    <div class="hint">
      <strong>Hint:</strong> Qualsevol usuari i contrasenya ‚â•4 car√†cters funciona
    </div>
  </div>
</div>{% endraw %}{% endcapture %}
{% include code-block.html lang="html" code=code_026 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/login/login.component.css</code></p>

{% capture code_027 %}.container {
  max-width: 400px;
  margin: 4rem auto;
  padding: 2rem;
}

.login-box {
  background: white;
  border-radius: 8px;
  padding: 2rem;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.login-box h2 {
  margin: 0 0 0.5rem 0;
  color: #2196F3;
  text-align: center;
}

.subtitle {
  text-align: center;
  color: #666;
  margin-bottom: 2rem;
}

.login-form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.form-group label {
  font-weight: 500;
  color: #333;
}

.form-input {
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 1rem;
}

.form-input:focus {
  outline: none;
  border-color: #2196F3;
}

.form-input:disabled {
  background: #f5f5f5;
  cursor: not-allowed;
}

.error-message {
  background: #ffebee;
  color: #c62828;
  padding: 0.75rem;
  border-radius: 4px;
  border-left: 4px solid #c62828;
}

.btn-login {
  padding: 1rem;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-login:hover:not(:disabled) {
  background: #1976D2;
}

.btn-login:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.hint {
  margin-top: 2rem;
  padding: 1rem;
  background: #E3F2FD;
  border-radius: 4px;
  font-size: 0.875rem;
  text-align: center;
}{% endcapture %}
{% include code-block.html lang="css" code=code_027 %}

  <p>Importeu FormsModule al m√≤dul principal:</p>

  <p><strong>Fitxer:</strong> <code>src/app/app.module.ts</code></p>

{% capture code_028 %}import { FormsModule } from '@angular/forms';

@NgModule({
  imports: [
    // ...
    FormsModule  // ‚Üê Afegir per ngModel
  ],
  // ...
})
export class AppModule { }{% endcapture %}
{% include code-block.html lang="typescript" code=code_028 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="Login mostra formulari correctament|Validacions funcionen (usuari i contrasenya)|Login simulat funciona amb credencials v√†lides|Redirigeix a /favorites despr√©s de login" %}

  <h3>5.3. Crear gu√†rdia d'autenticaci√≥</h3>

  <p>Genereu i implementeu la gu√†rdia que protegir√† les rutes privades:</p>

{% capture code_029 %}# Generar gu√†rdia
ng generate guard core/guards/auth --skip-tests{% endcapture %}
{% include code-block.html lang="bash" code=code_029 %}

  <p><strong>Fitxer:</strong> <code>src/app/core/guards/auth.guard.ts</code></p>

{% capture code_030 %}import { Injectable } from '@angular/core';
import { Router, CanActivate, ActivatedRouteSnapshot, RouterStateSnapshot } from '@angular/router';
import { AuthService } from '../services/auth.service';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {

  constructor(
    private router: Router,
    private authService: AuthService
  ) {}

  canActivate(
    route: ActivatedRouteSnapshot,
    state: RouterStateSnapshot
  ): boolean {
    const currentUser = this.authService.currentUserValue;

    if (currentUser) {
      // Usuari autenticat, permetre acc√©s
      return true;
    }

    // No autenticat, redirigir a login
    this.router.navigate(['/login'], {
      queryParams: { returnUrl: state.url }
    });
    return false;
  }
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_030 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="AuthGuard creat correctament|Verifica estat d'autenticaci√≥|Redirigeix a /login si no autenticat|Guarda returnUrl per tornar despr√©s" %}

  <h3>5.4. Actualitzar header amb estat d'usuari</h3>

  <p>Modifiqueu el component de cap√ßalera per mostrar l'estat d'autenticaci√≥:</p>

  <p><strong>Fitxer:</strong> <code>src/app/shared/components/header/header.component.ts</code></p>

{% capture code_031 %}import { Component, OnInit } from '@angular/core';
import { Router } from '@angular/router';
import { AuthService } from '../../../core/services/auth.service';
import { User } from '../../../core/models/user.model';

@Component({
  selector: 'app-header',
  templateUrl: './header.component.html',
  styleUrls: ['./header.component.css']
})
export class HeaderComponent implements OnInit {
  currentUser: User | null = null;

  constructor(
    private authService: AuthService,
    private router: Router
  ) {}

  ngOnInit(): void {
    this.authService.currentUser.subscribe(user => {
      this.currentUser = user;
    });
  }

  logout(): void {
    this.authService.logout();
    this.router.navigate(['/login']);
  }
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_031 %}

  <p>Actualitzeu el template del header:</p>

  <p><strong>Fitxer:</strong> <code>src/app/shared/components/header/header.component.html</code></p>

{% capture code_032 %}{% raw %}<header class="header">
  <div class="container">
    <h1 class="logo">
      <a routerLink="/home">Cat√†leg Universal</a>
    </h1>

    <nav class="nav">
      <a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-link">Inici</a>
      <a routerLink="/search" routerLinkActive="active" class="nav-link">Cerca</a>
      <a routerLink="/favorites" routerLinkActive="active" class="nav-link">Preferits</a>

      <!-- Mostra Login si NO est√† autenticat -->
      <a *ngIf="!currentUser" routerLink="/login" routerLinkActive="active" class="nav-link">Login</a>

      <!-- Mostra usuari i Logout si est√† autenticat -->
      <div *ngIf="currentUser" class="user-menu">
        <span class="username">{{ currentUser.username }}</span>
        <button (click)="logout()" class="btn-logout">Sortir</button>
      </div>
    </nav>
  </div>
</header>{% endraw %}{% endcapture %}
{% include code-block.html lang="html" code=code_032 %}

  <p>Afegiu els estils per al men√∫ d'usuari:</p>

  <p><strong>Fitxer:</strong> <code>src/app/shared/components/header/header.component.css</code></p>

{% capture code_033 %}/* ... estils anteriors ... */

.user-menu {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.username {
  color: white;
  font-weight: 500;
}

.btn-logout {
  padding: 0.5rem 1rem;
  background: rgba(255,255,255,0.2);
  color: white;
  border: 1px solid white;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-logout:hover {
  background: rgba(255,255,255,0.3);
}{% endcapture %}
{% include code-block.html lang="css" code=code_033 %}

  <h3>Checkpoint</h3>

  {% include checklist.html elements="AuthService gestiona estat d'autenticaci√≥|Login funciona amb credencials simulades|Header mostra nom d'usuari quan est√† autenticat|Bot√≥ Logout funciona correctament|AuthGuard protegeix rutes (aplicarem al seg√ºent bloc)" %}

  <h3>Resoluci√≥ de problemes</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Problema</th>
        <th>Causa probable</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>ngModel no funciona</td>
        <td>FormsModule no importat</td>
        <td>Afegir a app.module.ts</td>
      </tr>
      <tr>
        <td>currentUser sempre null</td>
        <td>BehaviorSubject mal inicialitzat</td>
        <td>Verificar constructor AuthService</td>
      </tr>
      <tr>
        <td>Logout no actualitza UI</td>
        <td>No subscrit a currentUser</td>
        <td>Subscribir al header.component</td>
      </tr>
      <tr>
        <td>Gu√†rdia no redirigeix</td>
        <td>Router no injectat</td>
        <td>Injectar Router a constructor</td>
      </tr>
    </tbody>
  </table>

</div>

<!-- SECCI√ì 6: Modularitzaci√≥ i lazy loading -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio6">
  <h2 id="Unitat4_Bloc4_Seccio6">6. Modularitzaci√≥ i lazy loading</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Crear m√≤dul de preferits amb components i rutes pr√≤pies, configurar lazy loading per carregar-lo nom√©s quan s'accedeix, i protegir-lo amb la gu√†rdia d'autenticaci√≥.</p>
  </div>

  <h3>6.1. Crear m√≤dul de preferits</h3>

  <p>Genereu un m√≤dul funcional amb el seu propi sistema de rutes:</p>

{% capture code_034 %}# Generar m√≤dul amb routing
ng generate module features/favorites --routing{% endcapture %}
{% include code-block.html lang="bash" code=code_034 %}

  <p>Creeu els components del m√≤dul:</p>

{% capture code_035 %}ng generate component features/favorites/favorites-list --skip-tests
ng generate component features/favorites/favorites-settings --skip-tests{% endcapture %}
{% include code-block.html lang="bash" code=code_035 %}

  <p>Configureu les rutes internes del m√≤dul:</p>

  <p><strong>Fitxer:</strong> <code>src/app/features/favorites/favorites-routing.module.ts</code></p>

{% capture code_036 %}import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { FavoritesListComponent } from './favorites-list/favorites-list.component';
import { FavoritesSettingsComponent } from './favorites-settings/favorites-settings.component';

const routes: Routes = [
  { path: '', redirectTo: 'list', pathMatch: 'full' },
  { path: 'list', component: FavoritesListComponent },
  { path: 'settings', component: FavoritesSettingsComponent }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class FavoritesRoutingModule { }{% endcapture %}
{% include code-block.html lang="typescript" code=code_036 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/favorites/favorites.module.ts</code></p>

{% capture code_037 %}import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FavoritesRoutingModule } from './favorites-routing.module';
import { FavoritesListComponent } from './favorites-list/favorites-list.component';
import { FavoritesSettingsComponent } from './favorites-settings/favorites-settings.component';

@NgModule({
  declarations: [
    FavoritesListComponent,
    FavoritesSettingsComponent
  ],
  imports: [
    CommonModule,
    FavoritesRoutingModule
  ]
})
export class FavoritesModule { }{% endcapture %}
{% include code-block.html lang="typescript" code=code_037 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="FavoritesModule creat amb routing propi|Components del m√≤dul generats|Rutes internes configurades (list, settings)" %}

  <h3>6.2. Implementar components de preferits</h3>

  <p>Desenvolupeu els components del m√≤dul de preferits:</p>

  <p><strong>Fitxer:</strong> <code>src/app/features/favorites/favorites-list/favorites-list.component.html</code></p>

{% capture code_038 %}{% raw %}<div class="favorites-container">
  <div class="favorites-header">
    <h2>Els meus preferits</h2>
    <a routerLink="/favorites/settings" class="btn-settings">‚öôÔ∏è Configuraci√≥</a>
  </div>

  <div class="favorites-content">
    <div class="welcome-message">
      <h3>Zona de preferits</h3>
      <p>Aquesta √©s una zona protegida que nom√©s els usuaris autenticats poden veure.</p>
      <p>Aqu√≠ podr√≠eu gestionar els vostres elements favorits, crear llistes personalitzades, etc.</p>
    </div>

    <div class="feature-list">
      <div class="feature-card">
        <h4>üìå Guardar preferits</h4>
        <p>Marca els elements que m√©s t'agradin per trobar-los f√†cilment</p>
      </div>
      <div class="feature-card">
        <h4>üìù Crear llistes</h4>
        <p>Organitza els teus preferits en col¬∑leccions tem√†tiques</p>
      </div>
      <div class="feature-card">
        <h4>üîî Notificacions</h4>
        <p>Rep alertes quan hi hagi novetats als teus preferits</p>
      </div>
    </div>
  </div>
</div>{% endraw %}{% endcapture %}
{% include code-block.html lang="html" code=code_038 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/favorites/favorites-list/favorites-list.component.css</code></p>

{% capture code_039 %}.favorites-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.favorites-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid #e0e0e0;
}

.favorites-header h2 {
  margin: 0;
  color: #2196F3;
}

.btn-settings {
  padding: 0.5rem 1rem;
  background: #4CAF50;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  transition: background 0.2s;
}

.btn-settings:hover {
  background: #45a049;
}

.favorites-content {
  background: white;
  border-radius: 8px;
  padding: 2rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.welcome-message {
  background: #E3F2FD;
  padding: 2rem;
  border-radius: 8px;
  margin-bottom: 2rem;
  text-align: center;
}

.welcome-message h3 {
  color: #1976D2;
  margin: 0 0 1rem 0;
}

.welcome-message p {
  margin: 0.5rem 0;
  color: #555;
}

.feature-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
}

.feature-card {
  padding: 1.5rem;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  transition: all 0.2s;
}

.feature-card:hover {
  border-color: #2196F3;
  box-shadow: 0 4px 8px rgba(33, 150, 243, 0.2);
}

.feature-card h4 {
  margin: 0 0 1rem 0;
  color: #333;
}

.feature-card p {
  margin: 0;
  color: #666;
  line-height: 1.5;
}{% endcapture %}
{% include code-block.html lang="css" code=code_039 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/favorites/favorites-settings/favorites-settings.component.html</code></p>

{% capture code_040 %}{% raw %}<div class="settings-container">
  <div class="settings-header">
    <h2>Configuraci√≥ de preferits</h2>
    <a routerLink="/favorites/list" class="btn-back">‚Üê Tornar a preferits</a>
  </div>

  <div class="settings-content">
    <div class="settings-section">
      <h3>Opcions de visualitzaci√≥</h3>
      <label class="checkbox-label">
        <input type="checkbox" checked>
        Mostrar imatges als preferits
      </label>
      <label class="checkbox-label">
        <input type="checkbox" checked>
        Ordenar per data d'addici√≥
      </label>
    </div>

    <div class="settings-section">
      <h3>Notificacions</h3>
      <label class="checkbox-label">
        <input type="checkbox">
        Alertes de nous elements similars
      </label>
      <label class="checkbox-label">
        <input type="checkbox">
        Resum setmanal per correu
      </label>
    </div>

    <div class="settings-actions">
      <button class="btn-save">Guardar canvis</button>
      <button class="btn-cancel">Cancel¬∑lar</button>
    </div>
  </div>
</div>{% endraw %}{% endcapture %}
{% include code-block.html lang="html" code=code_040 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/favorites/favorites-settings/favorites-settings.component.css</code></p>

{% capture code_041 %}.settings-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.settings-header h2 {
  margin: 0;
  color: #2196F3;
}

.btn-back {
  padding: 0.5rem 1rem;
  background: #e0e0e0;
  color: #333;
  text-decoration: none;
  border-radius: 4px;
}

.btn-back:hover {
  background: #d0d0d0;
}

.settings-content {
  background: white;
  border-radius: 8px;
  padding: 2rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.settings-section {
  margin-bottom: 2rem;
  padding-bottom: 2rem;
  border-bottom: 1px solid #e0e0e0;
}

.settings-section:last-of-type {
  border-bottom: none;
}

.settings-section h3 {
  margin: 0 0 1rem 0;
  color: #333;
}

.checkbox-label {
  display: block;
  margin: 1rem 0;
  cursor: pointer;
  user-select: none;
}

.checkbox-label input {
  margin-right: 0.5rem;
}

.settings-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  margin-top: 2rem;
}

.btn-save, .btn-cancel {
  padding: 0.75rem 2rem;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  cursor: pointer;
}

.btn-save {
  background: #4CAF50;
  color: white;
}

.btn-save:hover {
  background: #45a049;
}

.btn-cancel {
  background: #e0e0e0;
  color: #333;
}

.btn-cancel:hover {
  background: #d0d0d0;
}{% endcapture %}
{% include code-block.html lang="css" code=code_041 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="Components de preferits implementats|Navegaci√≥ interna funciona (list ‚Üî settings)|UI mostra zona protegida correctament" %}

  <h3>6.3. Configurar lazy loading i protecci√≥</h3>

  <p>Actualitzeu el m√≤dul de rutes principal per activar lazy loading i protecci√≥ amb gu√†rdia:</p>

  <p><strong>Fitxer:</strong> <code>src/app/app-routing.module.ts</code></p>

{% capture code_042 %}import { AuthGuard } from './core/guards/auth.guard';

const routes: Routes = [
  { path: '', redirectTo: '/home', pathMatch: 'full' },
  { path: 'home', component: HomeComponent },
  { path: 'search', component: SearchComponent },
  { path: 'item/:id', component: DetailComponent },
  { path: 'login', component: LoginComponent },
  {
    path: 'favorites',
    loadChildren: () => import('./features/favorites/favorites.module')
      .then(m => m.FavoritesModule),
    canActivate: [AuthGuard]  // ‚Üê Protegir amb gu√†rdia
  },
  { path: '404', component: NotFoundComponent },
  { path: '**', redirectTo: '/404' }
];{% endcapture %}
{% include code-block.html lang="typescript" code=code_042 %}

  <p>Verifiqueu que el lazy loading funciona correctament:</p>

{% capture code_043 %}# 1. Compilar amb stats
ng build --configuration production --stats-json

# 2. Verificar que crea chunk separat
ls -lh dist/cataleg-universal/browser/

# Haur√≠eu de veure:
# - main.*.js
# - features-favorites-favorites-module.*.js  ‚Üê Chunk separat!{% endcapture %}
{% include code-block.html lang="bash" code=code_043 %}

  <p>Proveu el flux complet d'autenticaci√≥ i acc√©s:</p>

{% capture code_044 %}1. Navegar sense login ‚Üí /favorites
   ‚Üí Hauria de redirigir a /login

2. Fer login amb credencials
   ‚Üí Hauria de redirigir a /favorites/list

3. Navegar a /favorites/settings
   ‚Üí Hauria de funcionar (ja autenticat)

4. Fer logout
   ‚Üí Tornar a intentar /favorites
   ‚Üí Hauria de redirigir a /login novament{% endcapture %}
{% include code-block.html lang="plaintext" code=code_044 %}

  <h3>Checkpoint</h3>

  {% include checklist.html elements="FavoritesModule crea chunk separat (lazy loading)|AuthGuard protegeix totes les rutes de /favorites|Login correcte dona acc√©s a preferits|Logout revoca acc√©s correctament|returnUrl funciona despr√©s del login" %}

  <h3>Resoluci√≥ de problemes</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Problema</th>
        <th>Causa probable</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Lazy loading no funciona</td>
        <td>loadChildren mal configurat</td>
        <td>Verificar sintaxi import()</td>
      </tr>
      <tr>
        <td>Chunk no es crea</td>
        <td>Build no optimitzat</td>
        <td>Usar --configuration production</td>
      </tr>
      <tr>
        <td>Gu√†rdia no aplica</td>
        <td>canActivate absent</td>
        <td>Afegir a ruta de favorites</td>
      </tr>
      <tr>
        <td>Redirecci√≥ infinita</td>
        <td>L√≤gica de gu√†rdia incorrecta</td>
        <td>Verificar condici√≥ isAuthenticated</td>
      </tr>
    </tbody>
  </table>

</div>

<!-- SECCI√ì 7: Optimitzacions de rendiment -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio7">
  <h2 id="Unitat4_Bloc4_Seccio7">7. Optimitzacions de rendiment</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Aplicar estrat√®gia OnPush per minimitzar detecci√≥ de canvis, implementar virtualitzaci√≥ per llistes grans amb Angular CDK, i mesurar impacte de les optimitzacions.</p>
  </div>

  <h3>7.1. Implementar estrat√®gia OnPush</h3>

  <p>Apliqueu la detecci√≥ de canvis OnPush al component de llistat per millorar el rendiment:</p>

  <p><strong>Fitxer:</strong> <code>src/app/features/home/home.component.ts</code></p>

{% capture code_045 %}import { Component, OnInit, ChangeDetectionStrategy } from '@angular/core';
// ... altres imports ...

@Component({
  selector: 'app-home',
  templateUrl: './home.component.html',
  styleUrls: ['./home.component.css'],
  changeDetection: ChangeDetectionStrategy.OnPush  // ‚Üê Afegir OnPush
})
export class HomeComponent implements OnInit {
  // ... codi existent ...
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_045 %}

  <p>Creeu component presentacional amb OnPush per les targetes:</p>

  <p><strong>Fitxer:</strong> <code>src/app/shared/components/item-card/item-card.component.ts</code></p>

{% capture code_046 %}import { Component, Input, Output, EventEmitter, ChangeDetectionStrategy } from '@angular/core';
import { Item } from '../../../core/models/item.model';

@Component({
  selector: 'app-item-card',
  templateUrl: './item-card.component.html',
  styleUrls: ['./item-card.component.css'],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class ItemCardComponent {
  @Input() item!: Item;
  @Output() cardClick = new EventEmitter<number>();

  onCardClick(): void {
    this.cardClick.emit(this.item.id);
  }
}{% endcapture %}
{% include code-block.html lang="typescript" code=code_046 %}

  <p><strong>Fitxer:</strong> <code>src/app/shared/components/item-card/item-card.component.html</code></p>

{% capture code_047 %}{% raw %}<div class="item-card" (click)="onCardClick()">
  <h3>{{ item.title }}</h3>
  <p>{{ item.body }}</p>
  <span class="item-id">ID: {{ item.id }}</span>
</div>{% endraw %}{% endcapture %}
{% include code-block.html lang="html" code=code_047 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="OnPush aplicat a components contenidors|Components presentacionals amb @Input i @Output|Immutabilitat respectada (no mutacions directes)" %}

  <h3>7.2. Implementar scroll virtual amb CDK</h3>

  <p>Instal¬∑leu Angular CDK per virtualitzaci√≥ de llistes:</p>

{% capture code_048 %}# Instal¬∑lar Angular CDK
npm install @angular/cdk{% endcapture %}
{% include code-block.html lang="bash" code=code_048 %}

  <p>Importeu el m√≤dul de scrolling:</p>

  <p><strong>Fitxer:</strong> <code>src/app/app.module.ts</code></p>

{% capture code_049 %}import { ScrollingModule } from '@angular/cdk/scrolling';

@NgModule({
  imports: [
    // ... altres imports ...
    ScrollingModule  // ‚Üê Afegir
  ],
  // ...
})
export class AppModule { }{% endcapture %}
{% include code-block.html lang="typescript" code=code_049 %}

  <p>Actualitzeu el component Home per usar scroll virtual:</p>

  <p><strong>Fitxer:</strong> <code>src/app/features/home/home.component.html</code></p>

{% capture code_050 %}{% raw %}<div class="container">
  <h2>Cat√†leg complet ({{ items.length }} elements)</h2>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">Carregant elements...</div>

  <!-- Error -->
  <div *ngIf="error" class="error">{{ error }}</div>

  <!-- Llistat amb scroll virtual -->
  <cdk-virtual-scroll-viewport *ngIf="!loading && !error" itemSize="200" class="viewport">
    <div *cdkVirtualFor="let item of items; trackBy: trackByItemId" class="item-wrapper">
      <app-item-card [item]="item" (cardClick)="viewDetail($event)"></app-item-card>
    </div>
  </cdk-virtual-scroll-viewport>
</div>{% endraw %}{% endcapture %}
{% include code-block.html lang="html" code=code_050 %}

  <p><strong>Fitxer:</strong> <code>src/app/features/home/home.component.css</code></p>

{% capture code_051 %}/* ... estils anteriors ... */

.viewport {
  height: 80vh;
  width: 100%;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
}

.item-wrapper {
  padding: 1rem;
  border-bottom: 1px solid #f0f0f0;
}{% endcapture %}
{% include code-block.html lang="css" code=code_051 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="Angular CDK instal¬∑lat correctament|ScrollingModule importat|cdk-virtual-scroll-viewport funciona|Nom√©s elements visibles es renderitzen" %}

  <h3>7.3. Mesurar rendiment</h3>

  <p>Utilitzeu les eines de desenvolupament del navegador per mesurar l'impacte de les optimitzacions:</p>

{% capture code_052 %}# 1. Obrir Chrome DevTools
# 2. Anar a Performance tab
# 3. Gravar mentre navegues:
#    - Scroll per la llista
#    - Navegar entre rutes
#    - Interactuar amb elements

# 4. Analitzar m√®triques:
#    - Scripting time (hauria de ser menor amb OnPush)
#    - Rendering time (hauria de ser menor amb virtualitzaci√≥)
#    - FPS (hauria de ser m√©s constant)

# 5. Comparar abans/despr√©s d'OnPush{% endcapture %}
{% include code-block.html lang="plaintext" code=code_052 %}

  <p>Proveu amb el Lighthouse integrat:</p>

{% capture code_053 %}# 1. Obrir Chrome DevTools
# 2. Anar a Lighthouse tab
# 3. Seleccionar:
#    - Performance
#    - Desktop
# 4. Generate report

# Buscar millores a:
# - First Contentful Paint (FCP)
# - Time to Interactive (TTI)
# - Total Blocking Time (TBT){% endcapture %}
{% include code-block.html lang="plaintext" code=code_053 %}

  <h3>Checkpoint</h3>

  {% include checklist.html elements="OnPush redueix cicles de detecci√≥ de canvis|Virtualitzaci√≥ millora scroll amb 100 elements|Lighthouse mostra millores de rendiment|FPS m√©s constant durant scroll|Bundle size redu√Øt amb lazy loading" %}

  <h3>Comparativa de rendiment</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>M√®trica</th>
        <th>Abans</th>
        <th>Despr√©s</th>
        <th>Millora</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>FCP (First Contentful Paint)</td>
        <td>~1.5s</td>
        <td>~0.8s</td>
        <td>47% m√©s r√†pid</td>
      </tr>
      <tr>
        <td>Bundle inicial</td>
        <td>~500KB</td>
        <td>~350KB</td>
        <td>30% m√©s petit</td>
      </tr>
      <tr>
        <td>Nodes DOM renderitzats (scroll)</td>
        <td>100</td>
        <td>~10-15</td>
        <td>85% menys</td>
      </tr>
      <tr>
        <td>FPS durant scroll</td>
        <td>30-40 FPS</td>
        <td>55-60 FPS</td>
        <td>50% millor</td>
      </tr>
    </tbody>
  </table>

  <h3>Resoluci√≥ de problemes</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Problema</th>
        <th>Causa probable</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>OnPush no actualitza UI</td>
        <td>Mutaci√≥ directa d'arrays</td>
        <td>Usar spread o immutabilitat</td>
      </tr>
      <tr>
        <td>CDK viewport no funciona</td>
        <td>ScrollingModule no importat</td>
        <td>Afegir a imports del m√≤dul</td>
      </tr>
      <tr>
        <td>Scroll irregular</td>
        <td>itemSize incorrecte</td>
        <td>Ajustar a al√ßada real dels items</td>
      </tr>
      <tr>
        <td>trackBy no funciona</td>
        <td>Funci√≥ retorna undefined</td>
        <td>Verificar que retorna item.id</td>
      </tr>
    </tbody>
  </table>

</div>

<!-- SECCI√ì 8: Verificaci√≥ i build de producci√≥ -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio8">
  <h2 id="Unitat4_Bloc4_Seccio8">8. Verificaci√≥ i build de producci√≥</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Compilar l'aplicaci√≥ per producci√≥, analitzar la mida dels bundles, verificar que totes les funcionalitats operen correctament i preparar l'aplicaci√≥ per desplegament.</p>
  </div>

  <h3>8.1. Build de producci√≥</h3>

  <p>Compileu l'aplicaci√≥ amb optimitzacions de producci√≥:</p>

{% capture code_054 %}# Build de producci√≥ amb stats
ng build --configuration production --stats-json

# Verificar sortida
ls -lh dist/cataleg-universal/browser/{% endcapture %}
{% include code-block.html lang="bash" code=code_054 %}

  <p>Analitzeu el contingut dels bundles generats:</p>

{% capture code_055 %}# Instal¬∑lar webpack-bundle-analyzer
npm install --save-dev webpack-bundle-analyzer

# Analitzar bundles
npx webpack-bundle-analyzer dist/cataleg-universal/browser/stats.json{% endcapture %}
{% include code-block.html lang="bash" code=code_055 %}

  <p><strong>Checkpoint:</strong></p>

  {% include checklist.html elements="Build de producci√≥ completa sense errors|Chunks separats per lazy loading visibles|Bundle analyzer mostra distribuci√≥ de mides|Compressi√≥ gzip aplicada autom√†ticament" %}

  <h3>8.2. Checklist de funcionalitats</h3>

  <p>Verifiqueu que totes les funcionalitats implementades funcionen correctament:</p>

  <h4>Navegaci√≥ i rutes</h4>

  {% include checklist.html elements="/ redirigeix a /home correctament|Totes les rutes principals funcionen (home, search, item/:id, login, favorites)|404 captura rutes inexistents|Navegaci√≥ del header actualitza ruta activa" %}

  <h4>Vista de detall</h4>

  {% include checklist.html elements="Par√†metre :id es captura correctament|API retorna dades de l'element|Botons Anterior/Seg√ºent funcionen|Bot√≥ Tornar retorna a /home" %}

  <h4>Autenticaci√≥</h4>

  {% include checklist.html elements="Login valida credencials (m√≠nim 4 car√†cters)|Estat d'usuari es guarda a localStorage|Header mostra usuari autenticat|Logout neteja estat i redirigeix" %}

  <h4>Protecci√≥ de rutes</h4>

  {% include checklist.html elements="AuthGuard bloqueja /favorites sense login|Login correcte dona acc√©s a favorites|returnUrl funciona despr√©s de login|Logout revoca acc√©s a favorites" %}

  <h4>Lazy loading</h4>

  {% include checklist.html elements="FavoritesModule crea chunk separat|Chunk nom√©s es carrega quan s'accedeix a /favorites|Network tab mostra c√†rrega diferida" %}

  <h4>Optimitzacions</h4>

  {% include checklist.html elements="OnPush aplicat a components|Virtualitzaci√≥ funciona amb scroll|trackBy implementat correctament|DevTools mostra millores de rendiment" %}

  <h3>8.3. An√†lisi de mides</h3>

  <p>Reviseu la mida dels arxius generats i identifiqueu possibles millores:</p>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Arxiu</th>
        <th>Mida (gzip)</th>
        <th>Descripci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>main.*.js</td>
        <td>~150-200 KB</td>
        <td>Bundle principal amb AppModule i components eagerly loaded</td>
      </tr>
      <tr>
        <td>polyfills.*.js</td>
        <td>~35-40 KB</td>
        <td>Polyfills necessaris per compatibilitat navegadors</td>
      </tr>
      <tr>
        <td>favorites-module.*.js</td>
        <td>~15-20 KB</td>
        <td>Chunk del m√≤dul de preferits (lazy loaded)</td>
      </tr>
      <tr>
        <td>styles.*.css</td>
        <td>~5-10 KB</td>
        <td>Estils globals compilats</td>
      </tr>
    </tbody>
  </table>

  <h3>8.4. Preparar per desplegament</h3>

  <p>Verifiqueu que l'aplicaci√≥ est√† llesta per publicar:</p>

{% capture code_056 %}# Servir build local
npx http-server dist/cataleg-universal/browser -p 8080

# Provar a: http://localhost:8080

# Verificar:
# - Navegaci√≥ funciona
# - Assets carreguen correctament
# - No hi ha errors a la consola
# - Rutes funcionen sense hash (#){% endcapture %}
{% include code-block.html lang="bash" code=code_056 %}

  <p>Creeu fitxer de configuraci√≥ per desplegament:</p>

  <h4>Opci√≥ 1: Desplegament a Vercel</h4>

  <p><strong>Fitxer:</strong> <code>vercel.json</code></p>

{% capture code_057 %}{
  "buildCommand": "ng build --configuration production",
  "outputDirectory": "dist/cataleg-universal/browser",
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}{% endcapture %}
{% include code-block.html lang="json" code=code_057 %}

  <p>Passos per desplegar a Vercel:</p>

{% capture code_058 %}# 1. Instal¬∑lar Vercel CLI (opcional, tamb√© pots usar la web)
npm install -g vercel

# 2. Login a Vercel
vercel login

# 3. Desplegar des del directori del projecte
vercel

# 4. Seguir les instruccions:
#    - Set up and deploy? Y
#    - Which scope? (seleccionar el teu compte)
#    - Link to existing project? N
#    - What's your project's name? cataleg-universal
#    - In which directory is your code located? ./
#    - Want to override the settings? N

# 5. Per desplegament de producci√≥:
vercel --prod{% endcapture %}
{% include code-block.html lang="bash" code=code_058 %}

  <h4>Opci√≥ 2: Desplegament a Netlify</h4>

  <p><strong>Fitxer:</strong> <code>netlify.toml</code></p>

{% capture code_059 %}[build]
  publish = "dist/cataleg-universal/browser"
  command = "ng build --configuration production"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200{% endcapture %}
{% include code-block.html lang="toml" code=code_059 %}

  <p>Passos per desplegar a Netlify:</p>

{% capture code_060 %}# 1. Instal¬∑lar Netlify CLI (opcional)
npm install -g netlify-cli

# 2. Login a Netlify
netlify login

# 3. Inicialitzar i desplegar
netlify init

# 4. O desplegar manualment:
#    - Anar a https://app.netlify.com
#    - New site from Git
#    - Connectar repositori
#    - Build command: ng build --configuration production
#    - Publish directory: dist/cataleg-universal/browser{% endcapture %}
{% include code-block.html lang="bash" code=code_060 %}

  <div class="info_box">
    <p><strong>Recomanaci√≥:</strong> Vercel ofereix integraci√≥ excel¬∑lent amb Angular i detecta autom√†ticament la configuraci√≥. √âs una opci√≥ molt convenient per projectes Angular.</p>
  </div>

  <h3>Checkpoint final</h3>

  {% include checklist.html elements="Build de producci√≥ completa sense warnings|Totes les funcionalitats verificades|Bundle analyzer executat i revisat|Aplicaci√≥ servida localment funciona|Preparada per desplegament a hosting" %}

  <h3>Resoluci√≥ de problemes</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Problema</th>
        <th>Causa probable</th>
        <th>Soluci√≥</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Build falla</td>
        <td>Errors de TypeScript</td>
        <td>Revisar consola i corregir errors</td>
      </tr>
      <tr>
        <td>Bundle massa gran</td>
        <td>Depend√®ncies pesades</td>
        <td>Revisar amb bundle analyzer</td>
      </tr>
      <tr>
        <td>404 en producci√≥</td>
        <td>Server no redirigeix a index.html</td>
        <td>Configurar redirects al servidor</td>
      </tr>
      <tr>
        <td>Assets no carreguen</td>
        <td>Base href incorrecte</td>
        <td>Verificar --base-href al build</td>
      </tr>
    </tbody>
  </table>

</div>

<!-- SECCI√ì 9: Autoavaluaci√≥ -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio9">
  <h2 id="Unitat4_Bloc4_Seccio9">9. Autoavaluaci√≥</h2>

  <p>Utilitzeu aquesta checklist per verificar que heu assolit tots els objectius del cas d'√∫s:</p>

  <h3>Sistema de rutes (RA4.1)</h3>

  {% include checklist.html elements="He configurat correctament totes les rutes principals|La navegaci√≥ entre vistes funciona sense errors|Els enlla√ßos actius es destaquen visualment|La ruta 404 captura paths inexistents" %}

  <h3>Gesti√≥ de par√†metres (RA4.1)</h3>

  {% include checklist.html elements="La vista de detall captura l'ID de la URL|Els par√†metres es processen correctament|La navegaci√≥ amb par√†metres funciona|He implementat trackBy per rendiment" %}

  <h3>Autenticaci√≥ i estat (RA4.2, RA4.3)</h3>

  {% include checklist.html elements="El servei d'autenticaci√≥ gestiona l'estat global|El login simula correctament l'autenticaci√≥|L'estat es preserva amb localStorage|El logout neteja l'estat correctament" %}

  <h3>Protecci√≥ de rutes (RA4.3)</h3>

  {% include checklist.html elements="La gu√†rdia bloqueja acc√©s no autoritzat|Les redireccions funcionen correctament|El returnUrl preserva la destinaci√≥ original|Totes les rutes protegides estan verificades" %}

  <h3>Modularitzaci√≥ (RA4.4)</h3>

  {% include checklist.html elements="He creat un m√≤dul funcional amb routing propi|El lazy loading funciona correctament|El chunk separat es genera al build|La c√†rrega diferida es verifica al Network tab" %}

  <h3>Optimitzacions (RA4.4)</h3>

  {% include checklist.html elements="He aplicat OnPush on correspon|La virtualitzaci√≥ millora el rendiment|He mesurat l'impacte amb DevTools|El bundle size s'ha redu√Øt amb lazy loading" %}

  <h3>Verificaci√≥ i desplegament (RA4.5)</h3>

  {% include checklist.html elements="El build de producci√≥ completa sense errors|He analitzat la mida dels bundles|Totes les funcionalitats estan verificades|L'aplicaci√≥ est√† llesta per publicar" %}

</div>

<!-- SECCI√ì 10: Recapitulaci√≥ -->
<div class="section cas-dus" id="Unitat4_Bloc4_Seccio10">
  <h2 id="Unitat4_Bloc4_Seccio10">10. Recapitulaci√≥</h2>

  <h3>Qu√® heu apr√®s</h3>

  <p>En aquest cas d'√∫s integrador, heu aplicat tots els coneixements del m√≤dul per construir una aplicaci√≥ Angular completa i professional. Heu treballat amb:</p>

  <h4>Navegaci√≥ i arquitectura</h4>

  <ul>
    <li><strong>Sistema de rutes multi-p√†gina:</strong> Configuraci√≥ completa amb rutes principals, par√†metres, lazy loading i gesti√≥ de 404</li>
    <li><strong>Components organitzats:</strong> Separaci√≥ entre contenidors i presentacionals amb responsabilitats clares</li>
    <li><strong>Serveis centralitzats:</strong> Gesti√≥ d'estat, autenticaci√≥ i comunicaci√≥ amb API en serveis reutilitzables</li>
  </ul>

  <h4>Seguretat i control d'acc√©s</h4>

  <ul>
    <li><strong>Autenticaci√≥ simulada:</strong> Sistema de login amb gesti√≥ d'estat persistent</li>
    <li><strong>Gu√†rdies de ruta:</strong> Protecci√≥ de seccions privades amb redireccions autom√†tiques</li>
    <li><strong>Gesti√≥ d'estat global:</strong> √ös de BehaviorSubject per estat reactiu compartit</li>
  </ul>

  <h4>Optimitzacions de rendiment</h4>

  <ul>
    <li><strong>Lazy loading:</strong> C√†rrega diferida de m√≤duls per reduir bundle inicial</li>
    <li><strong>OnPush:</strong> Estrat√®gia de detecci√≥ de canvis optimitzada</li>
    <li><strong>Virtualitzaci√≥:</strong> Renderitzaci√≥ eficient de llistes grans amb CDK</li>
    <li><strong>TrackBy:</strong> Optimitzaci√≥ de bucles *ngFor</li>
  </ul>

  <h4>Desplegament i producci√≥</h4>

  <ul>
    <li><strong>Build optimitzat:</strong> Compilaci√≥ per producci√≥ amb an√†lisi de bundles</li>
    <li><strong>Verificaci√≥ completa:</strong> Comprovaci√≥ sistem√†tica de totes les funcionalitats</li>
    <li><strong>Preparaci√≥ per publicar:</strong> Aplicaci√≥ llesta per desplegar a hosting</li>
  </ul>

  <h3>Passos seg√ºents</h3>

  <p>Per continuar millorant l'aplicaci√≥, podr√≠eu:</p>

  <ul>
    <li>Implementar tests unitaris i e2e amb Jest i Cypress</li>
    <li>Afegir internacionalitzaci√≥ (i18n) per m√∫ltiples idiomes</li>
    <li>Integrar una API real substituint JSONPlaceholder</li>
    <li>Implementar Progressive Web App (PWA) amb Service Workers</li>
    <li>Afegir animacions amb Angular Animations</li>
    <li>Configurar CI/CD per desplegament autom√†tic</li>
  </ul>

  <h3>Recursos addicionals</h3>

  <ul>
    <li><a href="https://angular.dev/guide/routing/common-router-tasks" target="_blank">Documentaci√≥ oficial Angular Router</a></li>
    <li><a href="https://angular.dev/best-practices/runtime-performance" target="_blank">Guia detecci√≥ de canvis</a></li>
    <li><a href="https://material.angular.dev/cdk/scrolling/overview" target="_blank">Angular CDK Scrolling</a></li>
    <li><a href="https://web.dev/articles/vitals" target="_blank">Web Vitals per mesurar rendiment</a></li>
  </ul>

  <div class="success_box">
    <p><strong>Felicitats!</strong> Heu completat el cas d'√∫s integrador de la Unitat 4. Ara teniu les habilitats necess√†ries per desenvolupar aplicacions Angular professionals amb navegaci√≥ complexa, seguretat, optimitzacions de rendiment i preparades per producci√≥.</p>
  </div>

</div>
