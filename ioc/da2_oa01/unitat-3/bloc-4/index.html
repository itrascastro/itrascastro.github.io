<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>Cas d'ús: Catàleg amb dades remotes i gestió avançada | DA2_OA01 - Programació Avançada (Angular) - IOC</title>
    <meta name="description" content="Material educatiu - Institut Obert de Catalunya">
    <meta name="page-unitat" content="3">
    <meta name="page-bloc" content="4">
    
    <!-- SEO Tags -->
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Cas d’ús: Catàleg amb dades remotes i gestió avançada | DA2_OA01 - Programació Avançada (Angular)</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Cas d’ús: Catàleg amb dades remotes i gestió avançada" />
<meta property="og:locale" content="ca_ES" />
<meta name="description" content="Materials del mòdul DA2_OA01 - Programació Avançada amb Angular" />
<meta property="og:description" content="Materials del mòdul DA2_OA01 - Programació Avançada amb Angular" />
<link rel="canonical" href="http://localhost:4006/ioc/da2_oa01/unitat-3/bloc-4/" />
<meta property="og:url" content="http://localhost:4006/ioc/da2_oa01/unitat-3/bloc-4/" />
<meta property="og:site_name" content="DA2_OA01 - Programació Avançada (Angular)" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Cas d’ús: Catàleg amb dades remotes i gestió avançada" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Materials del mòdul DA2_OA01 - Programació Avançada amb Angular","headline":"Cas d’ús: Catàleg amb dades remotes i gestió avançada","url":"http://localhost:4006/ioc/da2_oa01/unitat-3/bloc-4/"}</script>
<!-- End Jekyll SEO tag -->

    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/ioc/da2_oa01/assets/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="canonical" href="http://localhost:4006/ioc/da2_oa01/unitat-3/bloc-4/">
    <!-- Rich editor styles (for embedded notes panel) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.min.css">
    <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" disabled>
    <link rel="stylesheet" href="/ioc/da2_oa01/assets/css/quadern-rich-editor.css">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/ioc/da2_oa01/assets/images/favicon.ico">
    
    <!-- RSS Feed -->
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4006/ioc/da2_oa01/feed.xml" title="DA2_OA01 - Programació Avançada (Angular)" />

    <!-- Syntax Highlighting (Prism) -->
    <link id="prism-theme" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-jsx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-html.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-tsx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>

    <!-- Code Block Component -->
    <link rel="stylesheet" href="/ioc/da2_oa01/assets/css/code-block.css">
    <script src="/ioc/da2_oa01/assets/js/code-block.js"></script>

</head>

<body class="bloc-layout" data-baseurl="/ioc/da2_oa01">
    <!-- Skip to content for accessibility -->
    <a class="skip-link" href="#main-content">Salta al contingut principal</a>


    
    <!-- Header fix -->
    <header class="header" role="banner" id="top">
        <div class="header-brand">
            <a href="/ioc/da2_oa01/" class="logo-link" aria-label="Inici">
                <img src="/ioc/da2_oa01/assets/images/logo_IOC_light.jpg" alt="Institut Obert de Catalunya" class="logo logo-light">
                <img src="/ioc/da2_oa01/assets/images/logo_IOC_dark.png" alt="Institut Obert de Catalunya" class="logo logo-dark">
            </a>
            <a href="/ioc/da2_oa01/" class="title-link">
                <h1>DA2_OA01 - DA2_OA01 - Programació Avançada (Angular)</h1>
            </a>
        </div>
        <div class="header-actions">
            <button class="theme-toggle" id="theme-toggle">Mode Fosc</button>
            <button class="nav-panel-toggle" type="button" aria-expanded="false" aria-label="Obre la navegació">
                <i class="bi bi-list" aria-hidden="true"></i>
                <span class="nav-panel-label">Navegació</span>
            </button>
        </div>
    </header>

    <div class="offcanvas-backdrop" hidden></div>
    <nav class="offcanvas-nav" aria-hidden="true" aria-label="Navegació del curs">
        <div class="offcanvas-header">
            <h2 class="offcanvas-title">Navegació</h2>
            <button class="offcanvas-close" type="button" aria-label="Tanca la navegació">
                <i class="bi bi-x-lg" aria-hidden="true"></i>
            </button>
        </div>
        <div class="offcanvas-body">
            <a href="/ioc/da2_oa01/" class="nav-dropdown-item ">Índex del Curs</a>
            
                
                    <a href="/ioc/da2_oa01/unitat-1/bloc-1/" class="nav-dropdown-item ">
                        Unitat 1 - Bloc 1: Conceptes fonamentals i instal·lació
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-1/bloc-2/" class="nav-dropdown-item ">
                        Unitat 1 - Bloc 2: Entorn de desenvolupament integrat
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-1/bloc-3/" class="nav-dropdown-item ">
                        Unitat 1 - Bloc 3: Creació del projecte base
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-1/bloc-4/" class="nav-dropdown-item ">
                        Unitat 1 - Bloc 4: Cas d'ús: Preparació de l'entorn
                    </a>
                
            
                
                    <a href="/ioc/da2_oa01/unitat-2/bloc-1/" class="nav-dropdown-item ">
                        Unitat 2 - Bloc 1: Components i comunicació bàsica
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-2/bloc-2/" class="nav-dropdown-item ">
                        Unitat 2 - Bloc 2: Data binding i events
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-2/bloc-3/" class="nav-dropdown-item ">
                        Unitat 2 - Bloc 3: Formularis amb vinculació bidireccional
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-2/bloc-4/" class="nav-dropdown-item ">
                        Unitat 2 - Bloc 4: Cas d'ús: Catàleg d'elements
                    </a>
                
            
                
                    <a href="/ioc/da2_oa01/unitat-3/bloc-1/" class="nav-dropdown-item ">
                        Unitat 3 - Bloc 1: Serveis i separació de responsabilitats
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-3/bloc-2/" class="nav-dropdown-item ">
                        Unitat 3 - Bloc 2: Gestió d'estat i comunicació entre components
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-3/bloc-3/" class="nav-dropdown-item ">
                        Unitat 3 - Bloc 3: Optimització i bones pràctiques
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-3/bloc-4/" class="nav-dropdown-item current">
                        Unitat 3 - Bloc 4: Cas d'ús: Catàleg amb API REST
                    </a>
                
            
                
                    <a href="/ioc/da2_oa01/unitat-4/bloc-1/" class="nav-dropdown-item ">
                        Unitat 4 - Bloc 1: Sistema de rutes i navegació
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-4/bloc-2/" class="nav-dropdown-item ">
                        Unitat 4 - Bloc 2: Arquitectura escalable
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-4/bloc-3/" class="nav-dropdown-item ">
                        Unitat 4 - Bloc 3: Optimització de rendiment
                    </a>
                
                    <a href="/ioc/da2_oa01/unitat-4/bloc-4/" class="nav-dropdown-item ">
                        Unitat 4 - Bloc 4: Cas d'ús: Aplicació completa
                    </a>
                
            
        </div>
    </nav>

    <div class="container">
        <!-- Sidebar Navegació -->
        
        <aside class="sidebar">
            <button class="sidebar-toggle" type="button" aria-expanded="false">
                <span>Contingut del bloc</span>
                <i class="bi bi-chevron-down" aria-hidden="true"></i>
            </button>
            <div class="sidebar-scroll">
                <!-- Contingut d'aquest Bloc -->
                <div class="sidebar-section">
                    <h3>Contingut del Bloc</h3>
                    

    
    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio0" class="nav-link" data-section="Unitat3_Bloc4_Seccio0">Introducció</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio1" class="nav-link" data-section="Unitat3_Bloc4_Seccio1">1. Prerequisits</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio2" class="nav-link" data-section="Unitat3_Bloc4_Seccio2">2. Visió general de l'aplicació</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio3" class="nav-link" data-section="Unitat3_Bloc4_Seccio3">3. Configuració de l'API i entorn</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio4" class="nav-link" data-section="Unitat3_Bloc4_Seccio4">4. Models i adaptadors</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio5" class="nav-link" data-section="Unitat3_Bloc4_Seccio5">5. Servei HTTP i gestió d'estats</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio6" class="nav-link" data-section="Unitat3_Bloc4_Seccio6">6. Llistat reactiu amb estats</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio7" class="nav-link" data-section="Unitat3_Bloc4_Seccio7">7. Formulari de cerca amb validació asíncrona</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio8" class="nav-link" data-section="Unitat3_Bloc4_Seccio8">8. Preferits locals i formulari dinàmic</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio9" class="nav-link" data-section="Unitat3_Bloc4_Seccio9">9. Verificació final i control de versions</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio10" class="nav-link" data-section="Unitat3_Bloc4_Seccio10">10. Autoavaluació</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    
        
        
        
        
        
        
        
        <div class="nav-item">
            <a href="#Unitat3_Bloc4_Seccio11" class="nav-link" data-section="Unitat3_Bloc4_Seccio11">11. Recapitulació i contracte de sortida</a>
        </div>
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    



                </div>
            </div>
        </aside>
        

        <main class="main-content" role="main" id="main-content">
            
            <!-- Navegació horizontal -->
            
            <nav class="horizontal-nav" aria-label="Navegació de ruta">
                <div class="horizontal-nav-list">
                    <a href="/ioc/da2_oa01/" class="horizontal-nav-item">Inici</a>
                    
                    
                        
                        
                            
                        
                            
                        
                            
                                
                                
                        
                        
                            <span class="horizontal-nav-separator"> &gt; </span>
                            <a href="/ioc/da2_oa01/unitat-3/" class="horizontal-nav-item">
                                Unitat 3: Serveis i gestió de dades (RA3)
                            </a>
                        
                        
                        
                            
                            
                                
                            
                                
                            
                                
                            
                                
                                    
                                    
                            
                            
                                <span class="horizontal-nav-separator"> &gt; </span>
                                <span class="horizontal-nav-item current">
                                    Bloc 3.4: Cas d'ús: Catàleg amb API REST
                                </span>
                            
                        
                    
                </div>
            </nav>
            
            
            <!-- Contingut de la Pàgina -->
            <article class="page-content">
                <div class="content-body">
                    

<!-- Objectius del bloc (si estan definits al frontmatter) -->


<!-- Contingut principal -->
<!-- SECCIÓ 0: Introducció -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio0">
  <h2 id="Unitat3_Bloc4_Seccio0">Introducció</h2>

  <!-- MULTIMÈDIA -->
  <!--
  ════════════════════════════════════════════════════════════════
  Component: Enllaços multimèdia YouTube
  ════════════════════════════════════════════════════════════════

  Paràmetres:
    - unitat: número de la unitat (1-4)
    - bloc: número del bloc (1-4)
    - seccio: número de la secció (1-3)

  Exemple d'ús:
    {% include multimedia-youtube.html unitat=1 bloc=1 seccio=1 %}

  El component busca automàticament les URLs corresponents a
  site.data.multimedia i mostra els botons de vídeo i àudio.
  ════════════════════════════════════════════════════════════════
-->





  
  
  
  
  

  

  

  
<div class="multimedia-resources">
  <div class="multimedia-header">
    <i class="bi bi-play-circle-fill"></i>
    <span>Contingut multimèdia d'aquesta lectura</span>
  </div>

  <div class="multimedia-buttons">
    
    <a href="https://www.youtube.com/watch?v=ZUN7RmC9eoI" target="_blank" rel="noopener noreferrer" class="multimedia-btn video-btn" title="Unitat 3 · Lliçó 4 · Cas d'ús: Catàleg amb dades remotes i gestióavançada">
      <i class="bi bi-youtube"></i>
      <span>Veure vídeo</span>
      <i class="bi bi-box-arrow-up-right"></i>
    </a>
    

    
    <a href="https://www.youtube.com/watch?v=KYjzS7VyS2Y" target="_blank" rel="noopener noreferrer" class="multimedia-btn audio-btn" title="[Audio] Unitat 3 · Lliçó 4 · Cas d'ús: Catàleg amb dades remotes i gestióavançada">
      <i class="bi bi-mic-fill"></i>
      <span>Escoltar àudio</span>
      <i class="bi bi-box-arrow-up-right"></i>
    </a>
    
  </div>

  
  
</div>
  



  <div class="info_box">
    <p>Després de les 9 lectures de la Unitat 3, disposeu dels conceptes necessaris per construir una aplicació Angular que consumeix dades reals d'una API externa, les transforma amb adaptadors, gestiona els seus estats (càrrega, èxit, error) i ofereix formularis avançats amb validacions personalitzades i camps dinàmics.</p>

    <p>Aquest cas d'ús integra tots aquests conceptes en una aplicació funcional: un <strong>catàleg d'elements</strong> que carrega dades populars, permet cercar elements amb validació asíncrona, gestiona preferits locals amb persistència i ofereix un formulari dinàmic per afegir notes.</p>

    <p>L'aplicació que construireu és la base tècnica que podreu ampliar a la Unitat 4 amb navegació, rutes i optimització. Per això és fonamental que acabeu amb una aplicació robusta i ben documentada.</p>
  </div>

  <h3>Objectius del cas d'ús</h3>

  <ul>
    <li>Configurar l'accés a un servei extern (mock server amb json-server o API real) i documentar la configuració</li>
    <li>Implementar models TypeScript amb interfícies i adaptadors per transformar dades externes</li>
    <li>Crear serveis Angular amb <code>HttpClient</code> que gestionen estats de càrrega, èxit i error</li>
    <li>Construir formularis reactius amb validacions personalitzades síncrones i asíncrones</li>
    <li>Implementar gestió de preferits locals amb persistència a <code>localStorage</code></li>
    <li>Desenvolupar formularis dinàmics amb <code>FormArray</code> per gestionar notes</li>
  </ul>

  <h3>Resultats d'Aprenentatge i criteris coberts</h3>

  <ul>
    <li><strong>RA3 · Criteri 1</strong> — Defineix models de dades i estructures adequades al cas d'ús.</li>
    <li><strong>RA3 · Criteri 2</strong> — Utilitza serveis externs (APIs web) per obtenir, enviar i actualitzar informació.</li>
    <li><strong>RA3 · Criteri 3</strong> — Actualitza la interfície de manera reactiva davant canvis en les dades.</li>
    <li><strong>RA3 · Criteri 4</strong> — Gestiona estats de càrrega, errors i reintents amb criteri d'usuabilitat.</li>
    <li><strong>RA3 · Criteri 5</strong> — Documenta el flux de dades i les decisions preses per garantir mantenibilitat.</li>
  </ul>

  <h3>Lectures integrades</h3>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Lliçó</th>
        <th>Lectura</th>
        <th>Concepte aplicat</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan="3"><strong>3.1</strong></td>
        <td>3.1.1</td>
        <td>Creació de serveis i separació de responsabilitats</td>
      </tr>
      <tr>
        <td>3.1.2</td>
        <td>Client de peticions i comunicació amb serveis web</td>
      </tr>
      <tr>
        <td>3.1.3</td>
        <td>Gestió d'errors i estats de càrrega</td>
      </tr>
      <tr>
        <td rowspan="3"><strong>3.2</strong></td>
        <td>3.2.1</td>
        <td>Definició de models amb interfícies</td>
      </tr>
      <tr>
        <td>3.2.2</td>
        <td>Adaptadors i transformació de dades externes</td>
      </tr>
      <tr>
        <td>3.2.3</td>
        <td>Integració reactiva amb components</td>
      </tr>
      <tr>
        <td rowspan="3"><strong>3.3</strong></td>
        <td>3.3.1</td>
        <td>Formularis reactius: grups i controls</td>
      </tr>
      <tr>
        <td>3.3.2</td>
        <td>Validacions personalitzades i asíncrones</td>
      </tr>
      <tr>
        <td>3.3.3</td>
        <td>Formularis complexos i camps dinàmics</td>
      </tr>
    </tbody>
  </table>

</div>

<!-- SECCIÓ 1: Prerequisits -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio1">
  <h2 id="Unitat3_Bloc4_Seccio1">1. Prerequisits</h2>

  <p>Abans de començar aquest cas d'ús, necessiteu tenir preparat:</p>

  <h3>1.1. Projecte Angular funcional</h3>

  <ul>
    <li>Projecte <code>catalog-elements</code> inicialitzat amb Angular CLI 18+</li>
    <li>Git configurat amb repositori local inicialitzat</li>
    <li>Node.js i npm operatius (versions LTS 20.x o superior)</li>
  </ul>

  <h3>1.2. Coneixements de la Unitat 3</h3>

  <ul>
    <li>Lectures 3.1.1 a 3.1.3 (serveis i comunicació HTTP)</li>
    <li>Lectures 3.2.1 a 3.2.3 (models i adaptadors)</li>
    <li>Lectures 3.3.1 a 3.3.3 (formularis avançats)</li>
  </ul>

  <h3>1.3. Documentació preparada</h3>

  <ul>
    <li>Carpeta <code>docs/</code> amb fitxers <code>serveis.md</code>, <code>models.md</code>, <code>formularis.md</code></li>
    <li>Mock de dades: <code>src/app/mocks/dades-elements.mock.ts</code></li>
  </ul>

  <h3>1.4. Verificació ràpida</h3>

  <p>Executeu les següents comandes per assegurar-vos que el vostre entorn està llest:</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">cd ~/workspace/catalog-elements
ng version
git status</code></pre>
  </div>
</div>


  <p><strong>Punt d'autocomprovació:</strong> Veieu Angular CLI ≥18.0.0, <code>git status</code> mostra "working tree clean".</p>

</div>

<!-- SECCIÓ 2: Visió general de l'aplicació -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio2">
  <h2 id="Unitat3_Bloc4_Seccio2">2. Visió general de l'aplicació</h2>

  <h3>2.1. Què construireu</h3>

  <p>Una aplicació Angular completa amb quatre funcionalitats principals:</p>

  <ol>
    <li><strong>Llistat de populars:</strong> Carrega automàticament els elements més populars de l'API</li>
    <li><strong>Cerca d'elements:</strong> Formulari reactiu que filtra elements per nom amb validació asíncrona</li>
    <li><strong>Gestió d'estats:</strong> Indicadors visuals de càrrega, missatges d'error i gestió de reintents</li>
    <li><strong>Preferits locals:</strong> Sistema per marcar elements favorits amb notes dinàmiques persistents</li>
  </ol>

  <h3>2.2. Arquitectura de l'aplicació</h3>


<div class="code-block" data-lang="plaintext" role="region" aria-label="Bloc de codi plaintext">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">PLAINTEXT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-plaintext">src/app/
├── models/
│   └── element.model.ts          # Interfícies TypeScript
├── adaptadors/
│   └── element.adaptador.ts      # Funcions de transformació
├── serveis/
│   ├── element.service.ts        # Servei HTTP amb signals
│   └── preferits.service.ts      # Servei de persistència local
├── components/
│   ├── cataleg-page/             # Pàgina principal del catàleg
│   ├── element-card/             # Targeta individual d&#39;element
│   ├── formulari-cerca/          # Formulari de cerca reactiu
│   └── preferits-panel/          # Panell de preferits
└── validadors/
    └── codi-disponible.validator.ts  # Validador asíncron</code></pre>
  </div>
</div>


  <h3>2.3. Flux de dades</h3>

  <ol>
    <li>Component <code>CatalegPage</code> crida servei <code>ElementService.obtenirPopulars()</code></li>
    <li>Servei fa petició HTTP a l'API</li>
    <li>Adaptador transforma resposta JSON → model <code>ElementCataleg</code></li>
    <li>Component rep dades via signal i actualitza la vista</li>
    <li>Formulari de cerca valida entrada i filtra elements</li>
    <li>Preferits s'emmagatzemen a <code>localStorage</code> amb notes dinàmiques</li>
  </ol>

  <h3>2.4. Funcionalitats per bloc</h3>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Bloc</th>
        <th>Acció</th>
        <th>Resultat</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Bloc 1</strong></td>
        <td>Configurar servidor mock amb json-server</td>
        <td>API REST local funcional</td>
      </tr>
      <tr>
        <td><strong>Bloc 2</strong></td>
        <td>Crear models i adaptadors</td>
        <td>Interfícies i funcions de transformació</td>
      </tr>
      <tr>
        <td><strong>Bloc 3</strong></td>
        <td>Implementar servei HTTP</td>
        <td>Servei amb gestió d'estats i errors</td>
      </tr>
      <tr>
        <td><strong>Bloc 4</strong></td>
        <td>Desenvolupar llistat reactiu</td>
        <td>Component amb signals i indicadors visuals</td>
      </tr>
      <tr>
        <td><strong>Bloc 5</strong></td>
        <td>Crear formulari de cerca</td>
        <td>Formulari amb validació asíncrona</td>
      </tr>
      <tr>
        <td><strong>Bloc 6</strong></td>
        <td>Implementar preferits i notes</td>
        <td>Sistema de persistència amb FormArray</td>
      </tr>
    </tbody>
  </table>

</div>

<!-- SECCIÓ 3: Configuració de l'API i entorn -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio3">
  <h2 id="Unitat3_Bloc4_Seccio3">3. Configuració de l'API i entorn</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Configurar un servidor mock amb json-server per simular una API REST real.</p>
    <p><strong>Integra conceptes de:</strong> Lectura 3.1.2 (Client de peticions i comunicació amb serveis web), Lectura 3.1.3 (Gestió d'errors i estats de càrrega).</p>
  </div>

  <h3>3.1. Crear estructura de l'API mock</h3>

  <p>Crearem un servidor mock amb <code>json-server</code> per simular una API REST real.</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">cd ~/workspace/catalog-elements
mkdir -p tools/api
touch tools/api/cataleg.json
code tools/api/cataleg.json</code></pre>
  </div>
</div>


  <h3>3.2. Omplir fitxer de dades mock</h3>

  <p>Afegiu el següent contingut al fitxer <code>tools/api/cataleg.json</code>:</p>


<div class="code-block" data-lang="json" role="region" aria-label="Bloc de codi json">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">JSON</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-json">{
  &quot;elements&quot;: [
    {
      &quot;id&quot;: &quot;elem-001&quot;,
      &quot;nom&quot;: &quot;Placa Arduino Uno R3&quot;,
      &quot;descripcio&quot;: &quot;Microcontrolador amb processador ATmega328P&quot;,
      &quot;categoria&quot;: &quot;Electronics&quot;,
      &quot;preu&quot;: 24.99,
      &quot;imatge&quot;: &quot;https://via.placeholder.com/300x200?text=Arduino&quot;,
      &quot;popular&quot;: true,
      &quot;stock&quot;: 45
    },
    {
      &quot;id&quot;: &quot;elem-002&quot;,
      &quot;nom&quot;: &quot;Sensor ultrasònic HC-SR04&quot;,
      &quot;descripcio&quot;: &quot;Sensor de distància per mesura d&#39;obstacles&quot;,
      &quot;categoria&quot;: &quot;Sensors&quot;,
      &quot;preu&quot;: 3.50,
      &quot;imatge&quot;: &quot;https://via.placeholder.com/300x200?text=Sensor&quot;,
      &quot;popular&quot;: true,
      &quot;stock&quot;: 120
    },
    {
      &quot;id&quot;: &quot;elem-003&quot;,
      &quot;nom&quot;: &quot;Motor pas a pas NEMA 17&quot;,
      &quot;descripcio&quot;: &quot;Motor de precisió per projectes de robòtica&quot;,
      &quot;categoria&quot;: &quot;Motors&quot;,
      &quot;preu&quot;: 18.75,
      &quot;imatge&quot;: &quot;https://via.placeholder.com/300x200?text=Motor&quot;,
      &quot;popular&quot;: true,
      &quot;stock&quot;: 32
    },
    {
      &quot;id&quot;: &quot;elem-004&quot;,
      &quot;nom&quot;: &quot;Pantalla LCD 16x2&quot;,
      &quot;descripcio&quot;: &quot;Pantalla de text amb retroil·luminació blava&quot;,
      &quot;categoria&quot;: &quot;Displays&quot;,
      &quot;preu&quot;: 8.99,
      &quot;imatge&quot;: &quot;https://via.placeholder.com/300x200?text=LCD&quot;,
      &quot;popular&quot;: false,
      &quot;stock&quot;: 67
    },
    {
      &quot;id&quot;: &quot;elem-005&quot;,
      &quot;nom&quot;: &quot;Mòdul Bluetooth HC-05&quot;,
      &quot;descripcio&quot;: &quot;Comunicació sense fils per Arduino i Raspberry Pi&quot;,
      &quot;categoria&quot;: &quot;Communication&quot;,
      &quot;preu&quot;: 6.25,
      &quot;imatge&quot;: &quot;https://via.placeholder.com/300x200?text=Bluetooth&quot;,
      &quot;popular&quot;: true,
      &quot;stock&quot;: 89
    }
  ]
}</code></pre>
  </div>
</div>


  <p>Aquest JSON simula una resposta d'API real amb 5 elements del catàleg.</p>

  <h3>3.3. Instal·lar i arrencar json-server</h3>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">npm install -g json-server
json-server --watch tools/api/cataleg.json --port 4301 --delay 600</code></pre>
  </div>
</div>


  <p><strong>Paràmetres clau:</strong></p>

  <ul>
    <li><code>--port 4301</code> — Evita conflictes amb Angular (port 4200)</li>
    <li><code>--delay 600</code> — Simula latència de xarxa (600ms) per provar indicadors de càrrega</li>
  </ul>

  <p><strong>Verificació:</strong> Obriu <code>http://localhost:4301/elements</code> al navegador i hauríeu de veure l'array JSON amb els 5 elements.</p>

  <h3>3.4. Configurar variables d'entorn</h3>

  <p>Creeu un fitxer per gestionar la configuració de l'API:</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">touch src/environments/environment.development.ts
code src/environments/environment.development.ts</code></pre>
  </div>
</div>


  <p>Fitxer <code>src/environments/environment.development.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">export const environment = {
  production: false,
  apiUrl: &#39;http://localhost:4301&#39;,
  apiDelay: 600
};</code></pre>
  </div>
</div>


  <p>Separar la configuració de l'API permet canviar fàcilment entre mock local i API real sense modificar el codi dels serveis.</p>

  <h3>3.5. Documentar la configuració</h3>

  <p>Actualitzeu <code>docs/serveis.md</code> amb la documentació completa:</p>


<div class="code-block" data-lang="markdown" role="region" aria-label="Bloc de codi markdown">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">MARKDOWN</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-markdown"># Configuració de serveis

## API Mock (desenvolupament)

### Arrencar el servidor

```bash
json-server --watch tools/api/cataleg.json --port 4301 --delay 600
```

### Endpoints disponibles

- `GET /elements` - Retorna tots els elements
- `GET /elements?popular=true` - Filtra elements populars
- `GET /elements?q=Arduino` - Cerca elements per nom
- `GET /elements/:id` - Obté un element per ID

### Configuració

- **Port:** 4301
- **Latència simulada:** 600ms
- **Fitxer de dades:** `tools/api/cataleg.json`

## Canviar a API real

Per utilitzar una API real, modifiqueu `src/environments/environment.development.ts`:

```typescript
export const environment = {
  production: false,
  apiUrl: &#39;https://api.exemple.com&#39;,
  apiKey: &#39;LA_VOSTRA_CLAU_API&#39; // Si cal autenticació
};
```</code></pre>
  </div>
</div>


  <h3>3.6. Troubleshooting</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Solució</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>json-server: command not found</code></td>
        <td>json-server no instal·lat globalment</td>
        <td>Executar <code>npm install -g json-server</code> i reiniciar terminal</td>
      </tr>
      <tr>
        <td><code>EADDRINUSE: port 4301 already in use</code></td>
        <td>Port ja ocupat per un altre procés</td>
        <td>Linux/macOS: <code>lsof -ti:4301 | xargs kill -9</code></td>
      </tr>
      <tr>
        <td><code>ENOENT: no such file or directory</code></td>
        <td>Ruta incorrecta o fitxer no existeix</td>
        <td>Verificar ruta amb <code>pwd</code> i comprovar que <code>cataleg.json</code> existeix</td>
      </tr>
      <tr>
        <td><code>Cannot GET /elements</code> al navegador</td>
        <td>json-server no està actiu</td>
        <td>Comprovar que la terminal mostra "Resources" amb /elements</td>
      </tr>
      <tr>
        <td>Navegador mostra dades massa ràpid</td>
        <td>Falta paràmetre --delay</td>
        <td>Afegir <code>--delay 600</code> a la comanda json-server</td>
      </tr>
    </tbody>
  </table>

  <h3>3.7. Checkpoint</h3>

  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat el fitxer <code>cataleg.json</code> amb 5 elements de mostra</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Veig un array JSON amb 5 elements al navegador a <code>http://localhost:4301/elements</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">El servidor mock respon amb un retard observable (~600ms)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat el fitxer d'entorn amb la URL de l'API mock</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He documentat la configuració de l'API a <code>docs/serveis.md</code></div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


</div>

<!-- SECCIÓ 4: Models i adaptadors -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio4">
  <h2 id="Unitat3_Bloc4_Seccio4">4. Models i adaptadors</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Crear interfícies TypeScript per modelar les dades i adaptadors per transformar respostes de l'API.</p>
    <p><strong>Integra conceptes de:</strong> Lectura 3.2.1 (Definició de models amb interfícies), Lectura 3.2.2 (Adaptadors i transformació de dades externes).</p>
  </div>

  <h3>4.1. Crear interfície del model Element</h3>

  <p>Crearem les interfícies per modelar els elements del catàleg. Separarem el model intern de l'aplicació del model de resposta de l'API:</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">mkdir -p src/app/models
touch src/app/models/element.model.ts
code src/app/models/element.model.ts</code></pre>
  </div>
</div>


  <p>Fitxer <code>src/app/models/element.model.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">export interface ElementCataleg {
  id: string;
  nom: string;
  descripcio: string;
  categoria: string;
  preu: number;
  imatge: string;
  esPopular: boolean;
  stock: number;
  dataAfegit?: Date;
}

export interface ElementApiResponse {
  id: string;
  nom: string;
  descripcio: string;
  categoria: string;
  preu: number;
  imatge: string;
  popular: boolean;  // ← Diferent nom que el model intern
  stock: number;
}

export interface ElementsCercaResponse {
  elements: ElementApiResponse[];
  total: number;
}</code></pre>
  </div>
</div>


  <p><strong>Per què separar models?</strong> Aquesta separació permet adaptar noms (popular → esPopular), afegir camps calculats (dataAfegit) i protegir l'aplicació davant canvis a l'API.</p>

  <h3>4.2. Crear adaptador de transformació</h3>

  <p>Crearem funcions pures que transformen les dades de l'API al format intern:</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">mkdir -p src/app/adaptadors
touch src/app/adaptadors/element.adaptador.ts
code src/app/adaptadors/element.adaptador.ts</code></pre>
  </div>
</div>


  <p>Fitxer <code>src/app/adaptadors/element.adaptador.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { ElementCataleg, ElementApiResponse } from &#39;../models/element.model&#39;;

export function adaptarElementApi(apiElement: ElementApiResponse): ElementCataleg {
  return {
    id: apiElement.id,
    nom: apiElement.nom,
    descripcio: apiElement.descripcio,
    categoria: apiElement.categoria,
    preu: apiElement.preu,
    imatge: apiElement.imatge,
    esPopular: apiElement.popular,  // Canvi de nom
    stock: apiElement.stock,
    dataAfegit: new Date()  // Camp afegit
  };
}

export function adaptarElementsApi(apiElements: ElementApiResponse[]): ElementCataleg[] {
  return apiElements.map(adaptarElementApi);
}

export function elementBuit(): ElementCataleg {
  return {
    id: &#39;&#39;,
    nom: &#39;&#39;,
    descripcio: &#39;&#39;,
    categoria: &#39;&#39;,
    preu: 0,
    imatge: &#39;https://via.placeholder.com/300x200?text=Sense+imatge&#39;,
    esPopular: false,
    stock: 0,
    dataAfegit: new Date()
  };
}</code></pre>
  </div>
</div>


  <p><strong>Avantatges dels adaptadors com a funcions pures:</strong> Faciliten les proves unitàries i la reutilització.</p>

  <h3>4.3. Crear interfícies d'estat del servei</h3>

  <p>Afegiu al final del fitxer <code>element.model.ts</code> les interfícies per gestionar l'estat:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">export type EstatServei = &#39;inicial&#39; | &#39;carregant&#39; | &#39;exit&#39; | &#39;error&#39;;

export interface EstatElements {
  estat: EstatServei;
  elements: ElementCataleg[];
  error?: string;
}</code></pre>
  </div>
</div>


  <p>Aquestes interfícies permeten gestionar de forma estructurada els estats de càrrega, errors i llistes d'elements.</p>

  <h3>4.4. Provar l'adaptador amb dades mock</h3>

  <p>Creeu un fitxer temporal per provar els adaptadors:</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">touch src/app/adaptadors/element.adaptador.test.ts
code src/app/adaptadors/element.adaptador.test.ts</code></pre>
  </div>
</div>


  <p>Fitxer <code>element.adaptador.test.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { adaptarElementApi, adaptarElementsApi } from &#39;./element.adaptador&#39;;
import { ElementApiResponse } from &#39;../models/element.model&#39;;

const mockApiElement: ElementApiResponse = {
  id: &#39;test-001&#39;,
  nom: &#39;Element de prova&#39;,
  descripcio: &#39;Descripció de prova&#39;,
  categoria: &#39;Test&#39;,
  preu: 10.50,
  imatge: &#39;https://exemple.com/test.jpg&#39;,
  popular: true,
  stock: 25
};

const elementAdaptat = adaptarElementApi(mockApiElement);
console.log(&#39;Element adaptat:&#39;, elementAdaptat);
console.log(&#39;Camp esPopular:&#39;, elementAdaptat.esPopular);
console.log(&#39;Camp dataAfegit:&#39;, elementAdaptat.dataAfegit);

const mockApiElements = [mockApiElement, { ...mockApiElement, id: &#39;test-002&#39; }];
const elementsAdaptats = adaptarElementsApi(mockApiElements);
console.log(&#39;Elements adaptats:&#39;, elementsAdaptats.length);</code></pre>
  </div>
</div>


  <p>Executeu el test:</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">npx ts-node src/app/adaptadors/element.adaptador.test.ts</code></pre>
  </div>
</div>


  <p><strong>Resultat esperat:</strong> Veieu l'element adaptat amb <code>esPopular: true</code> i <code>dataAfegit</code> amb la data actual. Després, esborreu el fitxer de test.</p>

  <h3>4.5. Documentar models i adaptadors</h3>

  <p>Actualitzeu <code>docs/models.md</code> amb la documentació completa:</p>


<div class="code-block" data-lang="markdown" role="region" aria-label="Bloc de codi markdown">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">MARKDOWN</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-markdown"># Models i adaptadors

## Interfícies principals

### ElementCataleg (model intern)

Model utilitzat dins l&#39;aplicació Angular:

```typescript
interface ElementCataleg {
  id: string;
  nom: string;
  descripcio: string;
  categoria: string;
  preu: number;
  imatge: string;
  esPopular: boolean;    // ← Convenció camelCase
  stock: number;
  dataAfegit?: Date;     // ← Camp afegit
}
```

### ElementApiResponse (resposta API)

Format de les dades que retorna l&#39;API:

```typescript
interface ElementApiResponse {
  id: string;
  nom: string;
  descripcio: string;
  categoria: string;
  preu: number;
  imatge: string;
  popular: boolean;      // ← Nom diferent
  stock: number;
}
```

## Adaptadors

### adaptarElementApi()

Transforma un element de l&#39;API al format intern:

- Canvia `popular` → `esPopular`
- Afegeix `dataAfegit` amb data actual
- Manté la resta de camps

### adaptarElementsApi()

Aplica `adaptarElementApi()` a un array d&#39;elements.

### elementBuit()

Retorna un element amb valors per defecte per inicialitzar formularis.

## Mapeig de camps

| Camp API | Camp intern | Transformació |
|----------|-------------|---------------|
| `id` | `id` | Cap |
| `nom` | `nom` | Cap |
| `descripcio` | `descripcio` | Cap |
| `categoria` | `categoria` | Cap |
| `preu` | `preu` | Cap |
| `imatge` | `imatge` | Cap |
| `popular` | `esPopular` | Renombrat |
| `stock` | `stock` | Cap |
| — | `dataAfegit` | Afegit (Date actual) |</code></pre>
  </div>
</div>


  <h3>4.6. Troubleshooting</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Solució</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>Cannot find module './models/element.model'</code></td>
        <td>Ruta d'importació incorrecta</td>
        <td>Verificar que la ruta és relativa: <code>'../models/element.model'</code></td>
      </tr>
      <tr>
        <td><code>Property 'esPopular' does not exist on type...</code></td>
        <td>Interfície no definida correctament</td>
        <td>Comprovar que <code>ElementCataleg</code> té <code>esPopular: boolean</code></td>
      </tr>
      <tr>
        <td><code>Type 'Date' is not assignable to type 'undefined'</code></td>
        <td>Camp opcional mal definit</td>
        <td>Afegir <code>?</code> al camp: <code>dataAfegit?: Date</code></td>
      </tr>
      <tr>
        <td><code>Cannot read property 'map' of undefined</code></td>
        <td>Array no inicialitzat</td>
        <td>Afegir comprovació: <code>if (!apiElements) return []</code></td>
      </tr>
      <tr>
        <td>Tests d'adaptador fallen</td>
        <td>Dades mock incorrectes</td>
        <td>Verificar que mockApiElement té tots els camps requerits</td>
      </tr>
    </tbody>
  </table>

  <h3>4.7. Checkpoint</h3>

  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat les interfícies <code>ElementCataleg</code>, <code>ElementApiResponse</code> i <code>ElementsCercaResponse</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat les funcions <code>adaptarElementApi</code>, <code>adaptarElementsApi</code> i <code>elementBuit</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He afegit <code>EstatServei</code> i <code>EstatElements</code> al model</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He provat l'adaptador i funciona correctament</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He esborrat el fitxer de test temporal després de la verificació</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He documentat models i adaptadors a <code>docs/models.md</code></div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


</div>

<!-- SECCIÓ 5: Servei HTTP i gestió d'estats -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio5">
  <h2 id="Unitat3_Bloc4_Seccio5">5. Servei HTTP i gestió d'estats</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Crear un servei Angular amb HttpClient que gestiona estats de càrrega, èxit i error utilitzant signals.</p>
    <p><strong>Integra conceptes de:</strong> Lectura 3.1.1 (Creació de serveis i separació de responsabilitats), Lectura 3.1.2 (Client de peticions i comunicació amb serveis web), Lectura 3.1.3 (Gestió d'errors i estats de càrrega).</p>
  </div>

  <h3>5.1. Crear servei ElementService</h3>

  <p><strong>PowerShell (Windows):</strong></p>


<div class="code-block" data-lang="powershell" role="region" aria-label="Bloc de codi powershell">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">POWERSHELL</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-powershell">ng generate service serveis/element --skip-tests
code src\app\serveis\element.service.ts</code></pre>
  </div>
</div>


  <p><strong>bash/zsh (macOS/Linux):</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">ng generate service serveis/element --skip-tests
code src/app/serveis/element.service.ts</code></pre>
  </div>
</div>


  <h3>5.2. Implementar servei amb signals i HttpClient</h3>

  <p>Substituïu tot el contingut de <code>element.service.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { Injectable, signal } from &#39;@angular/core&#39;;
import { HttpClient, HttpErrorResponse } from &#39;@angular/common/http&#39;;
import { catchError, map, tap } from &#39;rxjs/operators&#39;;
import { of } from &#39;rxjs&#39;;

import { ElementCataleg, ElementApiResponse, EstatServei } from &#39;../models/element.model&#39;;
import { adaptarElementsApi } from &#39;../adaptadors/element.adaptador&#39;;
import { environment } from &#39;../../environments/environment.development&#39;;

@Injectable({
  providedIn: &#39;root&#39;
})
export class ElementService {
  // Signals per gestionar l&#39;estat de forma reactiva
  private readonly elementsSignal = signal&lt;ElementCataleg[]&gt;([]);
  private readonly estatSignal = signal&lt;EstatServei&gt;(&#39;inicial&#39;);
  private readonly errorSignal = signal&lt;string&gt;(&#39;&#39;);

  // Exposem signals com a només lectura
  readonly elements = this.elementsSignal.asReadonly();
  readonly estat = this.estatSignal.asReadonly();
  readonly error = this.errorSignal.asReadonly();

  private readonly apiUrl = environment.apiUrl;

  constructor(private http: HttpClient) {}

  /**
   * Obté els elements populars del catàleg
   */
  obtenirPopulars(): void {
    this.estatSignal.set(&#39;carregant&#39;);
    this.errorSignal.set(&#39;&#39;);

    this.http.get&lt;ElementApiResponse[]&gt;(`${this.apiUrl}/elements?popular=true`)
      .pipe(
        map(adaptarElementsApi),
        tap(elements =&gt; {
          this.elementsSignal.set(elements);
          this.estatSignal.set(&#39;exit&#39;);
        }),
        catchError((error: HttpErrorResponse) =&gt; {
          const missatgeError = this.gestionarError(error);
          this.errorSignal.set(missatgeError);
          this.estatSignal.set(&#39;error&#39;);
          this.elementsSignal.set([]);
          return of([]);
        })
      )
      .subscribe();
  }

  /**
   * Cerca elements per terme de cerca
   */
  cercar(terme: string): void {
    if (!terme.trim()) {
      this.obtenirPopulars();
      return;
    }

    this.estatSignal.set(&#39;carregant&#39;);
    this.errorSignal.set(&#39;&#39;);

    this.http.get&lt;ElementApiResponse[]&gt;(`${this.apiUrl}/elements?q=${terme}`)
      .pipe(
        map(adaptarElementsApi),
        tap(elements =&gt; {
          this.elementsSignal.set(elements);
          this.estatSignal.set(&#39;exit&#39;);
        }),
        catchError((error: HttpErrorResponse) =&gt; {
          const missatgeError = this.gestionarError(error);
          this.errorSignal.set(missatgeError);
          this.estatSignal.set(&#39;error&#39;);
          this.elementsSignal.set([]);
          return of([]);
        })
      )
      .subscribe();
  }

  /**
   * Comprova si un codi d&#39;element està disponible (per validació asíncrona)
   */
  codiDisponible(codi: string): Promise&lt;boolean&gt; {
    return new Promise((resolve) =&gt; {
      setTimeout(() =&gt; {
        this.http.get&lt;ElementApiResponse[]&gt;(`${this.apiUrl}/elements?id=${codi}`)
          .subscribe({
            next: (elements) =&gt; resolve(elements.length === 0),
            error: () =&gt; resolve(false)
          });
      }, 500);  // Simula latència de validació
    });
  }

  /**
   * Reinicia l&#39;estat del servei
   */
  reiniciar(): void {
    this.elementsSignal.set([]);
    this.estatSignal.set(&#39;inicial&#39;);
    this.errorSignal.set(&#39;&#39;);
  }

  /**
   * Gestiona errors HTTP i retorna missatges comprensibles
   */
  private gestionarError(error: HttpErrorResponse): string {
    if (error.error instanceof ErrorEvent) {
      // Error de client o xarxa
      return `Error de xarxa: ${error.error.message}`;
    }

    // Error del servidor
    switch (error.status) {
      case 0:
        return &#39;No es pot connectar al servidor. Comprova que json-server està actiu.&#39;;
      case 404:
        return &#39;Endpoint no trobat. Verifica la URL de l\&#39;API.&#39;;
      case 500:
        return &#39;Error intern del servidor.&#39;;
      default:
        return `Error desconegut (${error.status}): ${error.message}`;
    }
  }
}</code></pre>
  </div>
</div>


  <p><strong>Context:</strong> Aquest servei implementa:</p>
  <ul>
    <li><strong>Signals</strong> per gestió d'estat reactiu (Angular 16+)</li>
    <li><strong>Separació de responsabilitats:</strong> El servei només gestiona HTTP, l'adaptació és a l'adaptador</li>
    <li><strong>Gestió d'errors centralitzada</strong> amb missatges comprensibles</li>
    <li><strong>Mètodes per validació asíncrona</strong> (útil per formularis)</li>
  </ul>

  <h3>5.3. Configurar HttpClient a l'aplicació</h3>

  <p>Editeu <code>src/app/app.config.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { ApplicationConfig, provideZoneChangeDetection } from &#39;@angular/core&#39;;
import { provideRouter } from &#39;@angular/router&#39;;
import { provideHttpClient } from &#39;@angular/common/http&#39;;

import { routes } from &#39;./app.routes&#39;;

export const appConfig: ApplicationConfig = {
  providers: [
    provideZoneChangeDetection({ eventCoalescing: true }),
    provideRouter(routes),
    provideHttpClient()  // ← Afegir HttpClient
  ]
};</code></pre>
  </div>
</div>


  <h3>5.4. Provar el servei des de la consola del navegador</h3>

  <p>Editeu temporalment <code>app.component.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { Component, OnInit } from &#39;@angular/core&#39;;
import { ElementService } from &#39;./serveis/element.service&#39;;

@Component({
  selector: &#39;app-root&#39;,
  standalone: true,
  imports: [],
  template: `
    &lt;div&gt;
      &lt;h1&gt;Prova del servei&lt;/h1&gt;
      &lt;p&gt;Obre la consola per veure els resultats&lt;/p&gt;
    &lt;/div&gt;
  `
})
export class AppComponent implements OnInit {
  constructor(private elementService: ElementService) {}

  ngOnInit() {
    console.log(&#39;Estat inicial:&#39;, this.elementService.estat());

    this.elementService.obtenirPopulars();

    // Espera 1 segon i mostra resultats
    setTimeout(() =&gt; {
      console.log(&#39;Estat final:&#39;, this.elementService.estat());
      console.log(&#39;Elements:&#39;, this.elementService.elements());
      console.log(&#39;Error:&#39;, this.elementService.error());
    }, 1500);
  }
}</code></pre>
  </div>
</div>


  <p><strong>Verificació:</strong></p>

  <ol>
    <li>Assegureu-vos que <code>json-server</code> està actiu</li>
    <li>Executeu <code>ng serve</code></li>
    <li>Obriu <code>http://localhost:4200</code></li>
    <li>Obriu la consola del navegador (F12)</li>
  </ol>

  <p>Heu de veure:</p>
  <ul>
    <li>Estat inicial: <code>'inicial'</code></li>
    <li>Estat final: <code>'exit'</code></li>
    <li>Elements: Array amb elements populars</li>
    <li>Error: cadena buida <code>''</code></li>
  </ul>

  <p><strong>Prova d'error:</strong></p>

  <ol>
    <li>Atureu <code>json-server</code> (Ctrl+C)</li>
    <li>Recarregueu la pàgina</li>
    <li>Heu de veure:
      <ul>
        <li>Estat final: <code>'error'</code></li>
        <li>Error: "No es pot connectar al servidor..."</li>
      </ul>
    </li>
  </ol>

  <h3>5.5. Documentar el servei</h3>

  <p>Actualitzeu <code>docs/serveis.md</code> afegint:</p>


<div class="code-block" data-lang="markdown" role="region" aria-label="Bloc de codi markdown">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">MARKDOWN</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-markdown">## ElementService

### Responsabilitats

- Comunicació HTTP amb l&#39;API de catàleg
- Gestió d&#39;estats (inicial, carregant, èxit, error)
- Transformació de respostes amb adaptadors
- Gestió centralitzada d&#39;errors

### Mètodes públics

#### obtenirPopulars(): void

Carrega elements populars del catàleg.

**Flux:**
1. Canvia estat a `&#39;carregant&#39;`
2. Fa petició GET a `/elements?popular=true`
3. Adapta resposta amb `adaptarElementsApi`
4. Actualitza signals amb dades i estat `&#39;exit&#39;`
5. En cas d&#39;error, actualitza error i estat `&#39;error&#39;`

#### cercar(terme: string): void

Cerca elements per terme de cerca.

**Paràmetres:**
- `terme`: Text a cercar (mínim 1 caràcter)

**Comportament:**
- Si terme buit: carrega populars
- Si terme vàlid: cerca amb `/elements?q={terme}`

#### codiDisponible(codi: string): Promise&lt;boolean&gt;

Comprova si un codi d&#39;element està disponible (no existeix).

**Ús:** Validador asíncron per formularis

**Retorna:** `true` si el codi està disponible, `false` si ja existeix

#### reiniciar(): void

Neteja estat i elements del servei.

### Signals exposades (només lectura)

- `elements()`: Array d&#39;elements actuals
- `estat()`: Estat actual del servei
- `error()`: Missatge d&#39;error (si n&#39;hi ha)

### Gestió d&#39;errors

Errors HTTP es transformen en missatges comprensibles:

| Codi | Missatge |
|------|----------|
| 0 | &quot;No es pot connectar al servidor...&quot; |
| 404 | &quot;Endpoint no trobat...&quot; |
| 500 | &quot;Error intern del servidor&quot; |
| Altres | &quot;Error desconegut (XXX)...&quot; |

### Exemple d&#39;ús

```typescript
constructor(private elementService: ElementService) {}

ngOnInit() {
  // Carregar populars
  this.elementService.obtenirPopulars();

  // Observar estat
  effect(() =&gt; {
    console.log(&#39;Estat:&#39;, this.elementService.estat());
    console.log(&#39;Elements:&#39;, this.elementService.elements());
  });
}
```</code></pre>
  </div>
</div>


  <h3>5.6. Troubleshooting</h3>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Solució</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>NullInjectorError: No provider for HttpClient</code></td>
        <td>HttpClient no configurat</td>
        <td>Afegir <code>provideHttpClient()</code> a <code>app.config.ts</code></td>
      </tr>
      <tr>
        <td><code>Cannot read properties of undefined (reading 'set')</code></td>
        <td>Signal no inicialitzat</td>
        <td>Verificar que signals es defineixen amb <code>signal&lt;T&gt;(valorInicial)</code></td>
      </tr>
      <tr>
        <td><code>ERROR Error: NG0203: inject() must be called...</code></td>
        <td>Servei injectat fora del context</td>
        <td>Moure injecció al constructor, NO a mètodes</td>
      </tr>
      <tr>
        <td>Estat sempre en 'carregant'</td>
        <td>Subscribe no cridat</td>
        <td>Afegir <code>.subscribe()</code> al final del pipe</td>
      </tr>
      <tr>
        <td><code>CORS policy: No 'Access-Control-Allow-Origin' header</code></td>
        <td>json-server no permet CORS</td>
        <td>json-server té CORS activat per defecte, verificar URL</td>
      </tr>
      <tr>
        <td>Adaptador no transforma dades</td>
        <td>map() no aplicat</td>
        <td>Afegir <code>.pipe(map(adaptarElementsApi))</code> abans de tap</td>
      </tr>
      <tr>
        <td>Elements duplicats</td>
        <td>Múltiples crides simultànies</td>
        <td>Implementar debounce o takeUntil per cancel·lar peticions anteriors</td>
      </tr>
      <tr>
        <td><code>Cannot find module '@angular/common/http'</code></td>
        <td>Dependència no instal·lada</td>
        <td>Executar <code>npm install</code> per instal·lar totes les dependències</td>
      </tr>
    </tbody>
  </table>

  <h3>5.7. Checkpoint</h3>

  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat el servei <code>ElementService</code> amb signals</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He implementat els mètodes <code>obtenirPopulars()</code>, <code>cercar()</code> i <code>codiDisponible()</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He configurat <code>provideHttpClient()</code> a <code>app.config.ts</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He provat el servei i funciona correctament amb estats d'èxit i error</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He verificat la gestió d'errors centralitzada</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He documentat el servei a <code>docs/serveis.md</code></div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


</div>

<!-- SECCIÓ 6: Llistat reactiu amb estats -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio6">
  <h2 id="Unitat3_Bloc4_Seccio6">6. Llistat reactiu amb estats</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Crear un component de pàgina que mostra un llistat d'elements amb gestió visual dels quatre estats possibles (inicial, carregant, èxit, error).</p>
    <p><strong>Integra conceptes de:</strong> Lectura 3.2.3 (Integració reactiva amb components), Lectura 3.1.3 (Gestió d'errors i estats de càrrega).</p>
  </div>

  <h3>6.1. Crear component CatalegPage</h3>

  <p><strong>PowerShell (Windows):</strong></p>


<div class="code-block" data-lang="powershell" role="region" aria-label="Bloc de codi powershell">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">POWERSHELL</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-powershell">ng generate component pages/cataleg-page --standalone --inline-style=false --inline-template=false --skip-tests
code src\app\pages\cataleg-page\cataleg-page.component.ts</code></pre>
  </div>
</div>


  <p><strong>bash/zsh (macOS/Linux):</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">ng generate component pages/cataleg-page --standalone --inline-style=false --inline-template=false --skip-tests
code src/app/pages/cataleg-page/cataleg-page.component.ts</code></pre>
  </div>
</div>


  <h3>6.2. Implementar lògica del component</h3>

  <p>Substituïu el contingut de <code>cataleg-page.component.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { Component, OnInit } from &#39;@angular/core&#39;;
import { CommonModule } from &#39;@angular/common&#39;;
import { ElementService } from &#39;../../serveis/element.service&#39;;

@Component({
  selector: &#39;app-cataleg-page&#39;,
  standalone: true,
  imports: [CommonModule],
  templateUrl: &#39;./cataleg-page.component.html&#39;,
  styleUrl: &#39;./cataleg-page.component.scss&#39;
})
export class CatalegPageComponent implements OnInit {
  constructor(public elementService: ElementService) {}

  ngOnInit(): void {
    this.elementService.obtenirPopulars();
  }

  reintentar(): void {
    this.elementService.obtenirPopulars();
  }
}</code></pre>
  </div>
</div>


  <p><strong>Context:</strong> El component és mínim. Delega tota la lògica al servei i només exposa mètodes per la vista. És un component "contenidor" o "smart component".</p>

  <h3>6.3. Crear plantilla amb gestió d'estats</h3>

  <p>Substituïu el contingut de <code>cataleg-page.component.html</code>:</p>


<div class="code-block" data-lang="html" role="region" aria-label="Bloc de codi html">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">HTML</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-html">&lt;div class=&quot;cataleg-page&quot;&gt;
  &lt;header class=&quot;page-header&quot;&gt;
    &lt;h1&gt;Catàleg d&#39;Elements&lt;/h1&gt;
    &lt;p class=&quot;subtitle&quot;&gt;Elements populars del nostre catàleg&lt;/p&gt;
  &lt;/header&gt;

  &lt;!-- Estat: Carregant --&gt;
  &lt;div class=&quot;estat-carregant&quot; *ngIf=&quot;elementService.estat() === &#39;carregant&#39;&quot;&gt;
    &lt;div class=&quot;spinner&quot;&gt;&lt;/div&gt;
    &lt;p&gt;Carregant elements...&lt;/p&gt;
  &lt;/div&gt;

  &lt;!-- Estat: Error --&gt;
  &lt;div class=&quot;estat-error&quot; *ngIf=&quot;elementService.estat() === &#39;error&#39;&quot;&gt;
    &lt;div class=&quot;error-icon&quot;&gt;⚠️&lt;/div&gt;
    &lt;h2&gt;Error al carregar elements&lt;/h2&gt;
    &lt;p class=&quot;error-missatge&quot;&gt;{{ elementService.error() }}&lt;/p&gt;
    &lt;button class=&quot;btn-reintentar&quot; (click)=&quot;reintentar()&quot;&gt;
      Reintentar
    &lt;/button&gt;
  &lt;/div&gt;

  &lt;!-- Estat: Èxit (elements carregats) --&gt;
  &lt;div class=&quot;estat-exit&quot; *ngIf=&quot;elementService.estat() === &#39;exit&#39;&quot;&gt;
    &lt;!-- Missatge si no hi ha elements --&gt;
    &lt;div class=&quot;sense-resultats&quot; *ngIf=&quot;elementService.elements().length === 0&quot;&gt;
      &lt;p&gt;No s&#39;han trobat elements populars&lt;/p&gt;
    &lt;/div&gt;

    &lt;!-- Llistat d&#39;elements --&gt;
    &lt;div class=&quot;elements-grid&quot; *ngIf=&quot;elementService.elements().length &gt; 0&quot;&gt;
      &lt;div class=&quot;element-card&quot; *ngFor=&quot;let element of elementService.elements()&quot;&gt;
        &lt;img [src]=&quot;element.imatge&quot; [alt]=&quot;element.nom&quot; class=&quot;element-imatge&quot;&gt;
        &lt;div class=&quot;element-info&quot;&gt;
          &lt;h3 class=&quot;element-nom&quot;&gt;{{ element.nom }}&lt;/h3&gt;
          &lt;p class=&quot;element-categoria&quot;&gt;{{ element.categoria }}&lt;/p&gt;
          &lt;p class=&quot;element-descripcio&quot;&gt;{{ element.descripcio }}&lt;/p&gt;
          &lt;div class=&quot;element-footer&quot;&gt;
            &lt;span class=&quot;element-preu&quot;&gt;{{ element.preu | number:&#39;1.2-2&#39; }}€&lt;/span&gt;
            &lt;span class=&quot;element-stock&quot; [class.baix-stock]=&quot;element.stock &lt; 20&quot;&gt;
              Stock: {{ element.stock }}
            &lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Estat: Inicial (no s&#39;ha carregat res encara) --&gt;
  &lt;div class=&quot;estat-inicial&quot; *ngIf=&quot;elementService.estat() === &#39;inicial&#39;&quot;&gt;
    &lt;p&gt;Inicialitzant...&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
  </div>
</div>


  <p><strong>Context:</strong> La plantilla mostra diferents vistes segons l'estat del servei:</p>
  <ul>
    <li><strong>Carregant:</strong> Spinner animat</li>
    <li><strong>Error:</strong> Missatge amb botó de reintent</li>
    <li><strong>Èxit:</strong> Grid d'elements</li>
    <li><strong>Inicial:</strong> Missatge temporal</li>
  </ul>

  <h3>6.4. Afegir estils al component</h3>

  <p>Substituïu el contingut de <code>cataleg-page.component.scss</code>:</p>


<div class="code-block" data-lang="scss" role="region" aria-label="Bloc de codi scss">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">SCSS</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-scss">.cataleg-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.page-header {
  margin-bottom: 2rem;

  h1 {
    margin: 0 0 0.5rem;
    color: #333;
  }

  .subtitle {
    margin: 0;
    color: #666;
    font-size: 1.1rem;
  }
}

// Estat: Carregant
.estat-carregant {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 4rem 0;

  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  p {
    margin-top: 1rem;
    color: #666;
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

// Estat: Error
.estat-error {
  background-color: #fee;
  border: 2px solid #e74c3c;
  border-radius: 8px;
  padding: 2rem;
  text-align: center;
  margin: 2rem 0;

  .error-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  h2 {
    margin: 0 0 1rem;
    color: #c0392b;
  }

  .error-missatge {
    margin: 0 0 1.5rem;
    color: #666;
    font-size: 1rem;
  }

  .btn-reintentar {
    background-color: #e74c3c;
    color: white;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 4px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s;

    &amp;:hover {
      background-color: #c0392b;
    }
  }
}

// Estat: Èxit
.sense-resultats {
  text-align: center;
  padding: 3rem;
  color: #666;
  font-size: 1.1rem;
}

.elements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
}

.element-card {
  background-color: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  transition: transform 0.3s, box-shadow 0.3s;

  &amp;:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .element-imatge {
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .element-info {
    padding: 1rem;

    .element-nom {
      margin: 0 0 0.5rem;
      font-size: 1.2rem;
      color: #333;
    }

    .element-categoria {
      margin: 0 0 0.75rem;
      font-size: 0.9rem;
      color: #3498db;
      font-weight: 600;
    }

    .element-descripcio {
      margin: 0 0 1rem;
      color: #666;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .element-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 0.75rem;
      border-top: 1px solid #eee;

      .element-preu {
        font-size: 1.3rem;
        font-weight: bold;
        color: #27ae60;
      }

      .element-stock {
        font-size: 0.9rem;
        color: #666;
        padding: 0.25rem 0.5rem;
        background-color: #ecf0f1;
        border-radius: 4px;

        &amp;.baix-stock {
          background-color: #ffe6e6;
          color: #e74c3c;
        }
      }
    }
  }
}

// Estat: Inicial
.estat-inicial {
  text-align: center;
  padding: 3rem;
  color: #999;
  font-style: italic;
}</code></pre>
  </div>
</div>


  <h3>6.5. Integrar component a l'aplicació</h3>

  <p>Editeu <code>app.component.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { Component } from &#39;@angular/core&#39;;
import { CatalegPageComponent } from &#39;./pages/cataleg-page/cataleg-page.component&#39;;

@Component({
  selector: &#39;app-root&#39;,
  standalone: true,
  imports: [CatalegPageComponent],
  template: `&lt;app-cataleg-page /&gt;`,
  styles: [`
    :host {
      display: block;
      min-height: 100vh;
      background-color: #f5f5f5;
    }
  `]
})
export class AppComponent {}</code></pre>
  </div>
</div>


  <h3>6.6. Provar els diferents estats</h3>

  <p><strong>Verificació 1: Estat de càrrega</strong></p>

  <ol>
    <li>Assegureu-vos que json-server està actiu amb delay 600ms</li>
    <li>Executeu <code>ng serve</code></li>
    <li>Obriu <code>http://localhost:4200</code></li>
    <li>Heu de veure breument el spinner de càrrega</li>
  </ol>

  <p><strong>Verificació 2: Estat d'èxit</strong></p>

  <ol>
    <li>Després del spinner, heu de veure una graella amb elements</li>
    <li>Cada targeta mostra: imatge, nom, categoria, descripció, preu i stock</li>
    <li>Elements amb stock &lt; 20 mostren l'indicador en vermell</li>
  </ol>

  <p><strong>Verificació 3: Estat d'error</strong></p>

  <ol>
    <li>Atureu json-server (Ctrl+C a la terminal)</li>
    <li>Recarregueu la pàgina</li>
    <li>Heu de veure el missatge d'error amb botó "Reintentar"</li>
    <li>El missatge ha de ser: "No es pot connectar al servidor. Comprova que json-server està actiu."</li>
  </ol>

  <p><strong>Verificació 4: Reintent després d'error</strong></p>

  <ol>
    <li>Torneu a arrencar json-server</li>
    <li>Feu clic al botó "Reintentar"</li>
    <li>Heu de veure el spinner breument</li>
    <li>Després, els elements es carreguen correctament</li>
  </ol>

  <h3>6.7. Troubleshooting</h3>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Solució</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>Can't bind to 'ngIf' since it isn't a known property</code></td>
        <td>CommonModule no importat</td>
        <td>Afegir <code>CommonModule</code> a imports del component</td>
      </tr>
      <tr>
        <td>Elements no es mostren</td>
        <td>estat() no és 'exit'</td>
        <td>Verificar a consola el valor de <code>elementService.estat()</code></td>
      </tr>
      <tr>
        <td>Spinner no desapareix</td>
        <td>Subscribe no finalitza</td>
        <td>Verificar que tap() actualitza estat a 'exit'</td>
      </tr>
      <tr>
        <td>Estils no s'apliquen</td>
        <td>Fitxer SCSS no enllaçat</td>
        <td>Verificar <code>styleUrl</code> al decorador del component</td>
      </tr>
      <tr>
        <td>Pipe 'number' no funciona</td>
        <td>CommonModule no importat</td>
        <td>Afegir <code>CommonModule</code> a imports del component</td>
      </tr>
      <tr>
        <td>Imatges no es carreguen</td>
        <td>URLs placeholder invàlides</td>
        <td>Verificar que les URLs són accessibles</td>
      </tr>
    </tbody>
  </table>

  <h3>6.8. Checkpoint</h3>

  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat el component <code>CatalegPageComponent</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He implementat la plantilla amb gestió dels 4 estats (inicial, carregant, exit, error)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He afegit estils responsius amb indicadors visuals</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He integrat el component a l'aplicació</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He provat l'estat de càrrega (spinner visible)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He provat l'estat d'èxit (graella d'elements)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He provat l'estat d'error (missatge amb botó reintentar)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">El botó reintentar funciona correctament</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


</div>

<!-- SECCIÓ 7: Formulari de cerca amb validació asíncrona -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio7">
  <h2 id="Unitat3_Bloc4_Seccio7">7. Formulari de cerca amb validació asíncrona</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Crear un formulari reactiu de cerca amb validació asíncrona i debounce per evitar cerques excessives.</p>
    <p><strong>Integra conceptes de:</strong> Lectura 3.3.1 (Formularis reactius: grups i controls), Lectura 3.3.2 (Validacions personalitzades i asíncrones).</p>
  </div>

  <h3>7.1. Crear validador asíncron</h3>

  <p><strong>PowerShell (Windows):</strong></p>


<div class="code-block" data-lang="powershell" role="region" aria-label="Bloc de codi powershell">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">POWERSHELL</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-powershell">New-Item -Path &quot;src\app\validadors&quot; -ItemType Directory -Force
New-Item -Path &quot;src\app\validadors\codi-disponible.validator.ts&quot; -ItemType File
code src\app\validadors\codi-disponible.validator.ts</code></pre>
  </div>
</div>


  <p><strong>bash/zsh (macOS/Linux):</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">mkdir -p src/app/validadors
touch src/app/validadors/codi-disponible.validator.ts
code src/app/validadors/codi-disponible.validator.ts</code></pre>
  </div>
</div>


  <p>Afegiu el següent codi:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { AbstractControl, AsyncValidatorFn, ValidationErrors } from &#39;@angular/forms&#39;;
import { Observable, of } from &#39;rxjs&#39;;
import { map, delay } from &#39;rxjs/operators&#39;;
import { ElementService } from &#39;../serveis/element.service&#39;;

/**
 * Validador asíncron que comprova si un codi d&#39;element està disponible
 */
export function codiDisponibleValidator(elementService: ElementService): AsyncValidatorFn {
  return (control: AbstractControl): Observable&lt;ValidationErrors | null&gt; =&gt; {
    if (!control.value) {
      return of(null);
    }

    return of(control.value).pipe(
      delay(500),  // Simula latència de xarxa
      map(async (codi: string) =&gt; {
        const disponible = await elementService.codiDisponible(codi);
        return disponible ? null : { codiNoDisponible: { value: codi } };
      })
    ) as Observable&lt;ValidationErrors | null&gt;;
  };
}</code></pre>
  </div>
</div>


  <p><strong>Context:</strong> Aquest validador asíncron comprova si un codi ja existeix a l'API. El delay simula latència real i permet mostrar indicadors de "comprovant...".</p>

  <h3>7.2. Crear component de cerca</h3>

  <p><strong>PowerShell (Windows):</strong></p>


<div class="code-block" data-lang="powershell" role="region" aria-label="Bloc de codi powershell">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">POWERSHELL</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-powershell">ng generate component components/formulari-cerca --standalone --inline-style=false --inline-template=false --skip-tests
code src\app\components\formulari-cerca\formulari-cerca.component.ts</code></pre>
  </div>
</div>


  <p><strong>bash/zsh (macOS/Linux):</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">ng generate component components/formulari-cerca --standalone --inline-style=false --inline-template=false --skip-tests
code src/app/components/formulari-cerca/formulari-cerca.component.ts</code></pre>
  </div>
</div>


  <h3>7.3. Implementar formulari reactiu</h3>

  <p>Substituïu el contingut de <code>formulari-cerca.component.ts</code>:</p>



<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { Component, OnInit } from &#39;@angular/core&#39;;
import { CommonModule } from &#39;@angular/common&#39;;
import { FormBuilder, FormGroup, ReactiveFormsModule, Validators } from &#39;@angular/forms&#39;;
import { ElementService } from &#39;../../serveis/element.service&#39;;
import { codiDisponibleValidator } from &#39;../../validadors/codi-disponible.validator&#39;;
import { debounceTime } from &#39;rxjs/operators&#39;;

@Component({
  selector: &#39;app-formulari-cerca&#39;,
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule],
  templateUrl: &#39;./formulari-cerca.component.html&#39;,
  styleUrl: &#39;./formulari-cerca.component.scss&#39;
})
export class FormulariCercaComponent implements OnInit {
  formulariCerca!: FormGroup;

  constructor(
    private fb: FormBuilder,
    private elementService: ElementService
  ) {}

  ngOnInit(): void {
    this.formulariCerca = this.fb.group({
      terme: [&#39;&#39;, [
        Validators.minLength(3)
      ]]
    });

    // Cerca automàtica amb debounce
    this.formulariCerca.get(&#39;terme&#39;)?.valueChanges
      .pipe(debounceTime(500))
      .subscribe(terme =&gt; {
        if (this.formulariCerca.get(&#39;terme&#39;)?.valid) {
          this.cercar();
        }
      });
  }

  cercar(): void {
    const terme = this.formulariCerca.get(&#39;terme&#39;)?.value;
    this.elementService.cercar(terme);
  }

  netejar(): void {
    this.formulariCerca.reset();
    this.elementService.obtenirPopulars();
  }

  get estaCarregant(): boolean {
    return this.elementService.estat() === &#39;carregant&#39;;
  }

  get termeInvalid(): boolean {
    const control = this.formulariCerca.get(&#39;terme&#39;);
    return !!(control?.invalid &amp;&amp; control?.touched);
  }

  get missatgeError(): string {
    const control = this.formulariCerca.get(&#39;terme&#39;);
    if (control?.hasError(&#39;minlength&#39;)) {
      return &#39;Mínim 3 caràcters&#39;;
    }
    return &#39;&#39;;
  }
}</code></pre>
  </div>
</div>


  <p><strong>Context:</strong> El formulari implementa:</p>
  <ul>
    <li>Cerca automàtica amb <code>debounceTime</code> (espera 500ms després de l'última tecla)</li>
    <li>Validació de longitud mínima (3 caràcters)</li>
    <li>Gestió d'estats de càrrega</li>
  </ul>

  <h3>7.4. Crear plantilla del formulari</h3>

  <p>Substituïu el contingut de <code>formulari-cerca.component.html</code>:</p>


<div class="code-block" data-lang="html" role="region" aria-label="Bloc de codi html">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">HTML</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-html">&lt;div class=&quot;formulari-cerca&quot;&gt;
  &lt;form [formGroup]=&quot;formulariCerca&quot; (ngSubmit)=&quot;cercar()&quot;&gt;
    &lt;div class=&quot;camp-cerca&quot;&gt;
      &lt;input type=&quot;text&quot; formControlName=&quot;terme&quot; placeholder=&quot;Cerca elements per nom...&quot; class=&quot;input-cerca&quot; [class.invalid]=&quot;termeInvalid&quot;&gt;
      &lt;div class=&quot;indicadors&quot;&gt;
        &lt;span class=&quot;spinner-petit&quot; *ngIf=&quot;estaCarregant&quot;&gt;&lt;/span&gt;
        &lt;button type=&quot;button&quot; class=&quot;btn-netejar&quot; (click)=&quot;netejar()&quot; *ngIf=&quot;formulariCerca.get(&#39;terme&#39;)?.value&quot;&gt;✕&lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;missatge-error&quot; *ngIf=&quot;termeInvalid&quot;&gt;{{ missatgeError }}&lt;/div&gt;
    &lt;div class=&quot;accions&quot;&gt;
      &lt;button type=&quot;submit&quot; class=&quot;btn-cercar&quot; [disabled]=&quot;formulariCerca.invalid || estaCarregant&quot;&gt;Cercar&lt;/button&gt;
    &lt;/div&gt;
  &lt;/form&gt;
&lt;/div&gt;</code></pre>
  </div>
</div>


  <h3>7.5. Afegir estils al formulari</h3>

  <p>Substituïu el contingut de <code>formulari-cerca.component.scss</code>:</p>


<div class="code-block" data-lang="scss" role="region" aria-label="Bloc de codi scss">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">SCSS</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-scss">.formulari-cerca {
  background-color: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-bottom: 2rem;

  form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .camp-cerca {
    position: relative;
    display: flex;
    align-items: center;

    .input-cerca {
      flex: 1;
      padding: 0.75rem 3rem 0.75rem 1rem;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
      transition: border-color 0.3s;

      &amp;:focus {
        outline: none;
        border-color: #3498db;
      }

      &amp;.invalid {
        border-color: #e74c3c;
      }
    }

    .indicadors {
      position: absolute;
      right: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;

      .spinner-petit {
        width: 20px;
        height: 20px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      .btn-netejar {
        background: none;
        border: none;
        font-size: 1.2rem;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: color 0.3s;

        &amp;:hover {
          color: #e74c3c;
        }
      }
    }
  }

  .missatge-error {
    color: #e74c3c;
    font-size: 0.9rem;
    margin-top: -0.5rem;
  }

  .accions {
    display: flex;
    gap: 1rem;

    .btn-cercar {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;

      &amp;:hover:not(:disabled) {
        background-color: #2980b9;
      }

      &amp;:disabled {
        background-color: #bdc3c7;
        cursor: not-allowed;
      }
    }
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}</code></pre>
  </div>
</div>


  <h3>7.6. Integrar formulari al CatalegPage</h3>

  <p>Editeu <code>cataleg-page.component.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { Component, OnInit } from &#39;@angular/core&#39;;
import { CommonModule } from &#39;@angular/common&#39;;
import { ElementService } from &#39;../../serveis/element.service&#39;;
import { FormulariCercaComponent } from &#39;../../components/formulari-cerca/formulari-cerca.component&#39;;

@Component({
  selector: &#39;app-cataleg-page&#39;,
  standalone: true,
  imports: [CommonModule, FormulariCercaComponent],  // ← Afegir import
  templateUrl: &#39;./cataleg-page.component.html&#39;,
  styleUrl: &#39;./cataleg-page.component.scss&#39;
})
export class CatalegPageComponent implements OnInit {
  constructor(public elementService: ElementService) {}

  ngOnInit(): void {
    this.elementService.obtenirPopulars();
  }

  reintentar(): void {
    this.elementService.obtenirPopulars();
  }
}</code></pre>
  </div>
</div>


  <p>Actualitzeu <code>cataleg-page.component.html</code> afegint el formulari després del header:</p>


<div class="code-block" data-lang="html" role="region" aria-label="Bloc de codi html">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">HTML</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-html">&lt;div class=&quot;cataleg-page&quot;&gt;
  &lt;header class=&quot;page-header&quot;&gt;
    &lt;h1&gt;Catàleg d&#39;Elements&lt;/h1&gt;
    &lt;p class=&quot;subtitle&quot;&gt;Elements populars del nostre catàleg&lt;/p&gt;
  &lt;/header&gt;

  &lt;!-- AFEGIR FORMULARI AQUÍ --&gt;
  &lt;app-formulari-cerca /&gt;

  &lt;!-- Resta del contingut... --&gt;</code></pre>
  </div>
</div>


  <h3>7.7. Provar el formulari de cerca</h3>

  <p><strong>Verificació 1: Validació de longitud</strong></p>
  <ol>
    <li>Escriviu "Ar" (2 caràcters)</li>
    <li>Heu de veure el missatge "Mínim 3 caràcters"</li>
    <li>El botó "Cercar" està deshabilitat</li>
  </ol>

  <p><strong>Verificació 2: Cerca automàtica</strong></p>
  <ol>
    <li>Escriviu "Arduino" (més de 3 caràcters)</li>
    <li>Espereu 500ms sense escriure més</li>
    <li>Heu de veure el spinner petit a la dreta de l'input</li>
    <li>Després, els resultats es filtren automàticament</li>
  </ol>

  <p><strong>Verificació 3: Botó de netejar</strong></p>
  <ol>
    <li>Amb text a l'input, heu de veure una "✕" a la dreta</li>
    <li>Feu clic a la "✕"</li>
    <li>L'input es buida i es tornen a carregar els populars</li>
  </ol>

  <h3>7.8. Documentar formularis</h3>

  <p>Actualitzeu <code>docs/formularis.md</code>:</p>


<div class="code-block" data-lang="markdown" role="region" aria-label="Bloc de codi markdown">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">MARKDOWN</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-markdown"># Formularis

## FormulariCercaComponent

### Funcionalitat

Formulari reactiu per cercar elements del catàleg amb validació de longitud mínima i cerca automàtica amb debounce.

### Validacions

| Camp | Validació | Missatge d&#39;error |
|------|-----------|------------------|
| terme | `minLength(3)` | &quot;Mínim 3 caràcters&quot; |

### Comportament

- **Cerca automàtica:** Després de 500ms sense escriure, cerca automàticament
- **Debounce:** Evita cerques excessives mentre l&#39;usuari escriu
- **Indicador de càrrega:** Spinner petit mentre cerca
- **Botó netejar:** Apareix quan hi ha text, neteja i torna als populars

### Exemple d&#39;integració

```typescript
import { FormulariCercaComponent } from &#39;./components/formulari-cerca/formulari-cerca.component&#39;;

@Component({
  imports: [FormulariCercaComponent],
  template: `&lt;app-formulari-cerca /&gt;`
})
export class PageComponent {}
```</code></pre>
  </div>
</div>


  <h3>7.9. Troubleshooting</h3>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Solució</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>Can't bind to 'formGroup' since it isn't a known property</code></td>
        <td>ReactiveFormsModule no importat</td>
        <td>Afegir <code>ReactiveFormsModule</code> a imports del component</td>
      </tr>
      <tr>
        <td>Validador asíncron no s'executa</td>
        <td>Validador mal configurat</td>
        <td>Verificar que retorna <code>Observable&lt;ValidationErrors | null&gt;</code></td>
      </tr>
      <tr>
        <td>debounceTime no funciona</td>
        <td>RxJS operators mal importats</td>
        <td>Importar <code>import { debounceTime } from 'rxjs/operators'</code></td>
      </tr>
      <tr>
        <td>Formulari no reactiu</td>
        <td>FormGroup no inicialitzat</td>
        <td>Verificar que <code>ngOnInit()</code> crea el FormGroup</td>
      </tr>
      <tr>
        <td>valueChanges no s'activa</td>
        <td>Subscribe no cridat</td>
        <td>Afegir <code>.subscribe()</code> al final del pipe</td>
      </tr>
    </tbody>
  </table>

  <h3>7.10. Checkpoint</h3>

  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat el validador asíncron <code>codiDisponibleValidator</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat el component <code>FormulariCercaComponent</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He implementat el formulari reactiu amb <code>FormBuilder</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He afegit validació de longitud mínima (3 caràcters)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He implementat cerca automàtica amb <code>debounceTime</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He afegit indicadors visuals (spinner, botó netejar)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He integrat el formulari a <code>CatalegPageComponent</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He provat les 3 verificacions i funcionen correctament</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He documentat el formulari a <code>docs/formularis.md</code></div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


</div>

<!-- SECCIÓ 8: Preferits locals i formulari dinàmic -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio8">
  <h2 id="Unitat3_Bloc4_Seccio8">8. Preferits locals i formulari dinàmic</h2>

  <div class="info_box">
    <p><strong>Objectiu:</strong> Implementar sistema de preferits amb persistència a localStorage i formularis dinàmics amb FormArray per gestionar notes.</p>
    <p><strong>Integra conceptes de:</strong> Lectura 3.3.3 (Formularis complexos i camps dinàmics), Lectura 3.2.3 (Integració reactiva amb components).</p>
  </div>

  <h3>8.1. Crear servei de preferits</h3>

  <p><strong>PowerShell (Windows):</strong></p>


<div class="code-block" data-lang="powershell" role="region" aria-label="Bloc de codi powershell">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">POWERSHELL</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-powershell">ng generate service serveis/preferits --skip-tests
code src\app\serveis\preferits.service.ts</code></pre>
  </div>
</div>


  <p><strong>bash/zsh (macOS/Linux):</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">ng generate service serveis/preferits --skip-tests
code src/app/serveis/preferits.service.ts</code></pre>
  </div>
</div>


  <h3>8.2. Implementar servei amb localStorage</h3>

  <p>Substituïu tot el contingut de <code>preferits.service.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { Injectable, signal } from &#39;@angular/core&#39;;

export interface Preferit {
  elementId: string;
  elementNom: string;
  notes: string[];
  dataAfegit: Date;
}

@Injectable({
  providedIn: &#39;root&#39;
})
export class PreferitsService {
  private readonly CLAU_STORAGE = &#39;catalog_preferits&#39;;
  private readonly preferitsSignal = signal&lt;Preferit[]&gt;([]);

  readonly preferits = this.preferitsSignal.asReadonly();

  constructor() {
    this.carregarPreferits();
  }

  /**
   * Carrega preferits des de localStorage
   */
  private carregarPreferits(): void {
    const dades = localStorage.getItem(this.CLAU_STORAGE);
    if (dades) {
      try {
        const preferits = JSON.parse(dades) as Preferit[];
        // Convertir strings de data a objectes Date
        preferits.forEach(p =&gt; p.dataAfegit = new Date(p.dataAfegit));
        this.preferitsSignal.set(preferits);
      } catch (error) {
        console.error(&#39;Error carregant preferits:&#39;, error);
        this.preferitsSignal.set([]);
      }
    }
  }

  /**
   * Desa preferits a localStorage
   */
  private desarPreferits(): void {
    localStorage.setItem(this.CLAU_STORAGE, JSON.stringify(this.preferitsSignal()));
  }

  /**
   * Afegeix un element als preferits
   */
  afegirPreferit(elementId: string, elementNom: string): void {
    if (this.esPreferit(elementId)) {
      return;
    }

    const nouPreferit: Preferit = {
      elementId,
      elementNom,
      notes: [],
      dataAfegit: new Date()
    };

    this.preferitsSignal.update(preferits =&gt; [...preferits, nouPreferit]);
    this.desarPreferits();
  }

  /**
   * Elimina un element dels preferits
   */
  eliminarPreferit(elementId: string): void {
    this.preferitsSignal.update(preferits =&gt;
      preferits.filter(p =&gt; p.elementId !== elementId)
    );
    this.desarPreferits();
  }

  /**
   * Afegeix una nota a un preferit
   */
  afegirNota(elementId: string, nota: string): void {
    this.preferitsSignal.update(preferits =&gt;
      preferits.map(p =&gt; {
        if (p.elementId === elementId) {
          return { ...p, notes: [...p.notes, nota] };
        }
        return p;
      })
    );
    this.desarPreferits();
  }

  /**
   * Elimina una nota d&#39;un preferit
   */
  eliminarNota(elementId: string, indexNota: number): void {
    this.preferitsSignal.update(preferits =&gt;
      preferits.map(p =&gt; {
        if (p.elementId === elementId) {
          const notesActualitzades = [...p.notes];
          notesActualitzades.splice(indexNota, 1);
          return { ...p, notes: notesActualitzades };
        }
        return p;
      })
    );
    this.desarPreferits();
  }

  /**
   * Comprova si un element és preferit
   */
  esPreferit(elementId: string): boolean {
    return this.preferitsSignal().some(p =&gt; p.elementId === elementId);
  }

  /**
   * Obté un preferit per ID
   */
  obtenirPreferit(elementId: string): Preferit | undefined {
    return this.preferitsSignal().find(p =&gt; p.elementId === elementId);
  }
}</code></pre>
  </div>
</div>


  <p><strong>Context:</strong> Aquest servei gestiona preferits amb persistència a <code>localStorage</code>:</p>
  <ul>
    <li>Carrega automàticament al inicialitzar</li>
    <li>Desa després de cada modificació</li>
    <li>Utilitza signals per reactivitat</li>
    <li>Suporta notes dinàmiques per cada preferit</li>
  </ul>

  <h3>8.3. Crear component de preferits</h3>

  <p><strong>PowerShell (Windows):</strong></p>


<div class="code-block" data-lang="powershell" role="region" aria-label="Bloc de codi powershell">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">POWERSHELL</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-powershell">ng generate component components/preferits-panel --standalone --inline-style=false --inline-template=false --skip-tests
code src\app\components\preferits-panel\preferits-panel.component.ts</code></pre>
  </div>
</div>


  <p><strong>bash/zsh (macOS/Linux):</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">ng generate component components/preferits-panel --standalone --inline-style=false --inline-template=false --skip-tests
code src/app/components/preferits-panel/preferits-panel.component.ts</code></pre>
  </div>
</div>


  <h3>8.4. Implementar component amb FormArray</h3>

  <p>Substituïu tot el contingut de <code>preferits-panel.component.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { Component, OnInit } from &#39;@angular/core&#39;;
import { CommonModule } from &#39;@angular/common&#39;;
import { FormArray, FormBuilder, FormGroup, ReactiveFormsModule, Validators } from &#39;@angular/forms&#39;;
import { PreferitsService, Preferit } from &#39;../../serveis/preferits.service&#39;;

@Component({
  selector: &#39;app-preferits-panel&#39;,
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule],
  templateUrl: &#39;./preferits-panel.component.html&#39;,
  styleUrl: &#39;./preferits-panel.component.scss&#39;
})
export class PreferitsPanelComponent implements OnInit {
  formulariNotes: FormGroup;
  preferitSeleccionat: Preferit | null = null;

  constructor(
    private fb: FormBuilder,
    public preferitsService: PreferitsService
  ) {
    this.formulariNotes = this.fb.group({
      notes: this.fb.array([])
    });
  }

  ngOnInit(): void {}

  get notes(): FormArray {
    return this.formulariNotes.get(&#39;notes&#39;) as FormArray;
  }

  seleccionarPreferit(preferit: Preferit): void {
    this.preferitSeleccionat = preferit;
    this.notes.clear();

    // Carregar notes existents al FormArray
    preferit.notes.forEach(nota =&gt; {
      this.notes.push(this.fb.control(nota, [Validators.required, Validators.minLength(3)]));
    });

    // Afegir camp buit per nova nota
    this.notes.push(this.fb.control(&#39;&#39;, [Validators.required, Validators.minLength(3)]));
  }

  afegirNota(): void {
    if (!this.preferitSeleccionat) return;

    // Obtenir última nota (la buida)
    const ultimIndex = this.notes.length - 1;
    const ultimControl = this.notes.at(ultimIndex);

    if (ultimControl.valid) {
      const nota = ultimControl.value;
      this.preferitsService.afegirNota(this.preferitSeleccionat.elementId, nota);

      // Recarregar preferit actualitzat
      const preferitActualitzat = this.preferitsService.obtenirPreferit(this.preferitSeleccionat.elementId);
      if (preferitActualitzat) {
        this.seleccionarPreferit(preferitActualitzat);
      }
    }
  }

  eliminarNota(index: number): void {
    if (!this.preferitSeleccionat) return;

    this.preferitsService.eliminarNota(this.preferitSeleccionat.elementId, index);

    // Recarregar preferit actualitzat
    const preferitActualitzat = this.preferitsService.obtenirPreferit(this.preferitSeleccionat.elementId);
    if (preferitActualitzat) {
      this.seleccionarPreferit(preferitActualitzat);
    } else {
      this.preferitSeleccionat = null;
      this.notes.clear();
    }
  }

  eliminarPreferit(elementId: string): void {
    this.preferitsService.eliminarPreferit(elementId);
    if (this.preferitSeleccionat?.elementId === elementId) {
      this.preferitSeleccionat = null;
      this.notes.clear();
    }
  }

  tancarPanel(): void {
    this.preferitSeleccionat = null;
    this.notes.clear();
  }
}</code></pre>
  </div>
</div>


  <p><strong>Context:</strong> Aquest component implementa:</p>
  <ul>
    <li><strong>FormArray dinàmic</strong> per gestionar múltiples notes</li>
    <li>Carrega notes existents al FormArray</li>
    <li>Afegeix i elimina notes dinàmicament</li>
    <li>Persiste canvis amb el servei de preferits</li>
  </ul>

  <h3>8.5. Crear plantilla del panel de preferits</h3>

  <p>Substituïu tot el contingut de <code>preferits-panel.component.html</code>:</p>


<div class="code-block" data-lang="html" role="region" aria-label="Bloc de codi html">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">HTML</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-html">&lt;div class=&quot;preferits-panel&quot;&gt;
  &lt;h2&gt;Els meus preferits ({{ preferitsService.preferits().length }})&lt;/h2&gt;

  &lt;!-- Llista de preferits --&gt;
  &lt;div class=&quot;llista-preferits&quot; *ngIf=&quot;preferitsService.preferits().length &gt; 0&quot;&gt;
    &lt;div class=&quot;preferit-item&quot; *ngFor=&quot;let preferit of preferitsService.preferits()&quot; [class.seleccionat]=&quot;preferitSeleccionat?.elementId === preferit.elementId&quot;&gt;
      &lt;div class=&quot;preferit-info&quot; (click)=&quot;seleccionarPreferit(preferit)&quot;&gt;
        &lt;h3&gt;{{ preferit.elementNom }}&lt;/h3&gt;
        &lt;p class=&quot;notes-count&quot;&gt;{{ preferit.notes.length }} notes&lt;/p&gt;
        &lt;p class=&quot;data-afegit&quot;&gt;Afegit: {{ preferit.dataAfegit | date:&#39;dd/MM/yyyy HH:mm&#39; }}&lt;/p&gt;
      &lt;/div&gt;
      &lt;button class=&quot;btn-eliminar&quot; (click)=&quot;eliminarPreferit(preferit.elementId)&quot;&gt;🗑️&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Missatge si no hi ha preferits --&gt;
  &lt;div class=&quot;sense-preferits&quot; *ngIf=&quot;preferitsService.preferits().length === 0&quot;&gt;
    &lt;p&gt;No tens preferits encara&lt;/p&gt;
    &lt;p class=&quot;ajuda&quot;&gt;Fes clic a l&#39;estrella d&#39;un element per afegir-lo als preferits&lt;/p&gt;
  &lt;/div&gt;

  &lt;!-- Panel de notes (quan hi ha preferit seleccionat) --&gt;
  &lt;div class=&quot;panel-notes&quot; *ngIf=&quot;preferitSeleccionat&quot;&gt;
    &lt;div class=&quot;notes-header&quot;&gt;
      &lt;h3&gt;Notes de: {{ preferitSeleccionat.elementNom }}&lt;/h3&gt;
      &lt;button class=&quot;btn-tancar&quot; (click)=&quot;tancarPanel()&quot;&gt;✕&lt;/button&gt;
    &lt;/div&gt;

    &lt;form [formGroup]=&quot;formulariNotes&quot;&gt;
      &lt;div class=&quot;notes-llista&quot; formArrayName=&quot;notes&quot;&gt;
        &lt;div class=&quot;nota-item&quot; *ngFor=&quot;let notaControl of notes.controls; let i = index&quot;&gt;
          &lt;input type=&quot;text&quot; [formControlName]=&quot;i&quot; [placeholder]=&quot;i === notes.length - 1 ? &#39;Escriu una nova nota...&#39; : &#39;Nota &#39; + (i + 1)&quot; class=&quot;input-nota&quot; [class.invalid]=&quot;notaControl.invalid &amp;&amp; notaControl.touched&quot;&gt;
          &lt;button type=&quot;button&quot; class=&quot;btn-eliminar-nota&quot; (click)=&quot;eliminarNota(i)&quot; *ngIf=&quot;i &lt; notes.length - 1&quot;&gt;✕&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;button type=&quot;button&quot; class=&quot;btn-afegir-nota&quot; (click)=&quot;afegirNota()&quot; [disabled]=&quot;notes.at(notes.length - 1)?.invalid&quot;&gt;Afegir nota&lt;/button&gt;
    &lt;/form&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
  </div>
</div>


  <h3>8.6. Afegir estils al panel</h3>

  <p>Substituïu tot el contingut de <code>preferits-panel.component.scss</code>:</p>


<div class="code-block" data-lang="scss" role="region" aria-label="Bloc de codi scss">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">SCSS</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-scss">.preferits-panel {
  background-color: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-top: 2rem;

  h2 {
    margin: 0 0 1rem;
    color: #333;
  }
}

.llista-preferits {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1.5rem;

  .preferit-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border: 2px solid #eee;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s;

    &amp;:hover {
      border-color: #3498db;
      background-color: #f8f9fa;
    }

    &amp;.seleccionat {
      border-color: #3498db;
      background-color: #e3f2fd;
    }

    .preferit-info {
      flex: 1;

      h3 {
        margin: 0 0 0.5rem;
        font-size: 1.1rem;
        color: #333;
      }

      .notes-count {
        margin: 0;
        font-size: 0.9rem;
        color: #3498db;
        font-weight: 600;
      }

      .data-afegit {
        margin: 0.25rem 0 0;
        font-size: 0.85rem;
        color: #999;
      }
    }

    .btn-eliminar {
      background: none;
      border: none;
      font-size: 1.3rem;
      cursor: pointer;
      padding: 0.5rem;
      transition: transform 0.3s;

      &amp;:hover {
        transform: scale(1.2);
      }
    }
  }
}

.sense-preferits {
  text-align: center;
  padding: 2rem;
  color: #666;

  p {
    margin: 0.5rem 0;
  }

  .ajuda {
    font-size: 0.9rem;
    color: #999;
  }
}

.panel-notes {
  border-top: 2px solid #eee;
  padding-top: 1.5rem;

  .notes-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;

    h3 {
      margin: 0;
      color: #333;
    }

    .btn-tancar {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #999;
      transition: color 0.3s;

      &amp;:hover {
        color: #e74c3c;
      }
    }
  }

  .notes-llista {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 1rem;

    .nota-item {
      display: flex;
      gap: 0.5rem;
      align-items: center;

      .input-nota {
        flex: 1;
        padding: 0.75rem;
        border: 2px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        transition: border-color 0.3s;

        &amp;:focus {
          outline: none;
          border-color: #3498db;
        }

        &amp;.invalid {
          border-color: #e74c3c;
        }
      }

      .btn-eliminar-nota {
        background-color: #e74c3c;
        color: white;
        border: none;
        width: 32px;
        height: 32px;
        border-radius: 4px;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s;

        &amp;:hover {
          background-color: #c0392b;
        }
      }
    }
  }

  .btn-afegir-nota {
    width: 100%;
    background-color: #27ae60;
    color: white;
    border: none;
    padding: 0.75rem;
    border-radius: 4px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s;

    &amp;:hover:not(:disabled) {
      background-color: #229954;
    }

    &amp;:disabled {
      background-color: #bdc3c7;
      cursor: not-allowed;
    }
  }
}</code></pre>
  </div>
</div>


  <h3>8.7. Afegir botó de preferit a les targetes</h3>

  <p>Editeu <code>cataleg-page.component.html</code> actualitzant les targetes d'elements:</p>


<div class="code-block" data-lang="html" role="region" aria-label="Bloc de codi html">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">HTML</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-html">&lt;div class=&quot;element-card&quot; *ngFor=&quot;let element of elementService.elements()&quot;&gt;
  &lt;img [src]=&quot;element.imatge&quot; [alt]=&quot;element.nom&quot; class=&quot;element-imatge&quot;&gt;

  &lt;!-- AFEGIR BOTÓ DE PREFERIT --&gt;
  &lt;button class=&quot;btn-preferit&quot; [class.actiu]=&quot;preferitsService.esPreferit(element.id)&quot; (click)=&quot;togglePreferit(element)&quot;&gt;{{ preferitsService.esPreferit(element.id) ? &#39;★&#39; : &#39;☆&#39; }}&lt;/button&gt;

  &lt;div class=&quot;element-info&quot;&gt;
    &lt;!-- Resta del contingut... --&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
  </div>
</div>


  <p>Actualitzeu <code>cataleg-page.component.ts</code>:</p>


<div class="code-block" data-lang="typescript" role="region" aria-label="Bloc de codi typescript">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">TYPESCRIPT</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-typescript">import { Component, OnInit } from &#39;@angular/core&#39;;
import { CommonModule } from &#39;@angular/common&#39;;
import { ElementService } from &#39;../../serveis/element.service&#39;;
import { PreferitsService } from &#39;../../serveis/preferits.service&#39;;  // ← Afegir
import { FormulariCercaComponent } from &#39;../../components/formulari-cerca/formulari-cerca.component&#39;;
import { PreferitsPanelComponent } from &#39;../../components/preferits-panel/preferits-panel.component&#39;;  // ← Afegir
import { ElementCataleg } from &#39;../../models/element.model&#39;;  // ← Afegir

@Component({
  selector: &#39;app-cataleg-page&#39;,
  standalone: true,
  imports: [CommonModule, FormulariCercaComponent, PreferitsPanelComponent],  // ← Afegir PreferitsPanelComponent
  templateUrl: &#39;./cataleg-page.component.html&#39;,
  styleUrl: &#39;./cataleg-page.component.scss&#39;
})
export class CatalegPageComponent implements OnInit {
  constructor(
    public elementService: ElementService,
    public preferitsService: PreferitsService  // ← Afegir
  ) {}

  ngOnInit(): void {
    this.elementService.obtenirPopulars();
  }

  reintentar(): void {
    this.elementService.obtenirPopulars();
  }

  togglePreferit(element: ElementCataleg): void {
    if (this.preferitsService.esPreferit(element.id)) {
      this.preferitsService.eliminarPreferit(element.id);
    } else {
      this.preferitsService.afegirPreferit(element.id, element.nom);
    }
  }
}</code></pre>
  </div>
</div>


  <p>Afegiu els estils del botó a <code>cataleg-page.component.scss</code>:</p>


<div class="code-block" data-lang="scss" role="region" aria-label="Bloc de codi scss">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">SCSS</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-scss">.element-card {
  position: relative;  // ← Afegir

  // ... resta d&#39;estils ...

  .btn-preferit {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background-color: white;
    border: 2px solid #f39c12;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

    &amp;:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    &amp;.actiu {
      background-color: #f39c12;
      color: white;
    }
  }
}</code></pre>
  </div>
</div>


  <h3>8.8. Integrar panel de preferits</h3>

  <p>Afegiu el panel a <code>cataleg-page.component.html</code> després del llistat:</p>


<div class="code-block" data-lang="html" role="region" aria-label="Bloc de codi html">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">HTML</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-html">&lt;!-- Després de &lt;/div&gt; que tanca estat-exit --&gt;

&lt;!-- Panel de preferits --&gt;
&lt;app-preferits-panel /&gt;</code></pre>
  </div>
</div>


  <h3>8.9. Provar sistema de preferits</h3>

  <p><strong>Verificació 1: Afegir preferit</strong></p>
  <ol>
    <li>Feu clic a l'estrella buida (☆) d'un element</li>
    <li>L'estrella es torna plena i daurada (★)</li>
    <li>El comptador de preferits s'incrementa</li>
    <li>L'element apareix al panel de preferits</li>
  </ol>

  <p><strong>Verificació 2: Notes dinàmiques</strong></p>
  <ol>
    <li>Feu clic a un preferit del panel</li>
    <li>S'obre el formulari de notes</li>
    <li>Escriviu una nota al camp buit</li>
    <li>Feu clic a "Afegir nota"</li>
    <li>La nota s'afegeix i apareix un nou camp buit</li>
  </ol>

  <p><strong>Verificació 3: Persistència</strong></p>
  <ol>
    <li>Afegiu 2-3 preferits amb notes</li>
    <li>Recarregueu la pàgina (F5)</li>
    <li>Els preferits i les notes continuen presents</li>
  </ol>

  <p><strong>Verificació 4: Eliminar</strong></p>
  <ol>
    <li>Elimineu una nota (botó ✕ vermell)</li>
    <li>Elimineu un preferit (botó 🗑️)</li>
    <li>Les eliminacions es reflecteixen immediatament</li>
  </ol>

  <h3>8.10. Documentar sistema de preferits</h3>

  <p>Actualitzeu <code>docs/formularis.md</code> afegint:</p>


<div class="code-block" data-lang="markdown" role="region" aria-label="Bloc de codi markdown">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">MARKDOWN</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-markdown">## PreferitsPanelComponent

### Funcionalitat

Component amb FormArray dinàmic per gestionar notes de preferits amb persistència a localStorage.

### FormArray dinàmic

```typescript
formulariNotes = this.fb.group({
  notes: this.fb.array([])  // Array dinàmic de controls
});
```

**Comportament:**
1. Carrega notes existents al FormArray
2. Afegeix camp buit al final per noves notes
3. Validació: mínim 3 caràcters per nota
4. Persiste després de cada modificació

### Validacions

| Camp | Validació | Missatge |
|------|-----------|----------|
| Nota | `required, minLength(3)` | Validació visual (borde vermell) |

### Mètodes principals

- `seleccionarPreferit()`: Carrega notes del preferit al FormArray
- `afegirNota()`: Afegeix nota i recrea FormArray
- `eliminarNota()`: Elimina nota i actualitza FormArray

### Integració amb servei

```typescript
// Afegir nota
this.preferitsService.afegirNota(elementId, nota);

// Recarregar dades actualitzades
const actualitzat = this.preferitsService.obtenirPreferit(elementId);
this.seleccionarPreferit(actualitzat);
```</code></pre>
  </div>
</div>


  <p>Actualitzeu <code>docs/serveis.md</code> afegint:</p>


<div class="code-block" data-lang="markdown" role="region" aria-label="Bloc de codi markdown">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">MARKDOWN</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-markdown">## PreferitsService

### Responsabilitats

- Gestió de preferits amb localStorage
- Persistència automàtica després de cada modificació
- Gestió de notes dinàmiques per preferit

### Estructura de dades

```typescript
interface Preferit {
  elementId: string;
  elementNom: string;
  notes: string[];
  dataAfegit: Date;
}
```

### Mètodes

- `afegirPreferit(id, nom)`: Afegeix element als preferits
- `eliminarPreferit(id)`: Elimina preferit
- `afegirNota(id, nota)`: Afegeix nota a preferit
- `eliminarNota(id, index)`: Elimina nota específica
- `esPreferit(id)`: Comprova si element és preferit
- `obtenirPreferit(id)`: Retorna dades del preferit

### localStorage

- **Clau:** `&#39;catalog_preferits&#39;`
- **Format:** JSON string
- **Càrrega:** Automàtica al inicialitzar servei
- **Desat:** Després de cada modificació</code></pre>
  </div>
</div>


  <h3>8.11. Troubleshooting</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Error</th>
        <th>Causa</th>
        <th>Solució</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>localStorage is not defined</code></td>
        <td>Accés a localStorage en SSR</td>
        <td>Afegir comprovació: <code>if (typeof localStorage !== 'undefined')</code></td>
      </tr>
      <tr>
        <td>FormArray no s'actualitza</td>
        <td>No es crida <code>updateValueAndValidity()</code></td>
        <td>Cridar després de modificar FormArray</td>
      </tr>
      <tr>
        <td>Notes duplicades</td>
        <td>Múltiples crides a <code>afegirNota()</code></td>
        <td>Afegir comprovació abans d'afegir</td>
      </tr>
      <tr>
        <td>Dates no es deserialitzen</td>
        <td>JSON.parse no converteix strings</td>
        <td>Convertir manualment: <code>new Date(dateString)</code></td>
      </tr>
      <tr>
        <td>Preferits es perden</td>
        <td>localStorage bloquejat</td>
        <td>Verificar configuració del navegador</td>
      </tr>
      <tr>
        <td>Aplicació lenta</td>
        <td>json-server amb delay massa alt</td>
        <td>Reduir <code>--delay</code> a 300ms per desenvolupament</td>
      </tr>
      <tr>
        <td>Memory leak</td>
        <td>Subscripcions no cancel·lades</td>
        <td>Usar <code>takeUntilDestroyed()</code> o <code>async</code> pipe</td>
      </tr>
      <tr>
        <td>Signals no reactives</td>
        <td>No usar parèntesis <code>()</code></td>
        <td>Sempre cridar signals: <code>estat()</code> no <code>estat</code></td>
      </tr>
      <tr>
        <td>Tests fallen</td>
        <td>Mocks no configurats</td>
        <td>Afegir <code>HttpClientTestingModule</code> i mocks de serveis</td>
      </tr>
      <tr>
        <td>Build error</td>
        <td>Imports circulars</td>
        <td>Revisar imports i crear barrel files si cal</td>
      </tr>
    </tbody>
  </table>

  <h3>8.12. Checkpoint</h3>

  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat el servei <code>PreferitsService</code> amb localStorage</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He implementat el component <code>PreferitsPanelComponent</code> amb FormArray</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He afegit el botó de preferit a les targetes d'elements</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Puc afegir i eliminar preferits correctament</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Puc afegir notes dinàmiques amb validació</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Puc eliminar notes individuals</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Els preferits persisteixen després de recarregar la pàgina</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He documentat el sistema de preferits completament</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


</div>

<!-- SECCIÓ 9: Verificació final i control de versions -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio9">
  <h2 id="Unitat3_Bloc4_Seccio9">9. Verificació final i control de versions</h2>

  <h3>9.1. Executar linter</h3>

  <p><strong>PowerShell (Windows):</strong></p>


<div class="code-block" data-lang="powershell" role="region" aria-label="Bloc de codi powershell">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">POWERSHELL</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-powershell">npm run lint</code></pre>
  </div>
</div>


  <p><strong>bash/zsh (macOS/Linux):</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">npm run lint</code></pre>
  </div>
</div>


  <p><strong>Verificació:</strong> No hi ha d'haver errors de linting. Si n'hi ha, corregiu-los abans de continuar.</p>

  <h3>9.2. Executar tests</h3>

  <p>Si teniu tests configurats al projecte:</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">npm run test -- --watch=false --browsers=ChromeHeadless</code></pre>
  </div>
</div>


  <h3>9.3. Build de producció</h3>

  <p>Verifiqueu que el build es completa sense errors:</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">ng build --configuration production</code></pre>
  </div>
</div>


  <p><strong>Verificació:</strong> El build es completa sense errors i genera fitxers a <code>dist/</code>.</p>

  <h3>9.4. Revisar documentació</h3>

  <p>Verifiqueu que tots els fitxers de documentació estan actualitzats:</p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">ls docs/
# Ha de mostrar: serveis.md, models.md, formularis.md</code></pre>
  </div>
</div>


  <p>Obriu cada fitxer i verifiqueu que conté:</p>
  <ul>
    <li>Configuració de l'API</li>
    <li>Models i adaptadors documentats</li>
    <li>Serveis amb exemples d'ús</li>
    <li>Formularis amb validacions</li>
    <li>Sistema de preferits explicat</li>
  </ul>

  <h3>9.5. Commit final</h3>

  <p><strong>PowerShell (Windows):</strong></p>


<div class="code-block" data-lang="powershell" role="region" aria-label="Bloc de codi powershell">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">POWERSHELL</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-powershell">git status
git add .
git commit -m &quot;feat(u3-cas-us): catàleg complet amb API, cerca i preferits

- Configuració servidor mock amb json-server
- Models TypeScript amb adaptadors
- Servei HTTP amb gestió d&#39;estats (signals)
- Llistat reactiu amb indicadors de càrrega i error
- Formulari de cerca amb validació i debounce
- Sistema de preferits amb notes dinàmiques (FormArray)
- Persistència a localStorage
- Documentació completa de serveis, models i formularis&quot;</code></pre>
  </div>
</div>


  <p><strong>bash/zsh (macOS/Linux):</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">git status
git add .
git commit -m &quot;feat(u3-cas-us): catàleg complet amb API, cerca i preferits

- Configuració servidor mock amb json-server
- Models TypeScript amb adaptadors
- Servei HTTP amb gestió d&#39;estats (signals)
- Llistat reactiu amb indicadors de càrrega i error
- Formulari de cerca amb validació i debounce
- Sistema de preferits amb notes dinàmiques (FormArray)
- Persistència a localStorage
- Documentació completa de serveis, models i formularis&quot;</code></pre>
  </div>
</div>


  <h3>9.6. Crear etiqueta (opcional)</h3>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">git tag -a v3.4.1 -m &quot;Cas d&#39;ús U3.4.1: Catàleg amb dades remotes&quot;
git tag -l</code></pre>
  </div>
</div>


  <h3>9.7. Checkpoint</h3>

  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">El linter no reporta errors</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Els tests passen correctament (si n'hi ha)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Build de producció exitós</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Tots els fitxers de documentació estan complets</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Commit final creat amb missatge descriptiu</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Etiqueta <code>v3.4.1</code> creada (opcional)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text"><code>git status</code> mostra working tree net</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


</div>

<!-- SECCIÓ 10: Autoavaluació -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio10">
  <h2 id="Unitat3_Bloc4_Seccio10">10. Autoavaluació</h2>

  <h3>Definition of Done</h3>

  <p><strong>L'aplicació està completa quan:</strong></p>

  <p><strong>Funcionalitat API:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He configurat json-server al port 4301 amb 5 elements</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He verificat que l'API respon amb latència (~600ms)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat fitxer d'entorn amb URL de l'API</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He documentat la configuració a <code>docs/serveis.md</code></div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Models i adaptadors:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat interfícies <code>ElementCataleg</code> i <code>ElementApiResponse</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He implementat adaptadors <code>adaptarElementApi</code> i <code>adaptarElementsApi</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He provat els adaptadors amb dades mock</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He documentat models i mapeig de camps a <code>docs/models.md</code></div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Servei HTTP:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat <code>ElementService</code> amb signals</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He implementat mètodes <code>obtenirPopulars()</code> i <code>cercar()</code></div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He afegit gestió d'errors amb missatges comprensibles</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He provat el servei des de la consola del navegador</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Llistat reactiu:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat component <code>CatalegPage</code> amb gestió d'estats</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Veig spinner de càrrega correctament</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Veig missatge d'error quan l'API no respon</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">El botó "Reintentar" funciona correctament</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Els elements es mostren en graella responsiva</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Formulari de cerca:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat formulari reactiu amb validació de longitud</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">La cerca automàtica amb debounce funciona</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">El botó de netejar apareix i funciona</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Veig indicador de càrrega durant la cerca</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He documentat validacions a <code>docs/formularis.md</code></div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Sistema de preferits:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat servei de preferits amb localStorage</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Puc afegir i eliminar preferits</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Puc afegir notes dinàmiques amb FormArray</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Puc eliminar notes individuals</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Els preferits persisteixen després de recarregar</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He documentat el sistema a <code>docs/serveis.md</code> i <code>docs/formularis.md</code></div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Control de versions:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He fet commit final amb missatge descriptiu</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">He creat etiqueta <code>v3.4.1</code> (opcional)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text"><code>git status</code> mostra working tree net</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <h3>Competències adquirides</h3>

  <p><strong>Comunicació amb APIs:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Sé configurar un servidor mock amb json-server</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Puc crear serveis Angular amb HttpClient</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Gestiono correctament estats de càrrega i error</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Implemento gestió d'errors amb missatges comprensibles</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Models i transformació de dades:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Defineixo models TypeScript amb interfícies</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Creo adaptadors per transformar dades externes</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Mapejo camps de l'API al format intern</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Documento mapejos de camps clarament</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Reactivitat i signals:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Utilitzo signals per gestió d'estat reactiu</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Exposo signals com a només lectura</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Actualitzo signals des de serveis</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Consumeixo signals des de components</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Formularis avançats:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Creo formularis reactius amb FormBuilder</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Implemento validadors síncrons i asíncrons</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Gestiono FormArray dinàmics</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Afegeixo i elimino controls dinàmicament</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Persistència local:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Utilitzo localStorage per desar dades</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Serialitzo i deserialitzo JSON correctament</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Gestiono errors de localStorage</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Implemento carrega automàtica a l'inicialitzar</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


  <p><strong>Bones pràctiques:</strong></p>
  <!-- Component: Checklist (sense contenidor extern) -->

<div class="checklist-list" role="group" aria-label="Checklist">
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Separo responsabilitats (serveis, components, adaptadors)</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Documento decisions tècniques</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Utilitzo control de versions amb commits descriptius</div>
  </div>
  
  <div class="checklist-item" role="checkbox" tabindex="0" aria-checked="false">
    <div class="checklist-checkbox" aria-hidden="true"></div>
    <div class="checklist-text">Valido amb linter i build de producció</div>
  </div>
  
  <!-- Interacció via JS en assets/js/site.js: click/teclat actualitza aria-checked -->
</div>


</div>

<!-- SECCIÓ 11: Recapitulació i contracte de sortida -->
<div class="section cas-dus" id="Unitat3_Bloc4_Seccio11">
  <h2 id="Unitat3_Bloc4_Seccio11">11. Recapitulació i contracte de sortida</h2>

  <h3>Què hem aconseguit</h3>

  <p>Disposeu d'una <strong>aplicació Angular completa</strong> que integra tots els conceptes de la Unitat 3:</p>

  <ol>
    <li><strong>Consum de serveis externs:</strong> Servidor mock amb json-server, peticions HTTP amb <code>HttpClient</code>, gestió d'errors i estats</li>
    <li><strong>Models i adaptadors:</strong> Interfícies TypeScript, transformació de dades externes, mapeig de camps</li>
    <li><strong>Reactivitat amb signals:</strong> Gestió d'estat reactiu, signals només lectura, integració amb components</li>
    <li><strong>Formularis avançats:</strong> Formularis reactius, validacions síncrones i asíncrones, debounce per cerca</li>
    <li><strong>Camps dinàmics:</strong> FormArray per gestionar notes, afegir/eliminar controls dinàmicament</li>
    <li><strong>Persistència local:</strong> localStorage per preferits, serialització/deserialització automàtica</li>
  </ol>

  <h3>Què queda preparat per a la Unitat 4</h3>

  <p>A la <strong>Unitat 4 (RA4 - Navegació i optimització)</strong> podreu:</p>

  <ul>
    <li>Afegir <strong>sistema de rutes</strong> per navegar entre pàgines (llistat, detall, preferits)</li>
    <li>Implementar <strong>rutes niades</strong> per mostrar notes dins de detalls d'elements</li>
    <li>Afegir <strong>guàrdies de ruta</strong> per protegir l'accés a preferits</li>
    <li>Aplicar <strong>lazy loading</strong> per carregar components només quan calguin</li>
    <li>Optimitzar <strong>rendiment</strong> amb detecció de canvis i virtualització</li>
  </ul>

  <p>L'arquitectura actual (serveis, models, adaptadors) és la base sòlida sobre la qual construireu la navegació.</p>

  <h3>Contracte de sortida</h3>

  <div class="alert alert-success">
    <ul class="list-unstyled mb-0">
      <li><i class="bi bi-check-circle-fill text-success"></i> Aplicació Angular funcional amb 4 funcionalitats principals</li>
      <li><i class="bi bi-check-circle-fill text-success"></i> Servidor mock configurat i documentat</li>
      <li><i class="bi bi-check-circle-fill text-success"></i> Models i adaptadors testejats i documentats</li>
      <li><i class="bi bi-check-circle-fill text-success"></i> Servei HTTP amb gestió d'estats completa</li>
      <li><i class="bi bi-check-circle-fill text-success"></i> Formularis reactius amb validacions avançades</li>
      <li><i class="bi bi-check-circle-fill text-success"></i> Sistema de preferits amb persistència local</li>
      <li><i class="bi bi-check-circle-fill text-success"></i> Documentació tècnica completa (3 fitxers docs/)</li>
      <li><i class="bi bi-check-circle-fill text-success"></i> Control de versions amb commit descriptiu</li>
    </ul>
  </div>

  <p class="text-center mt-4"><strong>Esteu preparats per afrontar la Unitat 4 amb confiança!</strong></p>

  <h3>Referències ràpides</h3>

  <p><strong>Arrencar servidor de desenvolupament:</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash"># Terminal 1: Servidor mock
json-server --watch tools/api/cataleg.json --port 4301 --delay 600

# Terminal 2: Aplicació Angular
ng serve</code></pre>
  </div>
</div>


  <p><strong>Comandes essencials:</strong></p>


<div class="code-block" data-lang="bash" role="region" aria-label="Bloc de codi bash">
  <div class="code-header">
    <div class="code-info">
      <span class="code-lang">BASH</span>
      
    </div>
    <div class="code-actions">
      <button class="toggle-expand" title="Expandir/Col·lapsar alçada" aria-label="Expandir o col·lapsar alçada" aria-pressed="false"><i class="bi bi-arrows-fullscreen" aria-hidden="true"></i></button>
      <button class="toggle-lines" title="Mostrar/Ocultar números de línia" aria-label="Mostrar o ocultar números de línia">#</button>
      <button class="copy-btn" title="Copiar codi al portapapers" aria-label="Copiar codi"><i class="bi bi-clipboard" aria-hidden="true"></i></button>
    </div>
  </div>

  <div class="code-container">
    <div class="line-numbers" aria-hidden="true"></div>
    <pre role="textbox" aria-readonly="true" aria-label="Codi font"><code class="language-bash">ng serve                    # Arrencar app (http://localhost:4200)
ng build                    # Build de producció
npm run lint                # Validar codi
git status                  # Estat del repositori</code></pre>
  </div>
</div>


  <p><strong>Troubleshooting ràpid:</strong></p>

  <ul>
    <li>API no respon → Verificar json-server actiu al port 4301</li>
    <li>Elements no es carreguen → Comprovar estat del servei a consola</li>
    <li>Preferits no persisteixen → Verificar localStorage habilitat</li>
    <li>Validacions no funcionen → Comprovar imports de ReactiveFormsModule</li>
    <li>Signals no reactives → Usar parèntesis: <code>estat()</code> no <code>estat</code></li>
  </ul>

  <p><strong>Resolució de problemes detallada:</strong> Vegeu seccions de Troubleshooting de cada bloc</p>

  <h3>Prompts d'IA</h3>

  <p>Podeu usar IA per resoldre dubtes o ampliar coneixements:</p>

  <!-- Component: Prompt per IA amb caixa de text i botó de còpia -->
<div class="ai-prompt" role="note">
  <div class="component-header ai-header" role="heading" aria-level="4">
    <i class="bi bi-robot" aria-hidden="true"></i> Prompt per IA
    <div class="ai-actions">
      <button type="button" class="copy-btn" title="Copiar prompt" aria-label="Copiar prompt">
        <i class="bi bi-clipboard" aria-hidden="true"></i>
      </button>
    </div>
  </div>
  <div class="ai-container">
    <div class="ai-prompt-content" aria-label="Text del prompt"><strong>Rol:</strong> Ets un desenvolupador Angular senior especialitzat en arquitectura d'aplicacions web i patrons de disseny. <strong>Context:</strong> He completat el cas d'ús U3.4.1 d'un curs introductori d'Angular on he implementat una aplicació de catàleg amb consum d'API, gestió d'estats amb signals, formularis reactius i persistència local. <strong>Tasca:</strong> Proposa 3 millores arquitecturals per escalabilitat que pugui implementar, explicant els beneficis de cada una i proporcionant un exemple de codi concret. <strong>Format:</strong> Llista numerada amb títol, beneficis (3-4 punts) i bloc de codi TypeScript per cada millora.</div>
  </div>
</div>


  <!-- Component: Prompt per IA amb caixa de text i botó de còpia -->
<div class="ai-prompt" role="note">
  <div class="component-header ai-header" role="heading" aria-level="4">
    <i class="bi bi-robot" aria-hidden="true"></i> Prompt per IA
    <div class="ai-actions">
      <button type="button" class="copy-btn" title="Copiar prompt" aria-label="Copiar prompt">
        <i class="bi bi-clipboard" aria-hidden="true"></i>
      </button>
    </div>
  </div>
  <div class="ai-container">
    <div class="ai-prompt-content" aria-label="Text del prompt"><strong>Rol:</strong> Ets un expert en testing d'aplicacions Angular. <strong>Context:</strong> Tinc una aplicació Angular amb servei HTTP que consumeix dades d'una API, servei de preferits amb localStorage i formularis reactius amb validacions asíncrones. <strong>Tasca:</strong> Genera un pla de testing complet amb 10 casos de prova distribuïts entre tests unitaris (serveis, adaptadors) i tests d'integració (components). Prioritza els casos més crítics. <strong>Format:</strong> Taula amb columnes: Prioritat (Alta/Mitjana/Baixa), Tipus (Unitari/Integració), Component/Servei, Escenari a provar, Resultat esperat.</div>
  </div>
</div>


  <!-- Component: Prompt per IA amb caixa de text i botó de còpia -->
<div class="ai-prompt" role="note">
  <div class="component-header ai-header" role="heading" aria-level="4">
    <i class="bi bi-robot" aria-hidden="true"></i> Prompt per IA
    <div class="ai-actions">
      <button type="button" class="copy-btn" title="Copiar prompt" aria-label="Copiar prompt">
        <i class="bi bi-clipboard" aria-hidden="true"></i>
      </button>
    </div>
  </div>
  <div class="ai-container">
    <div class="ai-prompt-content" aria-label="Text del prompt"><strong>Rol:</strong> Ets un analista de rendiment d'aplicacions web. <strong>Context:</strong> He implementat una aplicació Angular que fa peticions HTTP amb gestió d'estats, cerca amb debounce i FormArray dinàmics. <strong>Tasca:</strong> Identifica 5 possibles colls d'ampolla de rendiment en aquesta arquitectura i proposa solucions específiques amb exemples de codi RxJS o optimitzacions d'Angular. <strong>Format:</strong> Llista amb estructura: Problema detectat → Impacte (Crític/Alt/Mitjà) → Solució proposada → Bloc de codi.</div>
  </div>
</div>


</div>


<!-- Exercicis proposats (si estan definits) -->


<!-- Recursos addicionals -->


<!-- Glossari del bloc -->



<!-- Schema.org structured data per SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "name": "Cas d'ús: Catàleg amb dades remotes i gestió avançada",
  "description": "",
  "author": {
    "@type": "Organization",
    "name": "Institut Obert de Catalunya"
  },
  "provider": {
    "@type": "Organization",
    "name": "Institut Obert de Catalunya"
  },
  "educationalLevel": "Intermediate",
  "learningResourceType": "Course Module",
  "inLanguage": "ca",
  
  
  "isPartOf": {
    "@type": "Course",
    "name": "DA2_OA01 - Programació Avançada (Angular) — IOC",
    "description": "Materials del mòdul DA2_OA01 - Programació Avançada amb Angular"
  }
}
</script>

                </div>
            </article>
            
            <!-- Navegació entre pàgines -->
            
            <nav class="page-navigation" role="navigation" aria-label="Navegació entre blocs">
                <div class="nav-links-container">
                    
                    
                    
                    
                    
                    
                    
                    
                        
                    
                        
                    
                        
                            
                            
                    
                    
                    
                        
                            
                        
                            
                        
                            
                        
                            
                                
                                
                                
                                
                                
                                    
                                    
                                        
                                    
                                        
                                    
                                        
                                            
                                            
                                
                                
                                
                                
                                
                                    
                                
                                    
                                
                                    
                                
                                    
                                
                                
                                
                    
                    
                    <div class="nav-link-wrapper">
                        
                        <a href="/ioc/da2_oa01/unitat-3/bloc-3/" class="nav-button" aria-label="Bloc anterior: Optimització i bones pràctiques">← Anterior</a>
                        
                    </div>
                    
                    <div class="nav-link-wrapper">
                        
                    </div>
                </div>
            </nav>
            
        </main>
    </div>

    <!-- Footer fix -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                Versió v1.0
            </div>
            <div class="footer-progress" aria-label="Progrés de lectura"><!-- Progrés per unitats (posició de la unitat actual) --><div class="progress-group course-progress">
                    <span class="progress-label">Unitat</span>
                    <span class="progress-text" data-pos="3" data-total="4">(3/4)</span>
                    <div class="progress-bar-footer"><div class="progress-fill-footer" style="width: 75%"></div></div>
                </div><!-- Progrés per blocs dins de la unitat --><div class="progress-group unit-progress">
                        <span class="progress-label">Bloc</span>
                        <span class="progress-text" data-pos="4" data-total="4">(4/4)</span>
                        <div class="progress-bar-footer"><div class="progress-fill-footer" style="width: 100%"></div></div>
                    </div>

                    <!-- Progrés per seccions (H2) dins del bloc --><div class="progress-group section-progress" data-scan-sections="true">
                        <span class="progress-label">Secció</span>
                        <span class="progress-text" data-pos="1" data-total="12">(1/12)</span>
                        <div class="progress-bar-footer"><div class="progress-fill-footer" style="width: 8%"></div></div>
                    </div></div>
            <div class="footer-actions" aria-label="Accions ràpides">
                <button class="task-btn footer-collapse-toggle" type="button" aria-expanded="true" aria-label="Amaga el peu de pàgina">
                  <i class="bi bi-chevron-down" aria-hidden="true"></i>
                </button>
                <a href="#top" id="footer-btn-top" class="task-btn" aria-label="Anar a l'inici">↑</a>
                <a href="#bottom" id="footer-btn-bottom" class="task-btn" aria-label="Anar al final">↓</a>
                <a href="#next" id="footer-btn-next" class="task-btn" aria-label="Secció següent">→</a>
                <a href="#prev" id="footer-btn-prev" class="task-btn" aria-label="Secció anterior">←</a>
                <a href="#bookmark" id="footer-btn-bookmark" class="task-btn" aria-label="Desar marcador" title="Desar marcador">
                  <i class="bi bi-bookmark" aria-hidden="true"></i>
                </a>
                <a href="/ioc/da2_oa01/quadern.html" class="task-btn" aria-label="Obrir quadern complet" title="Quadern">
                  <i class="bi bi-journal-text" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </footer>

    <!-- Config global per Quadern -->
    <script>
      window.siteConfig = window.siteConfig || {
        baseurl: "/ioc/da2_oa01",
        title: "DA2_OA01 - Programació Avançada (Angular)",
        version: "v1.0",
        cicle_modul: "DA2_OA01"
      };
    </script>
    <!-- Scripts del lloc -->
    <script src="/ioc/da2_oa01/assets/js/site.js" defer></script>
    <!-- Quadern Notes v2 (nou sistema) -->
    <script src="/ioc/da2_oa01/assets/js/quadern-app/constants.js" defer></script>
    <script src="/ioc/da2_oa01/assets/js/quadern-app/utils.js" defer></script>
    <script src="/ioc/da2_oa01/assets/js/quadern-app/store.js" defer></script>
    <script src="/ioc/da2_oa01/assets/js/quadern-app/panel.js" defer></script>
    <script src="/ioc/da2_oa01/assets/js/index-notes.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" defer></script>
    <script src="/ioc/da2_oa01/assets/js/quadern-app/rich-editor.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', function(){
        if (window.Quadern && typeof window.Quadern.bootstrapNotes === 'function') {
          try { window.Quadern.bootstrapNotes(); } catch(e) {}
        }
        if (window.Quadern && window.Quadern.RichEditor && typeof window.Quadern.RichEditor.autoInit === 'function') {
          try { window.Quadern.RichEditor.autoInit(); } catch(e) {}
        }
      });
    </script>
</body>
</html>
