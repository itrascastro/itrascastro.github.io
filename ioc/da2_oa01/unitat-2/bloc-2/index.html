---
layout: bloc
title: "Bloc 2: Directives estructurals i iteració"
description: "Directives estructurals *ngFor, variables locals, trackBy i llistes niades"
keywords: "ngFor, directives, iteració, trackBy, llistes, angular"
unitat: 2
bloc: 2
bloc_numero: 2
---

<!-- SECCIÓ 1: Directives estructurals: iteració de llistes -->
<div class="section" id="Unitat2_Bloc2_Seccio1">
  <h2 id="Unitat2_Bloc2_Seccio1">1. Directives estructurals: iteració de llistes</h2>

  <!-- MULTIMÈDIA -->
  {% include multimedia-youtube.html unitat=2 bloc=2 seccio=1 %}


  {% include objectius.html llista="Comprendre què són les directives estructurals, com modifiquen l'estructura del DOM i diferenciar-les de la vinculació de propietats, identificant quan utilitzar cada eina segons el context del catàleg d'elements|Utilitzar *ngFor per iterar col·leccions mostrant variables locals (index, first, last, even, odd) i aplicant-les per a estils alterns, numeració d'elements i informació posicional dins de les llistes del catàleg|Aplicar trackBy amb identificadors únics per millorar el rendiment en llistes dinàmiques, preservant l'estat dels components fills i evitant recreacions innecessàries quan les dades canvien" %}

  {% include info_box.html contingut="<strong>RA2 · Criteri 2</strong> — Mostra informació dinàmica utilitzant tècniques de vinculació de dades i plantilles." %}

  {% capture section_point_1_1 %}
    <p>Abans de començar aquesta lectura, assegureu-vos que heu completat:</p>
    <ul>
      <li><strong>Lectura 2.1.1</strong> — Creació del primer component: component <code>TargetaElementComponent</code> creat i operatiu.</li>
      <li><strong>Lectura 2.1.2</strong> — Interpolació i vinculació de propietats: domini de <code>@Input()</code> per passar dades als components.</li>
    </ul>

    <p>A més, necessiteu:</p>
    <ul>
      <li><strong>Projecte funcional:</strong> <code>~/workspace/cataleg-elements</code> amb el component <code>TargetaElementComponent</code> integrat.</li>
      <li><strong>Servidor de desenvolupament:</strong> <code>ng serve</code> executant-se i accessible.</li>
      <li><strong>VS Code obert:</strong> Projecte carregat.</li>
    </ul>

    <p><strong>Verificació ràpida:</strong></p>

    {% capture code_137 %}cd ~/workspace/cataleg-elements
ng serve --open{% endcapture %}
    {% include code-block.html lang="bash" code=code_137 %}

    <p><strong>Punt d'autocomprovació:</strong> El component <code>TargetaElementComponent</code> es renderitza correctament amb dades bàsiques.</p>
  {% endcapture %}
  {% include section-point.html numero="1.1" titol="Prerequisits" contingut=section_point_1_1 %}

  {% capture section_point_1_2 %}
    <h4>1.2.1. Què són les directives estructurals</h4>

    <p>Les <strong>directives estructurals</strong> són eines d'Angular que permeten <strong>modificar l'estructura del DOM</strong> de manera declarativa. A diferència de les directives d'atribut que només canvien aparença o comportament, les directives estructurals poden <strong>afegir, eliminar o repetir</strong> elements sencers del DOM.</p>

    <p><strong>Característica distintiva:</strong> Totes s'escriuen amb un <strong>asterisc (<code>*</code>)</strong> al davant, que és la sintaxi simplificada d'Angular.</p>

    <h4>1.2.2. Problema sense directives estructurals</h4>

    <p><strong>Situació abans d'Angular:</strong></p>

    <p>Abans de frameworks, mostrar una llista dinàmica d'elements requeria manipular el DOM manualment amb JavaScript:</p>

    {% capture code_138 %}// JavaScript pur: crear llista de 50 elements manualment
const contenidor = document.getElementById('llista-elements');
const elements = [
  { id: 1, titol: 'Colors corporatius', categoria: 'Paletes' },
  { id: 2, titol: 'Pack d\'icones', categoria: 'Icones' },
  { id: 3, titol: 'Sistema tipogràfic', categoria: 'Tipografia' }
  // ... 47 elements més
];

// Construir HTML manualment
let html = '<ul class="grid-targetes">';
elements.forEach((element, index) => {
  html += `
    <li class="${index % 2 === 0 ? 'parell' : 'senar'}">
      <article class="targeta" data-id="${element.id}">
        <h3>${element.titol}</h3>
        <span class="categoria">${element.categoria}</span>
      </article>
    </li>
  `;
});
html += '</ul>';
contenidor.innerHTML = html;

// Afegir listeners manualment
elements.forEach(element => {
  const targeta = document.querySelector(`[data-id="${element.id}"]`);
  targeta.addEventListener('click', () => {
    console.log('Clic a:', element.titol);
  });
});

// Total: 35-40 línies només per renderitzar i afegir listeners
// I això sense actualitzacions dinàmiques ni gestió d'errors!{% endcapture %}
    {% include code-block.html lang="javascript" code=code_138 %}

    <p><strong>Problemes que genera:</strong></p>

    <p><strong>1. Codi repetitiu i verbós</strong><br>
    Per mostrar una llista de 50 elements del catàleg, necessiteu escriure:</p>
    <ul>
      <li>10-15 línies per seleccionar contenidor i preparar dades</li>
      <li>20-25 línies pel bucle <code>forEach</code> i construcció manual d'HTML</li>
      <li>10-15 línies per afegir event listeners a cada targeta</li>
    </ul>

    <p><strong>Total:</strong> 40-55 línies de JavaScript només per renderitzar una llista. Si teniu 3 llistes diferents (elements destacats, recents, per categoria), multipliqueu per 3: <strong>120-165 línies</strong>.</p>

    <p><strong>Comparativa al catàleg:</strong></p>
    <ul>
      <li>Mostrar 50 targetes: 40-50 línies JavaScript manual</li>
      <li>Afegir filtre per categoria: +25 línies</li>
      <li>Afegir cerca: +30 línies</li>
      <li><strong>Total projecte:</strong> 95-105 línies només per llistes</li>
    </ul>

    <p><strong>2. Actualitzacions manuals propenses a errors</strong><br>
    Cada vegada que les dades canvien (afegir element, eliminar, ordenar), heu d'actualitzar manualment el DOM:</p>

    {% capture code_139 %}// Afegir nou element: codi manual propens a errors
function afegirElement(nouElement) {
  // Crear estructura HTML
  const li = document.createElement('li');
  const article = document.createElement('article');
  article.className = 'targeta';
  article.dataset.id = nouElement.id;

  const h3 = document.createElement('h3');
  h3.textContent = nouElement.titol;
  article.appendChild(h3);

  const span = document.createElement('span');
  span.className = 'categoria';
  span.textContent = nouElement.categoria;
  article.appendChild(span);

  li.appendChild(article);
  document.querySelector('.grid-targetes').appendChild(li);

  // Afegir listener
  article.addEventListener('click', () => {
    console.log('Clic a:', nouElement.titol);
  });
}

// 20 línies per afegir 1 element!{% endcapture %}
    {% include code-block.html lang="javascript" code=code_139 %}

    <p><strong>Errors típics que provoca:</strong></p>
    <ul>
      <li>Elements no s'actualitzen quan canvien dades → interfície desincronitzada</li>
      <li>Referències obsoletes (<code>querySelector</code> retorna <code>null</code>) → errors runtime</li>
      <li>Event listeners duplicats → múltiples execucions per un sol clic</li>
      <li>Pèrdua d'esdeveniments en recrear elements → funcionalitat trencada</li>
      <li>Fuites de memòria per no eliminar listeners antics → rendiment degradat</li>
    </ul>

    <p><strong>3. Dificultat per mantenir sincronització dades-vista</strong><br>
    L'estat de l'aplicació es fragmenta entre múltiples llocs:</p>
    <ul>
      <li>Array JavaScript amb les dades reals</li>
      <li>DOM amb els elements visuals</li>
      <li>Variables globals amb índexs i referències</li>
      <li>Atributs <code>data-*</code> amb informació duplicada</li>
    </ul>

    <p><strong>Exemple real de desincronització:</strong></p>

    {% capture code_140 %}let elements = [
  { id: 1, titol: 'Colors' },
  { id: 2, titol: 'Icones' },
  { id: 3, titol: 'Tipografia' }
];

// Renderitzar llista inicial (3 elements al DOM)
renderitzarLlista(elements);

// Eliminar element amb id=2 de l'array
elements = elements.filter(el => el.id !== 2);
// Ara: elements = [{id:1}, {id:3}]

// Problema: El DOM encara mostra 3 elements!
// Cal actualitzar manualment:
document.querySelector('[data-id="2"]').remove();

// Però si oblides aquesta línia, la interfície mostra dades incorrectes!{% endcapture %}
    {% include code-block.html lang="javascript" code=code_140 %}

    <p><strong>Desincronitzacions habituals:</strong></p>
    <ul>
      <li>L'array té 10 elements però el DOM mostra 12 (2 obsolets)</li>
      <li>Actualitzar un element a l'array no actualitza la targeta visual</li>
      <li>Ordenar l'array no reordena els elements al DOM</li>
      <li>Afegir element nou no apareix fins refrescar pàgina</li>
    </ul>

    <p><strong>4. Rendiment degradat amb llistes grans</strong><br>
    Sense optimitzacions intel·ligents, cada petit canvi recrea tota la llista:</p>

    {% capture code_141 %}// Rendiment dolent: recreació completa
function actualitzarLlista(elements) {
  const contenidor = document.querySelector('.grid-targetes');
  contenidor.innerHTML = ''; // DESTRUEIX TOT (inclosos listeners!)

  elements.forEach(element => {
    // Recrea TOTS els elements de zero
    const li = document.createElement('li');
    // ... 15 línies més per crear estructura completa
    contenidor.appendChild(li);
  });
}

// Cada tecla al camp de cerca → recreació completa!
inputCerca.addEventListener('input', (event) => {
  const filtrats = elements.filter(el =>
    el.titol.includes(event.target.value)
  );
  actualitzarLlista(filtrats); // Recrea tot el DOM
});{% endcapture %}
    {% include code-block.html lang="javascript" code=code_141 %}

    <p><strong>Impacte en rendiment mesurat:</strong></p>
    <ul>
      <li>Llista de 50 elements: 80-120ms per actualització</li>
      <li>Llista de 100 elements: 150-200ms per actualització</li>
      <li>Llista de 500 elements: 800-1200ms (1-1.2 segons)</li>
      <li>Llista de 1000 elements: 1500-2500ms (1.5-2.5 segons)</li>
    </ul>

    <p><strong>Experiència d'usuari:</strong> Cada tecla a la cerca recrea tots els elements → interfície que "peta", scroll que salta, inputs que perden focus.</p>

    <p><strong>5. Escalabilitat limitada i mantenibilitat baixa</strong><br>
    Afegir funcionalitats noves requereix modificar múltiples parts del codi i és propens a trencar funcionalitat existent.</p>

    <p><strong>Exemple real:</strong> Afegir numeració als elements</p>
    <ul>
      <li>Canviar el bucle <code>forEach</code> per afegir índex</li>
      <li>Modificar construcció d'HTML per incloure número</li>
      <li>Actualitzar els estils CSS</li>
      <li>Verificar que funciona amb filtre, cerca, ordenació</li>
      <li>Provar que no trenca event listeners</li>
    </ul>

    <p><strong>Temps necessari:</strong> 30-45 minuts de feina + 15 minuts de testing → <strong>45-60 minuts</strong> per afegir un simple número.</p>

    <p><strong>Risc:</strong> Alta probabilitat de trencar funcionalitat existent per la interconnexió de tot el codi.</p>

    <h4>1.2.3. Solució amb directives estructurals</h4>

    <p>Angular simplifica radicalment la gestió de llistes dinàmiques amb <code>*ngFor</code>:</p>

    <p><strong>Plantilla HTML (declarativa i clara):</strong></p>

    {% capture code_142 %}<!-- Angular: sintaxi declarativa -->
<ul class="grid-targetes">
  <li *ngFor="let element of elements; let i = index; let esParell = even"
      [class.parell]="esParell"
      [class.senar]="!esParell">
    <article class="targeta" (click)="onClicElement(element)">
      <span class="numero">{% raw %}{{ i + 1 }}{% endraw %}</span>
      <h3>{% raw %}{{ element.titol }}{% endraw %}</h3>
      <span class="categoria">{% raw %}{{ element.categoria }}{% endraw %}</span>
    </article>
  </li>
</ul>{% endcapture %}
    {% include code-block.html lang="html" code=code_142 %}

    <p><strong>Component TypeScript (lògica separada):</strong></p>

    {% capture code_143 %}export class CatalegComponent {
  elements: Element[] = [
    { id: 1, titol: 'Colors corporatius', categoria: 'Paletes' },
    { id: 2, titol: 'Pack d\'icones', categoria: 'Icones' },
    { id: 3, titol: 'Sistema tipogràfic', categoria: 'Tipografia' }
    // ... més elements
  ];

  onClicElement(element: Element): void {
    console.log('Clic a:', element.titol);
  }
}

// Total: 10 línies vs 40-50 del JavaScript manual{% endcapture %}
    {% include code-block.html lang="typescript" code=code_143 %}

    <p><strong>Avantatges principals:</strong></p>
    <ul>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Codi declaratiu:</strong> Descriviu <strong>què</strong> voleu mostrar, Angular gestiona el <strong>com</strong>.</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Actualitzacions automàtiques:</strong> Canvis a l'array → actualització automàtica del DOM.</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Rendiment optimitzat:</strong> Angular actualitza només els elements que canvien (amb <code>trackBy</code>).</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Sincronització garantida:</strong> Una única font de veritat (l'array del component).</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Mantenibilitat alta:</strong> Canvis concentrats en un sol lloc.</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Menys codi:</strong> Reducció del 75-80% de línies (40-50 → 10 línies).</li>
    </ul>

    <h4>1.2.4. Exemple real complet: Llista del catàleg</h4>

    <p><strong><i class="bi bi-x-circle text-danger" aria-hidden="true"></i> Sense *ngFor (JavaScript manual - 45 línies):</strong></p>

    {% capture code_144 %}// JavaScript pur: gestió manual completa
const contenidor = document.getElementById('cataleg');
const elements = [
  { id: 1, titol: 'Colors', categoria: 'Paletes', preu: 0 },
  { id: 2, titol: 'Icones', categoria: 'Icones', preu: 29 },
  { id: 3, titol: 'Tipografia', categoria: 'Tipografia', preu: 0 }
];

function renderitzarCataleg() {
  let html = '<ul class="grid">';

  elements.forEach((element, index) => {
    const classe = index % 2 === 0 ? 'parell' : 'senar';
    html += `
      <li class="${classe}">
        <article data-id="${element.id}">
          <span class="num">${index + 1}</span>
          <h3>${element.titol}</h3>
          <span class="cat">${element.categoria}</span>
          <span class="preu">${element.preu === 0 ? 'Gratuït' : element.preu + '€'}</span>
        </article>
      </li>
    `;
  });

  html += '</ul>';
  contenidor.innerHTML = html;

  // Afegir listeners
  elements.forEach(element => {
    const article = document.querySelector(`[data-id="${element.id}"]`);
    article.addEventListener('click', () => {
      alert('Element: ' + element.titol);
    });
  });
}

function afegirElement(nou) {
  elements.push(nou);
  renderitzarCataleg(); // Recrea tot!
}

function eliminarElement(id) {
  elements = elements.filter(el => el.id !== id);
  renderitzarCataleg(); // Recrea tot!
}

renderitzarCataleg();

// Total: 45 línies
// Problemes: recreació completa, listeners duplicats, no optimitzat{% endcapture %}
    {% include code-block.html lang="javascript" code=code_144 %}

    <p><strong><i class="bi bi-check-circle text-success" aria-hidden="true"></i> Amb *ngFor (Angular - 12 línies):</strong></p>

    {% capture code_145 %}<!-- cataleg.component.html -->
<ul class="grid">
  <li *ngFor="let element of elements; let i = index; let esParell = even; trackBy: trackById"
      [class.parell]="esParell">
    <article (click)="onClicElement(element)">
      <span class="num">{% raw %}{{ i + 1 }}{% endraw %}</span>
      <h3>{% raw %}{{ element.titol }}{% endraw %}</h3>
      <span class="cat">{% raw %}{{ element.categoria }}{% endraw %}</span>
      <span class="preu">{% raw %}{{ element.preu === 0 ? 'Gratuït' : element.preu + '€' }}{% endraw %}</span>
    </article>
  </li>
</ul>{% endcapture %}
    {% include code-block.html lang="html" code=code_145 %}

    {% capture code_146 %}// cataleg.component.ts
export class CatalegComponent {
  elements: Element[] = [
    { id: 1, titol: 'Colors', categoria: 'Paletes', preu: 0 },
    { id: 2, titol: 'Icones', categoria: 'Icones', preu: 29 },
    { id: 3, titol: 'Tipografia', categoria: 'Tipografia', preu: 0 }
  ];

  trackById(index: number, element: Element): number {
    return element.id;
  }

  onClicElement(element: Element): void {
    alert('Element: ' + element.titol);
  }

  afegirElement(nou: Element): void {
    this.elements.push(nou); // Actualització automàtica!
  }

  eliminarElement(id: number): void {
    this.elements = this.elements.filter(el => el.id !== id); // Automàtic!
  }
}

// Total: 12 línies (plantilla) + 15 línies (component) = 27 línies{% endcapture %}
    {% include code-block.html lang="typescript" code=code_146 %}

    <p><strong>Comparativa quantitativa:</strong></p>
    <ul>
      <li><strong>Línies de codi:</strong> 45 → 27 (-40%)</li>
      <li><strong>Complexitat ciclomàtica:</strong> Alta → Baixa</li>
      <li><strong>Actualitzacions:</strong> Manuals (recreació total) → Automàtiques (només canvis)</li>
      <li><strong>Rendiment 100 elements:</strong> 150ms → 15ms (-90%)</li>
      <li><strong>Errors potencials:</strong> 12-15 → 1-2 (-85%)</li>
      <li><strong>Temps desenvolupament:</strong> 45 min → 10 min (-78%)</li>
      <li><strong>Temps afegir funcionalitat:</strong> 30 min → 5 min (-83%)</li>
    </ul>

    <h4>1.2.5. Taula comparativa: JavaScript manual vs *ngFor</h4>

    <table>
      <thead>
        <tr>
          <th>Característica</th>
          <th>JavaScript manual</th>
          <th>*ngFor Angular</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Línies de codi</strong></td>
          <td>40-50</td>
          <td>10-15</td>
        </tr>
        <tr>
          <td><strong>Actualitzacions</strong></td>
          <td>Manuals (recreació total)</td>
          <td>Automàtiques (diff intel·ligent)</td>
        </tr>
        <tr>
          <td><strong>Rendiment (100 elements)</strong></td>
          <td>150-200ms</td>
          <td>10-20ms</td>
        </tr>
        <tr>
          <td><strong>Rendiment (1000 elements)</strong></td>
          <td>1500-2500ms</td>
          <td>80-150ms</td>
        </tr>
        <tr>
          <td><strong>Sincronització dades-vista</strong></td>
          <td>Manual (propensa a errors)</td>
          <td>Automàtica (garantida)</td>
        </tr>
        <tr>
          <td><strong>Event listeners</strong></td>
          <td>Manual (duplicació fàcil)</td>
          <td>Automàtic (gestió interna)</td>
        </tr>
        <tr>
          <td><strong>Mantenibilitat</strong></td>
          <td>Baixa (codi dispers)</td>
          <td>Alta (declaratiu)</td>
        </tr>
        <tr>
          <td><strong>Escalabilitat</strong></td>
          <td>Dolenta (temps lineal)</td>
          <td>Excel·lent (optimitzada)</td>
        </tr>
        <tr>
          <td><strong>Errors típics</strong></td>
          <td>10-15</td>
          <td>1-2</td>
        </tr>
        <tr>
          <td><strong>Testabilitat</strong></td>
          <td>Difícil (depèn DOM)</td>
          <td>Fàcil (component aïllat)</td>
        </tr>
        <tr>
          <td><strong>Temps desenvolupament</strong></td>
          <td>45-60 min</td>
          <td>10-15 min</td>
        </tr>
      </tbody>
    </table>

    <h4>1.2.6. Taula de conceptes clau</h4>

    <table>
      <thead>
        <tr>
          <th>Concepte</th>
          <th>Definició</th>
          <th>Sintaxi</th>
          <th>Exemple d'ús</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>*ngFor</strong></td>
          <td>Directiva d'iteració sobre col·leccions</td>
          <td><code>*ngFor="let x of xs"</code></td>
          <td>Mostrar llista elements</td>
        </tr>
        <tr>
          <td><strong>trackBy</strong></td>
          <td>Funció per identificar elements únics</td>
          <td><code>trackBy: trackByFn</code></td>
          <td>Optimitzar rendiment</td>
        </tr>
        <tr>
          <td><strong>index</strong></td>
          <td>Posició actual (començant per 0)</td>
          <td><code>let i = index</code></td>
          <td>Numeració, zebrat</td>
        </tr>
        <tr>
          <td><strong>first</strong></td>
          <td>Primer element (boolean)</td>
          <td><code>let isFirst = first</code></td>
          <td>Estil especial primer</td>
        </tr>
        <tr>
          <td><strong>last</strong></td>
          <td>Últim element (boolean)</td>
          <td><code>let isLast = last</code></td>
          <td>Estil especial últim</td>
        </tr>
        <tr>
          <td><strong>even</strong></td>
          <td>Element en posició parell (boolean)</td>
          <td><code>let isEven = even</code></td>
          <td>Files zebrades</td>
        </tr>
        <tr>
          <td><strong>odd</strong></td>
          <td>Element en posició senar (boolean)</td>
          <td><code>let isOdd = odd</code></td>
          <td>Files zebrades</td>
        </tr>
      </tbody>
    </table>

    <h4>1.2.7. Quan usar / quan no usar *ngFor</h4>

    <p><strong><i class="bi bi-check-circle text-success" aria-hidden="true"></i> Usar *ngFor quan:</strong></p>
    <ul>
      <li><strong>Mostrar llistes dinàmiques:</strong> Qualsevol col·lecció amb N elements desconeguts o variables (catàlegs, resultats cerca, feeds).</li>
      <li><strong>Generar opcions de formularis:</strong> Elements <code>&lt;option&gt;</code> dins de <code>&lt;select&gt;</code>, checkboxes o radios dinàmics.</li>
      <li><strong>Crear taules amb dades:</strong> Files de taules amb dades provinents de bases de dades, APIs o serveis.</li>
      <li><strong>Mostrar grids de targetes:</strong> Galeries d'imatges, catàlegs de productes, grids de contingut (Pinterest-style).</li>
    </ul>

    <p><strong><i class="bi bi-x-circle text-danger" aria-hidden="true"></i> No usar *ngFor (alternativa millor) quan:</strong></p>

    <p><strong>1. Nombre fix i conegut d'elements:</strong> Si sempre són exactament 3 botons o 5 seccions, escriviu-los manualment per claredat.</p>

    {% capture code_147 %}<!-- No cal *ngFor per 3 elements fixos -->
<button>Opció 1</button>
<button>Opció 2</button>
<button>Opció 3</button>{% endcapture %}
    {% include code-block.html lang="html" code=code_147 %}

    <p><strong>2. Opcions exclusives conegudes:</strong> Per múltiples opcions mútuament exclusives, useu <code>*ngSwitch</code> en lloc de <code>*ngFor</code>.</p>

    {% capture code_148 %}<!-- Millor amb *ngSwitch -->
<div [ngSwitch]="estat">
  <p *ngSwitchCase="'carregant'">Carregant...</p>
  <p *ngSwitchCase="'error'">Error!</p>
  <p *ngSwitchCase="'exit'">Carregat</p>
</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_148 %}

    <p><strong>3. Un sol element condicional:</strong> Si només mostreu/amageu un element, useu <code>*ngIf</code>.</p>

    {% capture code_149 %}<!-- Millor amb *ngIf -->
<p *ngIf="teResultats">Trobats {% raw %}{{ resultats.length }}{% endraw %} elements</p>{% endcapture %}
    {% include code-block.html lang="html" code=code_149 %}

    <h4>1.2.8. Característiques principals de *ngFor</h4>

    <p><strong>1. Sintaxi declarativa amb asterisc</strong><br>
    La sintaxi <code>*ngFor</code> s'integra directament a la plantilla HTML. L'asterisc és <strong>sintaxi sugar</strong> que Angular transforma internament a <code>&lt;ng-template&gt;</code> per gestionar la creació i destrucció d'elements.</p>

    <p><strong>2. Variables locals contextuals</strong><br>
    Cada iteració disposa de variables especials que proporcionen context sobre la posició: <code>index</code> (posició numèrica), <code>first</code>/<code>last</code> (booleans primers/últims), <code>even</code>/<code>odd</code> (booleans paritat). Aquestes variables permeten aplicar estils alterns, numeracions i comportaments condicionals.</p>

    <p><strong>3. Optimització amb trackBy</strong><br>
    La funció <code>trackBy</code> permet a Angular identificar cada element de manera única, evitant recreacions innecessàries quan les dades canvien. Sense <code>trackBy</code>, Angular recrea tots els elements; amb <code>trackBy</code>, només actualitza els que han canviat realment.</p>

    <p><strong>4. Change Detection automàtic</strong><br>
    Quan l'array canvia (afegir, eliminar, ordenar elements), Angular detecta automàticament els canvis i actualitza només les parts del DOM afectades, sense necessitat de codi manual.</p>

    <p><strong>5. Integració amb components fills</strong><br>
    <code>*ngFor</code> funciona perfectament amb components personalitzats, passant dades mitjançant <code>@Input()</code> i rebent esdeveniments amb <code>@Output()</code>, creant una arquitectura modular i reutilitzable.</p>

    <h4>1.2.9. Integració amb el projecte del curs</h4>

    <p>Al <strong>catàleg d'elements</strong>, utilitzarem <code>*ngFor</code> per implementar:</p>

    <p><strong>Funcionalitats principals:</strong></p>
    <ul>
      <li><strong>Grid de targetes:</strong> Mostrar tots els elements del catàleg amb <code>*ngFor</code> sobre el component <code>TargetaElementComponent</code>.</li>
      <li><strong>Llistes de categories:</strong> Iterar categories i, dins de cada categoria, iterar els seus elements (llistes niades).</li>
      <li><strong>Numeració d'elements:</strong> Utilitzar la variable <code>index</code> per mostrar "Element 1 de 50".</li>
      <li><strong>Estils zebrats:</strong> Aplicar classes CSS diferents a files parells/senars amb variables <code>even</code>/<code>odd</code>.</li>
      <li><strong>Optimització:</strong> Implementar <code>trackBy</code> amb els IDs únics per garantir rendiment amb centenars d'elements.</li>
      <li><strong>Filtres dinàmics:</strong> Filtrar elements per cerca o categoria actualitzant l'array, amb re-renderització automàtica.</li>
    </ul>

    <p>Aquest patró de <code>*ngFor</code> serà <strong>fonamental</strong> per mostrar contingut dinàmic de manera eficient i mantenible al vostre projecte.</p>
  {% endcapture %}
  {% include section-point.html numero="1.2" titol="Marc conceptual" contingut=section_point_1_2 %}

  {% capture section_point_1_3 %}
    <h4>1.3.1. Flux de treball amb *ngFor</h4>

    {% capture code_150 %}[Disseny] → [Identificar llista] → [Definir array] → [Escriure *ngFor]
              ↓                      ↓                  ↓
[Patró repetitiu]      [TypeScript interface]   [Variables locals]
              ↓                      ↓                  ↓
          [Decidir si cal trackBy] → [Implementar] → [Verificar]{% endcapture %}
    {% include code-block.html lang="text" code=code_150 %}

    <h4>1.3.2. Conceptes clau</h4>

    <ul>
      <li><strong>Declaratiu vs imperatiu:</strong> Descriviu QUÈ voleu; Angular gestiona el COM.</li>
      <li><strong>Context local:</strong> Variables <code>index</code>, <code>first</code>, <code>last</code>, <code>even</code>, <code>odd</code> disponibles automàticament.</li>
      <li><strong>Identitat única:</strong> Utilitzeu <code>trackBy</code> amb IDs únics per optimitzar rendiment.</li>
      <li><strong>Actualització intel·ligent:</strong> Angular actualitza només els elements que canvien.</li>
    </ul>

    <h4>1.3.3. Flux de dades</h4>

    {% capture code_151 %}Component (TypeScript)
    ↓
elements: Element[] = [...]
    ↓
Plantilla (*ngFor)
    ↓
<li *ngFor="let element of elements">
    ↓
Component fill
    ↓
<app-targeta [element]="element">
    ↓
DOM renderitzat{% endcapture %}
    {% include code-block.html lang="text" code=code_151 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Les directives estructurals són les eines més poderoses d'Angular per crear interfícies dinàmiques. *ngFor és especialment fonamental per mostrar qualsevol llista o col·lecció." %}
  {% endcapture %}
  {% include section-point.html numero="1.3" titol="Model mental" contingut=section_point_1_3 %}

  {% capture section_point_1_4 %}
    <h4>1.4.1. Objectiu</h4>
    <p>Entendre què són les directives estructurals i com modifiquen l'estructura del DOM.</p>

    <h4>1.4.2. Contingut</h4>

    <p>Les directives estructurals modifiquen l'estructura del DOM afegint, eliminant o repetint elements. S'identifiquen amb l'asterisc <code>*</code>.</p>

    <p><strong>Diferència amb vinculació de propietats:</strong></p>

    <table>
      <thead>
        <tr>
          <th>Aspecte</th>
          <th>Vinculació propietats</th>
          <th>Directives estructurals</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Què fa</strong></td>
          <td>Canvia valors atributs</td>
          <td>Modifica estructura DOM</td>
        </tr>
        <tr>
          <td><strong>Sintaxi</strong></td>
          <td><code>[prop]="valor"</code></td>
          <td><code>*directiva="expr"</code></td>
        </tr>
        <tr>
          <td><strong>Exemple</strong></td>
          <td><code>[src]="imatge"</code></td>
          <td><code>*ngFor="let x of xs"</code></td>
        </tr>
      </tbody>
    </table>

    <p><strong>Transformació interna:</strong></p>

    <p>Angular transforma <code>*ngFor</code> internament a <code>&lt;ng-template&gt;</code>:</p>

    {% capture code_152 %}<!-- Escrivim (sintaxi sugar) -->
<li *ngFor="let element of elements">{% raw %}{{ element }}{% endraw %}</li>

<!-- Angular transforma a -->
<ng-template ngFor let-element [ngForOf]="elements">
  <li>{% raw %}{{ element }}{% endraw %}</li>
</ng-template>{% endcapture %}
    {% include code-block.html lang="html" code=code_152 %}

    <p><strong>Avantatges:</strong></p>
    <ul>
      <li>Codi declaratiu (què en lloc de com)</li>
      <li>Gestió automàtica del cicle de vida</li>
      <li>Optimitzacions internes d'Angular</li>
    </ul>

    {% include success_box.html contingut="<strong>Clau:</strong> Les directives estructurals canvien QUANTS elements hi ha al DOM, no només el seu contingut." %}

    <h4>1.4.3. Resultat esperat</h4>
    <p>Compreneu la diferència fonamental entre directives estructurals i vinculació de propietats.</p>
  {% endcapture %}
  {% include section-point.html numero="1.4" titol="Què són les directives estructurals" contingut=section_point_1_4 %}

  {% capture section_point_1_5 %}
    <h4>1.5.1. Objectiu</h4>
    <p>Dominar la sintaxi fonamental de <code>*ngFor</code> i crear la primera iteració.</p>

    <h4>1.5.2. Contingut</h4>

    <p><strong>Sintaxi bàsica:</strong></p>

    {% capture code_153 %}<element *ngFor="let item of col·lecció">
  {% raw %}{{ item }}{% endraw %}
</element>{% endcapture %}
    {% include code-block.html lang="html" code=code_153 %}

    <p><strong>Components:</strong></p>
    <ul>
      <li><code>*ngFor</code>: directiva d'iteració</li>
      <li><code>let item</code>: variable local accessible dins del bloc</li>
      <li><code>of col·lecció</code>: array o iterable a recórrer</li>
    </ul>

    <p><strong>Important:</strong> Utilitzeu <code>of</code> (no <code>in</code>). <code>of</code> itera valors; <code>in</code> itera claus.</p>

    <p><strong>Exemple mínim:</strong></p>

    {% capture code_154 %}// Component
titols: string[] = ['Angular', 'TypeScript', 'RxJS'];{% endcapture %}
    {% include code-block.html lang="typescript" code=code_154 %}

    {% capture code_155 %}<!-- Plantilla -->
<ul>
  <li *ngFor="let titol of titols">{% raw %}{{ titol }}{% endraw %}</li>
</ul>{% endcapture %}
    {% include code-block.html lang="html" code=code_155 %}

    <p><strong>Resultat:</strong></p>

    {% capture code_156 %}<ul>
  <li>Angular</li>
  <li>TypeScript</li>
  <li>RxJS</li>
</ul>{% endcapture %}
    {% include code-block.html lang="html" code=code_156 %}

    <p><strong>Col·leccions suportades:</strong></p>
    <ul>
      <li>Arrays de primitius: <code>['A', 'B', 'C']</code></li>
      <li>Arrays d'objectes: <code>[{id:1}, {id:2}]</code> (més comú)</li>
      <li>Sets: <code>new Set([1,2,3])</code></li>
      <li>Maps (amb pipe <code>keyvalue</code>)</li>
    </ul>

    <p><strong>Exemple al catàleg:</strong></p>

    {% capture code_157 %}interface Element {
  id: number;
  titol: string;
  categoria: string;
}

elements: Element[] = [
  { id: 1, titol: 'Colors', categoria: 'Paletes' },
  { id: 2, titol: 'Icones', categoria: 'Icones' }
];{% endcapture %}
    {% include code-block.html lang="typescript" code=code_157 %}

    {% capture code_158 %}<ul>
  <li *ngFor="let element of elements">
    <h3>{% raw %}{{ element.titol }}{% endraw %}</h3>
    <span>{% raw %}{{ element.categoria }}{% endraw %}</span>
  </li>
</ul>{% endcapture %}
    {% include code-block.html lang="html" code=code_158 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Una línia *ngFor substitueix bucles manuals de 20-30 línies." %}

    <h4>1.5.3. Resultat esperat</h4>
    <p>Sabeu utilitzar la sintaxi bàsica <code>*ngFor="let item of items"</code> per iterar col·leccions.</p>
  {% endcapture %}
  {% include section-point.html numero="1.5" titol="Sintaxi bàsica de *ngFor" contingut=section_point_1_5 %}

  {% capture section_point_1_6 %}
    <h4>1.6.1. Objectiu</h4>
    <p>Utilitzar variables locals (<code>index</code>, <code>first</code>, <code>last</code>, <code>even</code>, <code>odd</code>) per estils i numeració.</p>

    <h4>1.6.2. Contingut</h4>

    <p><code>*ngFor</code> proporciona variables locals amb informació contextual:</p>

    <table>
      <thead>
        <tr>
          <th>Variable</th>
          <th>Tipus</th>
          <th>Valor</th>
          <th>Exemple d'ús</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>index</strong></td>
          <td>number</td>
          <td>0, 1, 2...</td>
          <td>Numeració</td>
        </tr>
        <tr>
          <td><strong>first</strong></td>
          <td>boolean</td>
          <td>true si és el primer</td>
          <td>Estil especial</td>
        </tr>
        <tr>
          <td><strong>last</strong></td>
          <td>boolean</td>
          <td>true si és l'últim</td>
          <td>Estil especial</td>
        </tr>
        <tr>
          <td><strong>even</strong></td>
          <td>boolean</td>
          <td>true si posició parell</td>
          <td>Zebrat</td>
        </tr>
        <tr>
          <td><strong>odd</strong></td>
          <td>boolean</td>
          <td>true si posició senar</td>
          <td>Zebrat</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Sintaxi:</strong></p>

    {% capture code_159 %}<li *ngFor="let item of items; let i = index; let isFirst = first">{% endcapture %}
    {% include code-block.html lang="html" code=code_159 %}

    <p><strong>Exemple amb index (numeració):</strong></p>

    {% capture code_160 %}<li *ngFor="let element of elements; let i = index">
  <span class="numero">{% raw %}{{ i + 1 }}{% endraw %}</span>
  <h3>{% raw %}{{ element.titol }}{% endraw %}</h3>
</li>{% endcapture %}
    {% include code-block.html lang="html" code=code_160 %}

    <p><strong>Resultat:</strong></p>

    {% capture code_161 %}1. Colors corporatius
2. Pack d'icones
3. Sistema tipogràfic{% endcapture %}
    {% include code-block.html lang="text" code=code_161 %}

    <p><strong>Exemple amb even/odd (zebrat):</strong></p>

    {% capture code_162 %}<li *ngFor="let element of elements; let esParell = even"
    [class.fila-clara]="esParell"
    [class.fila-fosca]="!esParell">
  {% raw %}{{ element.titol }}{% endraw %}
</li>{% endcapture %}
    {% include code-block.html lang="html" code=code_162 %}

    <p><strong>Exemple amb first/last:</strong></p>

    {% capture code_163 %}<li *ngFor="let element of elements; let isFirst = first; let isLast = last"
    [class.primera]="isFirst"
    [class.ultima]="isLast">
  {% raw %}{{ element.titol }}{% endraw %}
</li>{% endcapture %}
    {% include code-block.html lang="html" code=code_163 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Les variables locals permeten estils dinàmics sense lògica adicional al component." %}

    <h4>1.6.3. Resultat esperat</h4>
    <p>Sabeu utilitzar variables locals per crear numeracions i aplicar estils condicionals.</p>
  {% endcapture %}
  {% include section-point.html numero="1.6" titol="Variables locals disponibles" contingut=section_point_1_6 %}

  {% capture section_point_1_7 %}
    <h4>1.7.1. Objectiu</h4>
    <p>Implementar <code>trackBy</code> per millorar rendiment i preservar estat de components.</p>

    <h4>1.7.2. Contingut</h4>

    <p><strong>Per què trackBy és crucial:</strong></p>

    <p>Sense <code>trackBy</code>, quan l'array canvia, Angular destrueix i recrea TOTS els elements del DOM, perdent estat (scroll, focus, animacions).</p>

    <p>Amb <code>trackBy</code>, Angular identifica cada element de manera única i només actualitza els que han canviat realment.</p>

    <p><strong>Comparativa de rendiment:</strong></p>

    <table>
      <thead>
        <tr>
          <th>Escenari</th>
          <th>Sense trackBy</th>
          <th>Amb trackBy</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Actualitzar 1 de 100 elements</strong></td>
          <td>Recrea 100</td>
          <td>Actualitza 1</td>
        </tr>
        <tr>
          <td><strong>Afegir 1 element</strong></td>
          <td>Recrea 101</td>
          <td>Crea 1</td>
        </tr>
        <tr>
          <td><strong>Reordenar llista</strong></td>
          <td>Recrea tots</td>
          <td>Reordena (no recrea)</td>
        </tr>
        <tr>
          <td><strong>Temps 1000 elements</strong></td>
          <td>1500ms</td>
          <td>80ms</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Sintaxi:</strong></p>

    {% capture code_164 %}// Component
trackById(index: number, element: Element): number {
  return element.id; // Identificador únic
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_164 %}

    {% capture code_165 %}<!-- Plantilla -->
<li *ngFor="let element of elements; trackBy: trackById">
  {% raw %}{{ element.titol }}{% endraw %}
</li>{% endcapture %}
    {% include code-block.html lang="html" code=code_165 %}

    <p><strong>Important:</strong></p>
    <ul>
      <li>La funció <code>trackBy</code> rep l'índex i l'element</li>
      <li>Retorna un identificador únic (normalment <code>element.id</code>)</li>
      <li>NO utilitzeu l'índex com a identificador si l'array pot reordenar-se</li>
    </ul>

    <p><strong>Exemple complet:</strong></p>

    {% capture code_166 %}export class CatalegComponent {
  elements: Element[] = [...];

  trackById(index: number, element: Element): number {
    return element.id;
  }

  actualitzarElement(id: number, nouTitol: string): void {
    const element = this.elements.find(el => el.id === id);
    if (element) {
      element.titol = nouTitol;
      // Angular actualitza només aquest element gràcies a trackBy
    }
  }
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_166 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Sempre utilitzeu trackBy amb llistes dinàmiques per garantir rendiment i preservar estat." %}

    <h4>1.7.3. Resultat esperat</h4>
    <p>Sabeu implementar <code>trackBy</code> per optimitzar el rendiment de llistes dinàmiques.</p>
  {% endcapture %}
  {% include section-point.html numero="1.7" titol="Optimització amb trackBy" contingut=section_point_1_7 %}

  {% capture section_point_1_8 %}
    <h4>1.8.1. Objectiu</h4>
    <p>Integrar tots els conceptes en un component funcional del catàleg.</p>

    <h4>1.8.2. Contingut</h4>

    <p><strong>Component TypeScript:</strong></p>

    {% capture code_167 %}interface Element {
  id: number;
  titol: string;
  categoria: string;
  disponible: boolean;
}

@Component({
  selector: 'app-cataleg',
  templateUrl: './cataleg.component.html'
})
export class CatalegComponent {
  elements: Element[] = [
    { id: 1, titol: 'Colors', categoria: 'Paletes', disponible: true },
    { id: 2, titol: 'Icones', categoria: 'Icones', disponible: true },
    { id: 3, titol: 'Tipografia', categoria: 'Tipografia', disponible: false }
  ];

  trackById(index: number, element: Element): number {
    return element.id;
  }

  onClicElement(element: Element): void {
    console.log('Seleccionat:', element.titol);
  }
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_167 %}

    <p><strong>Plantilla HTML:</strong></p>

    {% capture code_168 %}<ul class="grid-cataleg">
  <li *ngFor="let element of elements;
              let i = index;
              let esParell = even;
              let isPrimer = first;
              trackBy: trackById"
      [class.parell]="esParell"
      [class.primer]="isPrimer">

    <article (click)="onClicElement(element)">
      <span class="numero">{% raw %}{{ i + 1 }}{% endraw %}</span>
      <h3>{% raw %}{{ element.titol }}{% endraw %}</h3>
      <span class="categoria">{% raw %}{{ element.categoria }}{% endraw %}</span>
      <span class="estat" [class.disponible]="element.disponible">
        {% raw %}{{ element.disponible ? 'Disponible' : 'No disponible' }}{% endraw %}
      </span>
    </article>
  </li>
</ul>{% endcapture %}
    {% include code-block.html lang="html" code=code_168 %}

    <p><strong>Resultat:</strong> Llista amb numeració, estils zebrats, primer element destacat, estat visual i optimització amb trackBy.</p>

    {% include success_box.html contingut="<strong>Clau:</strong> Aquest patró és la base per mostrar qualsevol llista al catàleg." %}

    <h4>1.8.3. Resultat esperat</h4>
    <p>Teniu un component funcional complet que integra tots els conceptes apresos.</p>
  {% endcapture %}
  {% include section-point.html numero="1.8" titol="Exemple pràctic complet" contingut=section_point_1_8 %}

  {% capture section_point_1_9 %}
    <h4>1.9.1. Objectiu</h4>
    <p>Gestionar múltiples nivells d'iteració amb <code>*ngFor</code>.</p>

    <h4>1.9.2. Contingut</h4>

    <p><strong>Escenari:</strong> Mostrar categories amb els seus elements.</p>

    {% capture code_169 %}interface Categoria {
  id: number;
  nom: string;
  elements: Element[];
}

categories: Categoria[] = [
  {
    id: 1,
    nom: 'Paletes',
    elements: [
      { id: 1, titol: 'Colors primaris' },
      { id: 2, titol: 'Colors secundaris' }
    ]
  },
  {
    id: 2,
    nom: 'Icones',
    elements: [
      { id: 3, titol: 'Pack bàsic' }
    ]
  }
];{% endcapture %}
    {% include code-block.html lang="typescript" code=code_169 %}

    <p><strong>Plantilla amb llistes niades:</strong></p>

    {% capture code_170 %}<section *ngFor="let categoria of categories; trackBy: trackCategoriaById">
  <h2>{% raw %}{{ categoria.nom }}{% endraw %}</h2>

  <ul>
    <li *ngFor="let element of categoria.elements; trackBy: trackElementById">
      {% raw %}{{ element.titol }}{% endraw %}
    </li>
  </ul>
</section>{% endcapture %}
    {% include code-block.html lang="html" code=code_170 %}

    <p><strong>Important:</strong></p>
    <ul>
      <li>Cada nivell té el seu propi context de variables locals</li>
      <li><code>trackBy</code> a TOTS els nivells per optimitzar</li>
      <li>Variables locals <code>index</code>, <code>first</code>, etc. són independents per nivell</li>
    </ul>

    {% include success_box.html contingut="<strong>Clau:</strong> Llistes niades permeten estructures jeràrquiques complexes de forma declarativa." %}

    <h4>1.9.3. Resultat esperat</h4>
    <p>Sabeu crear estructures niades amb múltiples nivells de <code>*ngFor</code>.</p>
  {% endcapture %}
  {% include section-point.html numero="1.9" titol="Llistes niades" contingut=section_point_1_9 %}

  {% capture section_point_1_10 %}
    <h4>1.10.1. Objectiu</h4>
    <p>Identificar i resoldre errors comuns amb <code>*ngFor</code>.</p>

    <h4>1.10.2. Contingut</h4>

    <p><strong>Problema 1: Referències perdudes sense trackBy</strong></p>

    {% capture code_171 %}Símptoma: Components fills perden estat en actualitzar array
Causa: Angular recrea elements sense identificador únic
Solució: Implementar trackBy amb element.id{% endcapture %}
    {% include code-block.html lang="text" code=code_171 %}

    <p><strong>Problema 2: Rendiment degradat amb llistes grans</strong></p>

    {% capture code_172 %}Símptoma: Interfície lenta en llistes de 500+ elements
Causa: Recreació completa sense trackBy
Solució: trackBy + virtualització (CDK Virtual Scrolling){% endcapture %}
    {% include code-block.html lang="text" code=code_172 %}

    <p><strong>Problema 3: Error "Cannot read property of undefined"</strong></p>

    {% capture code_173 %}Símptoma: Error en accedir propietats d'element
Causa: Array és undefined o null
Solució: Inicialitzar array buit: elements: Element[] = []{% endcapture %}
    {% include code-block.html lang="text" code=code_173 %}

    <p><strong>Problema 4: Variables locals no funcionen</strong></p>

    {% capture code_174 %}Símptoma: {% raw %}{{ i }}{% endraw %} mostra buit
Causa: Sintaxi incorrecta
Correcte: let i = index
Incorrecte: let i = i o index{% endcapture %}
    {% include code-block.html lang="text" code=code_174 %}

    {% include success_box.html contingut="<strong>Clau:</strong> La majoria de problemes es resolen amb trackBy i inicialització correcta d'arrays." %}

    <h4>1.10.3. Resultat esperat</h4>
    <p>Sabeu identificar i resoldre els errors més comuns amb <code>*ngFor</code>.</p>
  {% endcapture %}
  {% include section-point.html numero="1.10" titol="Problemes habituals i solucions" contingut=section_point_1_10 %}

  {% capture section_point_1_11 %}
    <h4>1.11.1. Objectiu</h4>
    <p>Consolidar recomanacions per utilitzar <code>*ngFor</code> de forma professional.</p>

    <h4>1.11.2. Contingut</h4>

    <p><strong>1. Sempre trackBy amb llistes dinàmiques</strong></p>

    {% capture code_175 %}// Sempre
trackById(index: number, item: Item): number {
  return item.id;
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_175 %}

    <p><strong>2. Identificadors estables i únics</strong></p>

    {% capture code_176 %}// Bon identificador
id: number (únic, estable)

// Mal identificador
Math.random() (canvia cada cop){% endcapture %}
    {% include code-block.html lang="typescript" code=code_176 %}

    <p><strong>3. Arrays inicialitzats</strong></p>

    {% capture code_177 %}// Correcte
elements: Element[] = [];

// Incorrecte
elements: Element[]; // undefined{% endcapture %}
    {% include code-block.html lang="typescript" code=code_177 %}

    <p><strong>4. Variables locals amb noms descriptius</strong></p>

    {% capture code_178 %}<!-- Clar -->
<li *ngFor="let element of elements; let esPrimer = first">

<!-- Confús -->
<li *ngFor="let e of el; let f = first">{% endcapture %}
    {% include code-block.html lang="html" code=code_178 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Seguir aquestes pràctiques garanteix codi mantenible i rendiment òptim." %}

    <h4>1.11.3. Resultat esperat</h4>
    <p>Apliqueu bones pràctiques professionals en l'ús de <code>*ngFor</code>.</p>
  {% endcapture %}
  {% include section-point.html numero="1.11" titol="Bones pràctiques" contingut=section_point_1_11 %}

  {% capture section_point_1_12 %}
    <p><strong>Component TypeScript:</strong></p>

    {% capture code_179 %}// cataleg.component.ts
export class CatalegComponent {
  elements: Element[] = [
    { id: 1, titol: 'Colors', disponible: true },
    { id: 2, titol: 'Icones', disponible: false }
  ];

  trackById = (i: number, el: Element) => el.id;
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_179 %}

    <p><strong>Plantilla HTML:</strong></p>

    {% capture code_180 %}<!-- cataleg.component.html -->
<ul>
  <li *ngFor="let el of elements; let i = index; trackBy: trackById"
      [class.no-disponible]="!el.disponible">
    {% raw %}{{ i + 1 }}{% endraw %}. {% raw %}{{ el.titol }}{% endraw %}
  </li>
</ul>{% endcapture %}
    {% include code-block.html lang="html" code=code_180 %}
  {% endcapture %}
  {% include section-point.html numero="1.12" titol="Mini exemple consolidat" contingut=section_point_1_12 %}

  {% capture section_point_1_13 %}
    <table>
      <thead>
        <tr>
          <th>Símptoma</th>
          <th>Causa</th>
          <th>Solució</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Llista no es mostra</td>
          <td>Array undefined</td>
          <td>Inicialitzar: <code>elements = []</code></td>
        </tr>
        <tr>
          <td>Estat es perd</td>
          <td>Falta trackBy</td>
          <td>Afegir <code>trackBy: trackById</code></td>
        </tr>
        <tr>
          <td>Rendiment lent</td>
          <td>Sense trackBy</td>
          <td>Implementar trackBy</td>
        </tr>
        <tr>
          <td>Error "undefined"</td>
          <td>Propietat no existeix</td>
          <td>Verificar interfície TypeScript</td>
        </tr>
      </tbody>
    </table>
  {% endcapture %}
  {% include section-point.html numero="1.13" titol="Resolució de problemes" contingut=section_point_1_13 %}

  {% capture section_point_1_14 %}
  {% capture prompt_1 %}<strong>Rol:</strong> formador Angular. <strong>Context:</strong> explicar diferència entre <code>of</code> i <code>in</code> a *ngFor. <strong>Tasca:</strong> crea taula comparativa 3 files (sintaxi, itera sobre, exemple). <strong>Format:</strong> Markdown.{% endcapture %}
  {% include prompt-ai.html contingut=prompt_1 %}

  {% capture prompt_2 %}<strong>Rol:</strong> mentor desenvolupament. <strong>Context:</strong> alumne pregunta quan usar trackBy. <strong>Tasca:</strong> explica en 80 paraules 3 situacions on trackBy és obligatori (llistes dinàmiques, components amb estat, rendiment). <strong>Format:</strong> paràgraf + 3 punts.{% endcapture %}
  {% include prompt-ai.html contingut=prompt_2 %}

  {% capture prompt_3 %}<strong>Rol:</strong> tècnica suport. <strong>Context:</strong> error "Cannot read property". <strong>Tasca:</strong> checklist 4 passos verificació quan *ngFor falla: 1. Array definit? 2. Array buit? 3. Propietats correctes? 4. TrackBy implementat? <strong>Format:</strong> llista numerada.{% endcapture %}
  {% include prompt-ai.html contingut=prompt_3 %}
  {% endcapture %}
  {% include section-point.html numero="1.14" titol="Prompts d'IA" contingut=section_point_1_14 %}

  {% capture section_point_1_15 %}
    <h4>Conceptes teòrics</h4>
    {% include checklist.html elements="Comprenc què són les directives estructurals i com modifiquen l'estructura del DOM|Entenc la diferència entre directives estructurals i vinculació de propietats|Sé explicar per què <code>trackBy</code> és crucial per al rendiment|Comprenc com funciona la transformació interna de *ngFor a ng-template" %}

    <h4>Habilitats pràctiques</h4>
    {% capture checklist_practiques %}Sé utilitzar la sintaxi bàsica <code>*ngFor="let item of items"</code>|Puc utilitzar variables locals (index, first, last, even, odd) per estils i numeració|He implementat <code>trackBy</code> amb identificadors únics per optimitzar rendiment|Sé crear llistes niades amb múltiples nivells d'iteració|Puc aplicar estils zebrats utilitzant les variables even/odd|Sé passar dades a components fills dins d'un *ngFor amb <code>@Input()</code>{% endcapture %}
    {% include checklist.html elements=checklist_practiques %}

    <h4>Resolució de problemes</h4>
    {% include checklist.html elements="Sé què fer si la llista no es mostra (array undefined)|Puc diagnosticar pèrdua d'estat per falta de trackBy|Entenc com resoldre errors de rendiment degradat amb llistes grans" %}
  {% endcapture %}
  {% include section-point.html numero="1.15" titol="Autoavaluació" contingut=section_point_1_15 %}

  {% capture section_point_1_16 %}
    <h4>Què heu après</h4>
    <p>En aquesta lectura heu après a utilitzar directives estructurals per crear llistes dinàmiques amb <code>*ngFor</code>. Heu comprès com Angular modifica l'estructura del DOM, la diferència amb vinculació de propietats, i per què les directives estructurals són essencials per aplicacions interactives. Heu dominat la sintaxi <code>*ngFor="let item of items"</code> i sabeu iterar sobre arrays d'objectes. Heu explorat les variables locals (<code>index</code>, <code>first</code>, <code>last</code>, <code>even</code>, <code>odd</code>) per aplicar numeracions i estils zebrats. Heu après la importància crítica de <code>trackBy</code> per optimitzar rendiment i preservar estat de components, implementant funcions que retornen identificadors únics. Heu practicat amb llistes niades per estructures jeràrquiques i sabeu resoldre problemes habituals com referències perdudes o rendiment degradat. Finalment, heu consolidat bones pràctiques: trackBy sempre amb llistes dinàmiques, identificadors estables i únics, arrays inicialitzats correctament. Amb aquests coneixements, esteu preparats per crear interfícies dinàmiques i eficients al catàleg d'elements.</p>
  {% endcapture %}
  {% include section-point.html numero="1.16" titol="Síntesi" contingut=section_point_1_16 %}

  {% capture section_point_1_17 %}
  {% include definicio.html terme="Directiva estructural" definicio="Eina d'Angular que modifica l'estructura del DOM afegint, eliminant o repetint elements." %}

  {% include definicio.html terme="*ngFor" definicio="Directiva d'iteració que crea múltiples còpies d'un element per cada ítem d'una col·lecció." %}

  {% include definicio.html terme="Sintaxi sugar" definicio="Notació simplificada amb asterisc que Angular transforma internament a <code>&lt;ng-template&gt;</code>." %}

  {% include definicio.html terme="Variables locals" definicio="<code>index</code>, <code>first</code>, <code>last</code>, <code>even</code>, <code>odd</code> disponibles automàticament dins de cada iteració." %}

  {% include definicio.html terme="trackBy" definicio="Funció que retorna identificador únic per cada element, permetent a Angular optimitzar actualitzacions." %}

  {% include definicio.html terme="Llistes niades" definicio="Múltiples nivells d'iteració amb <code>*ngFor</code> dins d'un altre <code>*ngFor</code>." %}

  {% include definicio.html terme="Context local" definicio="Cada nivell d'iteració té variables locals independents." %}

  {% include definicio.html terme="Change Detection" definicio="Sistema d'Angular que detecta canvis a l'array i actualitza només els elements afectats." %}
  {% endcapture %}
  {% include section-point.html numero="1.17" titol="Repàs de conceptes" contingut=section_point_1_17 %}

</div>

<!-- SECCIÓ 2: Directives estructurals: condicions -->
<div class="section" id="Unitat2_Bloc2_Seccio2">
  <h2 id="Unitat2_Bloc2_Seccio2">2. Directives estructurals: condicions</h2>

  <!-- MULTIMÈDIA -->
  {% include multimedia-youtube.html unitat=2 bloc=2 seccio=2 %}


  {% include objectius.html llista="Comprendre què són les directives condicionals, com permeten mostrar o amagar elements segons condicions booleanes, i diferenciar entre ocultar amb CSS i no renderitzar amb directives estructurals|Utilitzar *ngIf amb sintaxi bàsica i avançada (else, ng-template) per gestionar renderitzat condicional d'elements segons l'estat de l'aplicació|Aplicar ngSwitch per gestionar múltiples opcions exclusives de manera clara i declarativa, evitant encadenar condicionals|Implementar gestió d'estats habituals de la interfície (carregant, buit, error, disponible) mantenint la lògica al component i la plantilla declarativa" %}

  {% include info_box.html contingut="<strong>RA2 · Criteri 2</strong> — Mostra informació dinàmica utilitzant tècniques de vinculació de dades i plantilles." %}

  {% capture section_point_2_1 %}
    <p>Abans de començar aquesta lectura, assegureu-vos que heu completat:</p>
    <ul>
      <li><strong>Lectura 2.2.1</strong> — Directives estructurals: iteració de llistes amb domini de <code>*ngFor</code> i <code>trackBy</code>.</li>
      <li><strong>Lectura 2.1.2</strong> — Interpolació i vinculació de propietats per mostrar dades dinàmiques.</li>
    </ul>

    <p>A més, necessiteu:</p>
    <ul>
      <li><strong>Projecte funcional:</strong> <code>~/workspace/cataleg-elements</code> amb llista d'elements iterada correctament.</li>
      <li><strong>Servidor de desenvolupament:</strong> <code>ng serve</code> executant-se.</li>
      <li><strong>VS Code obert:</strong> Projecte carregat.</li>
    </ul>

    <p><strong>Verificació ràpida:</strong></p>

    {% capture code_181 %}cd ~/workspace/cataleg-elements
ng serve --open{% endcapture %}
    {% include code-block.html lang="bash" code=code_181 %}

    <p><strong>Punt d'autocomprovació:</strong> La llista d'elements es mostra correctament amb <code>*ngFor</code> abans de començar aquesta lectura.</p>
  {% endcapture %}
  {% include section-point.html numero="2.1" titol="Prerequisits" contingut=section_point_2_1 %}

  {% capture section_point_2_2 %}
    <h4>2.2.1. Què són les directives condicionals</h4>

    <p>Les <strong>directives condicionals</strong> són eines d'Angular que permeten <strong>mostrar o amagar elements</strong> del DOM segons condicions booleanes. A diferència d'ocultar amb CSS (<code>display: none</code>), les directives condicionals <strong>no renderitzen l'element al DOM</strong> si la condició és falsa, millorant rendiment i accessibilitat.</p>

    <p><strong>Característiques clau:</strong></p>
    <ul>
      <li><strong><code>*ngIf</code>:</strong> Mostra element si condició és certa, el destrueix si és falsa</li>
      <li><strong><code>*ngIf ... else</code>:</strong> Defineix plantilla alternativa amb <code>ng-template</code></li>
      <li><strong><code>ngSwitch</code>:</strong> Gestiona múltiples opcions exclusives de manera clara</li>
    </ul>

    <h4>2.2.2. Problema sense directives condicionals</h4>

    <p><strong>Situació abans d'Angular:</strong> Gestionar condicions i estats visuals requeria manipular el DOM manualment amb JavaScript:</p>

    {% capture code_182 %}// JavaScript pur: gestió manual d'estats i condicions
const spinner = document.getElementById('spinner');
const missatgeError = document.getElementById('missatge-error');
const llistaElements = document.getElementById('llista-elements');

let estat = 'carregant';

function actualitzarInterficie() {
  // Ocultar tots els elements primer
  spinner.style.display = 'none';
  missatgeError.style.display = 'none';
  llistaElements.style.display = 'none';

  // Mostrar segons estat
  if (estat === 'carregant') {
    spinner.style.display = 'block';
  } else if (estat === 'error') {
    missatgeError.style.display = 'block';
    missatgeError.textContent = 'Error en carregar';
  } else if (estat === 'disponible') {
    llistaElements.style.display = 'block';
  }
}

// Total: 25-30 línies només per canviar visibilitat{% endcapture %}
    {% include code-block.html lang="javascript" code=code_182 %}

    <p><strong>Problemes que genera:</strong></p>

    <p><strong>1. Gestió manual de visibilitat amb display</strong><br>
    Per cada estat, heu d'ocultar manualment tots els elements i després mostrar només el necessari. Si afegiu un nou estat, heu de modificar múltiples llocs.</p>

    <p><strong>2. Elements al DOM encara que no siguin visibles</strong><br>
    Amb <code>display: none</code>, els elements segueixen al DOM:</p>

    {% capture code_183 %}// Problema: element encara al DOM
missatgeError.style.display = 'none'; // Element segueix existint!

// Conseqüències:
// - Lectors de pantalla poden detectar-lo
// - Ocupa memòria innecessàriament
// - Event listeners segueixen actius{% endcapture %}
    {% include code-block.html lang="javascript" code=code_183 %}

    <ul>
      <li><strong>Accessibilitat:</strong> Lectors de pantalla poden llegir contingut "ocult"</li>
      <li><strong>Rendiment:</strong> 100 elements ocults ocupen memòria i processament innecessari</li>
      <li><strong>Seguretat:</strong> Dades sensibles "ocultes" segueixen visibles al codi font</li>
    </ul>

    <p><strong>3. Encadenament complex de condicionals</strong><br>
    Gestionar múltiples estats amb <code>if/else</code> crea codi difícil de llegir:</p>

    {% capture code_184 %}// Condicionals encadenats difícils de mantenir
if (estat === 'carregant') {
  mostrarSpinner();
} else if (estat === 'error') {
  if (tipusError === 'xarxa') {
    mostrarErrorXarxa();
  } else if (tipusError === 'autenticacio') {
    mostrarErrorAuth();
  } else {
    mostrarErrorGeneric();
  }
} else if (estat === 'buit') {
  mostrarMissatgeBuit();
}

// 20+ línies de condicionals niuats{% endcapture %}
    {% include code-block.html lang="javascript" code=code_184 %}

    <h4>2.2.3. Solució amb directives condicionals</h4>

    <p>Angular simplifica radicalment la gestió de condicions amb <code>*ngIf</code> i <code>ngSwitch</code>:</p>

    <p><strong>Plantilla HTML (declarativa i clara):</strong></p>

    {% capture code_185 %}<!-- Angular: sintaxi declarativa -->
<div *ngIf="estat === 'carregant'">
  <i class="bi bi-hourglass-split"></i> Carregant...
</div>

<div *ngIf="estat === 'error'">
  <i class="bi bi-exclamation-triangle"></i> Error en carregar els elements
</div>

<ul *ngIf="estat === 'disponible' && elements.length > 0">
  <li *ngFor="let element of elements">{% raw %}{{ element.titol }}{% endraw %}</li>
</ul>

<p *ngIf="estat === 'disponible' && elements.length === 0">
  No hi ha elements disponibles
</p>{% endcapture %}
    {% include code-block.html lang="html" code=code_185 %}

    <p><strong>Component TypeScript (lògica separada):</strong></p>

    {% capture code_186 %}export class CatalegComponent {
  estat: 'carregant' | 'error' | 'disponible' = 'carregant';
  elements: Element[] = [];

  ngOnInit(): void {
    this.carregarElements();
  }

  carregarElements(): void {
    this.estat = 'carregant';
    this.apiService.getElements().subscribe({
      next: (data) => {
        this.elements = data;
        this.estat = 'disponible';
      },
      error: () => {
        this.estat = 'error';
      }
    });
  }
}

// Total: 15 línies vs 40-50 del JavaScript manual{% endcapture %}
    {% include code-block.html lang="typescript" code=code_186 %}

    <p><strong>Avantatges principals:</strong></p>
    <ul>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Declaratiu:</strong> Descriviu <strong>què</strong> mostrar segons condició, Angular gestiona el <strong>com</strong>.</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>No al DOM si fals:</strong> Elements no existeixen al DOM si condició és falsa → millor rendiment i accessibilitat.</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Actualització automàtica:</strong> Canvis a l'estat → re-renderització automàtica.</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Codi net:</strong> Reducció del 60-70% de línies (40-50 → 15 línies).</li>
    </ul>

    <h4>2.2.4. Taula comparativa</h4>

    <table>
      <thead>
        <tr>
          <th>Característica</th>
          <th>JavaScript manual</th>
          <th>*ngIf Angular</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Línies de codi</strong></td>
          <td>25-40</td>
          <td>5-10</td>
        </tr>
        <tr>
          <td><strong>Element al DOM si ocult</strong></td>
          <td>Sí (display: none)</td>
          <td>No (destruït)</td>
        </tr>
        <tr>
          <td><strong>Actualitzacions</strong></td>
          <td>Manuals</td>
          <td>Automàtiques</td>
        </tr>
        <tr>
          <td><strong>Accessibilitat</strong></td>
          <td>Problemàtica</td>
          <td>Correcta</td>
        </tr>
        <tr>
          <td><strong>Rendiment</strong></td>
          <td>Baix (elements ocults ocupen memòria)</td>
          <td>Alt (només renderitza necessari)</td>
        </tr>
        <tr>
          <td><strong>Mantenibilitat</strong></td>
          <td>Baixa</td>
          <td>Alta</td>
        </tr>
      </tbody>
    </table>
  {% endcapture %}
  {% include section-point.html numero="2.2" titol="Marc conceptual" contingut=section_point_2_2 %}

  {% capture section_point_2_3 %}
    <h4>2.3.1. Flux amb directives condicionals</h4>

    {% capture code_187 %}[Component] → [Propietat booleana] → [*ngIf] → [Renderitzar si true / Destruir si false]
     ↓                                        ↓
[estat: string]                      <div *ngIf="estat === 'disponible'">
     ↓                                        ↓
[canvi d'estat]                      [Angular actualitza DOM automàticament]{% endcapture %}
    {% include code-block.html lang="text" code=code_187 %}

    <h4>2.3.2. Diferència clau: amagar vs no renderitzar</h4>

    {% capture code_188 %}[hidden] o display:none  →  Element al DOM (ocult visualment)
*ngIf="false"            →  Element NO al DOM (destruït completament){% endcapture %}
    {% include code-block.html lang="text" code=code_188 %}

    {% include success_box.html contingut="<strong>Clau:</strong> *ngIf NO oculta elements, els DESTRUEIX del DOM. Això millora rendiment, accessibilitat i seguretat." %}

    <h4>2.3.3. Quan usar cada opció</h4>

    <p><strong><i class="bi bi-check-circle text-success" aria-hidden="true"></i> Usar *ngIf quan:</strong></p>
    <ul>
      <li>L'element no és necessari la majoria del temps</li>
      <li>Conté dades sensibles que no s'han de veure al codi font</li>
      <li>Té molts elements fills (millor rendiment)</li>
    </ul>

    <p><strong><i class="bi bi-check-circle text-success" aria-hidden="true"></i> Usar [hidden] quan:</strong></p>
    <ul>
      <li>L'element canvia de visibilitat molt sovint (evitar recreació)</li>
      <li>És un element petit sense fills</li>
      <li>Cal mantenir l'estat intern del component fill</li>
    </ul>
  {% endcapture %}
  {% include section-point.html numero="2.3" titol="Model mental" contingut=section_point_2_3 %}

  {% capture section_point_2_4 %}
    <h4>2.4.1. Objectiu</h4>
    <p>Entendre com les directives condicionals controlen el renderitzat d'elements basant-se en valors booleà.</p>

    <h4>2.4.2. Contingut</h4>

    <p>Les directives condicionals permeten <strong>decidir si un element es renderitza o no</strong> al DOM segons una condició booleana.</p>

    <p><strong>Diferència fonamental:</strong></p>

    <table>
      <thead>
        <tr>
          <th>Tècnica</th>
          <th>Efecte</th>
          <th>Element al DOM</th>
          <th>Accessible</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>CSS display: none</strong></td>
          <td>Oculta visualment</td>
          <td>Sí</td>
          <td>Sí (lectors pantalla)</td>
        </tr>
        <tr>
          <td><strong>*ngIf</strong></td>
          <td>No renderitza</td>
          <td>No</td>
          <td>No (correcte)</td>
        </tr>
      </tbody>
    </table>

    <p><strong>Per què és important:</strong></p>
    <ul>
      <li><strong>Accessibilitat:</strong> Elements ocults amb CSS segueixen sent detectats per lectors de pantalla. Amb <code>*ngIf</code>, l'element no existeix.</li>
      <li><strong>Rendiment:</strong> 100 elements ocults ocupen memòria. Amb <code>*ngIf</code>, només els visibles consumeixen recursos.</li>
      <li><strong>Seguretat:</strong> Dades sensibles "ocultes" amb CSS segueixen al codi HTML. Amb <code>*ngIf</code>, no es renderitzen.</li>
    </ul>

    <p><strong>Sintaxi bàsica:</strong></p>

    {% capture code_189 %}<p *ngIf="teElements">Hi ha elements disponibles</p>{% endcapture %}
    {% include code-block.html lang="html" code=code_189 %}

    <p><strong>Com funciona:</strong></p>
    <ul>
      <li>Angular avalua l'expressió <code>teElements</code></li>
      <li>Si és <code>true</code> (o truthy), crea l'element al DOM</li>
      <li>Si és <code>false</code> (o falsy), no crea l'element</li>
      <li>Quan el valor canvia, Angular actualitza automàticament</li>
    </ul>

    {% include success_box.html contingut="<strong>Clau:</strong> *ngIf controla l'<strong>existència</strong> de l'element al DOM, no només la seva visibilitat." %}

    <h4>2.4.3. Resultat esperat</h4>
    <p>Compreneu la diferència entre ocultar amb CSS i no renderitzar amb <code>*ngIf</code>.</p>
  {% endcapture %}
  {% include section-point.html numero="2.4" titol="Directiva condicional: mostrar/amagar segons booleà" contingut=section_point_2_4 %}

  {% capture section_point_2_5 %}
    <h4>2.5.1. Objectiu</h4>
    <p>Dominar la sintaxi de <code>*ngIf</code> amb condicions simples, negació i expressions.</p>

    <h4>2.5.2. Contingut</h4>

    <p><strong>Condició simple:</strong></p>

    {% capture code_190 %}<div *ngIf="disponible">Element disponible</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_190 %}

    <p><strong>Negació:</strong></p>

    {% capture code_191 %}<div *ngIf="!disponible">Element no disponible</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_191 %}

    <p><strong>Expressions complexes:</strong></p>

    {% capture code_192 %}<div *ngIf="elements.length > 0">
  Hi ha {% raw %}{{ elements.length }}{% endraw %} elements
</div>

<div *ngIf="estatLlista === 'error'">
  Error en carregar
</div>

<div *ngIf="elements.length > 0 && !carregant">
  Llista carregada
</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_192 %}

    <p><strong>Valors truthy i falsy:</strong></p>

    <p>Angular avalua com <code>false</code>: <code>false</code>, <code>null</code>, <code>undefined</code>, <code>0</code>, <code>''</code> (string buit), <code>NaN</code></p>

    <p>Angular avalua com <code>true</code>: <code>true</code>, qualsevol número ≠ 0, qualsevol string no buit, arrays i objectes (fins i tot buits)</p>

    <p><strong>Exemple complet:</strong></p>

    {% capture code_193 %}export class CatalegComponent {
  elementsCataleg: Element[] = [];
  carregant = true;
  error: string | null = null;

  get teElements(): boolean {
    return this.elementsCataleg.length > 0;
  }
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_193 %}

    {% capture code_194 %}<!-- Condició simple -->
<div *ngIf="carregant">Carregant...</div>

<!-- Negació -->
<div *ngIf="!carregant">Carregat</div>

<!-- Expressió complexa -->
<div *ngIf="!carregant && teElements">
  Trobats {% raw %}{{ elementsCataleg.length }}{% endraw %} elements
</div>

<!-- Comprovació null -->
<div *ngIf="error">{% raw %}{{ error }}{% endraw %}</div>

<!-- Getter -->
<div *ngIf="teElements">Llista disponible</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_194 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Utilitzeu expressions clares i llegibles; eviteu lògica complexa a la plantilla." %}

    <h4>2.5.3. Resultat esperat</h4>
    <p>Sabeu utilitzar <code>*ngIf</code> amb condicions simples, negació i expressions complexes.</p>
  {% endcapture %}
  {% include section-point.html numero="2.5" titol="Sintaxi bàsica: condició simple i negació" contingut=section_point_2_5 %}

  {% capture section_point_2_6 %}
    <h4>2.6.1. Objectiu</h4>
    <p>Utilitzar <code>else</code> i <code>ng-template</code> per definir contingut alternatiu de manera clara.</p>

    <h4>2.6.2. Contingut</h4>

    <p><strong>Sintaxi amb else:</strong></p>

    {% capture code_195 %}<div *ngIf="teElements; else missatgeBuit">
  <ul>
    <li *ngFor="let element of elements">{% raw %}{{ element.titol }}{% endraw %}</li>
  </ul>
</div>

<ng-template #missatgeBuit>
  <p>No hi ha elements disponibles</p>
</ng-template>{% endcapture %}
    {% include code-block.html lang="html" code=code_195 %}

    <p><strong>Com funciona:</strong></p>
    <ol>
      <li>Angular avalua <code>teElements</code></li>
      <li>Si és <code>true</code>, renderitza el <code>&lt;div&gt;</code> amb la llista</li>
      <li>Si és <code>false</code>, renderitza el contingut de <code>&lt;ng-template&gt;</code></li>
    </ol>

    <p><strong>ng-template explicat:</strong></p>

    <p><code>ng-template</code> és un <strong>contenidor especial</strong> que no es renderitza per si mateix. Només es renderitza quan es referencia des d'un <code>else</code>, <code>then</code>, o programàticament.</p>

    <p><strong>Sintaxi completa amb then i else:</strong></p>

    {% capture code_196 %}<div *ngIf="estatLlista === 'disponible'; then llistaTemplate; else carregantTemplate"></div>

<ng-template #llistaTemplate>
  <ul>
    <li *ngFor="let element of elements">{% raw %}{{ element.titol }}{% endraw %}</li>
  </ul>
</ng-template>

<ng-template #carregantTemplate>
  <p>Carregant elements...</p>
</ng-template>{% endcapture %}
    {% include code-block.html lang="html" code=code_196 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Utilitzeu ng-template per definir contingut alternatiu de manera clara i reutilitzable." %}

    <h4>2.6.3. Resultat esperat</h4>
    <p>Sabeu utilitzar <code>else</code> i <code>ng-template</code> per gestionar alternatives.</p>
  {% endcapture %}
  {% include section-point.html numero="2.6" titol="Alternatives amb else: plantilles alternatives" contingut=section_point_2_6 %}

  {% capture section_point_2_7 %}
    <h4>2.7.1. Objectiu</h4>
    <p>Utilitzar <code>ngSwitch</code> per gestionar múltiples opcions exclusives de manera clara.</p>

    <h4>2.7.2. Contingut</h4>

    <p><strong>Quan usar ngSwitch:</strong> Utilitzeu <code>ngSwitch</code> quan tingueu <strong>3 o més opcions mútuament exclusives</strong>.</p>

    <p><strong>Sintaxi:</strong></p>

    {% capture code_197 %}<div [ngSwitch]="estatLlista">
  <p *ngSwitchCase="'carregant'">Carregant elements...</p>
  <p *ngSwitchCase="'error'">Error en carregar</p>
  <p *ngSwitchCase="'buit'">No hi ha elements</p>
  <p *ngSwitchCase="'disponible'">Llista disponible</p>
  <p *ngSwitchDefault>Estat desconegut</p>
</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_197 %}

    <p><strong>Components:</strong></p>
    <ul>
      <li><code>[ngSwitch]="valor"</code>: Expressió a avaluar (sense asterisc)</li>
      <li><code>*ngSwitchCase="'opcio'"</code>: Cas específic (amb asterisc)</li>
      <li><code>*ngSwitchDefault</code>: Cas per defecte (amb asterisc)</li>
    </ul>

    <p><strong>Comparativa:</strong></p>

    {% capture code_198 %}<!-- Amb múltiples *ngIf (menys clar) -->
<p *ngIf="estat === 'carregant'">Carregant...</p>
<p *ngIf="estat === 'error'">Error</p>
<p *ngIf="estat === 'buit'">Buit</p>
<p *ngIf="estat === 'disponible'">Disponible</p>

<!-- Amb ngSwitch (més clar) -->
<div [ngSwitch]="estat">
  <p *ngSwitchCase="'carregant'">Carregant...</p>
  <p *ngSwitchCase="'error'">Error</p>
  <p *ngSwitchCase="'buit'">Buit</p>
  <p *ngSwitchCase="'disponible'">Disponible</p>
</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_198 %}

    {% include success_box.html contingut="<strong>Clau:</strong> ngSwitch millora la llegibilitat quan hi ha múltiples opcions exclusives." %}

    <h4>2.7.3. Resultat esperat</h4>
    <p>Sabeu utilitzar <code>ngSwitch</code> per gestionar múltiples opcions exclusives.</p>
  {% endcapture %}
  {% include section-point.html numero="2.7" titol="Directiva de selecció múltiple: ngSwitch" contingut=section_point_2_7 %}

  {% capture section_point_2_8 %}
    <h4>2.8.1. Objectiu</h4>
    <p>Implementar una màquina d'estats completa per gestionar els escenaris habituals d'una interfície.</p>

    <h4>2.8.2. Contingut</h4>

    <p><strong>Els 4 estats habituals:</strong></p>
    <ol>
      <li><strong>Carregant (loading):</strong> Dades en procés d'obtenció</li>
      <li><strong>Buit (empty):</strong> No hi ha dades disponibles</li>
      <li><strong>Error:</strong> Ha fallat l'obtenció de dades</li>
      <li><strong>Disponible (success):</strong> Dades carregades correctament</li>
    </ol>

    <p><strong>Implementació amb tipus union:</strong></p>

    {% capture code_199 %}type EstatLlista = 'carregant' | 'buit' | 'error' | 'disponible';

export class CatalegComponent {
  estatLlista: EstatLlista = 'carregant';
  elements: Element[] = [];
  missatgeError = '';

  ngOnInit(): void {
    this.carregarElements();
  }

  carregarElements(): void {
    this.estatLlista = 'carregant';

    this.servei.obtenirElements().subscribe({
      next: (data) => {
        if (data.length === 0) {
          this.estatLlista = 'buit';
        } else {
          this.elements = data;
          this.estatLlista = 'disponible';
        }
      },
      error: (err) => {
        this.missatgeError = 'Error en carregar els elements';
        this.estatLlista = 'error';
      }
    });
  }
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_199 %}

    <p><strong>Plantilla amb ngSwitch:</strong></p>

    {% capture code_200 %}<div [ngSwitch]="estatLlista">
  <div *ngSwitchCase="'carregant'">
    <i class="bi bi-hourglass-split"></i> Carregant...
  </div>

  <div *ngSwitchCase="'error'">
    <i class="bi bi-exclamation-triangle text-danger"></i> {% raw %}{{ missatgeError }}{% endraw %}
    <button (click)="carregarElements()">Tornar a intentar</button>
  </div>

  <div *ngSwitchCase="'buit'">
    <i class="bi bi-inbox"></i> No hi ha elements disponibles
  </div>

  <div *ngSwitchCase="'disponible'">
    <ul>
      <li *ngFor="let element of elements">{% raw %}{{ element.titol }}{% endraw %}</li>
    </ul>
  </div>
</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_200 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Utilitzeu tipus union per garantir que només s'usin estats vàlids i evitar errors de tipus." %}

    <h4>2.8.3. Resultat esperat</h4>
    <p>Sabeu implementar una màquina d'estats per gestionar escenaris habituals.</p>
  {% endcapture %}
  {% include section-point.html numero="2.8" titol="Estats de la interfície: loading, empty, error, success" contingut=section_point_2_8 %}

  {% capture section_point_2_9 %}
    <h4>2.9.1. Objectiu</h4>
    <p>Integrar tots els conceptes en un exemple funcional complet amb simulació d'estats.</p>

    <h4>2.9.2. Contingut</h4>

    <p><strong>Component complet:</strong></p>

    {% capture code_201 %}type EstatLlista = 'carregant' | 'buit' | 'error' | 'disponible';

export class CatalegComponent {
  estatLlista: EstatLlista = 'carregant';
  elements: Element[] = [];
  missatgeError = '';

  carregarElements(): void {
    this.estatLlista = 'carregant';

    setTimeout(() => {
      const dades = this.obtenirDadesSimulades();

      if (Math.random() > 0.8) {
        this.estatLlista = 'error';
        this.missatgeError = 'Error de xarxa';
      } else {
        this.elements = dades;
        this.estatLlista = dades.length > 0 ? 'disponible' : 'buit';
      }
    }, 2000);
  }

  simularEstat(estat: EstatLlista): void {
    this.estatLlista = estat;
  }

  private obtenirDadesSimulades(): Element[] {
    return [
      { id: 1, titol: 'Colors', categoria: 'Paletes' },
      { id: 2, titol: 'Icones', categoria: 'Icones' }
    ];
  }
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_201 %}

    <p><strong>Plantilla amb controls de test:</strong></p>

    {% capture code_202 %}<!-- Controls per provar estats -->
<nav>
  <button (click)="simularEstat('carregant')">Carregant</button>
  <button (click)="simularEstat('disponible')">Disponible</button>
  <button (click)="simularEstat('buit')">Buit</button>
  <button (click)="simularEstat('error')">Error</button>
</nav>

<!-- Interfície principal -->
<div [ngSwitch]="estatLlista">
  <div *ngSwitchCase="'carregant'">
    <i class="bi bi-hourglass-split"></i> Carregant...
  </div>

  <div *ngSwitchCase="'error'">
    <i class="bi bi-exclamation-triangle"></i> {% raw %}{{ missatgeError }}{% endraw %}
    <button (click)="carregarElements()">Tornar a intentar</button>
  </div>

  <div *ngSwitchCase="'buit'">
    <i class="bi bi-inbox"></i> No hi ha elements
  </div>

  <div *ngSwitchCase="'disponible'">
    <ul>
      <li *ngFor="let el of elements; trackBy: trackById">{% raw %}{{ el.titol }}{% endraw %}</li>
    </ul>
  </div>
</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_202 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Els controls de test permeten verificar tots els estats sense dependre de dades reals." %}

    <h4>2.9.3. Resultat esperat</h4>
    <p>Teniu un component funcional amb gestió completa d'estats.</p>
  {% endcapture %}
  {% include section-point.html numero="2.9" titol="Exemple pràctic: missatges segons estat de càrrega" contingut=section_point_2_9 %}

  {% capture section_point_2_10 %}
    <h4>2.10.1. Objectiu</h4>
    <p>Comprendre les diferències tècniques entre amagar amb CSS i no renderitzar amb directives.</p>

    <h4>2.10.2. Contingut</h4>

    <p><strong>Amagar amb CSS:</strong></p>

    {% capture code_203 %}<!-- [hidden] o display: none -->
<div [hidden]="!teElements">Llista d'elements</div>

<!-- Resultat: element AL DOM però no visible -->{% endcapture %}
    {% include code-block.html lang="html" code=code_203 %}

    <p><strong>No renderitzar amb *ngIf:</strong></p>

    {% capture code_204 %}<!-- *ngIf -->
<div *ngIf="teElements">Llista d'elements</div>

<!-- Resultat: element NO AL DOM si false -->{% endcapture %}
    {% include code-block.html lang="html" code=code_204 %}

    <p><strong>Taula comparativa:</strong></p>

    <table>
      <thead>
        <tr>
          <th>Aspecte</th>
          <th>[hidden] / CSS</th>
          <th>*ngIf</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Al DOM</strong></td>
          <td>Sí</td>
          <td>No</td>
        </tr>
        <tr>
          <td><strong>Accessibilitat</strong></td>
          <td>Problemàtica (lectors detecten)</td>
          <td>Correcta</td>
        </tr>
        <tr>
          <td><strong>Rendiment</strong></td>
          <td>Baix (ocupa memòria)</td>
          <td>Alt (només renderitza necessari)</td>
        </tr>
        <tr>
          <td><strong>Seguretat</strong></td>
          <td>Baixa (dades al codi font)</td>
          <td>Alta (no renderitza dades)</td>
        </tr>
        <tr>
          <td><strong>Canvis freqüents</strong></td>
          <td>Millor (no recrea)</td>
          <td>Pitjor (recrea element)</td>
        </tr>
      </tbody>
    </table>

    {% include success_box.html contingut="<strong>Clau:</strong> Utilitzeu *ngIf per defecte; [hidden] només si l'element canvia molt sovint." %}

    <h4>2.10.3. Resultat esperat</h4>
    <p>Compreneu quan usar CSS vs *ngIf segons el cas d'ús.</p>
  {% endcapture %}
  {% include section-point.html numero="2.10" titol="Diferència entre amagar (CSS) i no renderitzar" contingut=section_point_2_10 %}

  {% capture section_point_2_11 %}
    <h4>2.11.1. Objectiu</h4>
    <p>Consolidar recomanacions per utilitzar directives condicionals de forma professional.</p>

    <h4>2.11.2. Contingut</h4>

    <p><strong>1. Utilitzar tipus union per estats:</strong></p>

    {% capture code_205 %}// Correcte
type Estat = 'carregant' | 'error' | 'buit' | 'ok';

// Incorrecte
estat: string; // Permet qualsevol valor{% endcapture %}
    {% include code-block.html lang="typescript" code=code_205 %}

    <p><strong>2. Lògica al component, no a la plantilla:</strong></p>

    {% capture code_206 %}// Correcte
get teElementsDisponibles(): boolean {
  return this.elements.length > 0 && !this.carregant;
}

<!-- Plantilla -->
<div *ngIf="teElementsDisponibles">...</div>

// Incorrecte (lògica a plantilla)
<div *ngIf="elements.length > 0 && !carregant && !error">...</div>{% endcapture %}
    {% include code-block.html lang="typescript" code=code_206 %}

    <p><strong>3. ngSwitch per 3+ opcions:</strong></p>

    {% capture code_207 %}<!-- Correcte amb 4 opcions -->
<div [ngSwitch]="estat">
  <p *ngSwitchCase="'carregant'">...</p>
  <p *ngSwitchCase="'error'">...</p>
  <p *ngSwitchCase="'buit'">...</p>
  <p *ngSwitchCase="'ok'">...</p>
</div>

<!-- Acceptable amb 2 opcions -->
<p *ngIf="disponible; else carregant">...</p>{% endcapture %}
    {% include code-block.html lang="html" code=code_207 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Seguir aquestes pràctiques garanteix codi mantenible i sense errors de tipus." %}

    <h4>2.11.3. Resultat esperat</h4>
    <p>Apliqueu bones pràctiques professionals amb directives condicionals.</p>
  {% endcapture %}
  {% include section-point.html numero="2.11" titol="Bones pràctiques: quan usar cada opció" contingut=section_point_2_11 %}

  {% capture section_point_2_12 %}
    <p><strong>Component TypeScript:</strong></p>

    {% capture code_208 %}// cataleg.component.ts
type Estat = 'carregant' | 'error' | 'buit' | 'ok';

export class CatalegComponent {
  estat: Estat = 'carregant';
  elements: Element[] = [];
  error = '';

  carregarElements(): void {
    this.estat = 'carregant';
    this.servei.obtenirElements().subscribe({
      next: (data) => {
        this.elements = data;
        this.estat = data.length > 0 ? 'ok' : 'buit';
      },
      error: () => {
        this.estat = 'error';
        this.error = 'Error en carregar';
      }
    });
  }
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_208 %}

    <p><strong>Plantilla HTML:</strong></p>

    {% capture code_209 %}<!-- cataleg.component.html -->
<div [ngSwitch]="estat">
  <p *ngSwitchCase="'carregant'">Carregant...</p>
  <p *ngSwitchCase="'error'">{% raw %}{{ error }}{% endraw %}</p>
  <p *ngSwitchCase="'buit'">Buit</p>
  <ul *ngSwitchCase="'ok'">
    <li *ngFor="let el of elements">{% raw %}{{ el.titol }}{% endraw %}</li>
  </ul>
</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_209 %}
  {% endcapture %}
  {% include section-point.html numero="2.12" titol="Mini exemple consolidat" contingut=section_point_2_12 %}

  {% capture section_point_2_13 %}
    <table>
      <thead>
        <tr>
          <th>Símptoma</th>
          <th>Causa</th>
          <th>Solució</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>"Can't bind to 'ngSwitch'"</td>
          <td>Falta CommonModule</td>
          <td>Afegir <code>CommonModule</code> a imports</td>
        </tr>
        <tr>
          <td>ng-template no es mostra</td>
          <td>Referència incorrecta</td>
          <td>Verificar <code>#nom</code> coincideix amb <code>else nom</code></td>
        </tr>
        <tr>
          <td>Estat no canvia</td>
          <td>Propietat no s'actualitza</td>
          <td>Verificar assignació al component</td>
        </tr>
        <tr>
          <td>Element visible quan no hauria</td>
          <td>Condició sempre certa</td>
          <td>Revisar lògica booleana</td>
        </tr>
      </tbody>
    </table>
  {% endcapture %}
  {% include section-point.html numero="2.13" titol="Resolució de problemes" contingut=section_point_2_13 %}

  {% capture section_point_2_14 %}
  {% capture prompt_1 %}<strong>Rol:</strong> mentor components. <strong>Context:</strong> reforçar ús de <code>*ngIf</code> amb plantilles alternatives. <strong>Tasca:</strong> crea taula amb 3 escenaris (sense dades, amb error, amb dades) indicant condició, contingut principal i plantilla alternativa. <strong>Format:</strong> taula Markdown.{% endcapture %}
  {% include prompt-ai.html contingut=prompt_1 %}

  {% capture prompt_2 %}<strong>Rol:</strong> tècnica suport. <strong>Context:</strong> alumne diu que estat d'error no mostra missatge. <strong>Tasca:</strong> checklist 5 passos (valor <code>estatLlista</code>, missatge, <code>ngSwitchCase</code>, CSS, consola) amb acció i resultat esperat. <strong>Format:</strong> llista numerada.{% endcapture %}
  {% include prompt-ai.html contingut=prompt_2 %}

  {% capture prompt_3 %}<strong>Rol:</strong> formadora Angular. <strong>Context:</strong> explicar diferència amagar CSS vs no renderitzar. <strong>Tasca:</strong> crea comparativa 6 aspectes (DOM, accessibilitat, rendiment, SEO, animacions, seguretat). <strong>Format:</strong> taula 3 columnes.{% endcapture %}
  {% include prompt-ai.html contingut=prompt_3 %}
  {% endcapture %}
  {% include section-point.html numero="2.14" titol="Prompts d'IA" contingut=section_point_2_14 %}

  {% capture section_point_2_15 %}
    <h4>Conceptes teòrics</h4>
    {% include checklist.html elements="Comprenc la diferència entre ocultar amb CSS i no renderitzar amb *ngIf|Entenc com funciona ng-template i quan es renderitza|Sé explicar quan usar ngSwitch vs múltiples *ngIf|Comprenc els 4 estats habituals d'una interfície (loading, empty, error, success)" %}

    <h4>Habilitats pràctiques</h4>
    {% capture checklist_practiques %}Sé utilitzar *ngIf amb condicions simples i negació|He implementat plantilles alternatives amb else i ng-template|Utilitzo ngSwitch per gestionar múltiples opcions exclusives|He creat una màquina d'estats amb tipus union TypeScript|Puc aplicar Bootstrap Icons per indicar estats visualment|Sé implementar botons de test per simular diferents estats{% endcapture %}
    {% include checklist.html elements=checklist_practiques %}

    <h4>Resolució de problemes</h4>
    {% include checklist.html elements="Sé què fer si ng-template no es mostra (verificar referència)|Puc diagnosticar problemes amb ngSwitch (CommonModule, sintaxi)|Entenc quan usar CSS vs *ngIf segons el cas d'ús" %}
  {% endcapture %}
  {% include section-point.html numero="2.15" titol="Autoavaluació" contingut=section_point_2_15 %}

  {% capture section_point_2_16 %}
    <h4>Què heu après</h4>
    <p>Heu integrat directives condicionals per gestionar el renderitzat d'elements segons condicions i estats de la interfície. Heu comprès la diferència fonamental entre ocultar amb CSS i no renderitzar amb <code>*ngIf</code>, millorant accessibilitat i rendiment. Heu dominat <code>*ngIf</code> amb sintaxi bàsica i avançada (else, ng-template) per controlar quins elements es renderitzen al DOM. Heu aplicat <code>ngSwitch</code> per gestionar múltiples opcions exclusives de manera clara, evitant encadenar condicionals. Heu implementat una màquina d'estats completa amb els 4 escenaris habituals (carregant, error, buit, disponible), preparant la interfície per integrar dades reals de serveis. Heu consolidat bones pràctiques: tipus union per garantir estats vàlids, lògica al component per mantenir plantilles declaratives, i documentació per facilitar mantenibilitat. Amb aquests coneixements, esteu preparats per crear interfícies reactives que responen adequadament a diferents escenaris i proporcionen una experiència d'usuari professional.</p>
  {% endcapture %}
  {% include section-point.html numero="2.16" titol="Síntesi" contingut=section_point_2_16 %}

  {% capture section_point_2_17 %}
  {% include definicio.html terme="Directiva condicional" definicio="Eina que controla si un element es renderitza al DOM segons una condició booleana." %}

  {% include definicio.html terme="*ngIf" definicio="Directiva que renderitza element si condició és certa, el destrueix si és falsa." %}

  {% include definicio.html terme="else" definicio="Sintaxi per definir contingut alternatiu quan condició és falsa." %}

  {% include definicio.html terme="ng-template" definicio="Contenidor que no es renderitza fins referenciada des d'un else o then." %}

  {% include definicio.html terme="ngSwitch" definicio="Directiva per seleccionar una plantilla entre múltiples opcions exclusives." %}

  {% include definicio.html terme="*ngSwitchCase" definicio="Cas específic dins d'un ngSwitch que es renderitza si coincideix amb el valor." %}

  {% include definicio.html terme="*ngSwitchDefault" definicio="Cas per defecte que es renderitza si cap *ngSwitchCase coincideix." %}

  {% include definicio.html terme="Tipus union" definicio="Definició TypeScript que limita valors possibles (e.g., <code>'a' | 'b' | 'c'</code>)." %}
  {% endcapture %}
  {% include section-point.html numero="2.17" titol="Repàs de conceptes" contingut=section_point_2_17 %}

</div>

<!-- SECCIÓ 3: Transformadors de dades (pipes) -->
<div class="section" id="Unitat2_Bloc2_Seccio3">
  <h2 id="Unitat2_Bloc2_Seccio3">3. Transformadors de dades (pipes)</h2>

  <!-- MULTIMÈDIA -->
  {% include multimedia-youtube.html unitat=2 bloc=2 seccio=3 %}


  {% include objectius.html llista="Utilitzar transformadors integrats (date, currency, percent, uppercase, lowercase) per formatar dades de presentació sense modificar l'origen|Aplicar paràmetres als transformadors per personalitzar el resultat segons les necessitats de cada context (format de data, moneda, decimals)|Encadenar múltiples transformadors per combinar transformacions de manera declarativa a la plantilla|Documentar criteris sobre quan transformar a la plantilla i quan preparar dades derivades a la classe del component" %}

  {% include info_box.html contingut="<strong>RA2 · Criteri 2</strong> — Mostra informació dinàmica utilitzant tècniques de vinculació de dades i plantilles." %}

  {% capture section_point_3_1 %}
    <p>Abans de començar aquesta lectura, necessiteu:</p>
    <ul>
      <li><strong>Lectures 2.2.1 i 2.2.2 completades:</strong> La llista d'elements del catàleg es mostra correctament amb <code>*ngFor</code> i les directives condicionals gestionen els diferents estats.</li>
      <li><strong>Projecte funcional:</strong> <code>cataleg-elements</code> amb <code>ng serve</code> executant-se.</li>
      <li><strong>Dades de prova:</strong> L'array <code>elementsCataleg</code> conté almenys 3-4 elements amb informació variada.</li>
    </ul>

    <p><strong>Verificació ràpida:</strong></p>

    {% capture code_210 %}# Comproveu que el servidor funciona
ng serve

# Al navegador, obriu: http://localhost:4200
# Heu de veure la llista d'elements sense errors{% endcapture %}
    {% include code-block.html lang="bash" code=code_210 %}

    <p><strong>Punt d'autocomprovació:</strong> Observeu que <code>elementsCataleg</code> i <code>estatLlista</code> estan definits al component i que el navegador mostra correctament la llista.</p>
  {% endcapture %}
  {% include section-point.html numero="3.1" titol="Prerequisits" contingut=section_point_3_1 %}

  {% capture section_point_3_2 %}
    <h4>3.2.1. Què són els transformadors (pipes)</h4>

    <p>Els <strong>transformadors (pipes)</strong> són filtres de presentació que permeten <strong>formatar les dades</strong> que es mostren a la plantilla sense alterar les dades originals del component. Angular proporciona transformadors integrats (<code>date</code>, <code>uppercase</code>, <code>lowercase</code>, <code>currency</code>, <code>percent</code>, <code>number</code>, <code>titlecase</code>) que s'apliquen amb l'operador de canonada (<code>|</code>).</p>

    <h4>3.2.2. Problema sense transformadors</h4>

    <p>Imagineu que teniu un element del catàleg amb aquesta informació:</p>

    {% capture code_211 %}export class AppComponent {
  elementsCataleg = [
    {
      id: 2,
      titol: 'Catàleg de colors corporatius',
      preu: 49.99,
      dataActualitzacio: '2025-01-15T10:00:00Z',
      categoria: 'paletes',
      percentatgeDisponibilitat: 0.85
    }
  ];
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_211 %}

    <p><strong>Voleu mostrar aquestes dades de manera llegible:</strong></p>
    <ul>
      <li>El preu <code>49.99</code> hauria de mostrar-se com <code>49,99 €</code></li>
      <li>La data ISO hauria de ser <code>15 de gener de 2025</code></li>
      <li>La categoria hauria d'aparèixer com <code>PALETES</code></li>
      <li>El percentatge <code>0.85</code> hauria de mostrar-se com <code>85%</code></li>
    </ul>

    <p><strong>Sense transformadors, heu de crear mètodes al component:</strong></p>

    {% capture code_212 %}// Component amb formatació manual - NO RECOMANAT
export class AppComponent {
  elementsCataleg = [/* ... */];

  formatarPreu(preu: number): string {
    return `${preu.toFixed(2).replace('.', ',')} €`;
  }

  formatarData(dataISO: string): string {
    const data = new Date(dataISO);
    const mesos = ['gener', 'febrer', 'març', /*...*/];
    return `${data.getDate()} de ${mesos[data.getMonth()]} de ${data.getFullYear()}`;
  }

  formatarCategoria(categoria: string): string {
    return categoria.toUpperCase();
  }

  formatarPercentatge(decimal: number): string {
    return `${Math.round(decimal * 100)}%`;
  }
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_212 %}

    <p><strong>Problemes que genera:</strong></p>
    <ul>
      <li><strong>Barreja de responsabilitats:</strong> La classe conté lògica de presentació barrejada amb lògica de negoci.</li>
      <li><strong>Codi repetitiu:</strong> Si necessiteu formatar preus a diversos components, heu de copiar el mètode.</li>
      <li><strong>Rendiment degradat:</strong> Cridar mètodes a la plantilla provoca execucions en cada cicle de detecció de canvis.</li>
      <li><strong>Localització complicada:</strong> Adaptar formats a diferents idiomes requereix modificar manualment cada mètode.</li>
    </ul>

    <h4>3.2.3. Solució amb transformadors (pipes)</h4>

    <p>Angular ofereix transformadors integrats que resolen aquests problemes:</p>

    {% capture code_213 %}// Component net, sense lògica de formatació
export class AppComponent {
  elementsCataleg = [
    {
      id: 2,
      titol: 'Catàleg de colors corporatius',
      preu: 49.99,
      dataActualitzacio: '2025-01-15T10:00:00Z',
      categoria: 'paletes',
      percentatgeDisponibilitat: 0.85
    }
  ];
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_213 %}

    {% capture code_214 %}<!-- Plantilla amb transformadors declaratius -->
<li *ngFor="let element of elementsCataleg">
  <h3>{% raw %}{{ element.titol }}{% endraw %}</h3>
  <p>Preu: {% raw %}{{ element.preu | currency:'EUR':'symbol':'1.2-2':'ca-ES' }}{% endraw %}</p>
  <p>Actualitzat: {% raw %}{{ element.dataActualitzacio | date:'d MMMM yyyy':'':'ca' }}{% endraw %}</p>
  <p>Categoria: {% raw %}{{ element.categoria | uppercase }}{% endraw %}</p>
  <p>Disponibilitat: {% raw %}{{ element.percentatgeDisponibilitat | percent:'1.0-0':'ca' }}{% endraw %}</p>
</li>{% endcapture %}
    {% include code-block.html lang="html" code=code_214 %}

    <p><strong>Avantatges:</strong></p>
    <ul>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Separació clara:</strong> La classe conté només dades i lògica de negoci.</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Reutilitzable:</strong> Els transformadors es poden utilitzar en qualsevol plantilla.</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Rendiment optimitzat:</strong> S'executen només quan les dades canvien.</li>
      <li><i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i> <strong>Localització automàtica:</strong> Respecten la configuració <code>LOCALE_ID</code>.</li>
    </ul>

    <h4>3.2.4. Taula comparativa</h4>

    <table>
      <thead>
        <tr>
          <th>Aspecte</th>
          <th>Sense pipes</th>
          <th>Amb pipes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Línies de codi</strong></td>
          <td>40-50</td>
          <td>5-10</td>
        </tr>
        <tr>
          <td><strong>Responsabilitats</strong></td>
          <td>Barrejades</td>
          <td>Separades</td>
        </tr>
        <tr>
          <td><strong>Reutilització</strong></td>
          <td>Baixa (copiar mètodes)</td>
          <td>Alta (declaratiu)</td>
        </tr>
        <tr>
          <td><strong>Rendiment</strong></td>
          <td>Baix (execució constant)</td>
          <td>Alt (pure pipes)</td>
        </tr>
        <tr>
          <td><strong>Localització</strong></td>
          <td>Manual</td>
          <td>Automàtica</td>
        </tr>
        <tr>
          <td><strong>Testabilitat</strong></td>
          <td>Difícil</td>
          <td>Fàcil (aïllada)</td>
        </tr>
      </tbody>
    </table>
  {% endcapture %}
  {% include section-point.html numero="3.2" titol="Marc conceptual" contingut=section_point_3_2 %}

  {% capture section_point_3_3 %}
    <h4>3.3.1. Flux amb transformadors</h4>

    {% capture code_215 %}[Dada original] → | transformador → [Dada formatada (només visualment)]
                                ↓
                    [Dada original NO canvia al component]{% endcapture %}
    {% include code-block.html lang="text" code=code_215 %}

    <h4>3.3.2. Diferència clau</h4>

    {% capture code_216 %}Component:  preu = 49.99
Plantilla:  {% raw %}{{ preu | currency:'EUR' }}{% endraw %}  →  49,99 €
Component:  preu segueix sent 49.99 (NO canvia){% endcapture %}
    {% include code-block.html lang="text" code=code_216 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Els transformadors són NOMÉS per presentació. Les dades originals NO es modifiquen." %}

    <h4>3.3.3. Operador de canonada (|)</h4>

    <p>L'operador <code>|</code> s'utilitza per aplicar transformadors:</p>

    {% capture code_217 %}{% raw %}{{ valor | transformador }}{% endraw %}
{% raw %}{{ valor | transformador:param1:param2 }}{% endraw %}
{% raw %}{{ valor | transformador1 | transformador2 }}{% endraw %}{% endcapture %}
    {% include code-block.html lang="html" code=code_217 %}
  {% endcapture %}
  {% include section-point.html numero="3.3" titol="Model mental" contingut=section_point_3_3 %}

  {% capture section_point_3_4 %}
    <h4>3.4.1. Objectiu</h4>
    <p>Comprendre la funció i necessitat dels transformadors com a mecanisme de formatació declarativa.</p>

    <h4>3.4.2. Contingut</h4>

    <p>Els transformadors són eines de presentació que s'apliquen a les dades just abans de mostrar-les. Angular els proporciona com a classes independents amb un únic propòsit: formatar valors sense alterar-los.</p>

    <p><strong>Així funciona internament:</strong></p>

    {% capture code_218 %}@Pipe({ name: 'uppercase' })
export class UpperCasePipe implements PipeTransform {
  transform(value: string): string {
    return value.toUpperCase();
  }
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_218 %}

    <p>Quan escriviu <code>{% raw %}{{ 'hola' | uppercase }}{% endraw %}</code>, Angular:</p>
    <ol>
      <li>Detecta l'operador <code>|</code> i identifica el pipe <code>uppercase</code></li>
      <li>Crida <code>UpperCasePipe.transform('hola')</code></li>
      <li>Rep el resultat <code>'HOLA'</code></li>
      <li>Mostra <code>HOLA</code> al navegador</li>
    </ol>

    <p><strong>Transformadors integrats d'Angular:</strong></p>
    <ul>
      <li><code>date</code>: formata dates i hores</li>
      <li><code>currency</code>: formata valors monetaris</li>
      <li><code>percent</code>: formata decimals com a percentatges</li>
      <li><code>uppercase</code> / <code>lowercase</code>: converteix text</li>
      <li><code>number</code>: formata números amb separadors</li>
      <li><code>titlecase</code>: primera lletra de cada paraula en majúscula</li>
    </ul>

    {% include success_box.html contingut="<strong>Clau:</strong> Els transformadors són filtres de presentació que s'apliquen amb |, formatant dades sense modificar-les." %}

    <h4>3.4.3. Resultat esperat</h4>
    <p>Enteneu què són els transformadors, per què existeixen, i com Angular els utilitza.</p>
  {% endcapture %}
  {% include section-point.html numero="3.4" titol="Què són els transformadors (pipes): filtres de presentació" contingut=section_point_3_4 %}

  {% capture section_point_3_5 %}
    <h4>3.5.1. Objectiu</h4>
    <p>Aprendre la sintaxi fonamental per aplicar transformadors a la plantilla.</p>

    <h4>3.5.2. Contingut</h4>

    <p><strong>Sintaxi general:</strong></p>

    {% capture code_219 %}{% raw %}{{ valor | nomTransformador }}{% endraw %}{% endcapture %}
    {% include code-block.html lang="html" code=code_219 %}

    <p><strong>Exemple amb uppercase:</strong></p>

    {% capture code_220 %}<p>{% raw %}{{ 'catàleg' | uppercase }}{% endraw %}</p>
<!-- Mostra: CATÀLEG -->{% endcapture %}
    {% include code-block.html lang="html" code=code_220 %}

    <p><strong>Aplicar a diferents expressions:</strong></p>

    {% capture code_221 %}<!-- Propietat del component -->
<h3>{% raw %}{{ element.categoria | uppercase }}{% endraw %}</h3>

<!-- Literal -->
<p>{% raw %}{{ 'text constant' | lowercase }}{% endraw %}</p>

<!-- Resultat d'operació -->
<span>{% raw %}{{ element.preu * 1.21 | number:'1.2-2' }}{% endraw %}</span>{% endcapture %}
    {% include code-block.html lang="html" code=code_221 %}

    <p><strong>Transformadors amb paràmetres:</strong></p>

    {% capture code_222 %}{% raw %}{{ valor | transformador:param1:param2:param3 }}{% endraw %}{% endcapture %}
    {% include code-block.html lang="html" code=code_222 %}

    {% capture code_223 %}<!-- Exemple date amb format personalitzat -->
<p>{% raw %}{{ element.data | date:'dd/MM/yyyy' }}{% endraw %}</p>
<!-- Mostra: 15/01/2025 -->

<!-- Exemple currency amb moneda -->
<p>{% raw %}{{ element.preu | currency:'EUR':'symbol':'1.2-2' }}{% endraw %}</p>
<!-- Mostra: 49,99 € -->{% endcapture %}
    {% include code-block.html lang="html" code=code_223 %}

    {% include success_box.html contingut="<strong>Clau:</strong> L'operador | aplica transformadors; els paràmetres es passen amb : després del nom." %}

    <h4>3.5.3. Resultat esperat</h4>
    <p>Sabeu utilitzar la sintaxi bàsica <code>|</code> i passar paràmetres als transformadors.</p>
  {% endcapture %}
  {% include section-point.html numero="3.5" titol="Sintaxi bàsica: operador de canonada |" contingut=section_point_3_5 %}

  {% capture section_point_3_6 %}
    <h4>3.6.1. Objectiu</h4>
    <p>Utilitzar els transformadors integrats més comuns per formatar dades.</p>

    <h4>3.6.2. Contingut</h4>

    <p><strong>1. uppercase / lowercase:</strong></p>

    {% capture code_224 %}<p>{% raw %}{{ 'catàleg' | uppercase }}{% endraw %}</p>  <!-- CATÀLEG -->
<p>{% raw %}{{ 'TÍTOL' | lowercase }}{% endraw %}</p>      <!-- títol -->{% endcapture %}
    {% include code-block.html lang="html" code=code_224 %}

    <p><strong>2. date:</strong></p>

    {% capture code_225 %}<p>{% raw %}{{ element.data | date:'short' }}{% endraw %}</p>         <!-- 15/1/25, 10:30 -->
<p>{% raw %}{{ element.data | date:'dd/MM/yyyy' }}{% endraw %}</p>   <!-- 15/01/2025 -->
<p>{% raw %}{{ element.data | date:'fullDate':'':'ca' }}{% endraw %}</p> <!-- dimecres, 15 de gener de 2025 -->{% endcapture %}
    {% include code-block.html lang="html" code=code_225 %}

    <p><strong>3. currency:</strong></p>

    {% capture code_226 %}<p>{% raw %}{{ 49.99 | currency:'EUR' }}{% endraw %}</p>                          <!-- €49,99 -->
<p>{% raw %}{{ 49.99 | currency:'EUR':'symbol' }}{% endraw %}</p>                <!-- €49,99 -->
<p>{% raw %}{{ 49.99 | currency:'EUR':'symbol':'1.2-2':'ca-ES' }}{% endraw %}</p> <!-- 49,99 € -->{% endcapture %}
    {% include code-block.html lang="html" code=code_226 %}

    <p><strong>4. percent:</strong></p>

    {% capture code_227 %}<p>{% raw %}{{ 0.85 | percent }}{% endraw %}</p>              <!-- 85% -->
<p>{% raw %}{{ 0.8567 | percent:'1.2-2' }}{% endraw %}</p>  <!-- 85,67% -->{% endcapture %}
    {% include code-block.html lang="html" code=code_227 %}

    <p><strong>5. number:</strong></p>

    {% capture code_228 %}<p>{% raw %}{{ 1234.56 | number }}{% endraw %}</p>           <!-- 1.234,56 -->
<p>{% raw %}{{ 1234.56 | number:'1.0-0' }}{% endraw %}</p>  <!-- 1.235 -->{% endcapture %}
    {% include code-block.html lang="html" code=code_228 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Els transformadors integrats cobreixen els casos més habituals sense necessitat de codi personalitzat." %}

    <h4>3.6.3. Resultat esperat</h4>
    <p>Sabeu utilitzar uppercase, lowercase, date, currency, percent i number.</p>
  {% endcapture %}
  {% include section-point.html numero="3.6" titol="Transformadors integrats" contingut=section_point_3_6 %}

  {% capture section_point_3_7 %}
    <h4>3.7.1. Objectiu</h4>
    <p>Personalitzar el resultat dels transformadors amb paràmetres.</p>

    <h4>3.7.2. Contingut</h4>

    <p><strong>Format de data personalitzat:</strong></p>

    {% capture code_229 %}<!-- Diferents formats -->
<p>{% raw %}{{ data | date:'short' }}{% endraw %}</p>              <!-- 15/1/25, 10:30 -->
<p>{% raw %}{{ data | date:'medium' }}{% endraw %}</p>             <!-- 15 gen. 2025, 10:30:00 -->
<p>{% raw %}{{ data | date:'long' }}{% endraw %}</p>               <!-- 15 de gener de 2025, 10:30:00 GMT+1 -->
<p>{% raw %}{{ data | date:'fullDate' }}{% endraw %}</p>           <!-- dimecres, 15 de gener de 2025 -->
<p>{% raw %}{{ data | date:'dd/MM/yyyy HH:mm' }}{% endraw %}</p>   <!-- 15/01/2025 10:30 -->{% endcapture %}
    {% include code-block.html lang="html" code=code_229 %}

    <p><strong>Moneda amb símbol personalitzat:</strong></p>

    {% capture code_230 %}<!-- Paràmetres: codi moneda : display : digitsInfo : locale -->
<p>{% raw %}{{ 49.99 | currency:'EUR':'symbol':'1.2-2':'ca-ES' }}{% endraw %}</p>  <!-- 49,99 € -->
<p>{% raw %}{{ 49.99 | currency:'USD':'symbol':'1.2-2':'en-US' }}{% endraw %}</p>  <!-- $49.99 -->
<p>{% raw %}{{ 49.99 | currency:'EUR':'code' }}{% endraw %}</p>                    <!-- EUR 49,99 -->{% endcapture %}
    {% include code-block.html lang="html" code=code_230 %}

    <p><strong>Decimals personalitzats:</strong></p>

    {% capture code_231 %}<!-- Format: 'minIntegerDigits.minFractionDigits-maxFractionDigits' -->
<p>{% raw %}{{ 1234.5 | number:'1.0-0' }}{% endraw %}</p>   <!-- 1.235 (arrodonit) -->
<p>{% raw %}{{ 1234.5 | number:'1.2-2' }}{% endraw %}</p>   <!-- 1.234,50 -->
<p>{% raw %}{{ 5 | number:'3.0-0' }}{% endraw %}</p>        <!-- 005 -->{% endcapture %}
    {% include code-block.html lang="html" code=code_231 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Els paràmetres permeten adaptar el format exacte a les necessitats de cada context." %}

    <h4>3.7.3. Resultat esperat</h4>
    <p>Sabeu personalitzar formats de data, moneda i decimals amb paràmetres.</p>
  {% endcapture %}
  {% include section-point.html numero="3.7" titol="Transformadors amb paràmetres" contingut=section_point_3_7 %}

  {% capture section_point_3_8 %}
    <h4>3.8.1. Objectiu</h4>
    <p>Combinar múltiples transformadors per aplicar transformacions complexes.</p>

    <h4>3.8.2. Contingut</h4>

    <p><strong>Sintaxi d'encadenament:</strong></p>

    {% capture code_232 %}{% raw %}{{ valor | transformador1 | transformador2 | transformador3 }}{% endraw %}{% endcapture %}
    {% include code-block.html lang="html" code=code_232 %}

    <p><strong>Exemple 1: Data formatada i en majúscules:</strong></p>

    {% capture code_233 %}<p>{% raw %}{{ element.data | date:'MMMM yyyy':'':'ca' | uppercase }}{% endraw %}</p>
<!-- gener 2025 → GENER 2025 -->{% endcapture %}
    {% include code-block.html lang="html" code=code_233 %}

    <p><strong>Exemple 2: Preu amb càlcul i format:</strong></p>

    {% capture code_234 %}<!-- Primer es calcula, després es formata -->
<p>Preu amb IVA: {% raw %}{{ (element.preu * 1.21) | currency:'EUR':'symbol':'1.2-2':'ca-ES' }}{% endraw %}</p>
<!-- 49.99 * 1.21 = 60.4879 → 60,49 € -->{% endcapture %}
    {% include code-block.html lang="html" code=code_234 %}

    <p><strong>Exemple 3: Text netejat i formatat:</strong></p>

    {% capture code_235 %}<p>{% raw %}{{ element.categoria | lowercase | titlecase }}{% endraw %}</p>
<!-- PALETES DE COLORS → paletes de colors → Paletes De Colors -->{% endcapture %}
    {% include code-block.html lang="html" code=code_235 %}

    <p><strong>Ordre d'execució:</strong> D'esquerra a dreta. El resultat del primer transformador és l'entrada del segon.</p>

    {% include success_box.html contingut="<strong>Clau:</strong> Encadenar transformadors permet combinar formatacions sense crear mètodes personalitzats." %}

    <h4>3.8.3. Resultat esperat</h4>
    <p>Sabeu encadenar múltiples transformadors per aplicar transformacions complexes.</p>
  {% endcapture %}
  {% include section-point.html numero="3.8" titol="Encadenar transformadors" contingut=section_point_3_8 %}

  {% capture section_point_3_9 %}
    <h4>3.9.1. Objectiu</h4>
    <p>Aplicar transformadors en casos reals del catàleg d'elements.</p>

    <h4>3.9.2. Contingut</h4>

    <p><strong>Cas 1: Targeta d'element amb informació formatada:</strong></p>

    {% capture code_236 %}<article class="targeta-element">
  <h3>{% raw %}{{ element.titol }}{% endraw %}</h3>
  <p class="categoria">{% raw %}{{ element.categoria | uppercase }}{% endraw %}</p>
  <p class="preu">{% raw %}{{ element.preu | currency:'EUR':'symbol':'1.2-2':'ca-ES' }}{% endraw %}</p>
  <p class="data">Actualitzat: {% raw %}{{ element.dataActualitzacio | date:'dd/MM/yyyy':'':'ca' }}{% endraw %}</p>
  <p class="disponibilitat">Disponibilitat: {% raw %}{{ element.percentatgeDisponibilitat | percent:'1.0-0' }}{% endraw %}</p>
</article>{% endcapture %}
    {% include code-block.html lang="html" code=code_236 %}

    <p><strong>Cas 2: Llista amb preus calculats:</strong></p>

    {% capture code_237 %}<ul>
  <li *ngFor="let el of elements">
    <span>{% raw %}{{ el.titol }}{% endraw %}</span>
    <span>Preu base: {% raw %}{{ el.preu | currency:'EUR' }}{% endraw %}</span>
    <span>Amb IVA: {% raw %}{{ (el.preu * 1.21) | currency:'EUR':'symbol':'1.2-2' }}{% endraw %}</span>
  </li>
</ul>{% endcapture %}
    {% include code-block.html lang="html" code=code_237 %}

    <p><strong>Cas 3: Indicador de descompte:</strong></p>

    {% capture code_238 %}<div *ngIf="element.descompte > 0">
  <p>Estalvieu: {% raw %}{{ element.descompte | percent:'1.0-0' }}{% endraw %}</p>
  <p>Preu final: {% raw %}{{ element.preu * (1 - element.descompte) | currency:'EUR' }}{% endraw %}</p>
</div>{% endcapture %}
    {% include code-block.html lang="html" code=code_238 %}

    {% include success_box.html contingut="<strong>Clau:</strong> Els transformadors permeten mostrar informació professional sense lògica de formatació al component." %}

    <h4>3.9.3. Resultat esperat</h4>
    <p>Sabeu aplicar transformadors en casos pràctics del catàleg.</p>
  {% endcapture %}
  {% include section-point.html numero="3.9" titol="Casos d'ús pràctics" contingut=section_point_3_9 %}

  {% capture section_point_3_10 %}
    <h4>3.10.1. Objectiu</h4>
    <p>Comprendre que els transformadors NO modifiquen les dades originals.</p>

    <h4>3.10.2. Contingut</h4>

    <p><strong>Exemple demostratiu:</strong></p>

    {% capture code_239 %}export class AppComponent {
  preu = 49.99;
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_239 %}

    {% capture code_240 %}<!-- Plantilla -->
<p>Original: {% raw %}{{ preu }}{% endraw %}</p>              <!-- 49.99 -->
<p>Formatat: {% raw %}{{ preu | currency:'EUR' }}{% endraw %}</p> <!-- 49,99 € -->
<p>Original de nou: {% raw %}{{ preu }}{% endraw %}</p>       <!-- 49.99 (no canvia!) -->{% endcapture %}
    {% include code-block.html lang="html" code=code_240 %}

    <p><strong>Implicacions:</strong></p>
    <ul>
      <li>Els transformadors són <strong>només per presentació</strong></li>
      <li>Les dades al component segueixen en format original</li>
      <li>Si necessiteu modificar les dades, feu-ho al component, NO amb pipes</li>
    </ul>

    <p><strong>Quan NO usar transformadors:</strong></p>
    <ul>
      <li>Càlculs complexos que necessiten resultat persistent</li>
      <li>Transformacions que s'han de guardar a base de dades</li>
      <li>Lògica de negoci (utilitzeu getters o mètodes al component)</li>
    </ul>

    {% include success_box.html contingut="<strong>Clau:</strong> Els transformadors són una capa de presentació. Les dades originals NO canvien mai." %}

    <h4>3.10.3. Resultat esperat</h4>
    <p>Compreneu les limitacions i quan NO usar transformadors.</p>
  {% endcapture %}
  {% include section-point.html numero="3.10" titol="Limitacions: no modifiquen dades originals" contingut=section_point_3_10 %}

  {% capture section_point_3_11 %}
    <h4>3.11.1. Objectiu</h4>
    <p>Entendre quan crear transformadors personalitzats (visió general).</p>

    <h4>3.11.2. Contingut</h4>

    <p><strong>Crear un transformador personalitzat quan:</strong></p>
    <ul>
      <li>Necessiteu una formatació específica del vostre domini (ex: format DNI, codi postal)</li>
      <li>Els transformadors integrats no cobreixen la vostra necessitat</li>
      <li>Teniu lògica de formatació repetida en múltiples components</li>
    </ul>

    <p><strong>Exemple conceptual (NO implementar ara):</strong></p>

    {% capture code_241 %}// Transformador personalitzat per formatar DNI
@Pipe({ name: 'dni' })
export class DniPipe implements PipeTransform {
  transform(value: string): string {
    // 12345678Z → 12.345.678-Z
    return value.replace(/(\d{2})(\d{3})(\d{3})(\w)/, '$1.$2.$3-$4');
  }
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_241 %}

    {% capture code_242 %}<!-- Ús -->
<p>DNI: {% raw %}{{ client.dni | dni }}{% endraw %}</p>{% endcapture %}
    {% include code-block.html lang="html" code=code_242 %}

    <p><strong>Criteris per decidir:</strong></p>
    <table>
      <thead>
        <tr>
          <th>Situació</th>
          <th>Solució</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Format estàndard (data, moneda)</td>
          <td>Usar transformador integrat</td>
        </tr>
        <tr>
          <td>Format específic domini (DNI, matrícula)</td>
          <td>Crear transformador personalitzat</td>
        </tr>
        <tr>
          <td>Càlcul complex amb estat</td>
          <td>Usar getter al component</td>
        </tr>
      </tbody>
    </table>

    {% include success_box.html contingut="<strong>Clau:</strong> Creeu transformadors personalitzats només quan els integrats no cobreixin la vostra necessitat." %}

    <h4>3.11.3. Resultat esperat</h4>
    <p>Sabeu quan considerar crear un transformador personalitzat.</p>
  {% endcapture %}
  {% include section-point.html numero="3.11" titol="Quan crear transformadors personalitzats" contingut=section_point_3_11 %}

  {% capture section_point_3_12 %}
    <p><strong>Component TypeScript:</strong></p>

    {% capture code_243 %}interface ElementCataleg {
  id: number;
  titol: string;
  categoria: string;
  preu: number;
  dataActualitzacio: string;
  percentatgeDisponibilitat: number;
}

export class AppComponent {
  elementsCataleg: ElementCataleg[] = [
    {
      id: 2,
      titol: 'catàleg de colors corporatius',
      categoria: 'paletes',
      preu: 49.99,
      dataActualitzacio: '2025-01-15T10:00:00Z',
      percentatgeDisponibilitat: 0.85
    }
  ];
}{% endcapture %}
    {% include code-block.html lang="typescript" code=code_243 %}

    <p><strong>Plantilla HTML amb transformadors:</strong></p>

    {% capture code_244 %}<article *ngFor="let element of elementsCataleg" class="targeta">
  <h3>{% raw %}{{ element.titol | titlecase }}{% endraw %}</h3>
  <span class="badge">{% raw %}{{ element.categoria | uppercase }}{% endraw %}</span>
  <p class="preu">{% raw %}{{ element.preu | currency:'EUR':'symbol':'1.2-2':'ca-ES' }}{% endraw %}</p>
  <p class="data">Actualitzat: {% raw %}{{ element.dataActualitzacio | date:'dd/MM/yyyy':'':'ca' }}{% endraw %}</p>
  <p class="disponibilitat">Disponibilitat: {% raw %}{{ element.percentatgeDisponibilitat | percent:'1.0-0' }}{% endraw %}</p>
</article>{% endcapture %}
    {% include code-block.html lang="html" code=code_244 %}
  {% endcapture %}
  {% include section-point.html numero="3.12" titol="Mini exemple pràctic" contingut=section_point_3_12 %}

  {% capture section_point_3_13 %}
    <table>
      <thead>
        <tr>
          <th>Símptoma</th>
          <th>Windows</th>
          <th>macOS/Linux</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Pipe no funciona</td>
          <td>Verificar importació <code>CommonModule</code></td>
          <td>Verificar importació <code>CommonModule</code></td>
        </tr>
        <tr>
          <td>Format incorrecte</td>
          <td>Comprovar paràmetres separats per <code>:</code></td>
          <td>Comprovar paràmetres separats per <code>:</code></td>
        </tr>
        <tr>
          <td>Locale no aplicat</td>
          <td>Configurar <code>LOCALE_ID</code> a <code>app.config.ts</code></td>
          <td>Configurar <code>LOCALE_ID</code> a <code>app.config.ts</code></td>
        </tr>
        <tr>
          <td>Data mostra ISO</td>
          <td>Afegir format: <code>date:'dd/MM/yyyy'</code></td>
          <td>Afegir format: <code>date:'dd/MM/yyyy'</code></td>
        </tr>
      </tbody>
    </table>
  {% endcapture %}
  {% include section-point.html numero="3.13" titol="Resolució de problemes (Win/macOS/Linux)" contingut=section_point_3_13 %}

  {% capture section_point_3_14 %}
  {% capture prompt_1 %}<strong>Rol:</strong> formadora Angular. <strong>Context:</strong> explicar diferència entre transformador i mètode al component. <strong>Tasca:</strong> crea taula comparativa 4 aspectes (executat quan, reutilització, rendiment, testabilitat). <strong>Format:</strong> taula Markdown 3 columnes.{% endcapture %}
  {% include prompt-ai.html contingut=prompt_1 %}

  {% capture prompt_2 %}<strong>Rol:</strong> mentor desenvolupament. <strong>Context:</strong> alumne pregunta quan usar pipe vs getter. <strong>Tasca:</strong> explica en 100 paraules: pipes per formatació presentació sense estat, getters per càlculs amb lògica negoci. Inclou 2 exemples. <strong>Format:</strong> paràgraf + 2 exemples codi.{% endcapture %}
  {% include prompt-ai.html contingut=prompt_2 %}

  {% capture prompt_3 %}<strong>Rol:</strong> experta pipes Angular. <strong>Context:</strong> ensenyar encadenament. <strong>Tasca:</strong> crea 3 exemples progressius encadenament: 1) data+uppercase, 2) preu+càlcul+currency, 3) text+lowercase+titlecase. Cada exemple amb entrada i sortida. <strong>Format:</strong> 3 blocs codi comentats.{% endcapture %}
  {% include prompt-ai.html contingut=prompt_3 %}
  {% endcapture %}
  {% include section-point.html numero="3.14" titol="Prompts d'IA" contingut=section_point_3_14 %}

  {% capture section_point_3_15 %}
    <h4>Conceptes teòrics</h4>
    {% include checklist.html elements="Comprenc què són els transformadors i per què existeixen|Entenc que els pipes NO modifiquen les dades originals|Sé explicar la diferència entre transformador i mètode al component|Comprenc com funciona l'operador de canonada |" %}

    <h4>Habilitats pràctiques</h4>
    {% capture checklist_practiques %}Sé utilitzar uppercase, lowercase, titlecase per formatar text|Puc aplicar date amb diferents formats personalitzats|Utilitzo currency amb símbols i decimals adequats|Sé formatar percentatges amb percent|Puc encadenar múltiples transformadors|Aplico transformadors en casos pràctics del catàleg{% endcapture %}
    {% include checklist.html elements=checklist_practiques %}

    <h4>Resolució de problemes</h4>
    {% include checklist.html elements="Sé què fer si un pipe no funciona (CommonModule)|Puc configurar LOCALE_ID per localització|Entenc quan crear un transformador personalitzat vs usar integrats" %}
  {% endcapture %}
  {% include section-point.html numero="3.15" titol="Autoavaluació" contingut=section_point_3_15 %}

  {% capture section_point_3_16 %}
    <h4>Què heu après</h4>
    <p>Heu integrat transformadors (pipes) per formatar dades de presentació sense modificar l'origen. Heu comprès que els transformadors són filtres declaratius aplicats amb l'operador de canonada (|) que separen la lògica de presentació de la lògica de negoci. Heu dominat els transformadors integrats més comuns: uppercase, lowercase, titlecase per text; date per dates amb formats personalitzats; currency per valors monetaris amb símbols adequats; percent per mostrar decimals com a percentatges; i number per formatar números amb separadors. Heu après a passar paràmetres als transformadors per personalitzar el resultat (format de data, moneda, decimals) i a encadenar múltiples transformadors per combinar transformacions complexes de manera declarativa. Heu aplicat aquests conceptes en casos pràctics del catàleg d'elements, creant targetes amb informació professional formatada. Heu comprès les limitacions dels transformadors (NO modifiquen dades originals) i quan considerar crear transformadors personalitzats per necessitats específiques del domini. Amb aquests coneixements, esteu preparats per crear interfícies amb presentació professional mantenint les dades en format adequat per a la lògica de negoci.</p>
  {% endcapture %}
  {% include section-point.html numero="3.16" titol="Síntesi" contingut=section_point_3_16 %}

  {% capture section_point_3_17 %}
  {% include definicio.html terme="Transformador (pipe)" definicio="Filtre de presentació que formata dades a la plantilla sense modificar l'origen." %}

  {% include definicio.html terme="Operador de canonada (|)" definicio="Símbol que aplica un transformador a un valor amb la sintaxi: valor | pipe." %}

  {% include definicio.html terme="uppercase / lowercase" definicio="Transformen text a majúscules o minúscules completament." %}

  {% include definicio.html terme="titlecase" definicio="Transforma la primera lletra de cada paraula a majúscula." %}

  {% include definicio.html terme="date" definicio="Formata dates amb patrons personalitzables (dd/MM/yyyy, fullDate, etc.)." %}

  {% include definicio.html terme="currency" definicio="Formata valors monetaris amb símbol de moneda i decimals." %}

  {% include definicio.html terme="percent" definicio="Transforma decimals a percentatges (0.85 → 85%)." %}

  {% include definicio.html terme="Encadenament" definicio="Aplicar múltiples transformadors consecutius amb la sintaxi: valor | pipe1 | pipe2." %}
  {% endcapture %}
  {% include section-point.html numero="3.17" titol="Repàs de conceptes" contingut=section_point_3_17 %}

</div>
