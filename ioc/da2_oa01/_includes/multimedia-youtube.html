<!--
  ════════════════════════════════════════════════════════════════
  Component: Enllaços multimèdia YouTube
  ════════════════════════════════════════════════════════════════

  Paràmetres:
    - unitat: número de la unitat (1-4)
    - bloc: número del bloc (1-4)
    - seccio: número de la secció (1-3)

  Exemple d'ús:
    {% raw %}{% include multimedia-youtube.html unitat=1 bloc=1 seccio=1 %}{% endraw %}

  El component busca automàticament les URLs corresponents a
  site.data.multimedia i mostra els botons de vídeo i àudio.
  ════════════════════════════════════════════════════════════════
-->

{% assign unitat_key = "unitat_" | append: include.unitat %}
{% assign multimedia_unitat = site.data.multimedia[unitat_key] %}

{% if multimedia_unitat %}
  {% comment %} Calcular índex de l'element dins de la unitat {% endcomment %}
  {% comment %} Fórmula lectures: (bloc-1)*3 + (seccio-1) {% endcomment %}
  {% comment %} Exemple: bloc=1, seccio=1 → (1-1)*3 + (1-1) = 0 (primer element) {% endcomment %}
  {% comment %} Exemple: bloc=2, seccio=1 → (2-1)*3 + (1-1) = 3 (quart element) {% endcomment %}
  {% comment %} Casos d'ús (bloc=4): sempre índex 9 (element 10è) {% endcomment %}

  {% if include.bloc == 4 %}
    {% assign index = 9 %}
  {% else %}
    {% assign bloc_minus_1 = include.bloc | minus: 1 %}
    {% assign seccio_minus_1 = include.seccio | minus: 1 %}
    {% assign index = bloc_minus_1 | times: 3 | plus: seccio_minus_1 %}
  {% endif %}

  {% assign multimedia_item = multimedia_unitat[index] %}

  {% if multimedia_item %}
<div class="multimedia-resources">
  <div class="multimedia-header">
    <i class="bi bi-play-circle-fill"></i>
    <span>Contingut multimèdia d'aquesta lectura</span>
  </div>

  <div class="multimedia-buttons">
    {% if multimedia_item.video_url %}
    <a href="{{ multimedia_item.video_url }}" target="_blank" rel="noopener noreferrer" class="multimedia-btn video-btn" title="{{ multimedia_item.video_title }}">
      <i class="bi bi-youtube"></i>
      <span>Veure vídeo</span>
      <i class="bi bi-box-arrow-up-right"></i>
    </a>
    {% endif %}

    {% if multimedia_item.audio_url %}
    <a href="{{ multimedia_item.audio_url }}" target="_blank" rel="noopener noreferrer" class="multimedia-btn audio-btn" title="{{ multimedia_item.audio_title }}">
      <i class="bi bi-mic-fill"></i>
      <span>Escoltar àudio</span>
      <i class="bi bi-box-arrow-up-right"></i>
    </a>
    {% endif %}
  </div>

  {% comment %} Información adicional opcional (comentada por defecto) {% endcomment %}
  {% comment %}
  <div class="multimedia-info">
    <small class="text-muted">
      <i class="bi bi-info-circle"></i>
      Els enllaços s'obren en una nova pestanya de YouTube
    </small>
  </div>
  {% endcomment %}
</div>
  {% else %}
    {% comment %} Debug: elemento no encontrado {% endcomment %}
    {% if jekyll.environment == "development" %}
<div class="multimedia-resources multimedia-error">
  <p><strong>⚠️ Advertència de desenvolupament:</strong> No s'ha trobat contingut multimèdia per Unitat {{ include.unitat }}, Bloc {{ include.bloc }}, Secció {{ include.seccio }} (índex calculat: {{ index }})</p>
</div>
    {% endif %}
  {% endif %}
{% else %}
  {% comment %} Debug: unidad no encontrada {% endcomment %}
  {% if jekyll.environment == "development" %}
<div class="multimedia-resources multimedia-error">
  <p><strong>⚠️ Advertència de desenvolupament:</strong> No s'ha trobat la unitat {{ include.unitat }} a multimedia.yml</p>
</div>
  {% endif %}
{% endif %}
